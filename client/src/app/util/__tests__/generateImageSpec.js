/**
 * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH
 * under one or more contributor license agreements. See the NOTICE file
 * distributed with this work for additional information regarding copyright
 * ownership.
 *
 * Camunda licenses this file to you under the MIT; you may not use this file
 * except in compliance with the MIT License.
 */

import generateImage from '../generateImage';

import { keys } from 'min-dash';

const EXCPECTED_JPEG_DATAURL = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCACQAJADASIAAhEBAxEB/8QAHQABAQABBQEBAAAAAAAAAAAAAAkHAQIECAoGA//EADQQAAEDAgUDAgQGAgIDAAAAAAECAwQABQYHCBESCSExEzIUIlGRQUJSYXGBM6EYwRUWI//EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCqdKUoFKUoFKUoFKVx59xt9qjKm3SdHhx0e52Q6ltCf5UogCg5FKx1ctR+nmzOLau+fOXUFbZ2WmTiiC0Un9wp0bUtuo7TzeXENWjPnLuctw7ITGxRBdKj+wS6d6DItK48C42+6xkzbZOjzI6/a6w6lxCv4UkkGuRQKUpQKUpQKUpQKUpQKUrataGkKccWlCEAqUpR2AA8kmg3V1n1N9QXT5phefw/iG9PYixc2jf/ANesvF19okfL8Q4SG447g7KPPY7hChXTrXh1Urj/AOQuWT+ly9pYjMcot0xlGVu46vwtu3q8JSO4+I8k929gEuKwrpB6ZGaepMx8yc158/B2CZyxKTJfb5XW8pUeRWwhz2IVvv67gIO4KUuAkgPzzp6rmqbOOa5YMt1s4Atcxz0Y8SwoL9ydCj8qVSlDnz322LKWjXwdt0Xa+8/paL9e8t8c3V50c/j8XXH4Zzifzbz3UuKB/YEmrV5GaUchNOdvRGyry8t9vm8OD13fT8RcX9xsecle6wD3+RJSgbnZIrLlBEG0dGzVvcmm3Jlzy/tSl+W5d5fUpH8+jHcH2Jpd+jZq3trLjkO55f3VSPDcS8vpUv8Aj1o7Y+5FW+pQefi46MNfeQEtd+smW+ObU60Ofx+Ebj8S5xH5t4DqnEgee4BFfeZLdV3VLk7NbsGZC2MwLXDc9GREvqCxcmgk7KSmUkc+e++5eQ6auXWI89NKOQeo23rjZqZe2+4TeHBm7sJ+HuLHbYcJCNlkDt8iipB2G6TQfCaZOoLp81PPM2DD16ew7i1xG5w9e+LL7pA7/DuAluQOxOyTz2G5QkV2XqG+r7plZqaa1P5k5Uz5+MMEwXDKMqOjjdLMlJ5Bb6G/ehO2/rtgAcSVJbGxObtB3VSnqn23J7VHekPMPcYtqxnJVstC/CG7go9lJPYfEdiDsXNwVOJCrVK2oWhxCXG1hSFAKSpJ3BB8EGt1ApSlApSlAqU/VQ15y0y7lpcydvYbaQlUbGV1iufMpR7Ktrax4AH+YjuSfS7bOJPcTX/qbOmDT9c8R2WShGLcQrNlw6nsVNyXEErk7fRlsKX3BHP00n3VMvpj6RBqTzWl5p5kwnJ+CcGykyJKZIK03i6qPNuOsq96E7+q6DvuC2kjZwmgzT03um3CvMK16hNQ1hLsV0omYawzMb+R5HZSJktB9yD2LbR7KGylApIBq8AAAANgKAAAADYCtaBSlKBSlKBSlKDQgKBSoAg9iDUoOpD024VlhXTUJp5sJZiM85eJcMw2/kYR5XMiIHtQO5caHZI3UnZIIFYK0ICgUqAIPYg0EqeldryluSrbpbzhvXqNrSI+DbtKc+ZKh7ba4s+QR/hJ7gj0u+7aRVeoa9TbSKNNWbETNDLaG7AwTjGSqTEEbdCbPdEnm5HQU+xB/wArW22wC0gbN7mnGgLU3/yg0/WzEt5kIViywLFlxEgbAuSW0Aok7fR5spX2AHP1Ej20HZKlKUClK49xnxrXb5NzmucI8Nlb7qv0oQkqUfsDQQ86smcs3NjVOvLqzPuyrXl/GbskWO1upLlwe4uSlJSO/MqU0yR9Y4/utukzIyBp0yAwjldHYQifChJk3h1OxL9yeHOSokeQFkoT9EIQPwqLWjq1y9R2v3C1+xC0HF3bFcvGNxC/mTyZU7OKVfUFxCUbeDy+legOgUpSgUpSgUpSgUpSgUpSgw/q1yMg6i9P+Lsr32ELuEyEqVZ3FbAs3Jn/AOkdQJ9oKwEKP6FrH41JbpM5yzMqdUqcubw+7FteYEVyzSWHd0pbuLPJyMpSfPPkl1kD6vmrk15+9YFsl6btf2Kb9h5kNrs+LImMLclHyp3eU1PCU/RIWtSNvA47eKD0CUrjwJsa5wY1yhuc48tpD7Sv1IUAUn7EVyKBWO9R1yXZtPOaF4bcKFwcGXuSlQOxSUQXlA/6rIlY61H25y8aec0bS02XFzcGXuMlAG5UVwXkgf7oJE9Gm1M3HVrcJjjfJVrwbcJbZ/SoyIjO/wBniP7q3dRD6NV1Zt2ra4RHXAlVzwbcIjY/UoSIru32aUf6q3lApSlApSlApSlApSlApSlAqIPWTtTNu1bwpbTYSq6YOt0tw/qUH5TO/wBmQP6q31RC6yd2ZuOreFDbc5KteDrdEcH6VF+U9t9ngf7oK+ad7ku86f8ALK7uOFa52DrLJUoncqK4TSif91kGseac7a5ZtPmWFodbLa4ODbLGUgjYpKILKSP9VkOgVx58GNc4Em2zWw5HlsrYdQfzIUkpUPsTXIpQefzRzdJWnPX9haw350NqtOLJmDrgV/Knk8p2CVK+gDi0q38Dj9K9AdQx6r+Tk7KPVW7mFZWXYlsx8w3fYkhrdIbuDXFuUlKvPMLS28fp8QP6rnpTzytuorITCWacN5CplwhJYuzSdgY9xaHCSgj8B6gKk/VCkH8aDLdKUoFKUoFKUoFKUoFKUoFefvWBc5Oo7X/imxWJ4OG8YuiYOgKR8yd2VNQApP1BWhS9/B5b+KtRqvzyt2nTIPFuaUt9CZsCEqPaGlbEv3J75IyAD5HMhSvohCz+FSP6T2TU3NrVQ3mHeWHZVry/juXyXId3UHLg7ybipUrzz5qceB/H4c/2FxYMONboUe3w2g3HitIZaQPCUJACR/QAr96UoFKUoOtWv/TCdUOQNxw7ZI6FYuw8s3nDqjsC5IQghcbc+A8glHcgBfpqPZNTM6Y2rwabc1ZeVuZE1yDgnGUlEeSqSShNouqTwbkLCvYhX+J0nbbZtRIDZBuRUo+qboJlom3PVFk5ZfVjvAycY2iK38za/wA1xaQPKT5eA7ggu9wXCkKtgggEHcGtalF03upHDtMO16etQt9LUdrhDw1iaW58jSPCIctZ9qR2Dbp7AbJVsACKuAgjcHcGg1pSlApSlApSlArQkAEk7AUJABJOwFSg6kPUkh3qHdNPenm/F2I6Vw8S4mhufI+jwuHEWPcg9w46OyhulO6SSQwt1N9Xf/JPNeLlblvNcnYJwbKXHimMStN4uqj6bkhAT70J3LTW2+4K1A7ObCm2gLTD/wAXcgLdhu9R2xi3ECxecRrGxLclxICIwUPKWUBKOxIK/UUOyq6cdLLQTLMy2aoc5LIG2WgmVg20ym/mWvym5OoPgDyyD3JPq9gGyqrVApSlApSlAratCHUKbcQlaFgpUlQ3BB8git1KCVOvHpXSnZdyzh0uWVC0OcpV1wZHTspKvK3bePBB8mP227+nvulsYN0j9TjNnTZ6GXGadvnYzwZBcEURZLhRdbOlJ4lDDjnvSnx6LmwHEJSpsb1ciut+pjQJp71PeteMT4fXYcVrTsnEVl4sSlnbt66SCiQOwHzpK9hslSaD67IzV1p81FQWXsssxbdJuLid3LNMWItyZO25BjrIUoD9SOSPoo1mKocZydJLVHljOfueXKLfmDaY6/UYkWp9MWelIPZSozqgee/4NLcP/WPLVq018aZpqMNXjHuPLEtocU2zF0FUkBA/KhE9tSkp8bcNv2oPQVSog2jrJ6t7a023MteX11Ujy5Lsz6VL/n0ZDY+wFLv1k9W9yacbh2zL+1KX4ciWZ9Skfx60hwfcGgt9WHM9NXmnzTrBeezNzFt0a4tp3bssNYlXJ07bgCOglSQf1L4o+qhUWLrqz18amZq8N2fHuPb8t0cFWzCMFUYFB/KtEBtJUnzvz37eayHk30kdUWZs5i5Zjot+X1pkL9R+RdH0yrgpJPdSIzSiee/4OrbP/YbNXPU2zZ1K+vlvldbpuDcFz3PhTEjOFd0vCVHiEPuI9qVePQb7HkQpTg22zroP6VslmXbc4dUdmQlLfGVasGSE8iVeUO3AeAB5Efvv29TbZTZ7i6aNAunvTD6N4wvh5d9xWhGy8RXri/KQdu/oJ2CI47kfIkK2OylKrshQbUIQ2hLbaEpQkBKUpGwAHgAVupSgUpSgUpSgUpSgUpSgVx59ut91jKhXSDHmR1+5qQ0lxCv5SoEGuRSgx1ctOGnm8LW7d8hsupy3DutUnC8F0qP7lTR3pbdOGnmzOIdtGQ2XUFbZ3QqNheC0Un9ilobVkWlBx4Fut9rjJhWyDHhx0e1phpLaE/wlIAFcilKBSlKBSlKBSlKD/9k=';

const EXPECTED_PNG_DATAURL = 'data:image/png;base64,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';

const expectedImagesByType = {
  png: EXPECTED_PNG_DATAURL,
  jpeg: EXCPECTED_JPEG_DATAURL
};

describe('util - generateImage', function() {

  this.timeout(5000);

  const svg = require('./diagram.svg'),
        outOfBoundsSVG = require('./out_of_bounds_diagram.svg'),
        webhookSVG = require('./webhook.svg');

  keys(expectedImagesByType).forEach(function(type) {

    it('should export <' + type + '>', async function() {

      const image = await generateImage(type, svg);

      expectToBeAnImage(image);
    });


    it('should automatically handle large images <' + type + '>', async function() {

      const image = await generateImage(type, outOfBoundsSVG);

      expectToBeAnImage(image);
    }).timeout(10000); // downscaling may exceed the default timeout 2000ms.


    it('should generate expected images <' + type + '>', async function() {

      const image = await generateImage(type, svg),
            expectedImage = expectedImagesByType[ type ];

      expect(image).to.be.eql(expectedImage);
    });


    it('should handle webhook icon <' + type + '>', async function() {

      const image = await generateImage(type, webhookSVG);

      expectToBeAnImage(image);
    });
  });

});


/**
 * If image cannot be generated properly it returns a data string with
 * 6 characters. If it is generated, image.length returns the actual size
 * of the generated image which is more than 6.
 */
function expectToBeAnImage(image) {
  expect(image).to.exist;
  expect(image.length).to.be.greaterThan(6);
}
