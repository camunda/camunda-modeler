/**
 * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH
 * under one or more contributor license agreements. See the NOTICE file
 * distributed with this work for additional information regarding copyright
 * ownership.
 *
 * Camunda licenses this file to you under the MIT; you may not use this file
 * except in compliance with the MIT License.
 */

import generateImage from '../generateImage';

import { keys } from 'min-dash';

const EXCPECTED_JPEG_DATAURL = 'data:image/jpeg;base64,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';

const EXPECTED_PNG_DATAURL = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJAAAACQCAYAAADnRuK4AAAAAXNSR0IArs4c6QAAEmhJREFUeF7tnQfsFEUbxl/sCqLYC6BijWILFqygImJBFHvBgogFFAtRsKAoqJAoil0sWBFRwYINFLEF7L0jqCgW7Ipdv/zG74zZm7nb25nZ272dJ7n8E9idnXn3ubl33trk77///lsCggQSSqBJIFBCyYXblAQCgQIRrCQQCGQlvnBzIFDggJUEAoGsxBduDgQKHLCSQCCQlfjCzYFAgQNWEggEshJfuDkQKHDASgKBQFbiCzcHAgUOWEkgEMhKfOHmQKDAASsJFJJAH374oXzwwQcyY8YMmTlzpvr76aefyg8//CA//fTTv5/vvvtOCXeJJZaQpk2b/vtZfPHFZaWVVpI11lhDVlttNVl99dWlTZs20rp1a6uXkcebG55AP/74ozzzzDPy1FNPydNPPy3Tp09XBPGBZs2aSfv27WWrrbaSrbfeWrbccktZbLHFfDwqM2M2JIHmzp0r119/vYwdO1ZefPHFugp7k002kf33318OPfRQWWaZZeo6Fx8PbxgC/fnnn/LQQw/JddddJ/fff7/8/vvvPuSVeMwFF1xQunXrJr169ZIdd9xR5ptvvsRjZenG3BPo+++/l0svvVSuvPJK+eSTT7IkW+NcWrZsKX369JFjjz1Wmjdvnos5myaZWwKh9F544YUyatQopfzmEZDnqKOOkpNOOklWWGGFPC4hfyGt77zzjpx33nly0003WQl8xRVXlLXWWkvWXnttdZpq27attGjRQlCEOWXxd+mll1bP+OqrrwRlHKLy9+uvv5bXX39d3n//fXn33XeFOX322WdW80FHGjhwoJpPnpCbHYiXd8opp8jVV18ttSaScOTedNNN1WezzTaTzTff3PlPB0f+adOmyXPPPac+zz77bM2katKkiRxzzDEyfPhwZTLIA3JBoEceeUQOO+wwmTNnTmyZLrXUUnLggQdKz549ZeONN459n8sLX3jhBbnhhhvktttuk2+++Sb20OhIHAY6d+4c+556XZh5Ah199NFq14kLTjhHHnmk7LPPPnFvSeW6cePGKX1t0qRJsZ/Xt29fdUDIMjJLIPSKvfbaS954442q8pt//vkVYc4880xZd911q15fzwtee+01GTp0qNx5552C6aEa1ltvPbnnnnuU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';

const expectedImagesByType = {
  png: EXPECTED_PNG_DATAURL,
  jpeg: EXCPECTED_JPEG_DATAURL
};

describe('util - generateImage', function() {

  const svg = require('./diagram.svg'),
        outOfBoundsSVG = require('./out_of_bounds_diagram.svg'),
        webhookSVG = require('./webhook.svg');

  keys(expectedImagesByType).forEach(function(type) {

    it('should export <' + type + '>', async function() {

      const image = await generateImage(type, svg);

      expectToBeAnImage(image);
    });


    it('should automatically handle large images <' + type + '>', async function() {

      const image = await generateImage(type, outOfBoundsSVG);

      expectToBeAnImage(image);
    }).timeout(10000); // downscaling may exceed the default timeout 2000ms.


    it('should generate expected images <' + type + '>', async function() {

      const image = await generateImage(type, svg),
            expectedImage = expectedImagesByType[ type ];

      expect(image).to.be.eql(expectedImage);
    });


    it('should handle webhook icon <' + type + '>', async function() {

      const image = await generateImage(type, webhookSVG);

      expectToBeAnImage(image);
    });
  });

});


/**
 * If image cannot be generated properly it returns a data string with
 * 6 characters. If it is generated, image.length returns the actual size
 * of the generated image which is more than 6.
 */
function expectToBeAnImage(image) {
  expect(image).to.exist;
  expect(image.length).to.be.greaterThan(6);
}
