"use strict";(self.webpackChunkcamunda_modeler_client=self.webpackChunkcamunda_modeler_client||[]).push([[8729],{2249:(e,t,n)=>{function o(e){return(e=e||document.activeElement)||(e=document.getSelection().focusNode),function(e){return"TEXTAREA"===e.tagName||"INPUT"===e.tagName||"true"===e.contentEditable}(e)}n.d(t,{v:()=>o})},34187:(e,t,n)=>{n.d(t,{A:()=>l,d:()=>s});var o=n(34942),r=n.n(o),i=n(60278),a=n.n(i)()(r());a.push([e.id,".Aa1q2MV_hdchoV3sn5og {\n  display: flex;\n  border-right: 1px solid var(--color-grey-225-10-75);\n  border-left: 1px solid var(--color-grey-225-10-75);\n  padding: 0 !important;\n}\n.Aa1q2MV_hdchoV3sn5og .btn {\n  padding: 0 10px;\n}\n.Aa1q2MV_hdchoV3sn5og .btn svg {\n  fill: currentColor;\n  margin-right: 5px;\n  width: 18px;\n  height: 18px;\n}\n","",{version:3,sources:["webpack://./src/app/tabs/form/FormPreviewToggle.less"],names:[],mappings:"AAAA;EACE,aAAA;EACA,mDAAA;EACA,kDAAA;EACA,qBAAA;AACF;AALA;EAOI,eAAA;AACJ;AARA;EAUM,kBAAA;EACA,iBAAA;EACA,WAAA;EACA,YAAA;AACN",sourcesContent:[":local(.FormPreviewToggle) {\n  display: flex;\n  border-right: 1px solid var(--color-grey-225-10-75);\n  border-left: 1px solid var(--color-grey-225-10-75);\n  padding: 0 !important;\n\n  .btn {\n    padding: 0 10px;\n\n    svg {\n      fill: currentColor;\n      margin-right: 5px;\n      width: 18px;\n      height: 18px;\n    }\n  }\n}"],sourceRoot:""}]);var s="Aa1q2MV_hdchoV3sn5og";const l=a},88729:(e,t,n)=>{n.r(t),n.d(t,{default:()=>$});var o=n(63696),r=n(29905),i=n(79171),a=n(99492),s=n(45782),l=n(95292),c=n.n(l),d=n(49893),h=n.n(d),A=n(9383),m=n.n(A),p=n(56884),u=n.n(p),f=n(99088),g=n.n(f),v=n(27997),y=n.n(v),E=n(90726),C={};C.styleTagTransform=y(),C.setAttributes=u(),C.insert=m().bind(null,"head"),C.domAPI=h(),C.insertStyleElement=g(),c()(E.A,C),E.A&&E.A.locals&&E.A.locals;var w=n(13);function P(e){const{inputActive:t}=e;return(0,w.Ox)(t)}function S(e){const{defaultUndoRedo:t}=e;return[t?(0,w.ce)(!0):(0,w.lP)(e),P(e),(0,w.$v)(e)]}function x({previewOpen:e}){return[{label:e?"Open design mode":"Open validation mode",accelerator:"CommandOrControl+P",action:e?"collapsePreview":"openPreview",options:{triggeredBy:Y.WINDOW_MENU}}]}var b=n(2249),O=n(89061),I=n(32901),B=n(32133),N=n(45369),D=n(82665),V=n(4452),k=n.n(V),L=n(26272);function F(){return F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},F.apply(null,arguments)}const _=({styles:e={},...t})=>o.createElement("svg",F({fill:"currentcolor",viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2"},t),o.createElement("path",{d:"M24.515 16.314L30 21.799 21.799 30l-5.485-5.485 2.121-2.122 3.364 3.364 3.958-3.958-3.364-3.364 2.122-2.121zm-7.494 4.665l-2.122 2.122-6-6 2.122-2.122 6 6zm6.08-6.08l-2.122 2.122-6-6 2.122-2.122 6 6zm-7.415-7.414l-2.121 2.122-3.364-3.364-3.958 3.958 3.364 3.364-2.122 2.121L2 10.201 10.201 2l5.485 5.485z"}),o.createElement("path",{d:"M3 23L19 7l6 6L9 29H3v-6zM21 5l6 6 1.751-1.751a3.18 3.18 0 000-4.498l-1.502-1.502a3.18 3.18 0 00-4.498 0L21 5z"}));function M(){return M=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},M.apply(null,arguments)}const R=({styles:e={},...t})=>o.createElement("svg",M({fill:"currentcolor",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},t),o.createElement("circle",{cx:"16",cy:"16",r:"4"}),o.createElement("path",{d:"M30.94 15.66A16.69 16.69 0 0016 5 16.69 16.69 0 001.06 15.66a1 1 0 000 .68A16.69 16.69 0 0016 27a16.69 16.69 0 0014.94-10.66 1 1 0 000-.68zM16 22.5a6.5 6.5 0 116.5-6.5 6.51 6.51 0 01-6.5 6.5z"}),o.createElement("path",{"data-name":"<Transparent Rectangle>",fill:"none",d:"M0 0h32v32H0z"}));var T=n(34187),q={};function z(e){const{onCollapsePreview:t,onOpenPreview:n,previewOpen:r}=e;return o.createElement(L.SQ,{slot:"status-bar__app",group:"1_form-preview"},o.createElement("div",{className:k()(T.d)},o.createElement("button",{className:k()("btn",{"btn--active":!r}),title:"Open design mode",onClick:()=>{t({triggeredBy:Y.STATUS_BAR})}},o.createElement(_,null)," Design"),o.createElement("button",{className:k()("btn",{"btn--active":r}),title:"Open validation mode",onClick:()=>{n({triggeredBy:Y.STATUS_BAR})}},o.createElement(R,null)," Validate")))}q.styleTagTransform=y(),q.setAttributes=u(),q.insert=m().bind(null,"head"),q.domAPI=h(),q.insertStyleElement=g(),c()(T.A,q),T.A&&T.A.locals&&T.A.locals;const j={executionPlatform:D.ug.PLATFORM},Q="formEditor",U={"form-preview":{open:!1},"form-input":{open:!1},"form-output":{open:!1}},Y={KEYBOARD_SHORTCUT:"keyboardShortcut",PREVIEW_PANEL:"previewPanel",STATUS_BAR:"statusBar",WINDOW_MENU:"windowMenu"};class Z extends a.OB{constructor(e){super(e);const{layout:t={}}=e;this.ref=(0,o.createRef)(),this.state={lastFormPreviewState:null,lastInputData:null,importing:!1,previewOpen:W(J(t)),triggeredBy:null},this.engineProfile=new N.A({get:()=>{const{form:e}=this.getCached(),t=e.getSchema();return(0,B.QD)(t,j)},set:e=>{const{form:t}=this.getCached(),n=t.getEditor(),o=n._state.schema;n.get("modeling").editFormField(o,e)},getCached:()=>this.getCached(),setCached:e=>this.setCached(e)}),this.handleLintingDebounced=(0,i.A)(this.handleLinting.bind(this))}componentDidMount(){let{form:e,lastSchema:t}=this.getCached();this.ref.current&&e.attachTo(this.ref.current),t?(this.handlePlaygroundRendered(),this.handleInitialPlaygroundLayout()):e.on("formPlayground.rendered",this.handlePlaygroundRendered)}componentWillUnmount(){this._isMounted=!1;const{form:e}=this.getCached();e.detach(),e.getEditor().get("eventBus").fire("detach"),this.listen("off")}componentDidUpdate(e){this.checkImport(e),function(e,t){return e.cachedState!==t.cachedState}(e,this.props)&&this.handleChanged()}checkImport(e){if(!this.isImportNeeded(e))return;const{xml:t}=this.props;this.importSchema(t)}isImportNeeded(e={}){const{importing:t}=this.state;if(t)return!1;const{xml:n}=this.props,{xml:o}=e;if(n===o)return!1;const{lastSchema:r}=this.getCached();return n!==r}async importSchema(e){this.setState({importing:!0});const{form:t}=this.getCached();let n=null,o=null;try{const r=JSON.parse(e),i=await t.getEditor().importSchema(r);i&&({error:n,warnings:o}=i)}catch(e){n=e,e.warnings&&(o=e.warnings)}this._isMounted&&this.handleImport(n,o)}handleImport(e,t){const{form:n}=this.getCached(),{onImport:o,xml:r}=this.props,i=n.getEditor().get("commandStack")._stackIdx;let a=null;try{a=this.engineProfile.get(!0)}catch(t){e=t}e?this.setCached({engineProfile:null,lastSchema:null}):(this.setCached({engineProfile:a,lastSchema:r,stackIdx:i}),this.handleLinting()),this.setState({importing:!1}),o(e,t)}listen(e){const{form:t}=this.getCached(),n=t.getEditor();["attach","commandStack.changed","import.done","propertiesPanel.focusin","propertiesPanel.focusout","selection.changed"].forEach((t=>n[e](t,this.handleChanged))),this.handleDataEditorInteraction(e),this.handleFormPreviewInteraction(e),"on"===e?(n.on("commandStack.changed",500,this.handleLintingDebounced),t.on("formPlayground.layoutChanged",this.handlePlaygroundLayoutChanged)):"off"===e&&(n.off("commandStack.changed",this.handleLintingDebounced),t.off("formPlayground.layoutChanged",this.handlePlaygroundLayoutChanged))}handleDataEditorInteractionStart=()=>{this.setState({lastInputData:this.getInputData()})};handleDataEditorInteractionEnd=()=>{const{onAction:e}=this.props,t=this.getInputData();this.state.lastInputData!==t&&e("emit-event",{type:"form.modeler.inputDataChanged"}),this.setState({lastInputData:null})};handleDataEditorInteraction(e){const t=this.ref.current.querySelector(".cfp-data-container");t&&("on"===e?(t.addEventListener("focusin",this.handleDataEditorInteractionStart),t.addEventListener("focusout",this.handleDataEditorInteractionEnd)):(t.removeEventListener("focusin",this.handleDataEditorInteractionStart),t.removeEventListener("focusout",this.handleDataEditorInteractionEnd)))}handleFormPreviewInteractionStart=()=>{this.setState({lastFormPreviewState:this.getFormPreviewState()})};handleFormPreviewInteractionEnd=()=>{const{onAction:e}=this.props,t=this.getFormPreviewState();this.state.lastFormPreviewState!==t&&e("emit-event",{type:"form.modeler.previewChanged"}),this.setState({lastFormPreviewState:null})};handleFormPreviewInteraction(e){const t=this.ref.current.querySelector(".cfp-preview-container");t&&("on"===e?(t.addEventListener("focusin",this.handleFormPreviewInteractionStart),t.addEventListener("focusout",this.handleFormPreviewInteractionEnd)):(t.removeEventListener("focusin",this.handleFormPreviewInteractionStart),t.removeEventListener("focusout",this.handleFormPreviewInteractionEnd)))}handleChanged=()=>{const{onChanged:e}=this.props,{previewOpen:t}=this.state,{form:n}=this.getCached(),o=n.getEditor().get("commandStack"),i=(0,b.v)()||function(){const e=document.body.querySelector('.cfp-collapsible-panel[data-idx="form-output"] .cfp-collapsible-panel-content');return!!e&&e.contains(document.activeElement)}(),a={defaultUndoRedo:i,dirty:this.isDirty(),inputActive:i,previewOpen:t,redo:o.canRedo(),removeSelected:i,save:!0,selectAll:!0,undo:o.canUndo()};var s;(0,r.Tn)(e)&&e({...a,editMenu:S(a),windowMenu:(s=a,[...x(s)])}),this.setState(a);try{const e=this.engineProfile.get();this.engineProfile.setCached(e)}catch(e){}};handlePlaygroundRendered=()=>{const{form:e}=this.getCached();this._isMounted=!0,this.listen("on"),e.getEditor().get("eventBus").fire("attach"),this.checkImport()};handleInitialPlaygroundLayout(){const{form:e}=this.getCached(),{layout:t}=this.props,n=J(t),o=function(e){return K(e,!0)}(n);o.length&&e.open(o);const r=function(e){return K(e,!1)}(n);r.length&&e.collapse(r)}handlePlaygroundLayoutChanged=e=>{const{layout:t}=e,{onAction:n,onLayoutChanged:o}=this.props;(0,r.Tn)(o)&&o({[Q]:t}),n("emit-event",{type:"form.modeler.playgroundLayoutChanged",payload:{layout:t,triggeredBy:this.state.triggeredBy||Y.PREVIEW_PANEL}}),this.setState({previewOpen:W(t),triggeredBy:null}),this.handleChanged()};onTogglePreview=(e,t={})=>{const{triggeredBy:n,triggeredByShortcut:o}=t,{form:r}=this.getCached();e?r.open():r.collapse(),this.setState({triggeredBy:o?Y.KEYBOARD_SHORTCUT:n})};onCollapsePreview=e=>this.onTogglePreview(!1,e);onOpenPreview=e=>this.onTogglePreview(!0,e);handleLinting=()=>{const e=this.engineProfile.getCached(),{form:t}=this.getCached();if(!e||!e.executionPlatformVersion)return;const n=t.getEditor().saveSchema(),{onAction:o}=this.props;o("lint-tab",{contents:n})};isDirty(){const{form:e,stackIdx:t}=this.getCached();return e.getEditor().get("commandStack")._stackIdx!==t}getForm(){const{form:e}=this.getCached();return e}getXML(){const{form:e,lastSchema:t}=this.getCached(),n=e.getEditor().get("commandStack")._stackIdx;if(!this.isDirty())return t||this.props.xml;const o=JSON.stringify(e.saveSchema(),null,2);return this.setCached({lastSchema:o,stackIdx:n}),o}getInputData(){const{form:e}=this.getCached();return e.getDataEditor().getValue()}getFormPreviewState(){const{form:e}=this.getCached();return e.getForm()._getState()}triggerAction(e,t){const{form:n}=this.getCached();if("collapsePreview"===e)return this.onCollapsePreview(t);if("openPreview"===e)return this.onOpenPreview(t);if(!this._isMounted)return;const o=n.getEditor().get("editorActions");return"showLintError"===e&&o.trigger("selectFormField",t),o.isRegistered(e)?o.trigger(e,t):void 0}render(){const e=this.engineProfile.getCached(),{importing:t,previewOpen:n}=this.state;return o.createElement("div",{className:E.k},o.createElement(s.aH,{hidden:!t}),o.createElement("div",{className:"form",onFocus:this.handleChanged,ref:this.ref}),e&&o.createElement(B.Si,{engineProfile:e,onChange:e=>this.engineProfile.set(e)}),o.createElement(z,{previewOpen:n,onCollapsePreview:this.onCollapsePreview,onOpenPreview:this.onOpenPreview}))}static createCachedState(e){const{layout:t={},onAction:n}=e,{name:o,version:r}=I.A,i=new O.n({schema:{components:[],type:"default"},layout:J(t),exporter:{name:o,version:r}});return n("emit-event",{type:"form.modeler.created",payload:i}),{__destroy:()=>{i.destroy()},engineProfile:null,form:i,lastSchema:null,stackIdx:-1}}}const H=(0,a.rx)((0,a.cP)(Z));function W(e={}){return(e["form-preview"]||{}).open||(e["form-input"]||{}).open||(e["form-output"]||{}).open}function J(e){const{[Q]:t}=e;return t||U}function K(e,t){return(0,r.HP)(e).reduce(((n,o)=>(e[o].open===t&&n.push(o),n)),[])}var X=n(83921);const $=(0,n(32528).a)("FormTab",[{type:"form",editor:H,defaultName:"Form"},{type:"json",editor:X.A,isFallback:!0,defaultName:"JSON"}])},90726:(e,t,n)=>{n.d(t,{A:()=>l,k:()=>s});var o=n(34942),r=n.n(o),i=n(60278),a=n.n(i)()(r());a.push([e.id,".e8uYBQqzVNaf5V2iZ8Or {\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n}\n.e8uYBQqzVNaf5V2iZ8Or .cfp-root {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow-y: auto;\n}\n.e8uYBQqzVNaf5V2iZ8Or .form {\n  display: flex;\n  flex: 1;\n  flex-direction: row;\n}\n.e8uYBQqzVNaf5V2iZ8Or .form .fjs-container {\n  --font-family: inherit;\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n}\n.e8uYBQqzVNaf5V2iZ8Or .form .bio-properties-panel {\n  --font-family: inherit;\n}\n.e8uYBQqzVNaf5V2iZ8Or .form .cm-editor .cm-scroller {\n  font-family: var(--font-family-monospace);\n}\n.e8uYBQqzVNaf5V2iZ8Or .form .cm-editor .cm-scroller * {\n  user-select: text;\n}\n.e8uYBQqzVNaf5V2iZ8Or .form .fjs-editor-container .fjs-properties-panel {\n  left: 1px;\n}\n.e8uYBQqzVNaf5V2iZ8Or .form .fjs-editor-container .fjs-properties-panel .bio-properties-panel {\n  --font-family: var(--font-family);\n  --font-family-monospace: var(--font-family-monospace);\n}\n.e8uYBQqzVNaf5V2iZ8Or .form .fjs-powered-by {\n  display: none;\n}\n","",{version:3,sources:["webpack://./src/app/tabs/form/FormEditor.less"],names:[],mappings:"AAAA;EACE,aAAA;EACA,OAAA;EACA,sBAAA;AACF;AAJA;EAMI,kBAAA;EACA,MAAA;EACA,OAAA;EACA,QAAA;EACA,SAAA;EACA,gBAAA;AACJ;AAZA;EAeI,aAAA;EACA,OAAA;EACA,mBAAA;AAAJ;AAjBA;EAoBM,sBAAA;EACA,aAAA;EACA,OAAA;EACA,sBAAA;AAAN;AAvBA;EA2BM,sBAAA;AADN;AA1BA;EAgCQ,yCAAA;AAHR;AA7BA;EAmCU,iBAAA;AAHV;AAhCA;EAyCM,SAAA;AANN;AAnCA;EA4CQ,iCAAA;EACA,qDAAA;AANR;AAvCA;EAkDM,aAAA;AARN",sourcesContent:[":local(.FormEditor) {\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n\n  .cfp-root {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    overflow-y: auto;\n  }\n\n  .form {\n    display: flex;\n    flex: 1;\n    flex-direction: row;\n  \n    .fjs-container {\n      --font-family: inherit;\n      display: flex;\n      flex: 1;\n      flex-direction: column;\n    }\n\n    .bio-properties-panel {\n      --font-family: inherit;\n    }\n\n    .cm-editor {\n      .cm-scroller {\n        font-family: var(--font-family-monospace);\n        \n        * {\n          user-select: text;\n        }\n      }\n    }\n  \n    .fjs-editor-container .fjs-properties-panel {\n      left: 1px;\n\n      .bio-properties-panel {\n        --font-family: var(--font-family);\n        --font-family-monospace: var(--font-family-monospace);\n      }\n    }\n\n    .fjs-powered-by {\n      display: none;\n    }\n  }\n}"],sourceRoot:""}]);var s="e8uYBQqzVNaf5V2iZ8Or";const l=a}}]);
//# sourceMappingURL=8729.js.map