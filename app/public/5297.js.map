{"version":3,"file":"5297.js","mappings":"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","sources":["webpack://camunda-modeler-client/../node_modules/@bpmn-io/add-exporter/index.js","webpack://camunda-modeler-client/../node_modules/@bpmn-io/variable-resolver/lib/VariableProvider.js","webpack://camunda-modeler-client/../node_modules/@bpmn-io/variable-resolver/node_modules/@bpmn-io/extract-process-variables/dist/index.js","webpack://camunda-modeler-client/../node_modules/@bpmn-io/variable-resolver/lib/base/util/CachedValue.js","webpack://camunda-modeler-client/../node_modules/@bpmn-io/variable-resolver/lib/base/util/ExtensionElementsUtil.js","webpack://camunda-modeler-client/../node_modules/@bpmn-io/variable-resolver/lib/base/util/scopeUtil.js","webpack://camunda-modeler-client/../node_modules/@bpmn-io/variable-resolver/lib/base/VariableResolver.js","webpack://camunda-modeler-client/../node_modules/@bpmn-io/variable-resolver/node_modules/@bpmn-io/extract-process-variables/zeebe/index.js","webpack://camunda-modeler-client/../node_modules/@bpmn-io/variable-resolver/lib/zeebe/util/VariableContext.js","webpack://camunda-modeler-client/../node_modules/@bpmn-io/variable-resolver/lib/zeebe/util/feelUtility.js","webpack://camunda-modeler-client/../node_modules/@bpmn-io/variable-resolver/lib/zeebe/extractors/connectors.js","webpack://camunda-modeler-client/../node_modules/@bpmn-io/variable-resolver/lib/index.js","webpack://camunda-modeler-client/../node_modules/@bpmn-io/variable-resolver/lib/zeebe/VariableResolver.js","webpack://camunda-modeler-client/../node_modules/@bpmn-io/variable-resolver/lib/camunda/VariableResolver.js","webpack://camunda-modeler-client/../node_modules/@camunda/linting/lib/modeler/Linting.js","webpack://camunda-modeler-client/../node_modules/@camunda/linting/lib/modeler/OverlayComponent.js","webpack://camunda-modeler-client/../node_modules/@camunda/linting/lib/modeler/LintingAnnotations.js","webpack://camunda-modeler-client/../node_modules/@camunda/linting/lib/modeler/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-color-picker/colors/ColorContextPadProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-color-picker/colors/ColorPopupProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-color-picker/colors/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-create-append-anything/dist/index.es.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/Util.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/context-pad/ContextPadTracking.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/context-pad/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/element-templates/ElementTemplatesTracking.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/element-templates/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/feel-popup/FeelPopupTracking.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/feel-popup/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/modeling/ModelingTracking.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/modeling/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/palette/PaletteTracking.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/palette/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/popup-menu/PopupMenuTracking.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/popup-menu/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/BpmnJSTracking.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/refactorings/RefactoringsTracking.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/selection/SelectionTracking.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-tracking/lib/features/index.js","webpack://camunda-modeler-client/../node_modules/camunda-bpmn-js-behaviors/lib/shared/DeleteParticipantBehaviour.js","webpack://camunda-modeler-client/../node_modules/camunda-bpmn-js-behaviors/lib/util/ExtensionElementsUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/node_modules/ids/dist/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/node_modules/moddle/dist/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/node_modules/moddle-xml/dist/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/node_modules/bpmn-moddle/dist/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/import/Util.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/util/CompatibilityUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/import/BpmnTreeWalker.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/import/Importer.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/util/PoweredByUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/BaseViewer.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/BaseModeler.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/draw/BpmnRenderUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/draw/BpmnRenderer.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/draw/TextRenderer.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/draw/PathMap.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/draw/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/import/BpmnImporter.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/import/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/core/index.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/root-elements/RootElementsBehavior.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/root-elements/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/drilldown/DrilldownBreadcrumbs.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/drilldown/DrilldownCentering.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/drilldown/SubprocessCompatibility.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/drilldown/DrilldownOverlayBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/drilldown/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/Viewer.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/NavigatedViewer.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/align-elements/AlignElementsIcons.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/align-elements/AlignElementsContextPadProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/align-elements/AlignElementsMenuProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/align-elements/BpmnAlignElements.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/align-elements/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/util/ModelingUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/auto-place/BpmnAutoPlaceUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/auto-place/BpmnAutoPlace.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/auto-place/index.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/auto-resize/AutoResize.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/auto-resize/BpmnAutoResize.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/auto-resize/AutoResizeProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/auto-resize/BpmnAutoResizeProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/auto-resize/index.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/complex-preview/ComplexPreview.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/complex-preview/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/AdaptiveLabelPositioningBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/AppendBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/AssociationBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/AttachEventBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/BoundaryEventBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/CompensateBoundaryEventBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/CreateBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/CreateDataObjectBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/CreateParticipantBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/DataInputAssociationBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/cmd/UpdateSemanticParentHandler.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/DataStoreBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/util/LaneUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/DeleteLaneBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/DetachEventBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/DropOnFlowBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/EventBasedGatewayBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/FixHoverBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/GroupBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/util/CategoryUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/util/LineIntersect.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/ImportDockingFix.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/IsHorizontalFix.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/util/LineAttachmentUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/util/LayoutUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/LabelBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/util/LabelLayoutUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/LayoutConnectionBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/util/ConnectionLayoutUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/MessageFlowBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/util/NonInterruptingUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/NonInterruptingBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/RemoveEmbeddedLabelBoundsBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/RemoveElementBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/RemoveParticipantBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/ReplaceConnectionBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/ReplaceElementBehaviour.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/ResizeBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/ResizeLaneBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/RootElementReferenceBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/SpaceToolBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/SubProcessPlaneBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/SubProcessStartEventBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/TextAnnotationBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/ToggleCollapseConnectionBehaviour.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/ToggleElementCollapseBehaviour.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/UnclaimIdBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/UnsetDefaultFlowBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/UpdateFlowNodeRefsBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/SetCompensationActivityAfterPasteBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/behavior/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/snapping/BpmnSnappingUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/rules/BpmnRules.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/rules/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/di-ordering/BpmnDiOrdering.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/di-ordering/index.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/ordering/OrderingProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/ordering/BpmnOrderingProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/ordering/index.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/copy-paste/CopyPaste.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/copy-paste/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/copy-paste/BpmnCopyPaste.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/copy-paste/ModdleCopy.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/copy-paste/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/replace/BpmnReplace.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/replace/index.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/space-tool/SpaceTool.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/space-tool/SpaceToolPreview.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/space-tool/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/space-tool/BpmnSpaceTool.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/space-tool/index.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/label-support/LabelSupport.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/label-support/index.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/attach-support/AttachSupport.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/attach-support/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/BpmnFactory.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/BpmnUpdater.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/ElementFactory.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/cmd/UpdateModdlePropertiesHandler.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/cmd/UpdatePropertiesHandler.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/cmd/UpdateCanvasRootHandler.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/cmd/AddLaneHandler.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/cmd/SplitLaneHandler.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/cmd/ResizeLaneHandler.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/cmd/UpdateFlowNodeRefsHandler.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/cmd/IdClaimHandler.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/cmd/SetColorHandler.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/label-editing/cmd/UpdateLabelHandler.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/Modeling.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/layout/ManhattanLayout.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/BpmnLayouter.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/append-preview/AppendPreview.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/append-preview/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/replace/ReplaceOptions.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/popup-menu/util/Icons.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/popup-menu/ReplaceMenuProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/popup-menu/util/TypeUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/popup-menu/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/context-pad/ContextPadProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/context-pad/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/distribute-elements/BpmnDistributeElements.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/distribute-elements/DistributeElementsIcons.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/distribute-elements/DistributeElementsMenuProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/distribute-elements/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/editor-actions/BpmnEditorActions.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/editor-actions/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/grid-snapping/BpmnGridSnapping.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/grid-snapping/behavior/GridSnappingAutoPlaceBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/grid-snapping/behavior/GridSnappingParticipantBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/grid-snapping/behavior/GridSnappingLayoutConnectionBehavior.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/grid-snapping/behavior/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/grid-snapping/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/interaction-events/BpmnInteractionEvents.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/interaction-events/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/keyboard/BpmnKeyboardBindings.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/keyboard/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/label-editing/LabelEditingProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/label-editing/LabelEditingPreview.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/label-editing/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/label-link/LabelLink.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/label-link/index.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/tooltips/Tooltips.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/tooltips/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling-feedback/ModelingFeedback.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/modeling-feedback/index.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/global-connect/GlobalConnect.js","webpack://camunda-modeler-client/../node_modules/diagram-js/lib/features/global-connect/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/palette/PaletteProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/palette/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/replace-preview/BpmnReplacePreview.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/replace-preview/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/snapping/BpmnConnectSnapping.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/snapping/BpmnCreateMoveSnapping.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/snapping/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/search/BpmnSearchProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/search/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/outline/OutlineUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/outline/OutlineProvider.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/features/outline/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js/lib/Modeler.js","webpack://camunda-modeler-client/../node_modules/diagram-js-minimap/dist/index.esm.js","webpack://camunda-modeler-client/../node_modules/camunda-bpmn-js/node_modules/diagram-js-grid/dist/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-executable-fix/src/ExecutableFix.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-executable-fix/src/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-executable-fix/index.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-native-copy-paste/lib/NativeCopyPaste.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-native-copy-paste/lib/PasteUtil.js","webpack://camunda-modeler-client/../node_modules/bpmn-js-native-copy-paste/lib/index.js","webpack://camunda-modeler-client/../node_modules/camunda-bpmn-js/lib/base/Modeler.js"],"sourcesContent":["import AddExporter from './add-exporter';\n\nexport default {\n  __init__: [ AddExporter ]\n};","/**\n * @typedef Variable\n * @property {string} name The name of the variable\n * @property {string} [type] The type of the variable\n * @property {string} [info] A description of the variable displayed as a tooltip\n * @property {boolean} [isList] whether the variable is a list\n * @property {Array<Variable>} [entries] If the variable is a context, this contains the entries of the context\n * @property {djs.model.Base} [scope] The scope of the variable, by default it is the container element of the element the variable is created from\n */\n\n/**\n * A basic provider that may be extended to provide variables for the variable resolver.\n *\n * Extensions should implement the method `getVariables`.\n */\nexport default class VariableProvider {\n  constructor(variableResolver) {\n    this._variableResolver = variableResolver;\n    this.register();\n  }\n\n  /**\n   * This method should implement the creation of a list of process variables.\n   *\n   * @param {djs.model.Base} element\n   * @return {Array<Variable>} a list of process variables\n   *\n   * The following example contains one variable\n   *\n   * @example\n   * VariableProvider.getVariables = function(element) {\n   *   const variables = [\n   *     {\n   *       name: 'myVariable',\n   *       type: 'String',\n   *       info: 'This is a global variable'\n   *     }\n   *   ];\n   *\n   *   if (is(element, 'bpmn:Process')) {\n   *     return variables;\n   *   }\n   * }\n   */\n  getVariables(element) { }\n\n  register() {\n    this._variableResolver.registerProvider(this);\n  }\n}\n\nVariableProvider.$inject = [ 'variableResolver' ];","import { filter, find, isArray, forEach, findIndex } from 'min-dash';\n\n/**\n * Get a inputOutput from the business object\n *\n * @param {ModdleElement} element\n *\n * @return {ModdleElement} the inputOutput object\n */\nfunction getInputOutput(element) {\n  return (getElements(element, 'camunda:InputOutput') || [])[0];\n}\n\n/**\n * Return all input parameters existing in the business object, and\n * an empty array if none exist.\n *\n * @param  {ModdleElement} element\n *\n * @return {Array<ModdleElement>} a list of input parameter objects\n */\nfunction getInputParameters(element) {\n  return getParameters(element, 'inputParameters');\n}\n\n/**\n * Return all output parameters existing in the business object, and\n * an empty array if none exist.\n *\n * @param  {ModdleElement} element\n * @param  {boolean} insideConnector\n *\n * @return {Array<ModdleElement>} a list of output parameter objects\n */\nfunction getOutputParameters(element) {\n  return getParameters(element, 'outputParameters');\n}\n\n/**\n * Return all form fields existing in the business object, and\n * an empty array if none exist.\n *\n * @param {ModdleElement} element\n *\n * @return {Array<ModdleElement>} a list of form fields\n */\nfunction getFormFields(element) {\n  var formData = getFormData(element);\n  return (formData && formData.get('fields')) || [];\n}\n\n/**\n * Return form data existing in the business object\n *\n * @param {ModdleElement} element\n *\n * @return {ModdleElement}\n */\nfunction getFormData(element) {\n  return getElements(element, 'camunda:FormData')[0];\n}\n\n/**\n * Return out mappings existing in the business object\n *\n * @param {ModdleElement} element\n *\n * @return {Array<ModdleElement>}\n */\nfunction getOutMappings(element) {\n  return getElements(element, 'camunda:Out');\n}\n\n\n// helpers //////////\n\nfunction getElements(element, type, property) {\n  var elements = getExtensionElements(element, type);\n\n  return elements ;\n}\n\nfunction getParameters(element, property) {\n  var inputOutput = getInputOutput(element);\n\n  return (inputOutput && inputOutput.get(property)) || [];\n}\n\nfunction getExtensionElements(element, type) {\n  var elements = [];\n  var extensionElements = element.get('extensionElements');\n\n  if (typeof extensionElements !== 'undefined') {\n    var extensionValues = extensionElements.get('values');\n\n    if (typeof extensionValues !== 'undefined') {\n      elements = filter(extensionValues, function(value) {\n        return is$2(value, type);\n      });\n    }\n  }\n\n  return elements;\n}\n\nfunction is$2(element, type) {\n  return (\n    element &&\n    typeof element.$instanceOf === 'function' &&\n    element.$instanceOf(type)\n  );\n}\n\n/**\n * Get all parent elements for a given element.\n *\n * @param {ModdleElement|string} element\n *\n * @returns {Array<ModdleElement>}\n */\nfunction getParents(element) {\n  var parents = [];\n  var current = element;\n\n  while (current.$parent) {\n    parents.push(current.$parent);\n    current = current.$parent;\n  }\n\n  return parents;\n}\n\n/**\n * Iterate over each element in a collection, calling the iterator function `fn`\n * with (element, index, recursionDepth).\n *\n * Recurse into all elements that are returned by `fn`.\n *\n * @param  {Object|Array<Object>} elements\n * @param  {Function} fn iterator function called with (element, index, recursionDepth)\n * @param  {number} [depth] maximum recursion depth\n */\nfunction eachElement(elements, fn, depth) {\n  depth = depth || 0;\n\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  forEach(elements, function(s, i) {\n    var filter = fn(s, i, depth);\n\n    if (isArray(filter) && filter.length) {\n      eachElement(filter, fn, depth + 1);\n    }\n  });\n}\n\n/**\n * Adds an element to a collection and returns true if the\n * element was added.\n *\n * @param {Array<Object>} elements\n * @param {Object} e\n * @param {boolean} unique\n */\nfunction add(elements, e, unique) {\n  var canAdd = !unique || elements.indexOf(e) === -1;\n\n  if (canAdd) {\n    elements.push(e);\n  }\n\n  return canAdd;\n}\n\n/**\n * Collects self + flow elements up to a given depth from a list of elements.\n *\n * @param  {ModdleElement|Array<ModdleElement>} elements the elements to select the flowElements from\n * @param  {boolean} unique whether to return a unique result set (no duplicates)\n * @param  {number} maxDepth the depth to search through or -1 for infinite\n *\n * @return {Array<ModdleElement>} found elements\n */\nfunction selfAndFlowElements(elements, unique, maxDepth) {\n  var result = [],\n      processedFlowElements = [];\n\n  eachElement(elements, function(element, i, depth) {\n    add(result, element, unique);\n\n    var flowElements = element.flowElements;\n\n    // max traversal depth not reached yet\n    {\n\n      // flowElements exist && flowElements not yet processed\n      if (flowElements && add(processedFlowElements, flowElements, unique)) {\n        return flowElements;\n      }\n    }\n  });\n\n  return result;\n}\n\n/**\n * Return self + ALL flowElements for a number of elements\n *\n * @param  {Array<ModdleElement>} elements to query\n * @param  {boolean} allowDuplicates to allow duplicates in the result set\n *\n * @return {Array<ModdleElement>} the collected elements\n */\nfunction selfAndAllFlowElements(elements, allowDuplicates) {\n  return selfAndFlowElements(elements, !allowDuplicates);\n}\n\n/**\n * Return full moddle element for given element id\n *\n * @param {string} elementId\n * @param {ModdleElement} rootElement\n *\n * @returns {ModdleElement}\n */\nfunction getElement(elementId, rootElement) {\n  var allElements = selfAndAllFlowElements(rootElement);\n\n  return find(allElements, function(element) {\n    return element.id === elementId;\n  });\n}\n\nfunction addVariableToList(variablesList, newVariable) {\n  var foundIdx = findIndex(variablesList, function(variable) {\n    return (\n      variable.name === newVariable.name && variable.scope === newVariable.scope\n    );\n  });\n\n  if (foundIdx >= 0) {\n    variablesList[foundIdx].origin = combineArrays$1(\n      variablesList[foundIdx].origin,\n      newVariable.origin\n    );\n  } else {\n    variablesList.push(newVariable);\n  }\n}\n\n/**\n * Creates new process variable definition object\n * Identifies correct (highest) scope, in which variable is available\n *\n * @param {ModdleElement} flowElement\n * @param {String} name\n * @param {ModdleElement} defaultScope\n *\n * @returns {ProcessVariable}\n */\nfunction createProcessVariable(flowElement, name, defaultScope) {\n  var scope = getScope(flowElement, defaultScope, name);\n\n  return {\n    name: name,\n    origin: [ flowElement ],\n    scope: scope,\n  };\n}\n\n\n// helpers ////////////////////\n\n/**\n * Set parent container if it defines it's own scope for the variable, so\n * when it defines an input mapping for it. Otherwise returns the default global scope\n */\nfunction getScope(element, globalScope, variableName) {\n  var parents = getParents(element);\n\n  var scopedParent = find(parents, function(parent) {\n    return (\n      is$1(parent, 'bpmn:SubProcess') && hasInputParameter(parent, variableName)\n    );\n  });\n\n  return scopedParent ? scopedParent : globalScope;\n}\n\nfunction is$1(element, type) {\n  return (\n    element &&\n      typeof element.$instanceOf === 'function' &&\n      element.$instanceOf(type)\n  );\n}\n\nfunction hasInputParameter(element, name) {\n  return find(getInputParameters(element), function(input) {\n    return input.name === name;\n  });\n}\n\nfunction combineArrays$1(a, b) {\n  return a.concat(b);\n}\n\n/**\n * Retrieves process variables defined in output parameters, e.g.\n *\n * <camunda:inputOutput>\n *   <camunda:outputParameter name=\"variable1\">200</camunda:outputParameter>\n *   <camunda:outputParameter name=\"variable2\">${myLocalVar + 20}</camunda:outputParameter>\n * </camunda:inputOutput>\n *\n * => Adds two variables \"variable1\" & \"variable2\" to the list.\n *\n */\nfunction extractOutputParameters(options) {\n  var elements = options.elements,\n      containerElement = options.containerElement,\n      processVariables = options.processVariables;\n\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  forEach(elements, function(element) {\n\n    // variables are created by output parameters\n    var outputParameters = getOutputParameters(element);\n\n    // extract all variables with correct scope\n    forEach(outputParameters, function(parameter) {\n      var newVariable = createProcessVariable(\n        element,\n        parameter.name,\n        containerElement\n      );\n\n      addVariableToList(processVariables, newVariable);\n    });\n  });\n\n  return processVariables;\n}\n\n/**\n * Retrieves process variables defined in result variables, e.g.\n *\n * <bpmn:sendTask\n *   id=\"SendTask_1\"\n *   camunda:expression=\"${myBean.ready}\"\n *   camunda:resultVariable=\"variable1\"\n * />\n *\n * => Adds one variable \"variable1\"to the list.\n *\n */\nfunction extractResultVariables(options) {\n  var elements = options.elements,\n      containerElement = options.containerElement,\n      processVariables = options.processVariables;\n\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  forEach(elements, function(element) {\n\n    var resultVariable = getResultVariable(element);\n\n    if (resultVariable) {\n      var newVariable = createProcessVariable(\n        element,\n        resultVariable,\n        containerElement\n      );\n\n      addVariableToList(processVariables, newVariable);\n    }\n  });\n\n  return processVariables;\n}\n\n\n// helpers ///////////////////////\n\nfunction getResultVariable(element) {\n  return element.get('camunda:resultVariable');\n}\n\n/**\n * Retrieves process variables defined in form fields, e.g.\n *\n * <camunda:formData>\n *   <camunda:formField id=\"variable1\" />\n *   <camunda:formField id=\"variable2\" />\n * </camunda:formData>\n *\n * => Adds two variables \"variable1\" & \"variable2\" to the list.\n *\n */\nfunction extractFormFields(options) {\n  var elements = options.elements,\n      containerElement = options.containerElement,\n      processVariables = options.processVariables;\n\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  forEach(elements, function(element) {\n\n    var formFields = getFormFields(element);\n\n    // extract all variables with correct scope\n    forEach(formFields, function(field) {\n      var newVariable = createProcessVariable(\n        element,\n        field.id,\n        containerElement\n      );\n\n      addVariableToList(processVariables, newVariable);\n    });\n  });\n\n  return processVariables;\n}\n\n/**\n * Retrieves process variables defined in output mappings and\n * ignores local variables, e.g.\n *\n * <bpmn:extensionElements>\n *   <camunda:out sourceExpression=\"${myBean.ready}\" target=\"variable1\" />\n *   <camunda:out source=\"foo\" target=\"variableLocal\" local=\"true\" />\n * </bpmn:extensionElements>\n *\n * => Adds one variable \"variable1\" to the list.\n *\n */\nfunction extractOutMappings(options) {\n  var elements = options.elements,\n      containerElement = options.containerElement,\n      processVariables = options.processVariables;\n\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  forEach(elements, function(element) {\n\n    var outMappings = getOutMappings(element);\n\n    // extract all variables with correct scope\n    forEach(outMappings, function(mapping) {\n\n      // do not use variables marked as <local>\n      if (mapping.local) {\n        return;\n      }\n\n      var newVariable = createProcessVariable(\n        element,\n        mapping.target,\n        containerElement\n      );\n\n      addVariableToList(processVariables, newVariable);\n    });\n  });\n\n  return processVariables;\n}\n\n/**\n *\n * @param {ModdleElement} element\n * @param {string} [type] - optional\n *\n * @return {Array<ModdleElement>|undefined} collection of event definitions or none\n */\nfunction getEventDefinitions(element, type) {\n  var eventDefinitions = element.eventDefinitions;\n\n  if (!eventDefinitions || !type) {\n    return eventDefinitions;\n  }\n\n  return filter(eventDefinitions, function(definition) {\n    return is(definition, type);\n  });\n}\n\n/**\n * Returns error event definitions for a given element.\n *\n * @param {ModdleElement} element\n *\n * @return {Array<ModdleElement>} collection of error event definitions\n */\nfunction getErrorEventDefinitions(element) {\n  return getEventDefinitions(element, 'bpmn:ErrorEventDefinition');\n}\n\n/**\n * Returns escalation event definitions for a given element.\n *\n * @param {ModdleElement} element\n *\n * @return {Array<ModdleElement>} collection of escalation event definitions\n */\nfunction getEscalationEventDefinitions(element) {\n  return getEventDefinitions(element, 'bpmn:EscalationEventDefinition');\n}\n\n\n// helper ////////////////\n\nfunction is(element, type) {\n  return (\n    element &&\n    typeof element.$instanceOf === 'function' &&\n    element.$instanceOf(type)\n  );\n}\n\n/**\n * Retrieves process variables defined in event definitions, e.g.\n *\n * <bpmn:escalationEventDefinition\n *   id=\"EscalationEventDefinition_1\"\n *   escalationRef=\"Escalation_1\"\n *   camunda:escalationCodeVariable=\"variable1\"\n * />\n *\n * => Adds one variable \"variable1\" to the list.\n *\n * <bpmn:errorEventDefinition\n *   id=\"ErrorEventDefinition_1\"\n *   errorRef=\"Error_1\"\n *   camunda:errorCodeVariable=\"variable2\"\n *   camunda:errorMessageVariable=\"variable3\"\n * />\n *\n * => Adds two variables \"variable2\" & \"variable3\" to the list.\n *\n */\nfunction extractEventDefinitionVariables(options) {\n  var elements = options.elements,\n      containerElement = options.containerElement,\n      processVariables = options.processVariables;\n\n  var addVariable = function(element, name) {\n    var newVariable = createProcessVariable(\n      element,\n      name,\n      containerElement\n    );\n\n    addVariableToList(processVariables, newVariable);\n  };\n\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  forEach(elements, function(element) {\n\n    // (1) error event code + message variable\n    var errorEventDefinitions = getErrorEventDefinitions(element);\n\n    forEach(errorEventDefinitions, function(definition) {\n\n      var errorCodeVariable = definition.get('errorCodeVariable'),\n          errorMessageVariable = definition.get('errorMessageVariable');\n\n      if (errorCodeVariable) {\n        addVariable(element, errorCodeVariable);\n      }\n\n      if (errorMessageVariable) {\n        addVariable(element, errorMessageVariable);\n      }\n    });\n\n    // (2) escalation code variable\n    var escalationEventDefinitions = getEscalationEventDefinitions(element);\n\n    forEach(escalationEventDefinitions, function(definition) {\n\n      var escalationCodeVariable = definition.get('escalationCodeVariable');\n\n      if (escalationCodeVariable) {\n        addVariable(element, escalationCodeVariable);\n      }\n    });\n\n  });\n\n  return processVariables;\n}\n\nvar extractors = [\n  extractOutputParameters,\n  extractResultVariables,\n  extractFormFields,\n  extractOutMappings,\n  extractEventDefinitionVariables\n];\n\n/**\n * @typedef {Object} ProcessVariable\n * @property {string} name\n * @property {Array<ModdleElement>} origin\n * @property {ModdleElement} scope\n */\n\n\n/**\n * Extractors add ProcessVariables to the `options.processVariables` parameter.\n * @callback extractor\n * @param {Object} options\n * @param {Array<ModdleElement>} options.elements\n * @param {ModdleElement} options.containerElement\n * @param {Array<ProcessVariable>} options.processVariables\n */\n\n// api /////////////////////////\n\n/**\n * Retrieves all process variables for a given container element.\n * @param {ModdleElement} containerElement\n * @param {Array<extractor>} additionalExtractors\n *\n * @returns {Promise<Array<ProcessVariable>>}\n */\nfunction getProcessVariables(containerElement, additionalExtractors = []) {\n  const allPromises = [];\n\n  var processVariables = [];\n\n  // (1) extract all flow elements inside the container\n  var elements = selfAndAllFlowElements([ containerElement ], false);\n\n  // (2) extract all variables from the extractors\n  forEach([ ...extractors, ...additionalExtractors ], function(extractor) {\n    allPromises.push(\n      extractor({\n        elements: elements,\n        containerElement: containerElement,\n        processVariables: processVariables\n      })\n    );\n  });\n\n  return Promise.all(allPromises)\n    .then(() => processVariables);\n}\n\n/**\n * Retrieves all variables which are available in the given scope\n *\n * * Exclude variables which are only available in other scopes\n * * Exclude variables which are produced by the given element\n * * Include variables which are available in parent scopes\n *\n * @param {string} scope\n * @param {ModdleElement} rootElement element from where to extract all variables\n * @param {Array<extractor>} additionalExtractors\n *\n * @returns {Promise<Array<ProcessVariable>>}\n */\nasync function getVariablesForScope(scope, rootElement, additionalExtractors = []) {\n\n  var allVariables = await getProcessVariables(rootElement, additionalExtractors);\n\n  var scopeElement = getElement(scope, rootElement);\n\n  // (1) get variables for given scope\n  var scopeVariables = filter(allVariables, function(variable) {\n    return variable.scope.id === scopeElement.id;\n  });\n\n  // (2) get variables for parent scopes\n  var parents = getParents(scopeElement);\n\n  var parentsScopeVariables = filter(allVariables, function(variable) {\n    return find(parents, function(parent) {\n      return parent.id === variable.scope.id;\n    });\n  });\n\n  return combineArrays(scopeVariables, parentsScopeVariables);\n}\n\n// helpers ////////////////////\n\nfunction combineArrays(a, b) {\n  return a.concat(b);\n}\n\nexport { getProcessVariables, getVariablesForScope };\n","export default class CachedValue {\n  constructor(generatorFunction) {\n    this._generate = generatorFunction;\n    this.value = null;\n    this.valid = false;\n  }\n\n  invalidate() {\n    this.valid = false;\n  }\n\n  get() {\n    if (!this.valid) {\n      this.value = this._generate();\n      this.valid = true;\n    }\n\n    return this.value;\n  }\n}","import { is } from 'bpmn-js/lib/util/ModelUtil';\nimport { filter } from 'min-dash';\n\nexport function hasOutputMappings(element) {\n  return !!getOutputParameters(element).length;\n}\n\nexport function hasInputParameter(element, name) {\n  return getInputParameters(element).find(function(input) {\n    return (\n      input.target === name || // zeebe\n      input.name === name // camunda\n    );\n  });\n}\n\nexport function getExtensionElementsList(businessObject, type = undefined) {\n  const extensionElements = businessObject.get('extensionElements');\n\n  if (!extensionElements) {\n    return [];\n  }\n\n  const values = extensionElements.get('values');\n\n  if (!values || !values.length) {\n    return [];\n  }\n\n  if (type) {\n    return values.filter(value => is(value, type));\n  }\n\n  return values;\n}\n\n// helpers //////////\n\nfunction getInputParameters(element) {\n  return getParameters(element, 'inputParameters');\n}\n\nfunction getOutputParameters(element) {\n  return getParameters(element, 'outputParameters');\n}\n\nexport function getInputOutput(element) {\n  return (\n    (getExtensionElements(element, 'zeebe:IoMapping'))[0] ||\n    (getExtensionElements(element, 'camunda:InputOutput'))[0]\n  );\n}\n\nfunction getParameters(element, property) {\n  var inputOutput = getInputOutput(element);\n\n  return (inputOutput && inputOutput.get(property)) || [];\n}\n\nfunction getExtensionElements(element, type) {\n  var elements = [];\n  var extensionElements = element.get('extensionElements');\n\n  if (typeof extensionElements !== 'undefined') {\n    var extensionValues = extensionElements.get('values');\n\n    if (typeof extensionValues !== 'undefined') {\n      elements = filter(extensionValues, function(value) {\n        return is(value, type);\n      });\n    }\n  }\n\n  return elements;\n}\n","import { is } from 'bpmn-js/lib/util/ModelUtil';\nimport { hasInputParameter, hasOutputMappings } from './ExtensionElementsUtil';\n\nexport function getScope(element, globalScope, variableName) {\n  var parents = getParents(element);\n\n  if (hasOutputMappings(element)) {\n    return element;\n  }\n\n  var scopedParent = parents.find(function(parent) {\n    return (\n      is(parent, 'bpmn:SubProcess') && hasInputParameter(parent, variableName)\n    );\n  });\n\n  return scopedParent ? scopedParent : globalScope;\n}\n\nexport function getParents(element) {\n  var parents = [];\n  var current = element;\n\n  while (current.$parent) {\n    parents.push(current.$parent);\n    current = current.$parent;\n  }\n\n  return parents;\n}","import { getBusinessObject, is } from 'bpmn-js/lib/util/ModelUtil';\nimport CachedValue from './util/CachedValue';\nimport { getParents, getScope } from './util/scopeUtil';\n\n/**\n * @typedef {Object} AdditionalVariable\n * @property {string} name The name of the variable\n * @property {string} [type] The type of the variable\n * @property {string} [info] A description of the variable displayed as a tooltip\n * @property {boolean} [isList] whether the variable is a list\n * @property {Array<AdditionalVariable>} [entries] If the variable is a context, this contains the entries of the context\n * @property {djs.model.Base} [scope] The scope of the variable, by default it is the container element of the element the variable is created from\n */\n\n/**\n * @typedef {AdditionalVariable} ProcessVariable\n * @property {Array<ModdleElement>} origin\n * @property {ModdleElement} scope\n * @property {Array<Object>} provider\n */\n\n/**\n * Base Class that handles additional variable extractors, variable parsing and caching.\n */\nexport class BaseVariableResolver {\n  constructor(eventBus, bpmnjs) {\n    this.providers = [];\n    this._eventBus = eventBus;\n    this._bpmnjs = bpmnjs;\n\n    this.rawVariables = new CachedValue(this._generateRawVariables.bind(this));\n    this.parsedVariables = new CachedValue(async () => {\n\n      const rawVariables = await this.getRawVariables();\n      const context = { variables: rawVariables };\n\n      eventBus.fire('variableResolver.parseVariables', context);\n\n      return context.variables;\n    });\n\n    eventBus.on([ 'commandStack.changed', 'diagram.clear', 'import.done', 'variables.changed' ], () => {\n      this.invalidateCache();\n    });\n\n    eventBus.on('variableResolver.parseVariables', (e, context) => {\n      context.variables = this._parseVariables(context.variables);\n    });\n  }\n\n  /**\n   * To be implemented by a subclass. This should be an instance of `getProcessVariables` from `@bpmn-io/extract-process-variables`,\n   * either C7 or C8.\n   *\n   * @returns {Promise<Array<ProcessVariable>>}\n   */\n  _baseExtractor() {\n    return [];\n  }\n\n\n  /**\n   * Returns an Object of all variables that are available in the current diagram,\n   * mapped to the respective scope.\n   * Variables with the same name are NOT merged together. Use this function to\n   * run linting, e.g. to check for conflicting variable schemas.\n   *\n   * The result is cached until the diagram changes.\n   *\n   * @async\n   * @returns {Object} rawVariables\n   * @returns {Array<ProcessVariable>} rawVariables.<scope>\n   */\n  async getRawVariables() {\n    return await this.rawVariables.get();\n  }\n\n  /**\n   * Returns an array of all variables that are available in the current diagram.\n   * Variables with the same name are NOT merged together. Use this function to\n   * run linting, e.g. to check for conflicting variable schemas.\n   *\n   * Use this function if you need all availables for all root elements. To filter for scope,\n   * use `getProcessVariables` or `getVariablesForElement`\n   *\n   * The result is cached until the diagram changes.\n   *\n   * @async\n   * @returns {Object} rawVariables\n   * @returns {Array<ProcessVariable>} rawVariables.<rootElement>\n   */\n  async getVariables() {\n    return await this.parsedVariables.get();\n  }\n\n  /**\n   * Force the cache to be invalidated an the variable extractors to be called\n   * again the next time `getVariables` is called.\n   */\n  invalidateCache() {\n    this.rawVariables.invalidate();\n    this.parsedVariables.invalidate();\n  }\n\n  /**\n   * Calls the baseExtractor and maps variables to the respective root element.\n   * Cf. `getRawVariables`\n   *\n   * @async\n   * @returns {Object} rawVariables\n   * @returns {Array<ProcessVariable>} rawVariables.<scope>\n   */\n  async _generateRawVariables() {\n    const bpmnjs = this._bpmnjs;\n\n    const variables = {};\n\n    const workerTasks = bpmnjs.getDefinitions().get('rootElements').map(async element => {\n\n      const elementVariables = await this._baseExtractor(element, [ this._extractor.bind(this) ]);\n\n      // Annotate variables with extractor information\n      variables[element.id] = elementVariables.map(variable => {\n        if (!variable.provider) {\n          variable.provider = [ this._baseExtractor ];\n        }\n\n        return variable;\n      });\n    });\n\n    await Promise.all(workerTasks);\n\n    return variables;\n  }\n\n\n  /**\n   * Parses the list of all variables and checks for duplicates. If duplicates are found, the schemas are merged\n   * into a single variable.\n   * Also maps the attribute `variable.type` to `variable.detail` for the feel editor to display it.\n   *\n   * Cf. `getVariables`\n   *\n   * @async\n   * @param {Object} rawVariables\n   * @param {Array<ProcessVariable>} rawVariables[scope]\n   * @returns {Object} parsedVariables\n   * @returns {Array<ProcessVariable>} parsedVariables[scope]\n   */\n  _parseVariables(rawVariables) {\n    const parsedVariables = {};\n    for (const key in rawVariables) {\n      const variables = rawVariables[key];\n\n      const mergedVariables = [];\n\n      variables.forEach(variable => {\n        const existingVariable = mergedVariables.find(v =>\n          v.name === variable.name && v.scope === variable.scope\n        );\n\n        if (existingVariable) {\n          merge('origin', existingVariable, variable);\n          merge('provider', existingVariable, variable);\n          mergeEntries(existingVariable, variable);\n        } else {\n          mergedVariables.push(variable);\n        }\n      });\n\n      mapToEditorFormat(mergedVariables);\n\n      parsedVariables[key] = mergedVariables;\n    }\n\n    return parsedVariables;\n  }\n\n  /**\n   * Callback used by `@bpmn-io/extract-process-variables`. It adds additional information from the <AdditionalVariable>\n   * returned from the providers to the <ProcessVariable> that is used by the resolver.\n   *\n   * It does not have a return value, the variables are added as a side effect to the `context.processVariables` array\n   *\n   * @async\n   * @param {Object} context\n   * @param {Array<ModdleElement>} context.elements\n   * @param {ModdleElement} context.containerElement\n   * @param {Array<ProcessVariable>} context.processVariables\n   */\n  async _extractor(context) {\n    const {\n      elements,\n      containerElement,\n      processVariables\n    } = context;\n\n    const self = this;\n\n    const workerTasks = elements.flatMap((element) => {\n      return self.providers.map(async (provider) => {\n        const newVariables = await provider.getVariables(element);\n\n        if (!newVariables) {\n          return;\n        }\n\n        // add scope and origin to variables\n        newVariables.forEach(variable => {\n          processVariables.push({\n            ...cloneVariable(variable),\n            origin: [ element ],\n            scope: variable.scope || getScope(element, containerElement, variable.name),\n            provider: [ provider ]\n          });\n        });\n      });\n    });\n\n    await Promise.all(workerTasks);\n  }\n\n  /**\n   * Add a new VariableProvider. This will be used the next time `getVariables` is called.\n   *\n   * @param {VariableProvider} provider\n   */\n  registerProvider(provider) {\n    this.providers.push(provider);\n    this.invalidateCache();\n  }\n\n  /**\n   * Returns all variables for the given root element.\n   *\n   * @async\n   * @param {ModdleElement} element\n   * @returns {Array<ProcessVariable>} variables\n   */\n  async getProcessVariables(element) {\n    const bo = getBusinessObject(element);\n\n    const allVariables = await this.getVariables();\n    return allVariables[bo.id] || [];\n  }\n\n  /**\n   * Returns all variables in the scope of the given element.\n   *\n   * @async\n   * @param {ModdleElement} element\n   * @returns {Array<ProcessVariable>} variables\n   */\n  async getVariablesForElement(element) {\n    const bo = getBusinessObject(element);\n\n    const root = getRootElement(bo);\n    const allVariables = await this.getProcessVariables(root);\n\n    // (1) get variables for given scope\n    var scopeVariables = allVariables.filter(function(variable) {\n      return variable.scope.id === bo.id;\n    });\n\n    // (2) get variables for parent scopes\n    var parents = getParents(bo);\n\n    var parentsScopeVariables = allVariables.filter(function(variable) {\n      return parents.find(function(parent) {\n        return parent.id === variable.scope.id;\n      });\n    });\n\n    const reversedVariables = [ ...scopeVariables, ...parentsScopeVariables ].reverse();\n\n    const seenNames = new Set();\n\n    return reversedVariables.filter(variable => {\n\n      // if external variable, keep\n      if (variable.provider.find(extractor => extractor !== this._baseExtractor)) {\n        return true;\n      }\n\n      // if not external, keep only the first occurrence of each name\n      if (!seenNames.has(variable.name)) {\n        seenNames.add(variable.name);\n\n        return true;\n      }\n\n      return false;\n    });\n  }\n}\n\nBaseVariableResolver.$inject = [ 'eventBus', 'bpmnjs' ];\n\n\n// helpers //////////////////////\n\nfunction getRootElement(element) {\n  const businessObject = getBusinessObject(element);\n\n  if (is(businessObject, 'bpmn:Participant')) {\n    return businessObject.processRef;\n  }\n\n  if (is(businessObject, 'bpmn:Process')) {\n    return businessObject;\n  }\n\n  let parent = businessObject;\n\n  while (parent.$parent && !is(parent, 'bpmn:Process')) {\n    parent = parent.$parent;\n  }\n\n  return parent;\n}\n\nfunction merge(property, target, source) {\n  if (!source[property]) {\n    source[property] = [];\n  }\n\n  if (!target[property]) {\n    target[property] = [];\n  }\n\n  const propertiesToAdd = source[property].filter(o => !target[property].includes(o));\n\n  target[property].push(...propertiesToAdd);\n}\n\nexport function mergeEntries(target, source, visited = []) {\n  if (visited.includes(source) || visited.includes(target)) {\n    return;\n  }\n  visited.push(source);\n  visited.push(target);\n\n  target.type = extendList(target.type, source.type, '|');\n  target.info = extendList(target.info, source.info, '\\n');\n  target.isList = !!target.isList === !!source.isList ? target.isList : 'optional';\n\n  if (!source.entries) {\n    return;\n  }\n\n  if (!target.entries) {\n    target.entries = [];\n  }\n\n  source.entries.forEach(variable => {\n    const existingEntry = target.entries.find(e => e.name === variable.name);\n\n    if (existingEntry) {\n      mergeEntries(existingEntry, variable, visited);\n    } else {\n      target.entries.push(variable);\n    }\n  });\n}\n\nconst extendList = (target, source, separator) => {\n  if (!target || target === source) {\n    return source;\n  } else {\n    const existingTypes = target.split(separator);\n    if (!existingTypes.includes(source)) {\n      existingTypes.push(source);\n    }\n    return existingTypes.join(separator);\n  }\n};\n\nfunction mapToEditorFormat(variables) {\n  if (!variables) {\n    return;\n  }\n\n  variables.forEach(variable => {\n    variable.detail = variable.type;\n    mapToEditorFormat(variable.entries);\n  });\n}\n\nfunction cloneVariable(variable) {\n  const newVariable = { ...variable };\n\n  if (newVariable.entries) {\n    newVariable.entries = newVariable.entries.map(cloneVariable);\n  }\n\n  return newVariable;\n}","import { filter, find, isArray, forEach, findIndex } from 'min-dash';\n\n/**\n * Get a inputOutput from the business object\n *\n * @param {ModdleElement} element\n *\n * @return {ModdleElement} the inputOutput object\n */\nfunction getInputOutput(element) {\n  return (getElements(element, 'zeebe:IoMapping') || [])[0];\n}\n\n/**\n * Return all input parameters existing in the business object, and\n * an empty array if none exist.\n *\n * @param  {ModdleElement} element\n *\n * @return {Array<ModdleElement>} a list of input parameter objects\n */\nfunction getInputParameters(element) {\n  return getParameters(element, 'inputParameters');\n}\n\n/**\n * Return out mappings existing in the business object\n *\n * @param {ModdleElement} element\n *\n * @return {Array<ModdleElement>}\n */\nfunction getOutMappings(element) {\n  return (getInputOutput(element) || {}).outputParameters;\n}\n\n/**\n * Return out mappings existing in the business object\n *\n * @param {ModdleElement} element\n *\n * @return {Array<ModdleElement>}\n */\nfunction getInMappings(element) {\n  return (getInputOutput(element) || {}).inputParameters;\n}\n\n/**\n * Get the inputElement name from a loopCharacteristics\n *\n * @param {MoodleElement} loopCharacteristics\n * @returns {String} outputCollection\n */\nfunction getInputElement(loopCharacteristics) {\n  const extensionElement = getElements(loopCharacteristics, 'zeebe:LoopCharacteristics')[0];\n  return extensionElement && extensionElement.inputElement;\n}\n\n/**\n * Get the outputCollection name from a loopCharacteristics\n *\n * @param {MoodleElement} loopCharacteristics\n * @returns {String} outputCollection\n */\nfunction getOutputCollection(loopCharacteristics) {\n  const extensionElement = getElements(loopCharacteristics, 'zeebe:LoopCharacteristics')[0];\n  return extensionElement && extensionElement.outputCollection;\n\n}\n\n/**\n * Get a calledDecision from the business object\n *\n * @param {MoodleElement} element\n * @returns {MoodleElement} the calledDecision object\n */\nfunction getCalledDecision(element) {\n  return (getElements(element, 'zeebe:CalledDecision') || [])[0];\n}\n\n\n/**\n * Get a script from the business object\n *\n * @param {MoodleElement} element\n * @returns {MoodleElement} the script object\n */\nfunction getScript(element) {\n  return (getElements(element, 'zeebe:Script') || [])[0];\n}\n\n// helpers //////////\n\nfunction getElements(element, type, property) {\n  var elements = getExtensionElements(element, type);\n\n  return elements ;\n}\n\nfunction getParameters(element, property) {\n  var inputOutput = getInputOutput(element);\n\n  return (inputOutput && inputOutput.get(property)) || [];\n}\n\nfunction getExtensionElements(element, type) {\n  var elements = [];\n  var extensionElements = element.get('extensionElements');\n\n  if (typeof extensionElements !== 'undefined') {\n    var extensionValues = extensionElements.get('values');\n\n    if (typeof extensionValues !== 'undefined') {\n      elements = filter(extensionValues, function(value) {\n        return is$2(value, type);\n      });\n    }\n  }\n\n  return elements;\n}\n\nfunction is$2(element, type) {\n  return (\n    element &&\n    typeof element.$instanceOf === 'function' &&\n    element.$instanceOf(type)\n  );\n}\n\n/**\n * Get all parent elements for a given element.\n *\n * @param {ModdleElement|string} element\n *\n * @returns {Array<ModdleElement>}\n */\nfunction getParents(element) {\n  var parents = [];\n  var current = element;\n\n  while (current.$parent) {\n    parents.push(current.$parent);\n    current = current.$parent;\n  }\n\n  return parents;\n}\n\n/**\n * Iterate over each element in a collection, calling the iterator function `fn`\n * with (element, index, recursionDepth).\n *\n * Recurse into all elements that are returned by `fn`.\n *\n * @param  {Object|Array<Object>} elements\n * @param  {Function} fn iterator function called with (element, index, recursionDepth)\n * @param  {number} [depth] maximum recursion depth\n */\nfunction eachElement(elements, fn, depth) {\n  depth = depth || 0;\n\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  forEach(elements, function(s, i) {\n    var filter = fn(s, i, depth);\n\n    if (isArray(filter) && filter.length) {\n      eachElement(filter, fn, depth + 1);\n    }\n  });\n}\n\n/**\n * Adds an element to a collection and returns true if the\n * element was added.\n *\n * @param {Array<Object>} elements\n * @param {Object} e\n * @param {boolean} unique\n */\nfunction add(elements, e, unique) {\n  var canAdd = !unique || elements.indexOf(e) === -1;\n\n  if (canAdd) {\n    elements.push(e);\n  }\n\n  return canAdd;\n}\n\n/**\n * Collects self + flow elements up to a given depth from a list of elements.\n *\n * @param  {ModdleElement|Array<ModdleElement>} elements the elements to select the flowElements from\n * @param  {boolean} unique whether to return a unique result set (no duplicates)\n * @param  {number} maxDepth the depth to search through or -1 for infinite\n *\n * @return {Array<ModdleElement>} found elements\n */\nfunction selfAndFlowElements(elements, unique, maxDepth) {\n  var result = [],\n      processedFlowElements = [];\n\n  eachElement(elements, function(element, i, depth) {\n    add(result, element, unique);\n\n    var flowElements = element.flowElements;\n\n    // max traversal depth not reached yet\n    {\n\n      // flowElements exist && flowElements not yet processed\n      if (flowElements && add(processedFlowElements, flowElements, unique)) {\n        return flowElements;\n      }\n    }\n  });\n\n  return result;\n}\n\n/**\n * Return self + ALL flowElements for a number of elements\n *\n * @param  {Array<ModdleElement>} elements to query\n * @param  {boolean} allowDuplicates to allow duplicates in the result set\n *\n * @return {Array<ModdleElement>} the collected elements\n */\nfunction selfAndAllFlowElements(elements, allowDuplicates) {\n  return selfAndFlowElements(elements, !allowDuplicates);\n}\n\n/**\n * Return full moddle element for given element id\n *\n * @param {string} elementId\n * @param {ModdleElement} rootElement\n *\n * @returns {ModdleElement}\n */\nfunction getElement(elementId, rootElement) {\n  var allElements = selfAndAllFlowElements(rootElement);\n\n  return find(allElements, function(element) {\n    return element.id === elementId;\n  });\n}\n\nfunction addVariableToList(variablesList, newVariable) {\n  var foundIdx = findIndex(variablesList, function(variable) {\n    return (\n      variable.name === newVariable.name && variable.scope === newVariable.scope\n    );\n  });\n\n  if (foundIdx >= 0) {\n    variablesList[foundIdx].origin = combineArrays$1(\n      variablesList[foundIdx].origin,\n      newVariable.origin\n    );\n  } else {\n    variablesList.push(newVariable);\n  }\n}\n\n/**\n * Creates new process variable definition object\n * Identifies correct (highest) scope, in which variable is available\n *\n * @param {ModdleElement} flowElement\n * @param {String} name\n * @param {ModdleElement} defaultScope\n *\n * @returns {ProcessVariable}\n */\nfunction createProcessVariable(flowElement, name, defaultScope) {\n  var scope = getScope$1(flowElement, defaultScope, name);\n\n  return {\n    name: name,\n    origin: [ flowElement ],\n    scope: scope\n  };\n}\n\n\n// helpers ////////////////////\n\n/**\n * Set parent container if it defines it's own scope for the variable, so\n * when it defines an input mapping for it. Otherwise returns the default global scope\n */\nfunction getScope$1(element, globalScope, variableName) {\n  var parents = getParents(element);\n\n  var scopedParent = find(parents, function(parent) {\n    return (\n      is$1(parent, 'bpmn:SubProcess') && hasInputParameter(parent, variableName)\n    );\n  });\n\n  return scopedParent ? scopedParent : globalScope;\n}\n\nfunction is$1(element, type) {\n  return (\n    element &&\n      typeof element.$instanceOf === 'function' &&\n      element.$instanceOf(type)\n  );\n}\n\nfunction hasInputParameter(element, name) {\n  return find(getInputParameters(element), function(input) {\n    return input.target === name;\n  });\n}\n\nfunction combineArrays$1(a, b) {\n  return a.concat(b);\n}\n\n/**\n * Retrieves process variables defined in output mappings, e.g.\n *\n * <bpmn:serviceTask id=\"ServiceTask\">\n *   <bpmn:extensionElements>\n *     <zeebe:ioMapping>\n *       <zeebe:input source=\"= source\" target=\"variable1\" />\n *     </zeebe:ioMapping>\n *   </bpmn:extensionElements>\n * </bpmn:serviceTask>\n *\n * => Adds one variable \"variable1\" to the list.\n *\n */\nfunction extractInMappings(options) {\n  var elements = options.elements,\n      processVariables = options.processVariables;\n\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  forEach(elements, function(element) {\n\n    var inMappings = getInMappings(element);\n\n    // extract all variables with correct scope\n    forEach(inMappings, function(mapping) {\n\n      var newVariable = createProcessVariable(\n        element,\n        mapping.target,\n        element\n      );\n\n      addVariableToList(processVariables, newVariable);\n    });\n  });\n\n  return processVariables;\n}\n\n/**\n * Retrieves process variables defined in result variables, e.g.\n *\n * <bpmn:serviceTask id=\"ServiceTask\">\n *   <bpmn:multiInstanceLoopCharacteristics>\n *     <bpmn:extensionElements>\n *       <zeebe:loopCharacteristics inputElement=\"inputElement\" outputCollection=\"outputCollection\" />\n *     </bpmn:extensionElements>\n *   </bpmn:multiInstanceLoopCharacteristics>\n * </bpmn:serviceTask>\n *\n * => Adds one variable \"inputElement\"to the list.\n *\n */\nfunction extractInputElement(options) {\n  var elements = options.elements,\n      processVariables = options.processVariables;\n\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  forEach(elements, function(element) {\n\n    var loopCharacteristics = element.loopCharacteristics;\n\n    var inputElement = loopCharacteristics && getInputElement(loopCharacteristics);\n\n    if (inputElement) {\n      var newVariable = createProcessVariable(\n        element,\n        inputElement,\n        element\n      );\n\n      addVariableToList(processVariables, newVariable);\n    }\n  });\n\n  return processVariables;\n}\n\n/**\n * Retrieves process variables defined in output mappings, e.g.\n *\n * <bpmn:serviceTask id=\"ServiceTask\">\n *   <bpmn:extensionElements>\n *     <zeebe:ioMapping>\n *       <zeebe:output source=\"= source\" target=\"variable1\" />\n *     </zeebe:ioMapping>\n *   </bpmn:extensionElements>\n * </bpmn:serviceTask>\n *\n * => Adds one variable \"variable1\" to the list.\n *\n */\nfunction extractOutMappings(options) {\n  var elements = options.elements,\n      containerElement = options.containerElement,\n      processVariables = options.processVariables;\n\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  forEach(elements, function(element) {\n\n    var outMappings = getOutMappings(element);\n\n    // extract all variables with correct scope\n    forEach(outMappings, function(mapping) {\n      var newVariable = createProcessVariable(\n        element,\n        mapping.target,\n        containerElement\n      );\n\n      addVariableToList(processVariables, newVariable);\n    });\n  });\n\n  return processVariables;\n}\n\n/**\n * Retrieves process variables defined in output collection, e.g.\n *\n * <bpmn:serviceTask id=\"ServiceTask\">\n *   <bpmn:multiInstanceLoopCharacteristics>\n *     <bpmn:extensionElements>\n *       <zeebe:loopCharacteristics inputElement=\"inputElement\" outputCollection=\"outputCollection\" />\n *     </bpmn:extensionElements>\n *   </bpmn:multiInstanceLoopCharacteristics>\n * </bpmn:serviceTask>\n *\n * => Adds one variable \"outputCollection\"to the list.\n *\n */\nfunction extractOutputCollections(options) {\n  var elements = options.elements,\n      containerElement = options.containerElement,\n      processVariables = options.processVariables;\n\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  forEach(elements, function(element) {\n\n    var loopCharacteristics = element.loopCharacteristics;\n\n    var outputCollection = loopCharacteristics && getOutputCollection(loopCharacteristics);\n\n    if (outputCollection) {\n      var newVariable = createProcessVariable(\n        element,\n        outputCollection,\n        containerElement\n      );\n\n      addVariableToList(processVariables, newVariable);\n    }\n  });\n\n  return processVariables;\n}\n\n/**\n * Extracts process variables from extension elements that have a result\n * variable, e.g. given the following element:\n *\n * <bpmn:businessRuleTask id=\"Task_1\">\n *   <bpmn:extensionElements>\n *     <zeebe:calledDecision resultVariable=\"foo\" />\n *   </bpmn:extensionElements>\n * </bpmn:businessRuleTask>\n *\n * a process variable with name 'foo' is extracted.\n *\n * If output variables exist, the scope is set to the element.\n *\n * If an output variable with the same name exists, e.g. given the following\n * element:\n *\n * <bpmn:businessRuleTask id=\"Task_1\">\n *   <bpmn:extensionElements>\n *     <zeebe:calledDecision resultVariable=\"foo\" />\n *     <zeebe:ioMapping>\n *       <zeebe:output target=\"foo\" />\n *     </zeebe:ioMapping>\n *   </bpmn:extensionElements>\n * </bpmn:businessRuleTask>\n *\n * no process variable is created.\n *\n * @param {Object} options\n * @param {Array<ModdleElement>} options.elements\n * @param {ModdleElement} options.containerElement\n * @param {Array<ProcessVariable>} options.processVariables\n *\n * @return {Array<ProcessVariable>}\n */\nfunction extractResultVariables(options) {\n  var elements = options.elements,\n      containerElement = options.containerElement,\n      processVariables = options.processVariables;\n\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  forEach(elements, function(element) {\n\n    var extensionElement = getCalledDecision(element) || getScript(element);\n\n    if (!extensionElement) {\n      return;\n    }\n\n    var resultVariable = extensionElement.resultVariable;\n\n    if (hasOutMappings(element)) {\n      containerElement = element;\n\n      if (processVariables.some(variable => variable.name === resultVariable)) {\n        return processVariables;\n      }\n    }\n\n    if (resultVariable) {\n      var newVariable = createProcessVariable(\n        element,\n        resultVariable,\n        containerElement\n      );\n\n      addVariableToList(processVariables, newVariable);\n    }\n  });\n\n  return processVariables;\n}\n\nfunction hasOutMappings(element) {\n  var outMappings = getOutMappings(element);\n\n  return outMappings && outMappings.length;\n}\n\nvar extractors = [\n  extractInMappings,\n  extractInputElement,\n  extractOutMappings,\n  extractOutputCollections,\n  extractResultVariables\n];\n\n/**\n * @typedef {Object} ProcessVariable\n * @property {string} name\n * @property {Array<ModdleElement>} origin\n * @property {ModdleElement} scope\n */\n\n// api /////////////////////////\n\n/**\n * Extractors add ProcessVariables to the `options.processVariables` parameter.\n * @callback extractor\n * @param {Object} options\n * @param {Array<ModdleElement>} options.elements\n * @param {ModdleElement} options.containerElement\n * @param {Array<ProcessVariable>} options.processVariables\n */\n\n/**\n * Retrieves all process variables for a given container element.\n * @param {ModdleElement} containerElement\n * @param {Array<extractor>} [additionalExtractors]\n *\n * @returns {Promise<Array<ProcessVariable>>}\n */\nfunction getProcessVariables(containerElement, additionalExtractors = []) {\n  var processVariables = [];\n\n  // (1) extract all flow elements inside the container\n  var elements = selfAndAllFlowElements([ containerElement ], false);\n\n  const allPromises = [];\n\n  // (2) extract all variables from the extractors\n  forEach([ ...extractors, ...additionalExtractors ], function(extractor) {\n    allPromises.push(extractor({\n      elements: elements,\n      containerElement: containerElement,\n      processVariables: processVariables\n    }));\n  });\n\n  return Promise.all(allPromises)\n    .then(() => processVariables);\n}\n\n/**\n * Retrieves all variables which are available in the given scope\n *\n * * Exclude variables which are only available in other scopes\n * * Exclude variables which are produced by the given element\n * * Include variables which are available in parent scopes\n *\n * @param {string} scope\n * @param {ModdleElement} rootElement element from where to extract all variables\n * @param {Array<extractor>} [additionalExtractors]\n *\n * @returns {Promise<Array<ProcessVariable>>}\n */\nasync function getVariablesForScope(scope, rootElement, additionalExtractors = []) {\n\n  var allVariables = await getProcessVariables(rootElement, additionalExtractors);\n\n  var scopeElement = getElement(scope, rootElement);\n\n  // (1) get variables for given scope\n  var scopeVariables = filter(allVariables, function(variable) {\n    return variable.scope.id === scopeElement.id;\n  });\n\n  // (2) get variables for parent scopes\n  var parents = getParents(scopeElement);\n\n  var parentsScopeVariables = filter(allVariables, function(variable) {\n    return find(parents, function(parent) {\n      return parent.id === variable.scope.id;\n    });\n  });\n\n  return combineArrays(scopeVariables, parentsScopeVariables);\n}\n\n\nfunction getVariablesForElement(element, additionalExtractors = []) {\n  return getVariablesForScope(getScope(element), getRootElement(element), additionalExtractors);\n}\n\nfunction getScope(element) {\n  const bo = getBusinessObject(element);\n\n  if (is(element, 'bpmn:Participant')) {\n    return bo.processRef.id;\n  }\n\n  return bo.id;\n}\n\nfunction getRootElement(element) {\n  const businessObject = getBusinessObject(element);\n\n  if (is(businessObject, 'bpmn:Participant')) {\n    return businessObject.processRef;\n  }\n\n  if (is(businessObject, 'bpmn:Process')) {\n    return businessObject;\n  }\n\n  let parent = businessObject;\n\n  while (parent.$parent && !is(parent, 'bpmn:Process')) {\n    parent = parent.$parent;\n  }\n\n  return parent;\n}\n\n\n// helpers ////////////////////\n\nfunction combineArrays(a, b) {\n  return a.concat(b);\n}\n\n\nfunction getBusinessObject(element) {\n  return (element && element.businessObject) || element;\n}\n\n\nfunction is(element, type) {\n  var bo = getBusinessObject(element);\n\n  return bo && (typeof bo.$instanceOf === 'function') && bo.$instanceOf(type);\n}\n\nexport { getProcessVariables, getVariablesForElement, getVariablesForScope };\n","import { VariableContext } from '@bpmn-io/lezer-feel';\n\n\n/**\n * @typedef { { entries?: Record<string, any>, [key: string]: any } } EntriesContextValue\n */\n\n/**\n * An alternative context that holds additional meta-data\n */\nexport class EntriesContext extends VariableContext {\n\n  /**\n   * @param {EntriesContextValue} value\n   */\n  constructor(value = { entries: {} }) {\n    super(value);\n\n    const entries = this.value.entries = this.value.entries || {};\n\n    for (const [ key, entry ] of Object.entries(entries)) {\n      if (entry instanceof EntriesContext) {\n        continue;\n      }\n\n      entries[key] = EntriesContext.of(entry);\n    }\n  }\n\n  getKeys() {\n    return Object.keys(this.value.entries);\n  }\n\n  get(key) {\n    const value = this.value.entries[key];\n\n    if (!value) {\n      return value;\n    }\n\n    const atomicValue = value?.value.atomicValue;\n\n    // keep value producer\n    if (atomicValue?.fn) {\n      return atomicValue;\n    }\n\n    return value;\n  }\n\n  /**\n   * @param {string} key\n   * @param {any} value\n   *\n   * @return {this}\n   */\n  set(key, value) {\n\n    const constructor = /** @type { typeof EntriesContext } */ (this.constructor);\n\n    return /** @type {this} */ (constructor.of(\n      {\n        ...this.value,\n        entries: {\n          ...this.value.entries,\n          [key]: value\n        }\n      }\n    ));\n  }\n\n  /**\n   * @param { EntriesContext | EntriesContextValue | Record<string, any> } context\n   *\n   * @return { EntriesContextValue }\n   */\n  static __unwrap(context) {\n\n    if (this.isAtomic(context)) {\n      return context instanceof this\n        ? context.value\n        : { atomicValue: context };\n    }\n\n    return context;\n  }\n\n  /**\n   * @param { EntriesContextValue } context\n   * @param { EntriesContextValue} other\n   *\n   * @return { EntriesContextValue }\n   */\n  static __merge(context, other) {\n\n    const {\n      entries: contextEntries = {},\n      ...contextRest\n    } = this.__unwrap(context);\n\n    const {\n      entries: otherEntries = {},\n      ...otherRest\n    } = this.__unwrap(other);\n\n    // @ts-ignore \"access to internals\"\n    const mergedEntries = super.__merge(contextEntries, otherEntries);\n\n    return {\n      ...contextRest,\n      ...otherRest,\n      entries: mergedEntries\n    };\n  }\n}","import { parser, trackVariables } from '@bpmn-io/lezer-feel';\nimport {\n  ContextTracker,\n} from '@lezer/lr';\n\nimport { EntriesContext } from './VariableContext';\nimport { getExtensionElementsList } from '../../base/util/ExtensionElementsUtil';\nimport { getParents } from '../../base/util/scopeUtil';\nimport { is } from 'bpmn-js/lib/util/ModelUtil';\n\nexport function parseVariables(variables) {\n\n  const variablesToResolve = [];\n\n  // Step 1 - Parse all variables and populate all that don't have references\n  // to other variables\n  variables.forEach(variable => {\n    variable.origin.forEach(origin => {\n      const expressionDetails = getExpressionDetails(variable, origin);\n\n      if (!expressionDetails) {\n        return;\n      }\n\n      const { expression, unresolved } = expressionDetails;\n\n      variablesToResolve.push({ variable, expression, unresolved });\n    });\n  });\n\n  // Step 2 - Order all Variables and resolve them\n  return resolveReferences(variablesToResolve, variables);\n}\n\nfunction resolveReferences(variablesToResolve, allVariables) {\n  const sortedVariables = [];\n\n  // Step 2.1 - Try to order Variables that rely on each other\n  variablesToResolve.forEach((details) => {\n    const { variable, unresolved } = details;\n    const insertBefore = sortedVariables.findIndex(({ unresolved: u }) => {\n      return u.includes(variable.name);\n    });\n\n    // Insert directly before the first variable that depends on this one\n    if (insertBefore > -1) {\n      sortedVariables.splice(insertBefore, 0, details);\n      return;\n    }\n\n    // Insert directly after the last variable that this one depends on\n    // this ensures that later downstream variables are behind this one\n    const insertAfter = sortedVariables.findLastIndex(({ variable: v }) => {\n      return unresolved.includes(v.name);\n    });\n\n    if (insertAfter > -1) {\n      sortedVariables.splice(insertAfter + 1, 0, details);\n      return;\n    }\n\n    sortedVariables.push(details);\n  });\n\n  const variablesWithoutMappings = allVariables.filter(v =>\n    !variablesToResolve.find(({ variable: unresolved }) => {\n      v === unresolved;\n    })\n  );\n\n  const rootContext = {\n    name: 'OuterContext',\n    entries: toOptimizedFormat(variablesWithoutMappings)\n  };\n\n  const newVariables = [];\n\n  // Step 2.2 - parse in order, building up the context with resolved variable values\n  // This will resolve all variables that don't have circular dependencies on each other\n  sortedVariables.forEach(({ variable, expression }) => {\n    const resultContext = getResultContext(expression, filterForScope(rootContext, variable));\n\n    let computedResult = resultContext.computedValue();\n\n    // Wrap primitive values in an EntriesContext\n    if (!(computedResult instanceof EntriesContext)) {\n      computedResult = EntriesContext.of(computedResult);\n    }\n\n    // Ensure we don't copy the scope from the mapped variable\n    computedResult.scope = variable.scope;\n\n    rootContext.entries[variable.name] = computedResult;\n\n    newVariables.push({\n      newVariable: toUnifiedFormat({\n        [variable.name]: computedResult\n      })[0],\n      oldVariable: variable\n    });\n  });\n\n  // Ensure meta-data (scope, origin) is kept from original variable\n  const result = newVariables.map(({ newVariable, oldVariable }) => {\n    if (oldVariable) {\n      return {\n        ...newVariable,\n        ...oldVariable\n      };\n    }\n    return newVariable;\n  });\n\n  return result;\n}\n\n\n// helpers //////////////////////\n\n/**\n * Parses the expression with the given variables and return the result context\n *\n * @param {String} expression\n * @param {Variables} variables\n * @returns {EntriesContext}\n */\nexport function getResultContext(expression, variables = {}) {\n  const contextTracker = trackVariables(variables, EntriesContext);\n\n  // This is a hack to get the latest variables from the context tracker\n  // lezer does not automatically annotate the parse tree with the context\n  let latestVariables = contextTracker.start;\n\n  const customContextTracker = new ContextTracker({\n    start: contextTracker.start,\n    reduce(...args) {\n      const result = contextTracker.reduce(...args);\n      latestVariables = result;\n      return result;\n    }\n  });\n\n  const contextualParser = parser.configure({\n    contextTracker: customContextTracker,\n    strict: true\n  });\n\n  try {\n    contextualParser.parse(expression);\n  } catch (error) {\n\n    // bail out in case of an error\n    return latestVariables;\n  }\n\n  return latestVariables;\n}\n\n/**\n * Given a Variable and a specific origin, return the mapping expression and all\n * unresolved variables used in that expression. Returns undefined if no mapping\n * exists for the given origin.\n *\n * @param {ProcessVariable} variable\n * @param {djs.model.Base} origin\n * @returns {{ expression: String, unresolved: Array<String> }}}\n */\nfunction getExpressionDetails(variable, origin) {\n\n  // if variable scope is !== origin (global), prioritize IoExpression over ScriptExpression\n  // if variable scope is === origin (local), prioritize ScriptExpression over IoExpression\n  const expression = variable.scope !== origin\n    ? getIoExpression(variable, origin) || getScriptExpression(variable, origin)\n    : getScriptExpression(variable, origin) || getIoExpression(variable, origin);\n\n  if (!expression) {\n    return;\n  }\n\n  const result = getResultContext(expression);\n\n  const unresolved = findUnresolvedVariables(result);\n\n  return { expression, unresolved };\n}\n\n/**\n * Given a Variable and a specific origin, return the mapping expression for all\n * input outputs mapping. Returns undefined if no mapping exists for the given origin.\n *\n * @param {ProcessVariable} variable\n * @param {djs.model.Base} origin\n * @returns { expression: String}\n */\nfunction getIoExpression(variable, origin) {\n  const ioMapping = getExtensionElementsList(origin, 'zeebe:IoMapping')[0];\n\n  if (!ioMapping) {\n    return;\n  }\n\n  let mappings;\n  if (origin === variable.scope) {\n    mappings = ioMapping.inputParameters;\n  } else {\n    mappings = ioMapping.outputParameters;\n  }\n\n  if (!mappings) {\n    return;\n  }\n\n  const mapping = mappings.slice().reverse().find(mapping => mapping.target === variable.name);\n\n  if (!mapping || !mapping.source) {\n    return;\n  }\n\n  return mapping.source.substring(1);\n\n}\n\n/**\n * Given a Variable and a specific origin, return the mapping expression for script\n * task result variable. Returns undefined if no mapping exists for the given origin.\n *\n * @param {ProcessVariable} variable\n * @param {djs.model.Base} origin\n * @returns {string}\n */\nfunction getScriptExpression(variable, origin) {\n  const script = getExtensionElementsList(origin, 'zeebe:Script')[0];\n\n  if (!script || !script.expression) {\n    return;\n  }\n\n  if (script.resultVariable === variable.name) {\n    return script.expression.substring(1);\n  }\n}\n\n/**\n * Traverses the parseTree and returns all `VariableName` nodes with no value\n *\n * @param {Object} node\n * @returns {Array<String>}\n */\nfunction findUnresolvedVariables(node) {\n  const results = [];\n\n  results.push(...(node.children.flatMap(findUnresolvedVariables)));\n\n  if (node.name === 'VariableName' && !node.value) {\n    results.push(node.raw);\n  }\n\n  return results;\n}\n\n\n/**\n * Transforms the entries of a variable from an array to an object.\n * This allows faster lookup times during parsing.\n *\n * [ { name, entries: [] } ]\n * to\n * {name: { name, entries: {} }}\n */\nfunction toOptimizedFormat(variables) {\n\n  if (!variables) {\n    return;\n  }\n\n  const result = {};\n\n  variables.forEach(variable => {\n    result[variable.name] = { ...variable };\n    result[variable.name].entries = toOptimizedFormat(variable.entries);\n  });\n\n  return result;\n}\n\n/**\n * Transforms EntriesContext to the format required by the feel-editor\n */\nexport function toUnifiedFormat(variables) {\n  if (!variables) {\n    return;\n  }\n\n  const result = [];\n\n  for (const key in variables) {\n    let variable = variables[key];\n\n    if (variable instanceof EntriesContext) {\n      variable = variable.value;\n    }\n\n    if (!variable) {\n      result.push({\n        name: key\n      });\n      continue;\n    }\n\n    result.push({\n      ...annotate(variable),\n      entries: toUnifiedFormat(variable.entries),\n      name: key,\n      scope: variable.scope\n    });\n  }\n\n  return result;\n}\n\n\nfunction annotate(variable) {\n  return {\n    ...variable,\n    type: getType(variable),\n    info: getInfo(variable)\n  };\n\n}\n\nfunction getType(variable) {\n\n  if (!variable) {\n    return '';\n  }\n\n  if (variable.type) {\n    return variable.type;\n  }\n\n  if (variable.entries && Object.keys(variable.entries).length) {\n    return 'Context';\n  }\n\n  if (variable.atomicValue) {\n    return capitalize(typeof variable.atomicValue);\n  }\n\n  return '';\n}\n\nfunction getInfo(variable) {\n  if (!variable) {\n    return '';\n  }\n\n  if (variable.info) {\n    return variable.info;\n  }\n\n  if (variable.atomicValue) {\n    return '' + variable.atomicValue;\n  }\n\n  return '';\n}\n\nfunction capitalize(string) {\n  return string.charAt(0).toUpperCase() + string.slice(1);\n}\n\nfunction filterForScope(context, variable) {\n  const scopedResults = {\n    entries: {}\n  };\n\n  const validScopes = variable.origin.flatMap(bo => {\n    return [ bo, ...getParents(bo) ];\n  });\n\n  for (const key in context.entries) {\n    const entry = context.entries[key];\n\n    if (validScopes.find(scope => scope.id === entry.scope.id)) {\n      scopedResults.entries[key] = entry;\n    }\n  }\n\n  return scopedResults;\n}\n\n/**\n * Remove input/output element name after current definition\n */\nexport function getElementNamesToRemove(moddleElement, inputOutput) {\n  const namesToFilter = [];\n\n  // Input: remove all inputs defined after the current input definition\n  if (is(moddleElement, 'zeebe:Input')) {\n    const allInputs = inputOutput.inputParameters;\n\n    const inputsToFilter =\n        allInputs\n          .slice(allInputs.indexOf(moddleElement))\n          .map(o => o.target);\n\n    namesToFilter.push(...inputsToFilter);\n  }\n\n  const allOutputs = inputOutput.outputParameters;\n\n  // Output: remove all outputs defined after the current output definition\n  if (is(moddleElement, 'zeebe:Output')) {\n\n    // Get all output mappings defined after the current element, including own name\n    const outputsToFilter = allOutputs\n      .slice(allOutputs.indexOf(moddleElement))\n      .map(o => o.target);\n\n    namesToFilter.push(...outputsToFilter);\n  }\n\n  // Input or general property: remove all outputs\n  else if (allOutputs) {\n\n    // Input or execution-related element, remove all outputs\n    const outputsToFilter = allOutputs\n      .map(o => o.target);\n\n    namesToFilter.push(...outputsToFilter);\n  }\n\n  return namesToFilter;\n}\n","import VariableProvider from '../../VariableProvider';\nimport { getExtensionElementsList } from '../../base/util/ExtensionElementsUtil';\nimport { getResultContext, toUnifiedFormat } from '../util/feelUtility';\n\n/**\n * TODO: This method tries to mirror the behavior of ConnectorMappings. However, this is not possible in all cases,\n * as the absence of the header has execution implications. This should be replaced with engine behavior in the\n * Connector Implementation at one point.\n */\nclass ConnectorVariableProvider extends VariableProvider {\n  getVariables(element) {\n\n    const result = [];\n\n    const taskheaders = getExtensionElementsList(element, 'zeebe:TaskHeaders')[0];\n\n    if (!taskheaders || !taskheaders.values) {\n      return;\n    }\n\n    const headers = taskheaders.values;\n\n    const resultVariable = headers.find(header => {\n      return header.key === 'resultVariable';\n    });\n\n    const resultExpression = headers.find(header => {\n      return header.key === 'resultExpression';\n    });\n\n    if (resultVariable && resultVariable.value) {\n      result.push({\n        name: resultVariable.value\n      });\n    }\n\n    if (resultExpression && resultExpression.value) {\n\n      // parse with FEEL\n      const resultContext = getResultContext(resultExpression.value.substring(1));\n\n      const expressionVariables = toUnifiedFormat(resultContext.computedValue(), result);\n\n      if (expressionVariables && expressionVariables.length > 0) {\n        result.push(\n          ...expressionVariables[0].entries\n        );\n      }\n    }\n\n    return result;\n  }\n}\n\nexport default ConnectorVariableProvider;","import CamundaVariableResolver from './camunda/VariableResolver';\nimport ZeebeVariableResolver from './zeebe/VariableResolver';\nimport VariableProvider from './VariableProvider';\nimport ConnectorVariableProvider from './zeebe/extractors/connectors';\n\nexport const ZeebeVariableResolverModule = {\n  __init__: [\n    'variableResolver',\n    'connectorVariableProvider'\n  ],\n  variableResolver: [ 'type', ZeebeVariableResolver ],\n  connectorVariableProvider: [ 'type', ConnectorVariableProvider ]\n};\n\nexport const CamundaVariableResolverModule = {\n  __init__: [\n    'variableResolver',\n  ],\n  variableResolver: [ 'type', CamundaVariableResolver ],\n};\n\nexport { VariableProvider };","import { getProcessVariables } from '@bpmn-io/extract-process-variables/zeebe';\nimport { BaseVariableResolver } from '../base/VariableResolver';\nimport {\n  parseVariables,\n  getElementNamesToRemove\n} from './util/feelUtility';\nimport {\n  getBusinessObject,\n  is\n} from 'bpmn-js/lib/util/ModelUtil';\nimport { getInputOutput } from '../base/util/ExtensionElementsUtil';\n\n\nconst HIGH_PRIORITY = 2000;\n\n/**\n * The Camunda 8 Implementation for the VariableResolver.\n */\nexport default class ZeebeVariableResolver extends BaseVariableResolver {\n  constructor(eventBus, bpmnjs) {\n    super(eventBus, bpmnjs);\n    this._baseExtractor = getProcessVariables;\n\n    eventBus.on('variableResolver.parseVariables', HIGH_PRIORITY, this._resolveVariables);\n  }\n\n  async getVariablesForElement(element, moddleElement) {\n    const variables = await super.getVariablesForElement(element);\n\n    const bo = getBusinessObject(element);\n\n    if (!moddleElement) {\n      return variables;\n    }\n\n    const inputOutput = getInputOutput(bo);\n\n    if (!inputOutput) {\n      return variables;\n    }\n\n    const namesToFilter = getElementNamesToRemove(moddleElement, inputOutput);\n\n    return variables.filter(v => {\n\n      // Keep all variables that are also defined in other elements\n      if (v.origin.length > 1 || v.origin[0] !== bo) {\n        return true;\n      }\n\n      // Keep all variables from external data providers in outputs\n      if (\n        is(moddleElement, 'zeebe:Output') &&\n        v.provider.find(extractor => extractor !== this._baseExtractor)\n      ) {\n        return true;\n      }\n\n      // Filter all pre-defined variables\n      return !namesToFilter.includes(v.name);\n    });\n  }\n\n  /**\n   * Parsed the variables and resolves the variable schema to kept the\n   * variable schema throughout the process.\n   *\n   * @param {Event} e\n   * @param {Object} context\n   * @param {Array<ProcessVariable>} context.variables\n   */\n  _resolveVariables(e, context) {\n    const rawVariables = context.variables;\n\n    const mappedVariables = {};\n\n    for (const key in rawVariables) {\n      const variables = rawVariables[key];\n      const newVariables = parseVariables(variables);\n\n      mappedVariables[key] = [ ...variables, ...newVariables ];\n    }\n\n    context.variables = mappedVariables;\n  }\n}\n","import { getProcessVariables } from '@bpmn-io/extract-process-variables';\nimport { BaseVariableResolver } from '../base/VariableResolver';\n\n/**\n * The Camunda 7 Implementation for the VariableResolver.\n */\nexport default class CamundaVariableResolver extends BaseVariableResolver {\n  constructor(eventBus, bpmnjs) {\n    super(eventBus, bpmnjs);\n    this._baseExtractor = getProcessVariables;\n  }\n}","import { getBusinessObject, is } from 'bpmn-js/lib/util/ModelUtil';\n\nimport { getErrors } from '../utils/properties-panel';\n\nexport default class Linting {\n  constructor(canvas, config, elementRegistry, eventBus, lintingAnnotations, selection) {\n    this._canvas = canvas;\n    this._elementRegistry = elementRegistry;\n    this._eventBus = eventBus;\n    this._lintingAnnotations = lintingAnnotations;\n    this._selection = selection;\n\n    this._active = config && config.active || false;\n    this._reports = [];\n\n    eventBus.on('selection.changed', () => this._update());\n\n    eventBus.on('lintingAnnotations.click', ({ report }) => this.showError(report));\n  }\n\n  showError(report) {\n    const {\n      id,\n      propertiesPanel = {}\n    } = report;\n\n    const selectableElement = this._getSelectableElement(id);\n\n    if (selectableElement) {\n      this._canvas.scrollToElement(selectableElement);\n\n      if (selectableElement === this._canvas.getRootElement()) {\n        this._selection.select();\n      } else {\n        this._selection.select(selectableElement);\n      }\n    }\n\n    const { entryIds = [] } = propertiesPanel;\n\n    // TODO(philippfromme): remove timeout once properties panel is fixed\n    setTimeout(() => {\n      this._eventBus.fire('propertiesPanel.showEntry', {\n        id: entryIds[ Math.max(0, entryIds.length - 1) ]\n      });\n    });\n  }\n\n  setErrors(reports) {\n    this._reports = reports;\n\n    this._update();\n  }\n\n  activate() {\n    this._active = true;\n\n    this._update();\n  }\n\n  deactivate() {\n    this._active = false;\n\n    this._update();\n  }\n\n  isActive() {\n    return this._active;\n  }\n\n  _update() {\n\n    // set annotations\n    this._lintingAnnotations.setErrors(this.isActive() ? this._reports : []);\n\n    // set properties panel errors\n    const selectedElement = this._getSelectedElement();\n\n    this._eventBus.fire('propertiesPanel.setErrors', {\n      errors: getErrors(this._reports, selectedElement)\n    });\n  }\n\n  _getSelectableElement(id) {\n    let element = this._elementRegistry.get(id);\n\n    if (!element) {\n      element = this._elementRegistry.filter(element => {\n        return is(element, 'bpmn:Participant') && getBusinessObject(element).get('processRef').get('id') === id;\n      })[ 0 ];\n    }\n\n    return element;\n  }\n\n  _getSelectedElement() {\n    const selection = this._selection.get();\n\n    if (!selection || !selection.length) {\n      return this._canvas.getRootElement();\n    }\n\n    const selectedElement = selection[ 0 ];\n\n    if (isLabel(selectedElement)) {\n      return selectedElement.labelTarget;\n    }\n\n    return selectedElement;\n  }\n}\n\nLinting.$inject = [\n  'canvas',\n  'config.linting',\n  'elementRegistry',\n  'eventBus',\n  'lintingAnnotations',\n  'selection'\n];\n\nfunction isLabel(element) {\n  return !!element.labelTarget;\n}\n","import {\n  render as renderComponent,\n  html\n} from '@bpmn-io/diagram-js-ui';\n\nimport classNames from 'clsx';\n\nconst errorSvg = html`\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\n  <path d=\"M16,2C8.3,2,2,8.3,2,16s6.3,14,14,14s14-6.3,14-14S23.7,2,16,2z M21.4,23L16,17.6L10.6,23L9,21.4l5.4-5.4L9,10.6L10.6,9\n    l5.4,5.4L21.4,9l1.6,1.6L17.6,16l5.4,5.4L21.4,23z\" fill=\"currentColor\" />\n</svg>\n`;\n\nconst warningSvg = html`\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\n<path d=\"M16,2C8.3,2,2,8.3,2,16s6.3,14,14,14s14-6.3,14-14C30,8.3,23.7,2,16,2z M14.9,8h2.2v11h-2.2V8z M16,25\n  c-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22c0.8,0,1.5,0.7,1.5,1.5S16.8,25,16,25z\" fill=\"currentColor\" />\n</svg>\n`;\n\nconst infoSvg = html`\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\n  <path d=\"M16,2A14,14,0,1,0,30,16,14,14,0,0,0,16,2Zm0,6a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,16,8Zm4,16.125H12v-2.25h2.875v-5.75H13v-2.25h4.125v8H20Z\" fill=\"currentColor\" />\n</svg>\n`;\n\nconst icons = {\n  error: errorSvg,\n  warn: warningSvg,\n  info: infoSvg\n};\n\nexport function OverlayComponent(props) {\n\n  const {\n    onClick = () => {},\n    reports\n  } = props;\n\n  const category =\n    reports.find(({ category }) => category === 'error')\n      ? 'error'\n      : reports.find(({ category }) => category === 'warn')\n        ? 'warn'\n        : 'info';\n\n  return html`\n    <div\n      class=${ classNames('cl-icon',`cl-icon-${category}`) }\n      onClick=${ onClick }\n      title=\"Click to show issue\"\n    >\n      ${ icons[category] }\n    </div>\n  `;\n}\n\nexport function renderOverlay(el, props) {\n  return renderComponent(html`<${OverlayComponent} ...${props} />`, el);\n}","import { groupBy } from 'min-dash';\n\nimport { domify } from 'min-dom';\n\nimport { renderOverlay } from './OverlayComponent';\nimport { is } from 'bpmn-js/lib/util/ModelUtil';\n\n\nexport default class LintingAnnotations {\n  constructor(canvas, elementRegistry, eventBus, overlays) {\n    this._canvas = canvas;\n    this._elementRegistry = elementRegistry;\n    this._eventBus = eventBus;\n    this._overlays = overlays;\n\n    this._reportsByElement = {};\n\n    this._overlayIds = {};\n  }\n\n  setErrors(reports) {\n    this._reportsByElement = groupBy(reports.filter(report => report.category !== 'rule-error'), 'id');\n\n    this._update();\n  }\n\n  _update(reportsByElement) {\n    if (!reportsByElement) {\n      reportsByElement = this._reportsByElement;\n    }\n\n    this._overlays.remove({ type: 'linting' });\n\n    Object.entries(reportsByElement).forEach(([ id, reports ]) => {\n      const element = this._elementRegistry.get(id);\n\n      if (!element || element === this._canvas.getRootElement()) {\n        return;\n      }\n\n      const html = domify(`\n        <div class=\"cl-overlay-root\"></div>\n      `);\n\n      renderOverlay(html, {\n        reports,\n        onClick: () => {\n          this._eventBus.fire('lintingAnnotations.click', { report: reports[ 0 ] });\n        }\n      });\n\n      const position = getAnnotationPosition(element);\n\n      const overlayId = this._overlays.add(element, 'linting', {\n        position,\n        html,\n        scale: {\n          min: .7\n        }\n      });\n\n      this._overlayIds[ id ] = overlayId;\n    });\n  }\n}\n\nLintingAnnotations.$inject = [\n  'canvas',\n  'elementRegistry',\n  'eventBus',\n  'overlays'\n];\n\n\nfunction getAnnotationPosition(element) {\n\n  if (!element.parent) {\n\n    if (is(element, 'bpmn:SubProcess')) {\n      return {\n        top: 50,\n        left: 150\n      };\n    }\n\n    return {\n      top: 20,\n      left: 150\n    };\n  }\n\n  return {\n    bottom: 14,\n    left: -6\n  };\n}","import Linting from './Linting';\nimport LintingAnnotations from './LintingAnnotations';\n\nexport default {\n  __init__: [\n    'linting',\n    'lintingAnnotations'\n  ],\n  linting: [ 'type', Linting ],\n  lintingAnnotations: [ 'type', LintingAnnotations ]\n};","const colorImageSvg = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"22\" height=\"22\" fill=\"currentColor\">\r\n  <path d=\"m12.5 5.5.3-.4 3.6-3.6c.5-.5 1.3-.5 1.7 0l1 1c.5.4.5 1.2 0 1.7l-3.6 3.6-.4.2v.2c0 1.4.6 2 1 2.7v.6l-1.7 1.6c-.2.2-.4.2-.6 0L7.3 6.6a.4.4 0 0 1 0-.6l.3-.3.5-.5.8-.8c.2-.2.4-.1.6 0 .9.5 1.5 1.1 3 1.1zm-9.9 6 4.2-4.2 6.3 6.3-4.2 4.2c-.3.3-.9.3-1.2 0l-.8-.8-.9-.8-2.3-2.9\" />\r\n</svg>`;\r\n\r\n\r\nexport default function ColorContextPadProvider(contextPad, popupMenu, canvas, translate) {\r\n\r\n  this._contextPad = contextPad;\r\n  this._popupMenu = popupMenu;\r\n  this._canvas = canvas;\r\n  this._translate = translate;\r\n\r\n  contextPad.registerProvider(this);\r\n}\r\n\r\n\r\nColorContextPadProvider.$inject = [\r\n  'contextPad',\r\n  'popupMenu',\r\n  'canvas',\r\n  'translate'\r\n];\r\n\r\n\r\nColorContextPadProvider.prototype.getContextPadEntries = function(element) {\r\n  return this._createPopupAction([ element ]);\r\n};\r\n\r\n\r\nColorContextPadProvider.prototype.getMultiElementContextPadEntries = function(elements) {\r\n\r\n  return this._createPopupAction(elements);\r\n};\r\n\r\nColorContextPadProvider.prototype._createPopupAction = function(elements) {\r\n\r\n  const translate = this._translate;\r\n  const contextPad = this._contextPad;\r\n  const popupMenu = this._popupMenu;\r\n\r\n  return {\r\n    'set-color': {\r\n      group: 'edit',\r\n      className: 'bpmn-icon-color',\r\n      title: translate('Set color'),\r\n      html: `<div class=\"entry\">${colorImageSvg}</div>`,\r\n      action: {\r\n        click: (event, element) => {\r\n\r\n          // get start popup draw start position\r\n          var position = {\r\n            ...getStartPosition(contextPad, elements),\r\n            cursor: {\r\n              x: event.x,\r\n              y: event.y\r\n            }\r\n          };\r\n\r\n          // open new color-picker popup\r\n          popupMenu.open(elements, 'color-picker', position);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n};\r\n\r\n\r\n// helpers //////////////////////\r\n\r\nfunction getStartPosition(contextPad, elements) {\r\n\r\n  var Y_OFFSET = 5;\r\n\r\n  var pad = contextPad.getPad(elements).html;\r\n\r\n  var padRect = pad.getBoundingClientRect();\r\n\r\n  var pos = {\r\n    x: padRect.left,\r\n    y: padRect.bottom + Y_OFFSET\r\n  };\r\n\r\n  return pos;\r\n}\r\n","const COLORS = [ {\n  label: 'Default',\n  fill: undefined,\n  stroke: undefined\n}, {\n  label: 'Blue',\n  fill: '#BBDEFB',\n  stroke: '#0D4372'\n}, {\n  label: 'Orange',\n  fill: '#FFE0B2',\n  stroke: '#6B3C00'\n}, {\n  label: 'Green',\n  fill: '#C8E6C9',\n  stroke: '#205022'\n}, {\n  label: 'Red',\n  fill: '#FFCDD2',\n  stroke: '#831311'\n}, {\n  label: 'Purple',\n  fill: '#E1BEE7',\n  stroke: '#5B176D'\n} ];\n\n\nexport default function ColorPopupProvider(config, bpmnRendererConfig, popupMenu, modeling, translate) {\n  this._popupMenu = popupMenu;\n  this._modeling = modeling;\n  this._translate = translate;\n\n  this._colors = config && config.colors || COLORS;\n  this._defaultFillColor = bpmnRendererConfig && bpmnRendererConfig.defaultFillColor || 'white';\n  this._defaultStrokeColor = bpmnRendererConfig && bpmnRendererConfig.defaultStrokeColor || 'rgb(34, 36, 42)';\n\n  this._popupMenu.registerProvider('color-picker', this);\n}\n\n\nColorPopupProvider.$inject = [\n  'config.colorPicker',\n  'config.bpmnRenderer',\n  'popupMenu',\n  'modeling',\n  'translate'\n];\n\n\nColorPopupProvider.prototype.getEntries = function(elements) {\n  var self = this;\n\n  var colorIconHtml = `\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 25 25\" height=\"100%\" width=\"100%\">\n      <rect rx=\"2\" x=\"1\" y=\"1\" width=\"22\" height=\"22\" fill=\"var(--fill-color)\" stroke=\"var(--stroke-color)\" style=\"stroke-width:2\"></rect>\n    </svg>\n  `;\n\n  var entries = this._colors.map(function(color) {\n\n    var entryColorIconHtml = colorIconHtml.replace('var(--fill-color)', color.fill || self._defaultFillColor)\n      .replace('var(--stroke-color)', color.stroke || self._defaultStrokeColor);\n\n    return {\n      title: self._translate(color.label),\n      id: color.label.toLowerCase() + '-color',\n      imageHtml: entryColorIconHtml,\n      action: createAction(self._modeling, elements, color)\n    };\n  });\n\n  return entries;\n};\n\n\nfunction createAction(modeling, element, color) {\n  return function() {\n    modeling.setColor(element, color);\n  };\n}","import ColorContextPadProvider from './ColorContextPadProvider';\nimport ColorPopupProvider from './ColorPopupProvider';\n\nexport default {\n  __init__: [\n    'colorContextPadProvider',\n    'colorPopupProvider'\n  ],\n  colorContextPadProvider: [ 'type', ColorContextPadProvider ],\n  colorPopupProvider: [ 'type', ColorPopupProvider ]\n};","/**\n * Flatten array, one level deep.\n *\n * @template T\n *\n * @param {T[][] | T[] | null} [arr]\n *\n * @return {T[]}\n */\n\nconst nativeToString = Object.prototype.toString;\nconst nativeHasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction isUndefined(obj) {\n  return obj === undefined;\n}\n\nfunction isNil(obj) {\n  return obj == null;\n}\n\nfunction isArray(obj) {\n  return nativeToString.call(obj) === '[object Array]';\n}\n\nfunction isObject(obj) {\n  return nativeToString.call(obj) === '[object Object]';\n}\n\nfunction isNumber(obj) {\n  return nativeToString.call(obj) === '[object Number]';\n}\n\n/**\n * @param {any} obj\n *\n * @return {boolean}\n */\nfunction isFunction(obj) {\n  const tag = nativeToString.call(obj);\n\n  return (\n    tag === '[object Function]' ||\n    tag === '[object AsyncFunction]' ||\n    tag === '[object GeneratorFunction]' ||\n    tag === '[object AsyncGeneratorFunction]' ||\n    tag === '[object Proxy]'\n  );\n}\n\n/**\n * Return true, if target owns a property with the given key.\n *\n * @param {Object} target\n * @param {String} key\n *\n * @return {Boolean}\n */\nfunction has(target, key) {\n  return !isNil(target) && nativeHasOwnProperty.call(target, key);\n}\n\n/**\n * @template T\n * @typedef { (\n *   ((e: T) => boolean) |\n *   ((e: T, idx: number) => boolean) |\n *   ((e: T, key: string) => boolean) |\n *   string |\n *   number\n * ) } Matcher\n */\n\n/**\n * @template T\n * @template U\n *\n * @typedef { (\n *   ((e: T) => U) | string | number\n * ) } Extractor\n */\n\n\n/**\n * @template T\n * @typedef { (val: T, key: any) => boolean } MatchFn\n */\n\n/**\n * @template T\n * @typedef { T[] } ArrayCollection\n */\n\n/**\n * @template T\n * @typedef { { [key: string]: T } } StringKeyValueCollection\n */\n\n/**\n * @template T\n * @typedef { { [key: number]: T } } NumberKeyValueCollection\n */\n\n/**\n * @template T\n * @typedef { StringKeyValueCollection<T> | NumberKeyValueCollection<T> } KeyValueCollection\n */\n\n/**\n * @template T\n * @typedef { KeyValueCollection<T> | ArrayCollection<T> } Collection\n */\n\n/**\n * Find element in collection.\n *\n * @template T\n * @param {Collection<T>} collection\n * @param {Matcher<T>} matcher\n *\n * @return {Object}\n */\nfunction find(collection, matcher) {\n\n  const matchFn = toMatcher(matcher);\n\n  let match;\n\n  forEach(collection, function(val, key) {\n    if (matchFn(val, key)) {\n      match = val;\n\n      return false;\n    }\n  });\n\n  return match;\n\n}\n\n\n/**\n * Iterate over collection; returning something\n * (non-undefined) will stop iteration.\n *\n * @template T\n * @param {Collection<T>} collection\n * @param { ((item: T, idx: number) => (boolean|void)) | ((item: T, key: string) => (boolean|void)) } iterator\n *\n * @return {T} return result that stopped the iteration\n */\nfunction forEach(collection, iterator) {\n\n  let val,\n      result;\n\n  if (isUndefined(collection)) {\n    return;\n  }\n\n  const convertKey = isArray(collection) ? toNum : identity;\n\n  for (let key in collection) {\n\n    if (has(collection, key)) {\n      val = collection[key];\n\n      result = iterator(val, convertKey(key));\n\n      if (result === false) {\n        return val;\n      }\n    }\n  }\n}\n\n\n/**\n * Return true if some elements in the collection\n * match the criteria.\n *\n * @param  {Object|Array} collection\n * @param  {Function} matcher\n *\n * @return {Boolean}\n */\nfunction some(collection, matcher) {\n\n  return !!find(collection, matcher);\n}\n\n\n/**\n * @template T\n * @param {Matcher<T>} matcher\n *\n * @return {MatchFn<T>}\n */\nfunction toMatcher(matcher) {\n  return isFunction(matcher) ? matcher : (e) => {\n    return e === matcher;\n  };\n}\n\n\nfunction identity(arg) {\n  return arg;\n}\n\nfunction toNum(arg) {\n  return Number(arg);\n}\n\n/**\n * Convenience wrapper for `Object.assign`.\n *\n * @param {Object} target\n * @param {...Object} others\n *\n * @return {Object} the target\n */\nfunction assign(target, ...others) {\n  return Object.assign(target, ...others);\n}\n\nconst EVENT_GROUP = {\n  id: 'events',\n  name: 'Events'\n};\n\nconst TASK_GROUP = {\n  id: 'tasks',\n  name: 'Tasks'\n};\n\nconst DATA_GROUP = {\n  id: 'data',\n  name: 'Data'\n};\n\nconst PARTICIPANT_GROUP = {\n  id: 'participants',\n  name: 'Participants'\n};\n\nconst SUBPROCESS_GROUP = {\n  id: 'subprocess',\n  name: 'Sub-processes'\n};\n\nconst GATEWAY_GROUP = {\n  id: 'gateways',\n  name: 'Gateways'\n};\n\nconst NONE_EVENTS = [\n  {\n    label: 'Start event',\n    actionName: 'none-start-event',\n    className: 'bpmn-icon-start-event-none',\n    target: {\n      type: 'bpmn:StartEvent'\n    }\n  },\n  {\n    label: 'Intermediate throw event',\n    actionName: 'none-intermediate-throwing',\n    className: 'bpmn-icon-intermediate-event-none',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent'\n    }\n  },\n  {\n    label: 'Boundary event',\n    actionName: 'none-boundary-event',\n    className: 'bpmn-icon-intermediate-event-none',\n    target: {\n      type: 'bpmn:BoundaryEvent'\n    }\n  },\n  {\n    label: 'End event',\n    actionName: 'none-end-event',\n    className: 'bpmn-icon-end-event-none',\n    target: {\n      type: 'bpmn:EndEvent'\n    }\n  }\n].map(option => ({ ...option, group: EVENT_GROUP }));\n\nconst TYPED_START_EVENTS = [\n  {\n    label: 'Message start event',\n    actionName: 'message-start',\n    className: 'bpmn-icon-start-event-message',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Timer start event',\n    actionName: 'timer-start',\n    className: 'bpmn-icon-start-event-timer',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition'\n    }\n  },\n  {\n    label: 'Conditional start event',\n    actionName: 'conditional-start',\n    className: 'bpmn-icon-start-event-condition',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition'\n    }\n  },\n  {\n    label: 'Signal start event',\n    actionName: 'signal-start',\n    className: 'bpmn-icon-start-event-signal',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  }\n].map(option => ({ ...option, group: EVENT_GROUP }));\n\nconst TYPED_NON_INTERRUPTING_START_EVENTS = [\n  {\n    label: 'Message start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-message-start',\n    className: 'bpmn-icon-start-event-non-interrupting-message',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Timer start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-timer-start',\n    className: 'bpmn-icon-start-event-non-interrupting-timer',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Conditional start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-conditional-start',\n    className: 'bpmn-icon-start-event-non-interrupting-condition',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Signal start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-signal-start',\n    className: 'bpmn-icon-start-event-non-interrupting-signal',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Escalation start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-escalation-start',\n    className: 'bpmn-icon-start-event-non-interrupting-escalation',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition',\n      isInterrupting: false\n    }\n  }\n].map(option => ({ ...option, group: EVENT_GROUP, rank: -1 }));\n\nconst TYPED_INTERMEDIATE_EVENT = [\n  {\n    label: 'Message intermediate catch event',\n    actionName: 'message-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-message',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Message intermediate throw event',\n    actionName: 'message-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-message',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Timer intermediate catch event',\n    actionName: 'timer-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-timer',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition'\n    }\n  },\n  {\n    label: 'Escalation intermediate throw event',\n    actionName: 'escalation-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-escalation',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition'\n    }\n  },\n  {\n    label: 'Conditional intermediate catch event',\n    actionName: 'conditional-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-condition',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition'\n    }\n  },\n  {\n    label: 'Link intermediate catch event',\n    actionName: 'link-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-link',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:LinkEventDefinition',\n      eventDefinitionAttrs: {\n        name: ''\n      }\n    }\n  },\n  {\n    label: 'Link intermediate throw event',\n    actionName: 'link-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-link',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:LinkEventDefinition',\n      eventDefinitionAttrs: {\n        name: ''\n      }\n    }\n  },\n  {\n    label: 'Compensation intermediate throw event',\n    actionName: 'compensation-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-compensation',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition'\n    }\n  },\n  {\n    label: 'Signal intermediate catch event',\n    actionName: 'signal-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-signal',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  },\n  {\n    label: 'Signal intermediate throw event',\n    actionName: 'signal-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-signal',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  }\n].map(option => ({ ...option, group: EVENT_GROUP }));\n\nconst TYPED_BOUNDARY_EVENT = [\n  {\n    label: 'Message boundary event',\n    actionName: 'message-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-message',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Timer boundary event',\n    actionName: 'timer-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-timer',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition'\n    }\n  },\n  {\n    label: 'Escalation boundary event',\n    actionName: 'escalation-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-escalation',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition'\n    }\n  },\n  {\n    label: 'Conditional boundary event',\n    actionName: 'conditional-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-condition',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition'\n    }\n  },\n  {\n    label: 'Error boundary event',\n    actionName: 'error-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-error',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:ErrorEventDefinition'\n    }\n  },\n  {\n    label: 'Cancel boundary event',\n    actionName: 'cancel-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-cancel',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:CancelEventDefinition'\n    }\n  },\n  {\n    label: 'Signal boundary event',\n    actionName: 'signal-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-signal',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  },\n  {\n    label: 'Compensation boundary event',\n    actionName: 'compensation-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-compensation',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition'\n    }\n  },\n  {\n    label: 'Message boundary event (non-interrupting)',\n    actionName: 'non-interrupting-message-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-message',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Timer boundary event (non-interrupting)',\n    actionName: 'non-interrupting-timer-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-timer',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Escalation boundary event (non-interrupting)',\n    actionName: 'non-interrupting-escalation-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-escalation',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Conditional boundary event (non-interrupting)',\n    actionName: 'non-interrupting-conditional-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-condition',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Signal boundary event (non-interrupting)',\n    actionName: 'non-interrupting-signal-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-signal',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition',\n      cancelActivity: false\n    }\n  }\n].map(option => ({ ...option, group: EVENT_GROUP }));\n\nconst TYPED_END_EVENT = [\n  {\n    label: 'Message end event',\n    actionName: 'message-end',\n    className: 'bpmn-icon-end-event-message',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Escalation end event',\n    actionName: 'escalation-end',\n    className: 'bpmn-icon-end-event-escalation',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition'\n    }\n  },\n  {\n    label: 'Error end event',\n    actionName: 'error-end',\n    className: 'bpmn-icon-end-event-error',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:ErrorEventDefinition'\n    }\n  },\n  {\n    label: 'Cancel end event',\n    actionName: 'cancel-end',\n    className: 'bpmn-icon-end-event-cancel',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:CancelEventDefinition'\n    }\n  },\n  {\n    label: 'Compensation end event',\n    actionName: 'compensation-end',\n    className: 'bpmn-icon-end-event-compensation',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition'\n    }\n  },\n  {\n    label: 'Signal end event',\n    actionName: 'signal-end',\n    className: 'bpmn-icon-end-event-signal',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  },\n  {\n    label: 'Terminate end event',\n    actionName: 'terminate-end',\n    className: 'bpmn-icon-end-event-terminate',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:TerminateEventDefinition'\n    }\n  }\n].map(option => ({ ...option, group: EVENT_GROUP }));\n\nconst GATEWAY$1 = [\n  {\n    label: 'Exclusive gateway',\n    actionName: 'exclusive-gateway',\n    className: 'bpmn-icon-gateway-xor',\n    target: {\n      type: 'bpmn:ExclusiveGateway'\n    }\n  },\n  {\n    label: 'Parallel gateway',\n    actionName: 'parallel-gateway',\n    className: 'bpmn-icon-gateway-parallel',\n    target: {\n      type: 'bpmn:ParallelGateway'\n    }\n  },\n  {\n    label: 'Inclusive gateway',\n    search: 'or',\n    actionName: 'inclusive-gateway',\n    className: 'bpmn-icon-gateway-or',\n    target: {\n      type: 'bpmn:InclusiveGateway'\n    },\n    rank: -1\n  },\n  {\n    label: 'Complex gateway',\n    actionName: 'complex-gateway',\n    className: 'bpmn-icon-gateway-complex',\n    target: {\n      type: 'bpmn:ComplexGateway'\n    },\n    rank: -1\n  },\n  {\n    label: 'Event-based gateway',\n    actionName: 'event-based-gateway',\n    className: 'bpmn-icon-gateway-eventbased',\n    target: {\n      type: 'bpmn:EventBasedGateway',\n      instantiate: false,\n      eventGatewayType: 'Exclusive'\n    }\n  }\n].map(option => ({ ...option, group: GATEWAY_GROUP }));\n\nconst SUBPROCESS = [\n  {\n    label: 'Call activity',\n    actionName: 'call-activity',\n    className: 'bpmn-icon-call-activity',\n    target: {\n      type: 'bpmn:CallActivity'\n    }\n  },\n  {\n    label: 'Transaction',\n    actionName: 'transaction',\n    className: 'bpmn-icon-transaction',\n    target: {\n      type: 'bpmn:Transaction',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Event sub-process',\n    search: 'subprocess',\n    actionName: 'event-subprocess',\n    className: 'bpmn-icon-event-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      triggeredByEvent: true,\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Sub-process (collapsed)',\n    search: 'subprocess',\n    actionName: 'collapsed-subprocess',\n    className: 'bpmn-icon-subprocess-collapsed',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: false\n    }\n  },\n  {\n    label: 'Sub-process (expanded)',\n    search: 'subprocess',\n    actionName: 'expanded-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Ad-hoc sub-process (collapsed)',\n    search: 'adhoc subprocess',\n    actionName: 'collapsed-ad-hoc-subprocess',\n    className: 'bpmn-icon-subprocess-collapsed',\n    target: {\n      type: 'bpmn:AdHocSubProcess',\n      isExpanded: false\n    }\n  },\n  {\n    label: 'Ad-hoc sub-process (expanded)',\n    search: 'adhoc subprocess',\n    actionName: 'expanded-ad-hoc-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:AdHocSubProcess',\n      isExpanded: true\n    }\n  }\n].map(option => ({ ...option, group: SUBPROCESS_GROUP }));\n\nconst TASK$1 = [\n  {\n    label: 'Task',\n    actionName: 'task',\n    className: 'bpmn-icon-task',\n    target: {\n      type: 'bpmn:Task'\n    }\n  },\n  {\n    label: 'User task',\n    actionName: 'user-task',\n    className: 'bpmn-icon-user',\n    target: {\n      type: 'bpmn:UserTask'\n    }\n  },\n  {\n    label: 'Service task',\n    actionName: 'service-task',\n    className: 'bpmn-icon-service',\n    target: {\n      type: 'bpmn:ServiceTask'\n    }\n  },\n  {\n    label: 'Send task',\n    actionName: 'send-task',\n    className: 'bpmn-icon-send',\n    target: {\n      type: 'bpmn:SendTask'\n    },\n    rank: -1\n  },\n  {\n    label: 'Receive task',\n    actionName: 'receive-task',\n    className: 'bpmn-icon-receive',\n    target: {\n      type: 'bpmn:ReceiveTask'\n    },\n    rank: -1\n  },\n  {\n    label: 'Manual task',\n    actionName: 'manual-task',\n    className: 'bpmn-icon-manual',\n    target: {\n      type: 'bpmn:ManualTask'\n    },\n    rank: -1\n  },\n  {\n    label: 'Business rule task',\n    actionName: 'rule-task',\n    className: 'bpmn-icon-business-rule',\n    target: {\n      type: 'bpmn:BusinessRuleTask'\n    }\n  },\n  {\n    label: 'Script task',\n    actionName: 'script-task',\n    className: 'bpmn-icon-script',\n    target: {\n      type: 'bpmn:ScriptTask'\n    }\n  }\n].map(option => ({ ...option, group: TASK_GROUP }));\n\nconst DATA_OBJECTS = [\n  {\n    label: 'Data store reference',\n    actionName: 'data-store-reference',\n    className: 'bpmn-icon-data-store',\n    target: {\n      type: 'bpmn:DataStoreReference'\n    }\n  },\n  {\n    label: 'Data object reference',\n    actionName: 'data-object-reference',\n    className: 'bpmn-icon-data-object',\n    target: {\n      type: 'bpmn:DataObjectReference'\n    }\n  }\n].map(option => ({ ...option, group: DATA_GROUP }));\n\nconst PARTICIPANT$1 = [\n  {\n    label: 'Expanded pool/participant',\n    search: 'Non-empty pool/participant',\n    actionName: 'expanded-pool',\n    className: 'bpmn-icon-participant',\n    target: {\n      type: 'bpmn:Participant',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Empty pool/participant',\n    search: 'Collapsed pool/participant',\n    actionName: 'collapsed-pool',\n    className: 'bpmn-icon-lane',\n    target: {\n      type: 'bpmn:Participant',\n      isExpanded: false\n    }\n  }\n].map(option => ({ ...option, group: PARTICIPANT_GROUP }));\n\nconst CREATE_OPTIONS = [\n  ...GATEWAY$1,\n  ...TASK$1,\n  ...SUBPROCESS,\n  ...NONE_EVENTS,\n  ...TYPED_START_EVENTS,\n  ...TYPED_NON_INTERRUPTING_START_EVENTS,\n  ...TYPED_INTERMEDIATE_EVENT,\n  ...TYPED_END_EVENT,\n  ...TYPED_BOUNDARY_EVENT,\n  ...DATA_OBJECTS,\n  ...PARTICIPANT$1\n];\n\n/**\n * This module is an append menu provider for the popup menu.\n */\nfunction AppendMenuProvider(\n    elementFactory, popupMenu,\n    create, autoPlace, rules,\n    mouse, translate\n) {\n\n  this._elementFactory = elementFactory;\n  this._popupMenu = popupMenu;\n  this._create = create;\n  this._autoPlace = autoPlace;\n  this._rules = rules;\n  this._create = create;\n  this._mouse = mouse;\n  this._translate = translate;\n\n  this.register();\n}\n\nAppendMenuProvider.$inject = [\n  'elementFactory',\n  'popupMenu',\n  'create',\n  'autoPlace',\n  'rules',\n  'mouse',\n  'translate'\n];\n\n/**\n * Register append menu provider in the popup menu\n */\nAppendMenuProvider.prototype.register = function() {\n  this._popupMenu.registerProvider('bpmn-append', this);\n};\n\n/**\n * Gets the append options for the given element as menu entries\n *\n * @param {djs.model.Base} element\n *\n * @return {Array<Object>} a list of menu entry items\n */\nAppendMenuProvider.prototype.getPopupMenuEntries = function(element) {\n  const rules = this._rules;\n  const translate = this._translate;\n\n  const entries = {};\n\n  if (!rules.allowed('shape.append', { element: element })) {\n    return [];\n  }\n\n  // filter out elements with no incoming connections\n  const appendOptions = this._filterEntries(CREATE_OPTIONS);\n\n  // map options to menu entries\n  appendOptions.forEach(option => {\n    const {\n      actionName,\n      className,\n      label,\n      target,\n      description,\n      group,\n      search,\n      rank\n    } = option;\n\n    entries[`append-${actionName}`] = {\n      label: label && translate(label),\n      className,\n      description,\n      group: group && {\n        ...group,\n        name: translate(group.name)\n      },\n      search,\n      rank,\n      action: this._createEntryAction(element, target)\n    };\n  });\n\n  return entries;\n};\n\n/**\n * Filter out entries from the options.\n *\n * @param {Array<Object>} entries\n *\n * @return {Array<Object>} filtered entries\n */\nAppendMenuProvider.prototype._filterEntries = function(entries) {\n  return entries.filter(option => {\n\n    const target = option.target;\n    const {\n      type,\n      eventDefinitionType\n    } = target;\n\n    if ([\n      'bpmn:StartEvent',\n      'bpmn:Participant'\n    ].includes(type)) {\n      return false;\n    }\n\n    if (type === 'bpmn:BoundaryEvent' && isUndefined(eventDefinitionType)) {\n      return false;\n    }\n\n    return true;\n  });\n};\n\n/**\n * Create an action for a given target.\n *\n * @param {djs.model.Base} element\n * @param {Object} target\n *\n * @return {Object}\n */\nAppendMenuProvider.prototype._createEntryAction = function(element, target) {\n  const elementFactory = this._elementFactory;\n  const autoPlace = this._autoPlace;\n  const create = this._create;\n  const mouse = this._mouse;\n\n\n  const autoPlaceElement = () => {\n    const newElement = elementFactory.create('shape', target);\n    autoPlace.append(element, newElement);\n  };\n\n  const manualPlaceElement = (event) => {\n    const newElement = elementFactory.create('shape', target);\n\n    if (event instanceof KeyboardEvent) {\n      event = mouse.getLastMoveEvent();\n    }\n\n    return create.start(event, newElement, {\n      source: element\n    });\n  };\n\n  return {\n    click: this._canAutoPlaceElement(target) ? autoPlaceElement : manualPlaceElement,\n    dragstart: manualPlaceElement\n  };\n};\n\n/**\n * Check if the element should be auto placed.\n *\n * @param {Object} target\n *\n * @return {Boolean}\n */\nAppendMenuProvider.prototype._canAutoPlaceElement = (target) => {\n  const { type } = target;\n\n  if (type === 'bpmn:BoundaryEvent') {\n    return false;\n  }\n\n  if (type === 'bpmn:SubProcess' && target.triggeredByEvent) {\n    return false;\n  }\n\n  if (type === 'bpmn:IntermediateCatchEvent' && target.eventDefinitionType === 'bpmn:LinkEventDefinition') {\n    return false;\n  }\n\n  return true;\n};\n\nconst appendIcon = `<svg width=\"22\" height=\"22\" viewBox=\"0 0 5.82 5.82\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\">\n  <path d=\"M1.3 3.4c.3 0 .5-.2.5-.5s-.2-.4-.5-.4c-.2 0-.4.1-.4.4 0 .3.2.5.4.5zM3 3.4c.2 0 .4-.2.4-.5s-.2-.4-.4-.4c-.3 0-.5.1-.5.4 0 .3.2.5.5.5zM4.6 3.4c.2 0 .4-.2.4-.5s-.2-.4-.4-.4c-.3 0-.5.1-.5.4 0 .3.2.5.5.5z\"/>\n</svg>`;\nconst createIcon = `<svg width=\"46\" height=\"46\" viewBox=\"-2 -2 9.82 9.82\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\">\n  <path d=\"M1.3 3.4c.3 0 .5-.2.5-.5s-.2-.4-.5-.4c-.2 0-.4.1-.4.4 0 .3.2.5.4.5zM3 3.4c.2 0 .4-.2.4-.5s-.2-.4-.4-.4c-.3 0-.5.1-.5.4 0 .3.2.5.5.5zM4.6 3.4c.2 0 .4-.2.4-.5s-.2-.4-.4-.4c-.3 0-.5.1-.5.4 0 .3.2.5.5.5z\"/>\n</svg>`;\n\n/**\n * A provider for append context pad button\n */\nfunction AppendContextPadProvider(contextPad, popupMenu, translate, canvas, rules) {\n\n  this._contextPad = contextPad;\n  this._popupMenu = popupMenu;\n  this._translate = translate;\n  this._canvas = canvas;\n  this._rules = rules;\n\n  this.register();\n}\n\nAppendContextPadProvider.$inject = [\n  'contextPad',\n  'popupMenu',\n  'translate',\n  'canvas',\n  'rules'\n];\n\n/**\n * Register append button provider in the context pad\n */\nAppendContextPadProvider.prototype.register = function() {\n  this._contextPad.registerProvider(this);\n};\n\n/**\n * Gets the append context pad entry\n *\n * @param {djs.model.Base} element\n * @returns {Object} entries\n */\nAppendContextPadProvider.prototype.getContextPadEntries = function(element) {\n  const popupMenu = this._popupMenu;\n  const translate = this._translate;\n  const rules = this._rules;\n  const getAppendMenuPosition = this._getAppendMenuPosition.bind(this);\n\n  if (rules.allowed('shape.append', { element })) {\n\n    // append menu entry\n    return {\n      'append': {\n        group: 'model',\n        html: `<div class=\"entry\">${appendIcon}</div>`,\n        title: translate('Append element'),\n        action: {\n          click: function(event, element) {\n\n            const position = assign(getAppendMenuPosition(element), {\n              cursor: { x: event.x, y: event.y }\n            });\n\n            popupMenu.open(element, 'bpmn-append', position, {\n              title: translate('Append element'),\n              width: 300,\n              search: true\n            });\n          }\n        }\n      }\n    };\n  }\n};\n\n/**\n * Calculates the position for the append menu relatively to the element\n *\n * @param {djs.model.Base} element\n * @returns {Object}\n */\nAppendContextPadProvider.prototype._getAppendMenuPosition = function(element) {\n  const X_OFFSET = 5;\n\n  const pad = this._canvas.getContainer().querySelector('.djs-context-pad');\n\n  const padRect = pad.getBoundingClientRect();\n\n  const pos = {\n    x: padRect.right + X_OFFSET,\n    y: padRect.top\n  };\n\n  return pos;\n};\n\nfunction e(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}));}\n\n/**\n * @typedef { import('../model/Types').Element } Element\n * @typedef { import('../model/Types').ModdleElement } ModdleElement\n */\n\n/**\n * Is an element of the given BPMN type?\n *\n * @param  {Element|ModdleElement} element\n * @param  {string} type\n *\n * @return {boolean}\n */\nfunction is(element, type) {\n  var bo = getBusinessObject(element);\n\n  return bo && (typeof bo.$instanceOf === 'function') && bo.$instanceOf(type);\n}\n\n\n/**\n * Return true if element has any of the given types.\n *\n * @param {Element|ModdleElement} element\n * @param {string[]} types\n *\n * @return {boolean}\n */\nfunction isAny(element, types) {\n  return some(types, function(t) {\n    return is(element, t);\n  });\n}\n\n/**\n * Return the business object for a given element.\n *\n * @param {Element|ModdleElement} element\n *\n * @return {ModdleElement}\n */\nfunction getBusinessObject(element) {\n  return (element && element.businessObject) || element;\n}\n\n/**\n * Return the di object for a given element.\n *\n * @param {Element} element\n *\n * @return {ModdleElement}\n */\nfunction getDi(element) {\n  return element && element.di;\n}\n\n/**\n * Checks whether a value is an instance of Label.\n *\n * @param {any} value\n *\n * @return {boolean}\n */\nfunction isLabel(value) {\n  return isObject(value) && has(value, 'labelTarget');\n}\n\n/**\n * @typedef {import('../core/Types').ElementLike} ElementLike\n * @typedef {import('../core/EventBus').default} EventBus\n * @typedef {import('./CommandStack').CommandContext} CommandContext\n *\n * @typedef {string|string[]} Events\n * @typedef { (context: CommandContext) => ElementLike[] | void } HandlerFunction\n * @typedef { (context: CommandContext) => void } ComposeHandlerFunction\n */\n\nvar DEFAULT_PRIORITY = 1000;\n\n/**\n * A utility that can be used to plug into the command execution for\n * extension and/or validation.\n *\n * @class\n * @constructor\n *\n * @example\n *\n * ```javascript\n * import CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n *\n * class CommandLogger extends CommandInterceptor {\n *   constructor(eventBus) {\n *     super(eventBus);\n *\n *   this.preExecute('shape.create', (event) => {\n *     console.log('commandStack.shape-create.preExecute', event);\n *   });\n * }\n * ```\n *\n * @param {EventBus} eventBus\n */\nfunction CommandInterceptor(eventBus) {\n\n  /**\n   * @type {EventBus}\n   */\n  this._eventBus = eventBus;\n}\n\nCommandInterceptor.$inject = [ 'eventBus' ];\n\nfunction unwrapEvent(fn, that) {\n  return function(event) {\n    return fn.call(that || null, event.context, event.command, event);\n  };\n}\n\n\n/**\n * Intercept a command during one of the phases.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {string} [hook] phase to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.on = function(events, hook, priority, handlerFn, unwrap, that) {\n\n  if (isFunction(hook) || isNumber(hook)) {\n    that = unwrap;\n    unwrap = handlerFn;\n    handlerFn = priority;\n    priority = hook;\n    hook = null;\n  }\n\n  if (isFunction(priority)) {\n    that = unwrap;\n    unwrap = handlerFn;\n    handlerFn = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  if (isObject(unwrap)) {\n    that = unwrap;\n    unwrap = false;\n  }\n\n  if (!isFunction(handlerFn)) {\n    throw new Error('handlerFn must be a function');\n  }\n\n  if (!isArray(events)) {\n    events = [ events ];\n  }\n\n  var eventBus = this._eventBus;\n\n  forEach(events, function(event) {\n\n    // concat commandStack(.event)?(.hook)?\n    var fullEvent = [ 'commandStack', event, hook ].filter(function(e) { return e; }).join('.');\n\n    eventBus.on(fullEvent, priority, unwrap ? unwrapEvent(handlerFn, that) : handlerFn, that);\n  });\n};\n\n/**\n * Add a <canExecute> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.canExecute = createHook('canExecute');\n\n/**\n * Add a <preExecute> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.preExecute = createHook('preExecute');\n\n/**\n * Add a <preExecuted> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.preExecuted = createHook('preExecuted');\n\n/**\n * Add a <execute> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.execute = createHook('execute');\n\n/**\n * Add a <executed> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.executed = createHook('executed');\n\n/**\n * Add a <postExecute> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.postExecute = createHook('postExecute');\n\n/**\n * Add a <postExecuted> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.postExecuted = createHook('postExecuted');\n\n/**\n * Add a <revert> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.revert = createHook('revert');\n\n/**\n * Add a <reverted> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.reverted = createHook('reverted');\n\n/*\n * Add prototype methods for each phase of command execution (e.g. execute,\n * revert).\n *\n * @param {string} hook\n *\n * @return { (\n *   events?: Events,\n *   priority?: number,\n *   handlerFn: ComposeHandlerFunction|HandlerFunction,\n *   unwrap?: boolean\n * ) => any }\n */\nfunction createHook(hook) {\n\n  /**\n   * @this {CommandInterceptor}\n   *\n   * @param {Events} [events]\n   * @param {number} [priority]\n   * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n   * @param {boolean} [unwrap]\n   * @param {any} [that]\n   */\n  const hookFn = function(events, priority, handlerFn, unwrap, that) {\n\n    if (isFunction(events) || isNumber(events)) {\n      that = unwrap;\n      unwrap = handlerFn;\n      handlerFn = priority;\n      priority = events;\n      events = null;\n    }\n\n    this.on(events, hook, priority, handlerFn, unwrap, that);\n  };\n\n  return hookFn;\n}\n\n/**\n * @typedef {import('../../core/EventBus').default} EventBus\n */\n\n/**\n * A basic provider that may be extended to implement modeling rules.\n *\n * Extensions should implement the init method to actually add their custom\n * modeling checks. Checks may be added via the #addRule(action, fn) method.\n *\n * @class\n *\n * @param {EventBus} eventBus\n */\nfunction RuleProvider(eventBus) {\n  CommandInterceptor.call(this, eventBus);\n\n  this.init();\n}\n\nRuleProvider.$inject = [ 'eventBus' ];\n\ne(RuleProvider, CommandInterceptor);\n\n\n/**\n * Adds a modeling rule for the given action, implemented through\n * a callback function.\n *\n * The callback receives a modeling specific action context\n * to perform its check. It must return `false` to disallow the\n * action from happening or `true` to allow the action. Usually returing\n * `null` denotes that a particular interaction shall be ignored.\n * By returning nothing or `undefined` you pass evaluation to lower\n * priority rules.\n *\n * @example\n *\n * ```javascript\n * ResizableRules.prototype.init = function() {\n *\n *   \\/**\n *    * Return `true`, `false` or nothing to denote\n *    * _allowed_, _not allowed_ and _continue evaluating_.\n *    *\\/\n *   this.addRule('shape.resize', function(context) {\n *\n *     var shape = context.shape;\n *\n *     if (!context.newBounds) {\n *       // check general resizability\n *       if (!shape.resizable) {\n *         return false;\n *       }\n *\n *       // not returning anything (read: undefined)\n *       // will continue the evaluation of other rules\n *       // (with lower priority)\n *       return;\n *     } else {\n *       // element must have minimum size of 10*10 points\n *       return context.newBounds.width > 10 && context.newBounds.height > 10;\n *     }\n *   });\n * };\n * ```\n *\n * @param {string|string[]} actions the identifier for the modeling action to check\n * @param {number} [priority] the priority at which this rule is being applied\n * @param {(any) => any} fn the callback function that performs the actual check\n */\nRuleProvider.prototype.addRule = function(actions, priority, fn) {\n\n  var self = this;\n\n  if (typeof actions === 'string') {\n    actions = [ actions ];\n  }\n\n  actions.forEach(function(action) {\n\n    self.canExecute(action, priority, function(context, action, event) {\n      return fn(context);\n    }, true);\n  });\n};\n\n/**\n * Implement this method to add new rules during provider initialization.\n */\nRuleProvider.prototype.init = function() {};\n\n/**\n * Append anything modeling rules\n */\nfunction AppendRules(eventBus) {\n  RuleProvider.call(this, eventBus);\n}\n\ne(AppendRules, RuleProvider);\n\nAppendRules.$inject = [\n  'eventBus'\n];\n\nAppendRules.prototype.init = function() {\n  this.addRule('shape.append', function(context) {\n\n    const source = context.element;\n\n    const businessObject = getBusinessObject(source);\n\n    if (isLabel(source)) {\n      return false;\n    }\n\n    if (isAny(source, [\n      'bpmn:EndEvent',\n      'bpmn:Group',\n      'bpmn:TextAnnotation',\n      'bpmn:Lane',\n      'bpmn:Participant',\n      'bpmn:DataStoreReference',\n      'bpmn:DataObjectReference'\n    ])) {\n      return false;\n    }\n\n    if (isConnection(source)) {\n      return false;\n    }\n\n    if (is(source, 'bpmn:IntermediateThrowEvent') && hasEventDefinition(source, 'bpmn:LinkEventDefinition')) {\n      return false;\n    }\n\n    if (is(source, 'bpmn:SubProcess') && businessObject.triggeredByEvent) {\n      return false;\n    }\n  });\n\n};\n\n\n// helpers //////////////\nfunction hasEventDefinition(element, eventDefinition) {\n  const bo = getBusinessObject(element);\n\n  return !!find(bo.eventDefinitions || [], function(definition) {\n    return is(definition, eventDefinition);\n  });\n}\n\nfunction isConnection(element) {\n  return element.waypoints;\n}\n\nvar AppendMenuModule = {\n  __init__: [\n    'appendMenuProvider',\n    'appendContextPadProvider',\n    'appendRules'\n  ],\n  appendMenuProvider: [ 'type', AppendMenuProvider ],\n  appendContextPadProvider: [ 'type', AppendContextPadProvider ],\n  appendRules: [ 'type', AppendRules ]\n};\n\n/**\n * This module is a create menu provider for the popup menu.\n */\nfunction CreateMenuProvider(\n    elementFactory, popupMenu, create,\n    autoPlace, mouse, translate\n) {\n  this._elementFactory = elementFactory;\n  this._popupMenu = popupMenu;\n  this._create = create;\n  this._autoPlace = autoPlace;\n  this._mouse = mouse;\n  this._translate = translate;\n\n  this.register();\n}\n\nCreateMenuProvider.$inject = [\n  'elementFactory',\n  'popupMenu',\n  'create',\n  'autoPlace',\n  'mouse',\n  'translate'\n];\n\n/**\n * Register create menu provider in the popup menu\n */\nCreateMenuProvider.prototype.register = function() {\n  this._popupMenu.registerProvider('bpmn-create', this);\n};\n\n/**\n * Returns the create options as menu entries\n *\n * @param {djs.model.Base} element\n *\n * @return {Array<Object>} a list of menu entry items\n */\nCreateMenuProvider.prototype.getPopupMenuEntries = function() {\n\n  const entries = {};\n\n  // map options to menu entries\n  CREATE_OPTIONS.forEach(option => {\n    const {\n      actionName,\n      className,\n      label,\n      target,\n      description,\n      group,\n      search,\n      rank\n    } = option;\n\n    const targetAction = this._createEntryAction(target);\n\n    entries[`create-${actionName}`] = {\n      label: label && this._translate(label),\n      className,\n      description,\n      group: group && {\n        ...group,\n        name: this._translate(group.name)\n      },\n      search,\n      rank,\n      action: {\n        click: targetAction,\n        dragstart: targetAction\n      }\n    };\n  });\n\n  return entries;\n};\n\n/**\n * Create an action for a given target\n *\n * @param {Object} target\n * @returns {Object}\n */\nCreateMenuProvider.prototype._createEntryAction = function(target) {\n\n  const create = this._create;\n  const mouse = this._mouse;\n  const popupMenu = this._popupMenu;\n  const elementFactory = this._elementFactory;\n\n  let newElement;\n\n  return (event) => {\n    popupMenu.close();\n\n    // create the new element\n    if (target.type === 'bpmn:Participant') {\n      newElement = elementFactory.createParticipantShape(target);\n    } else {\n      newElement = elementFactory.create('shape', target);\n    }\n\n    // use last mouse event if triggered via keyboard\n    if (event instanceof KeyboardEvent) {\n      event = mouse.getLastMoveEvent();\n    }\n\n    return create.start(event, newElement);\n  };\n};\n\nvar bugTestDiv;\nif (typeof document !== 'undefined') {\n  bugTestDiv = document.createElement('div');\n  // Setup\n  bugTestDiv.innerHTML = '  <link/><table></table><a href=\"/a\">a</a><input type=\"checkbox\"/>';\n  // Make sure that link elements get serialized correctly by innerHTML\n  // This requires a wrapper element in IE\n  !bugTestDiv.getElementsByTagName('link').length;\n  bugTestDiv = undefined;\n}\n\nfunction query(selector, el) {\n  el = el || document;\n\n  return el.querySelector(selector);\n}\n\nconst LOWER_PRIORITY = 900;\n\n/**\n * A palette provider for the create elements menu.\n */\nfunction CreatePaletteProvider(palette, translate, popupMenu, canvas, mouse) {\n\n  this._palette = palette;\n  this._translate = translate;\n  this._popupMenu = popupMenu;\n  this._canvas = canvas;\n  this._mouse = mouse;\n\n  this.register();\n}\n\nCreatePaletteProvider.$inject = [\n  'palette',\n  'translate',\n  'popupMenu',\n  'canvas',\n  'mouse'\n];\n\n/**\n * Register create button provider in the palette\n */\nCreatePaletteProvider.prototype.register = function() {\n  this._palette.registerProvider(LOWER_PRIORITY, this);\n};\n\n/**\n * Gets the palette create entry\n *\n * @param {djs.model.Base} element\n * @returns {Object}\n */\nCreatePaletteProvider.prototype.getPaletteEntries = function(element) {\n  const translate = this._translate,\n        popupMenu = this._popupMenu,\n        canvas = this._canvas,\n        mouse = this._mouse;\n\n  const getPosition = (event) => {\n    const X_OFFSET = 35;\n    const Y_OFFSET = 10;\n\n    if (event instanceof KeyboardEvent) {\n      event = mouse.getLastMoveEvent();\n      return { x: event.x, y: event.y };\n    }\n\n    const target = event && event.target || query('.djs-palette [data-action=\"create\"]');\n    const targetPosition = target.getBoundingClientRect();\n\n    return target && {\n      x: targetPosition.left + targetPosition.width / 2 + X_OFFSET,\n      y: targetPosition.top + targetPosition.height / 2 + Y_OFFSET\n    };\n  };\n\n  return {\n    'create': {\n      group: 'create',\n      html: `<div class=\"entry\"> ${createIcon}</div>`,\n      title: translate('Create element'),\n      action: {\n        click: function(event) {\n          const position = getPosition(event);\n\n          const element = canvas.getRootElement();\n\n          popupMenu.open(element, 'bpmn-create', position, {\n            title: translate('Create element'),\n            width: 300,\n            search: true\n          });\n        }\n      }\n    }\n  };\n};\n\nvar CreateMenuModule = {\n  __init__: [\n    'createMenuProvider',\n    'createPaletteProvider'\n  ],\n  createMenuProvider: [ 'type', CreateMenuProvider ],\n  createPaletteProvider: [ 'type', CreatePaletteProvider ]\n};\n\n/**\n * Registers and executes BPMN specific editor actions.\n *\n * @param {Injector} injector\n */\nfunction CreateAppendEditorActions(injector) {\n  this._injector = injector;\n\n  this.registerActions();\n}\n\nCreateAppendEditorActions.$inject = [\n  'injector'\n];\n\n/**\n * Register actions.\n *\n * @param {Injector} injector\n */\nCreateAppendEditorActions.prototype.registerActions = function() {\n  const editorActions = this._injector.get('editorActions', false);\n  const selection = this._injector.get('selection', false);\n  const contextPad = this._injector.get('contextPad', false);\n  const palette = this._injector.get('palette', false);\n  const popupMenu = this._injector.get('popupMenu', false);\n\n  const actions = {};\n\n  // append\n  if (selection && contextPad && palette && popupMenu && palette) {\n    assign(actions, {\n      'appendElement': function(event) {\n        const selected = selection && selection.get();\n\n        if (selected.length == 1 && !popupMenu.isEmpty(selected[0], 'bpmn-append')) {\n          contextPad.triggerEntry('append', 'click', event);\n        } else {\n          palette.triggerEntry('create', 'click', event);\n        }\n      }\n    });\n  }\n\n  // create\n  if (palette) {\n    assign(actions, {\n      'createElement': function(event) {\n        palette.triggerEntry('create', 'click', event);\n      } }\n    );\n  }\n\n  editorActions && editorActions.register(actions);\n\n};\n\nvar EditorActionsModule = {\n  __depends__: [\n    AppendMenuModule,\n    CreateMenuModule\n  ],\n  __init__: [\n    'createAppendEditorActions'\n  ],\n  createAppendEditorActions: [ 'type', CreateAppendEditorActions ]\n};\n\nvar KEYS_COPY = [ 'c', 'C' ];\r\nvar KEYS_PASTE = [ 'v', 'V' ];\r\nvar KEYS_REDO = [ 'y', 'Y' ];\r\nvar KEYS_UNDO = [ 'z', 'Z' ];\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n * @return {boolean}\r\n */\r\nfunction isCmd(event) {\r\n\r\n  // ensure we don't react to AltGr\r\n  // (mapped to CTRL + ALT)\r\n  if (event.altKey) {\r\n    return false;\r\n  }\r\n\r\n  return event.ctrlKey || event.metaKey;\r\n}\r\n\r\n/**\r\n * Checks if key pressed is one of provided keys.\r\n *\r\n * @param {string|string[]} keys\r\n * @param {KeyboardEvent} event\r\n * @return {boolean}\r\n */\r\nfunction isKey(keys, event) {\r\n  keys = isArray(keys) ? keys : [ keys ];\r\n\r\n  return keys.indexOf(event.key) !== -1 || keys.indexOf(event.code) !== -1;\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nfunction isShift(event) {\r\n  return event.shiftKey;\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nfunction isCopy(event) {\r\n  return isCmd(event) && isKey(KEYS_COPY, event);\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nfunction isPaste(event) {\r\n  return isCmd(event) && isKey(KEYS_PASTE, event);\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nfunction isUndo(event) {\r\n  return isCmd(event) && !isShift(event) && isKey(KEYS_UNDO, event);\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nfunction isRedo(event) {\r\n  return isCmd(event) && (\r\n    isKey(KEYS_REDO, event) || (\r\n      isKey(KEYS_UNDO, event) && isShift(event)\r\n    )\r\n  );\r\n}\n\nvar LOW_PRIORITY = 500;\n\n\n/**\n * Adds default keyboard bindings.\n *\n * This does not pull in any features will bind only actions that\n * have previously been registered against the editorActions component.\n *\n * @param {EventBus} eventBus\n * @param {Keyboard} keyboard\n */\nfunction KeyboardBindings(eventBus, keyboard) {\n\n  var self = this;\n\n  eventBus.on('editorActions.init', LOW_PRIORITY, function(event) {\n\n    var editorActions = event.editorActions;\n\n    self.registerBindings(keyboard, editorActions);\n  });\n}\n\nKeyboardBindings.$inject = [\n  'eventBus',\n  'keyboard'\n];\n\n\n/**\n * Register available keyboard bindings.\n *\n * @param {Keyboard} keyboard\n * @param {EditorActions} editorActions\n */\nKeyboardBindings.prototype.registerBindings = function(keyboard, editorActions) {\n\n  /**\n   * Add keyboard binding if respective editor action\n   * is registered.\n   *\n   * @param {string} action name\n   * @param {Function} fn that implements the key binding\n   */\n  function addListener(action, fn) {\n\n    if (editorActions.isRegistered(action)) {\n      keyboard.addListener(fn);\n    }\n  }\n\n\n  // undo\n  // (CTRL|CMD) + Z\n  addListener('undo', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isUndo(event)) {\n      editorActions.trigger('undo');\n\n      return true;\n    }\n  });\n\n  // redo\n  // CTRL + Y\n  // CMD + SHIFT + Z\n  addListener('redo', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isRedo(event)) {\n      editorActions.trigger('redo');\n\n      return true;\n    }\n  });\n\n  // copy\n  // CTRL/CMD + C\n  addListener('copy', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isCopy(event)) {\n      editorActions.trigger('copy');\n\n      return true;\n    }\n  });\n\n  // paste\n  // CTRL/CMD + V\n  addListener('paste', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isPaste(event)) {\n      editorActions.trigger('paste');\n\n      return true;\n    }\n  });\n\n  // zoom in one step\n  // CTRL/CMD + +\n  addListener('stepZoom', function(context) {\n\n    var event = context.keyEvent;\n\n    // quirk: it has to be triggered by `=` as well to work on international keyboard layout\n    // cf: https://github.com/bpmn-io/bpmn-js/issues/1362#issuecomment-722989754\n    if (isKey([ '+', 'Add', '=' ], event) && isCmd(event)) {\n      editorActions.trigger('stepZoom', { value: 1 });\n\n      return true;\n    }\n  });\n\n  // zoom out one step\n  // CTRL + -\n  addListener('stepZoom', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isKey([ '-', 'Subtract' ], event) && isCmd(event)) {\n      editorActions.trigger('stepZoom', { value: -1 });\n\n      return true;\n    }\n  });\n\n  // zoom to the default level\n  // CTRL + 0\n  addListener('zoom', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isKey('0', event) && isCmd(event)) {\n      editorActions.trigger('zoom', { value: 1 });\n\n      return true;\n    }\n  });\n\n  // delete selected element\n  // DEL\n  addListener('removeSelection', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isKey([ 'Backspace', 'Delete', 'Del' ], event)) {\n      editorActions.trigger('removeSelection');\n\n      return true;\n    }\n  });\n};\n\n/**\n * BPMN 2.0 specific keyboard bindings.\n *\n * @param {Injector} injector\n */\nfunction CreateAppendKeyboardBindings(injector) {\n\n  this._injector = injector;\n  this._keyboard = this._injector.get('keyboard', false);\n  this._editorActions = this._injector.get('editorActions', false);\n\n  if (this._keyboard) {\n    this._injector.invoke(KeyboardBindings, this);\n  }\n}\n\ne(CreateAppendKeyboardBindings, KeyboardBindings);\n\nCreateAppendKeyboardBindings.$inject = [\n  'injector'\n];\n\n\n/**\n * Register available keyboard bindings.\n *\n * @param {Keyboard} keyboard\n * @param {EditorActions} editorActions\n */\nCreateAppendKeyboardBindings.prototype.registerBindings = function() {\n\n  const keyboard = this._keyboard;\n  const editorActions = this._editorActions;\n\n  // inherit default bindings\n  KeyboardBindings.prototype.registerBindings.call(this, keyboard, editorActions);\n\n  /**\n   * Add keyboard binding if respective editor action\n   * is registered.\n   *\n   * @param {string} action name\n   * @param {Function} fn that implements the key binding\n   */\n  function addListener(action, fn) {\n\n    if (editorActions && editorActions.isRegistered(action)) {\n      keyboard && keyboard.addListener(fn);\n    }\n  }\n\n  // activate append/create element\n  // A\n  addListener('appendElement', function(context) {\n\n    const event = context.keyEvent;\n\n    if (keyboard && keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard && keyboard.isKey([ 'a', 'A' ], event)) {\n\n      editorActions && editorActions.trigger('appendElement', event);\n      return true;\n    }\n  });\n\n  // N\n  addListener('createElement', function(context) {\n\n    const event = context.keyEvent;\n\n    if (keyboard && keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard && keyboard.isKey([ 'n', 'N' ], event)) {\n      editorActions && editorActions.trigger('createElement', event);\n\n      return true;\n    }\n  });\n\n};\n\nvar KeyboardBindingsModule = {\n  __depends__: [\n    AppendMenuModule,\n    CreateMenuModule\n  ],\n  __init__: [\n    'createAppendKeyboardBindings'\n  ],\n  createAppendKeyboardBindings: [ 'type', CreateAppendKeyboardBindings ]\n};\n\nvar index$1 = {\n  __depends__: [\n    AppendMenuModule,\n    CreateMenuModule,\n    EditorActionsModule,\n    KeyboardBindingsModule\n  ],\n};\n\n/**\n * A popup menu provider that allows to append elements with\n * element templates.\n */\nfunction ElementTemplatesAppendProvider(\n    popupMenu, translate, elementTemplates,\n    autoPlace, create, mouse, rules) {\n\n  this._popupMenu = popupMenu;\n  this._translate = translate;\n  this._elementTemplates = elementTemplates;\n  this._autoPlace = autoPlace;\n  this._create = create;\n  this._mouse = mouse;\n  this._rules = rules;\n\n  this.register();\n}\n\nElementTemplatesAppendProvider.$inject = [\n  'popupMenu',\n  'translate',\n  'elementTemplates',\n  'autoPlace',\n  'create',\n  'move',\n  'rules'\n];\n\n/**\n * Register append menu provider in the popup menu\n */\nElementTemplatesAppendProvider.prototype.register = function() {\n  this._popupMenu.registerProvider('bpmn-append', this);\n};\n\n/**\n * Adds the element templates to the append menu.\n * @param {djs.model.Base} element\n *\n * @returns {Object}\n */\nElementTemplatesAppendProvider.prototype.getPopupMenuEntries = function(element) {\n  return (entries) => {\n\n    if (!this._rules.allowed('shape.append', { element: element })) {\n      return [];\n    }\n\n    const filteredTemplates = this._filterTemplates(this._elementTemplates.getLatest());\n\n    // add template entries\n    assign(entries, this.getTemplateEntries(element, filteredTemplates));\n\n    return entries;\n  };\n};\n\n/**\n * Get all element templates.\n *\n * @param {djs.model.Base} element\n *\n * @return {Object} element templates as menu entries\n */\nElementTemplatesAppendProvider.prototype.getTemplateEntries = function(element, templates) {\n\n  const templateEntries = {};\n\n  templates.map(template => {\n\n    const {\n      icon = {},\n      category,\n      keywords = [],\n    } = template;\n\n    const entryId = `append.template-${template.id}`;\n\n    const defaultGroup = {\n      id: 'templates',\n      name: this._translate('Templates')\n    };\n\n    templateEntries[entryId] = {\n      label: template.name,\n      description: template.description,\n      documentationRef: template.documentationRef,\n      search: keywords,\n      imageUrl: icon.contents,\n      group: category || defaultGroup,\n      action: this._getEntryAction(element, template)\n    };\n  });\n\n  return templateEntries;\n};\n\n/**\n * Filter out templates from the options.\n *\n * @param {Array<Object>} templates\n *\n * @returns {Array<Object>}\n */\nElementTemplatesAppendProvider.prototype._filterTemplates = function(templates) {\n  return templates.filter(template => {\n    const {\n      appliesTo,\n      elementType\n    } = template;\n\n    const type = (elementType && elementType.value) || appliesTo[0];\n\n    // elements that can not be appended\n    if ([\n      'bpmn:StartEvent',\n      'bpmn:Participant'\n    ].includes(type)) {\n      return false;\n    }\n\n    // sequence flow templates are supported\n    // but connections are not appendable\n    if ('bpmn:SequenceFlow' === type) {\n      return false;\n    }\n\n    return true;\n  });\n};\n\n/**\n * Create an action for a given template.\n *\n * @param {djs.model.Base} element\n * @param {Object} template\n *\n * @returns {Object}\n */\nElementTemplatesAppendProvider.prototype._getEntryAction = function(element, template) {\n  const autoPlaceElement = () => {\n    const newElement = this._elementTemplates.createElement(template);\n\n    this._autoPlace.append(element, newElement);\n  };\n\n  const manualPlaceElement = (event) => {\n    const newElement = this._elementTemplates.createElement(template);\n\n    if (event instanceof KeyboardEvent) {\n      event = this._mouse.getLastMoveEvent();\n    }\n\n    return this._create.start(event, newElement, {\n      source: element\n    });\n  };\n\n  return {\n    click: canAutoPlaceElement(template) ? autoPlaceElement : manualPlaceElement,\n    dragstart: manualPlaceElement\n  };\n};\n\nfunction canAutoPlaceElement(elementTemplate) {\n  const {\n    appliesTo = [],\n    elementType = {}\n  } = elementTemplate;\n\n  const type = elementType.value || appliesTo[0];\n\n  if (type === 'bpmn:BoundaryEvent') {\n    return false;\n  }\n\n  if (type === 'bpmn:IntermediateCatchEvent' && elementType.eventDefinition === 'bpmn:LinkEventDefinition') {\n    return false;\n  }\n\n  return true;\n}\n\nvar AppendElementTemplatesModule = {\n  __init__: [ 'elementTemplatesAppendProvider' ],\n  elementTemplatesAppendProvider: [ 'type', ElementTemplatesAppendProvider ]\n};\n\n/**\n * A popup menu provider that allows to create elements with\n * element templates.\n */\nfunction ElementTemplatesCreateProvider(\n    popupMenu, translate,\n    elementTemplates, mouse, create) {\n\n  this._popupMenu = popupMenu;\n  this._translate = translate;\n  this._elementTemplates = elementTemplates;\n  this._mouse = mouse;\n  this._create = create;\n\n  this.register();\n}\n\nElementTemplatesCreateProvider.$inject = [\n  'popupMenu',\n  'translate',\n  'elementTemplates',\n  'mouse',\n  'create'\n];\n\n/**\n * Register create menu provider in the popup menu\n */\nElementTemplatesCreateProvider.prototype.register = function() {\n  this._popupMenu.registerProvider('bpmn-create', this);\n};\n\n/**\n * Adds the element templates to the create menu.\n * @param {djs.model.Base} element\n *\n * @returns {Object}\n */\nElementTemplatesCreateProvider.prototype.getPopupMenuEntries = function(element) {\n  return (entries) => {\n\n    // add template entries\n    assign(entries, this.getTemplateEntries(element));\n\n    return entries;\n  };\n};\n\n/**\n * Get all element templates.\n *\n * @param {djs.model.Base} element\n *\n * @return {Array<Object>} a list of element templates as menu entries\n */\nElementTemplatesCreateProvider.prototype.getTemplateEntries = function() {\n\n  const templates = this._elementTemplates.getLatest();\n  const templateEntries = {};\n\n  templates.map(template => {\n\n    const {\n      icon = {},\n      category,\n      keywords = [],\n    } = template;\n\n    const entryId = `create.template-${template.id}`;\n\n    const defaultGroup = {\n      id: 'templates',\n      name: this._translate('Templates')\n    };\n\n    templateEntries[entryId] = {\n      label: template.name,\n      description: template.description,\n      documentationRef: template.documentationRef,\n      imageUrl: icon.contents,\n      group: category || defaultGroup,\n      search: keywords,\n      action: {\n        click: this._getEntryAction(template),\n        dragstart: this._getEntryAction(template)\n      }\n    };\n  });\n\n  return templateEntries;\n};\n\n\nElementTemplatesCreateProvider.prototype._getEntryAction = function(template) {\n  const create = this._create;\n  const popupMenu = this._popupMenu;\n  const elementTemplates = this._elementTemplates;\n  const mouse = this._mouse;\n\n  return (event) => {\n\n    popupMenu.close();\n\n    // create the new element\n    let newElement = elementTemplates.createElement(template);\n\n    // use last mouse event if triggered via keyboard\n    if (event instanceof KeyboardEvent) {\n      event = mouse.getLastMoveEvent();\n    }\n\n    return create.start(event, newElement);\n  };\n};\n\nvar CreateElementTemplatesModule = {\n  __init__: [ 'elementTemplatesCreateProvider' ],\n  elementTemplatesCreateProvider: [ 'type', ElementTemplatesCreateProvider ]\n};\n\n/**\n * A replace menu provider that allows to replace elements with\n * element templates.\n */\nfunction ElementTemplatesReplaceProvider(popupMenu, translate, elementTemplates) {\n\n  this._popupMenu = popupMenu;\n  this._translate = translate;\n  this._elementTemplates = elementTemplates;\n\n  this.register();\n}\n\nElementTemplatesReplaceProvider.$inject = [\n  'popupMenu',\n  'translate',\n  'elementTemplates'\n];\n\n/**\n * Register replace menu provider in the popup menu\n */\nElementTemplatesReplaceProvider.prototype.register = function() {\n  this._popupMenu.registerProvider('bpmn-replace', this);\n};\n\n/**\n * Adds the element templates to the replace menu.\n * @param {djs.model.Base} element\n *\n * @returns {Object}\n */\nElementTemplatesReplaceProvider.prototype.getPopupMenuEntries = function(element) {\n\n  return (entries) => {\n\n    // convert our entries into something sortable\n    let entrySet = Object.entries(entries);\n\n    // add template entries\n    entrySet = [ ...entrySet, ...this.getTemplateEntries(element) ];\n\n    // convert back to object\n    return entrySet.reduce((entries, [ key, value ]) => {\n      entries[key] = value;\n\n      return entries;\n    }, {});\n  };\n};\n\n/**\n * Get all element templates that can be used to replace the given element.\n *\n * @param {djs.model.Base} element\n *\n * @return {Array<Object>} a list of element templates as menu entries\n */\nElementTemplatesReplaceProvider.prototype.getTemplateEntries = function(element) {\n\n  const templates = this._getMatchingTemplates(element);\n  return templates.map(template => {\n\n    const {\n      icon = {},\n      category,\n      keywords = [],\n    } = template;\n\n    const entryId = `replace.template-${template.id}`;\n\n    const defaultGroup = {\n      id: 'templates',\n      name: this._translate('Templates')\n    };\n\n    return [ entryId, {\n      label: template.name,\n      description: template.description,\n      documentationRef: template.documentationRef,\n      imageUrl: icon.contents,\n      search: keywords,\n      group: category || defaultGroup,\n      action: () => {\n        this._elementTemplates.applyTemplate(element, template);\n      }\n    } ];\n  });\n};\n\n/**\n * Returns the templates that can the element can be replaced with.\n *\n * @param  {djs.model.Base} element\n *\n * @return {Array<ElementTemplate>}\n */\nElementTemplatesReplaceProvider.prototype._getMatchingTemplates = function(element) {\n  return this._elementTemplates.getLatest(element).filter(template => {\n    return !isTemplateApplied(element, template);\n  });\n};\n\n\n// helpers ////////////\nfunction isTemplateApplied(element, template) {\n  const businessObject = getBusinessObject(element);\n\n  if (businessObject) {\n    return businessObject.get('zeebe:modelerTemplate') === template.id;\n  }\n\n  return false;\n}\n\nvar ReplaceElementTemplatesModule = {\n  __init__: [\n    'elementTemplatesReplaceProvider'\n  ],\n  elementTemplatesReplaceProvider: [ 'type', ElementTemplatesReplaceProvider ]\n};\n\n/**\n * @typedef {import('../model/Types').Element} Element\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * @param {Element} element\n * @param {ModdleElement} [di]\n *\n * @return {boolean}\n */\nfunction isExpanded(element, di) {\n\n  if (is(element, 'bpmn:CallActivity')) {\n    return false;\n  }\n\n  if (is(element, 'bpmn:SubProcess')) {\n    di = di || getDi(element);\n\n    if (di && is(di, 'bpmndi:BPMNPlane')) {\n      return true;\n    }\n\n    return di && !!di.isExpanded;\n  }\n\n  if (is(element, 'bpmn:Participant')) {\n    return !!getBusinessObject(element).processRef;\n  }\n\n  return true;\n}\n\n/**\n * @typedef {import('../../../model/Types').Element} Element\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').PopupMenuTarget} PopupMenuTarget\n *\n * @typedef {(entry: PopupMenuTarget) => boolean} DifferentTypeValidator\n */\n\n/**\n * Returns true, if an element is from a different type\n * than a target definition. Takes into account the type,\n * event definition type and triggeredByEvent property.\n *\n * @param {Element} element\n *\n * @return {DifferentTypeValidator}\n */\nfunction isDifferentType(element) {\n\n  return function(entry) {\n    var target = entry.target;\n\n    var businessObject = getBusinessObject(element),\n        eventDefinition = businessObject.eventDefinitions && businessObject.eventDefinitions[0];\n\n    var isTypeEqual = businessObject.$type === target.type;\n\n    var isEventDefinitionEqual = (\n      (eventDefinition && eventDefinition.$type) === target.eventDefinitionType\n    );\n\n    var isTriggeredByEventEqual = (\n\n      // coherse to <false>\n      !!target.triggeredByEvent === !!businessObject.triggeredByEvent\n    );\n\n    var isExpandedEqual = (\n      target.isExpanded === undefined ||\n      target.isExpanded === isExpanded(element)\n    );\n\n    return !isTypeEqual || !isEventDefinitionEqual || !isTriggeredByEventEqual || !isExpandedEqual;\n  };\n}\n\n/**\n * @typedef { () => string } LabelGetter\n *\n * @typedef { {\n *   label: string | LabelGetter;\n *   actionName: string;\n *   className: string;\n *   target?: {\n *     type: string;\n *     isExpanded?: boolean;\n *     isInterrupting?: boolean;\n *     triggeredByEvent?: boolean;\n *     cancelActivity?: boolean;\n *     eventDefinitionType?: string;\n *     eventDefinitionAttrs?: Record<string, any>\n *   };\n * } } ReplaceOption\n */\n\n/**\n * @type {ReplaceOption[]}\n */\nvar START_EVENT = [\n  {\n    label: 'Start event',\n    actionName: 'replace-with-none-start',\n    className: 'bpmn-icon-start-event-none',\n    target: {\n      type: 'bpmn:StartEvent'\n    }\n  },\n  {\n    label: 'Intermediate throw event',\n    actionName: 'replace-with-none-intermediate-throwing',\n    className: 'bpmn-icon-intermediate-event-none',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent'\n    }\n  },\n  {\n    label: 'End event',\n    actionName: 'replace-with-none-end',\n    className: 'bpmn-icon-end-event-none',\n    target: {\n      type: 'bpmn:EndEvent'\n    }\n  },\n  {\n    label: 'Message start event',\n    actionName: 'replace-with-message-start',\n    className: 'bpmn-icon-start-event-message',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Timer start event',\n    actionName: 'replace-with-timer-start',\n    className: 'bpmn-icon-start-event-timer',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition'\n    }\n  },\n  {\n    label: 'Conditional start event',\n    actionName: 'replace-with-conditional-start',\n    className: 'bpmn-icon-start-event-condition',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition'\n    }\n  },\n  {\n    label: 'Signal start event',\n    actionName: 'replace-with-signal-start',\n    className: 'bpmn-icon-start-event-signal',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nvar START_EVENT_SUB_PROCESS = [\n  {\n    label: 'Start event',\n    actionName: 'replace-with-none-start',\n    className: 'bpmn-icon-start-event-none',\n    target: {\n      type: 'bpmn:StartEvent'\n    }\n  },\n  {\n    label: 'Intermediate throw event',\n    actionName: 'replace-with-none-intermediate-throwing',\n    className: 'bpmn-icon-intermediate-event-none',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent'\n    }\n  },\n  {\n    label: 'End event',\n    actionName: 'replace-with-none-end',\n    className: 'bpmn-icon-end-event-none',\n    target: {\n      type: 'bpmn:EndEvent'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nvar INTERMEDIATE_EVENT = [\n  {\n    label: 'Start event',\n    actionName: 'replace-with-none-start',\n    className: 'bpmn-icon-start-event-none',\n    target: {\n      type: 'bpmn:StartEvent'\n    }\n  },\n  {\n    label: 'Intermediate throw event',\n    actionName: 'replace-with-none-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-none',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent'\n    }\n  },\n  {\n    label: 'End event',\n    actionName: 'replace-with-none-end',\n    className: 'bpmn-icon-end-event-none',\n    target: {\n      type: 'bpmn:EndEvent'\n    }\n  },\n  {\n    label: 'Message intermediate catch event',\n    actionName: 'replace-with-message-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-message',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Message intermediate throw event',\n    actionName: 'replace-with-message-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-message',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Timer intermediate catch event',\n    actionName: 'replace-with-timer-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-timer',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition'\n    }\n  },\n  {\n    label: 'Escalation intermediate throw event',\n    actionName: 'replace-with-escalation-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-escalation',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition'\n    }\n  },\n  {\n    label: 'Conditional intermediate catch event',\n    actionName: 'replace-with-conditional-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-condition',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition'\n    }\n  },\n  {\n    label: 'Link intermediate catch event',\n    actionName: 'replace-with-link-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-link',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:LinkEventDefinition',\n      eventDefinitionAttrs: {\n        name: ''\n      }\n    }\n  },\n  {\n    label: 'Link intermediate throw event',\n    actionName: 'replace-with-link-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-link',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:LinkEventDefinition',\n      eventDefinitionAttrs: {\n        name: ''\n      }\n    }\n  },\n  {\n    label: 'Compensation intermediate throw event',\n    actionName: 'replace-with-compensation-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-compensation',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition'\n    }\n  },\n  {\n    label: 'Signal intermediate catch event',\n    actionName: 'replace-with-signal-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-signal',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  },\n  {\n    label: 'Signal intermediate throw event',\n    actionName: 'replace-with-signal-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-signal',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nvar END_EVENT = [\n  {\n    label: 'Start event',\n    actionName: 'replace-with-none-start',\n    className: 'bpmn-icon-start-event-none',\n    target: {\n      type: 'bpmn:StartEvent'\n    }\n  },\n  {\n    label: 'Intermediate throw event',\n    actionName: 'replace-with-none-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-none',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent'\n    }\n  },\n  {\n    label: 'End event',\n    actionName: 'replace-with-none-end',\n    className: 'bpmn-icon-end-event-none',\n    target: {\n      type: 'bpmn:EndEvent'\n    }\n  },\n  {\n    label: 'Message end event',\n    actionName: 'replace-with-message-end',\n    className: 'bpmn-icon-end-event-message',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Escalation end event',\n    actionName: 'replace-with-escalation-end',\n    className: 'bpmn-icon-end-event-escalation',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition'\n    }\n  },\n  {\n    label: 'Error end event',\n    actionName: 'replace-with-error-end',\n    className: 'bpmn-icon-end-event-error',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:ErrorEventDefinition'\n    }\n  },\n  {\n    label: 'Cancel end event',\n    actionName: 'replace-with-cancel-end',\n    className: 'bpmn-icon-end-event-cancel',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:CancelEventDefinition'\n    }\n  },\n  {\n    label: 'Compensation end event',\n    actionName: 'replace-with-compensation-end',\n    className: 'bpmn-icon-end-event-compensation',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition'\n    }\n  },\n  {\n    label: 'Signal end event',\n    actionName: 'replace-with-signal-end',\n    className: 'bpmn-icon-end-event-signal',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  },\n  {\n    label: 'Terminate end event',\n    actionName: 'replace-with-terminate-end',\n    className: 'bpmn-icon-end-event-terminate',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:TerminateEventDefinition'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nvar GATEWAY = [\n  {\n    label: 'Exclusive gateway',\n    actionName: 'replace-with-exclusive-gateway',\n    className: 'bpmn-icon-gateway-xor',\n    target: {\n      type: 'bpmn:ExclusiveGateway'\n    }\n  },\n  {\n    label: 'Parallel gateway',\n    actionName: 'replace-with-parallel-gateway',\n    className: 'bpmn-icon-gateway-parallel',\n    target: {\n      type: 'bpmn:ParallelGateway'\n    }\n  },\n  {\n    label: 'Inclusive gateway',\n    actionName: 'replace-with-inclusive-gateway',\n    className: 'bpmn-icon-gateway-or',\n    target: {\n      type: 'bpmn:InclusiveGateway'\n    }\n  },\n  {\n    label: 'Complex gateway',\n    actionName: 'replace-with-complex-gateway',\n    className: 'bpmn-icon-gateway-complex',\n    target: {\n      type: 'bpmn:ComplexGateway'\n    }\n  },\n  {\n    label: 'Event-based gateway',\n    actionName: 'replace-with-event-based-gateway',\n    className: 'bpmn-icon-gateway-eventbased',\n    target: {\n      type: 'bpmn:EventBasedGateway',\n      instantiate: false,\n      eventGatewayType: 'Exclusive'\n    }\n  }\n\n  // Gateways deactivated until https://github.com/bpmn-io/bpmn-js/issues/194\n  // {\n  //   label: 'Event based instantiating Gateway',\n  //   actionName: 'replace-with-exclusive-event-based-gateway',\n  //   className: 'bpmn-icon-exclusive-event-based',\n  //   target: {\n  //     type: 'bpmn:EventBasedGateway'\n  //   },\n  //   options: {\n  //     businessObject: { instantiate: true, eventGatewayType: 'Exclusive' }\n  //   }\n  // },\n  // {\n  //   label: 'Parallel Event based instantiating Gateway',\n  //   actionName: 'replace-with-parallel-event-based-instantiate-gateway',\n  //   className: 'bpmn-icon-parallel-event-based-instantiate-gateway',\n  //   target: {\n  //     type: 'bpmn:EventBasedGateway'\n  //   },\n  //   options: {\n  //     businessObject: { instantiate: true, eventGatewayType: 'Parallel' }\n  //   }\n  // }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nvar SUBPROCESS_EXPANDED = [\n  {\n    label: 'Transaction',\n    actionName: 'replace-with-transaction',\n    className: 'bpmn-icon-transaction',\n    target: {\n      type: 'bpmn:Transaction',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Event sub-process',\n    actionName: 'replace-with-event-subprocess',\n    className: 'bpmn-icon-event-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      triggeredByEvent: true,\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Ad-hoc sub-process',\n    actionName: 'replace-with-ad-hoc-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:AdHocSubProcess',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Sub-process (collapsed)',\n    actionName: 'replace-with-collapsed-subprocess',\n    className: 'bpmn-icon-subprocess-collapsed',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: false\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nvar AD_HOC_SUBPROCESS_EXPANDED = [\n  {\n    label: 'Sub-process',\n    actionName: 'replace-with-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Transaction',\n    actionName: 'replace-with-transaction',\n    className: 'bpmn-icon-transaction',\n    target: {\n      type: 'bpmn:Transaction',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Event sub-process',\n    actionName: 'replace-with-event-subprocess',\n    className: 'bpmn-icon-event-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      triggeredByEvent: true,\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Ad-hoc sub-process (collapsed)',\n    actionName: 'replace-with-collapsed-ad-hoc-subprocess',\n    className: 'bpmn-icon-subprocess-collapsed',\n    target: {\n      type: 'bpmn:AdHocSubProcess',\n      isExpanded: false\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nvar TRANSACTION = [\n  {\n    label: 'Transaction',\n    actionName: 'replace-with-transaction',\n    className: 'bpmn-icon-transaction',\n    target: {\n      type: 'bpmn:Transaction',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Sub-process',\n    actionName: 'replace-with-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Ad-hoc sub-process',\n    actionName: 'replace-with-ad-hoc-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:AdHocSubProcess',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Event sub-process',\n    actionName: 'replace-with-event-subprocess',\n    className: 'bpmn-icon-event-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      triggeredByEvent: true,\n      isExpanded: true\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nvar EVENT_SUB_PROCESS = TRANSACTION;\n\n/**\n * @type {ReplaceOption[]}\n */\nvar TASK = [\n  {\n    label: 'Task',\n    actionName: 'replace-with-task',\n    className: 'bpmn-icon-task',\n    target: {\n      type: 'bpmn:Task'\n    }\n  },\n  {\n    label: 'User task',\n    actionName: 'replace-with-user-task',\n    className: 'bpmn-icon-user',\n    target: {\n      type: 'bpmn:UserTask'\n    }\n  },\n  {\n    label: 'Service task',\n    actionName: 'replace-with-service-task',\n    className: 'bpmn-icon-service',\n    target: {\n      type: 'bpmn:ServiceTask'\n    }\n  },\n  {\n    label: 'Send task',\n    actionName: 'replace-with-send-task',\n    className: 'bpmn-icon-send',\n    target: {\n      type: 'bpmn:SendTask'\n    }\n  },\n  {\n    label: 'Receive task',\n    actionName: 'replace-with-receive-task',\n    className: 'bpmn-icon-receive',\n    target: {\n      type: 'bpmn:ReceiveTask'\n    }\n  },\n  {\n    label: 'Manual task',\n    actionName: 'replace-with-manual-task',\n    className: 'bpmn-icon-manual',\n    target: {\n      type: 'bpmn:ManualTask'\n    }\n  },\n  {\n    label: 'Business rule task',\n    actionName: 'replace-with-rule-task',\n    className: 'bpmn-icon-business-rule',\n    target: {\n      type: 'bpmn:BusinessRuleTask'\n    }\n  },\n  {\n    label: 'Script task',\n    actionName: 'replace-with-script-task',\n    className: 'bpmn-icon-script',\n    target: {\n      type: 'bpmn:ScriptTask'\n    }\n  },\n  {\n    label: 'Call activity',\n    actionName: 'replace-with-call-activity',\n    className: 'bpmn-icon-call-activity',\n    target: {\n      type: 'bpmn:CallActivity'\n    }\n  },\n  {\n    label: 'Sub-process (collapsed)',\n    actionName: 'replace-with-collapsed-subprocess',\n    className: 'bpmn-icon-subprocess-collapsed',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: false\n    }\n  },\n  {\n    label: 'Sub-process (expanded)',\n    actionName: 'replace-with-expanded-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Ad-hoc sub-process (collapsed)',\n    actionName: 'replace-with-collapsed-ad-hoc-subprocess',\n    className: 'bpmn-icon-subprocess-collapsed',\n    target: {\n      type: 'bpmn:AdHocSubProcess',\n      isExpanded: false\n    }\n  },\n  {\n    label: 'Ad-hoc sub-process (expanded)',\n    actionName: 'replace-with-ad-hoc-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:AdHocSubProcess',\n      isExpanded: true\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nvar DATA_OBJECT_REFERENCE = [\n  {\n    label: 'Data store reference',\n    actionName: 'replace-with-data-store-reference',\n    className: 'bpmn-icon-data-store',\n    target: {\n      type: 'bpmn:DataStoreReference'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nvar DATA_STORE_REFERENCE = [\n  {\n    label: 'Data object reference',\n    actionName: 'replace-with-data-object-reference',\n    className: 'bpmn-icon-data-object',\n    target: {\n      type: 'bpmn:DataObjectReference'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nvar BOUNDARY_EVENT = [\n  {\n    label: 'Message boundary event',\n    actionName: 'replace-with-message-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-message',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Timer boundary event',\n    actionName: 'replace-with-timer-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-timer',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Escalation boundary event',\n    actionName: 'replace-with-escalation-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-escalation',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Conditional boundary event',\n    actionName: 'replace-with-conditional-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-condition',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Error boundary event',\n    actionName: 'replace-with-error-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-error',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:ErrorEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Cancel boundary event',\n    actionName: 'replace-with-cancel-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-cancel',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:CancelEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Signal boundary event',\n    actionName: 'replace-with-signal-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-signal',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Compensation boundary event',\n    actionName: 'replace-with-compensation-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-compensation',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Message boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-message-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-message',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Timer boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-timer-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-timer',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Escalation boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-escalation-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-escalation',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Conditional boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-conditional-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-condition',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Signal boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-signal-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-signal',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition',\n      cancelActivity: false\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nvar EVENT_SUB_PROCESS_START_EVENT = [\n  {\n    label: 'Message start event',\n    actionName: 'replace-with-message-start',\n    className: 'bpmn-icon-start-event-message',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Timer start event',\n    actionName: 'replace-with-timer-start',\n    className: 'bpmn-icon-start-event-timer',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Conditional start event',\n    actionName: 'replace-with-conditional-start',\n    className: 'bpmn-icon-start-event-condition',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Signal start event',\n    actionName: 'replace-with-signal-start',\n    className: 'bpmn-icon-start-event-signal',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Error start event',\n    actionName: 'replace-with-error-start',\n    className: 'bpmn-icon-start-event-error',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:ErrorEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Escalation start event',\n    actionName: 'replace-with-escalation-start',\n    className: 'bpmn-icon-start-event-escalation',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Compensation start event',\n    actionName: 'replace-with-compensation-start',\n    className: 'bpmn-icon-start-event-compensation',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Message start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-message-start',\n    className: 'bpmn-icon-start-event-non-interrupting-message',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Timer start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-timer-start',\n    className: 'bpmn-icon-start-event-non-interrupting-timer',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Conditional start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-conditional-start',\n    className: 'bpmn-icon-start-event-non-interrupting-condition',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Signal start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-signal-start',\n    className: 'bpmn-icon-start-event-non-interrupting-signal',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Escalation start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-escalation-start',\n    className: 'bpmn-icon-start-event-non-interrupting-escalation',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition',\n      isInterrupting: false\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nvar SEQUENCE_FLOW = [\n  {\n    label: 'Sequence flow',\n    actionName: 'replace-with-sequence-flow',\n    className: 'bpmn-icon-connection'\n  },\n  {\n    label: 'Default flow',\n    actionName: 'replace-with-default-flow',\n    className: 'bpmn-icon-default-flow'\n  },\n  {\n    label: 'Conditional flow',\n    actionName: 'replace-with-conditional-flow',\n    className: 'bpmn-icon-conditional-flow'\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nvar PARTICIPANT = [\n  {\n    label: 'Expanded pool/participant',\n    actionName: 'replace-with-expanded-pool',\n    className: 'bpmn-icon-participant',\n    target: {\n      type: 'bpmn:Participant',\n      isExpanded: true\n    }\n  },\n  {\n    label: function(element) {\n      var label = 'Empty pool/participant';\n\n      if (element.children && element.children.length) {\n        label += ' (removes content)';\n      }\n\n      return label;\n    },\n    actionName: 'replace-with-collapsed-pool',\n\n    // TODO(@janstuemmel): maybe design new icon\n    className: 'bpmn-icon-lane',\n    target: {\n      type: 'bpmn:Participant',\n      isExpanded: false\n    }\n  }\n];\n\n/**\n * @type {{ [key: string]: ReplaceOption[]}}\n */\nvar TYPED_EVENT = {\n  'bpmn:MessageEventDefinition': [\n    {\n      label: 'Message start event',\n      actionName: 'replace-with-message-start',\n      className: 'bpmn-icon-start-event-message',\n      target: {\n        type: 'bpmn:StartEvent',\n        eventDefinitionType: 'bpmn:MessageEventDefinition'\n      }\n    },\n    {\n      label: 'Message intermediate catch event',\n      actionName: 'replace-with-message-intermediate-catch',\n      className: 'bpmn-icon-intermediate-event-catch-message',\n      target: {\n        type: 'bpmn:IntermediateCatchEvent',\n        eventDefinitionType: 'bpmn:MessageEventDefinition'\n      }\n    },\n    {\n      label: 'Message intermediate throw event',\n      actionName: 'replace-with-message-intermediate-throw',\n      className: 'bpmn-icon-intermediate-event-throw-message',\n      target: {\n        type: 'bpmn:IntermediateThrowEvent',\n        eventDefinitionType: 'bpmn:MessageEventDefinition'\n      }\n    },\n    {\n      label: 'Message end event',\n      actionName: 'replace-with-message-end',\n      className: 'bpmn-icon-end-event-message',\n      target: {\n        type: 'bpmn:EndEvent',\n        eventDefinitionType: 'bpmn:MessageEventDefinition'\n      }\n    }\n  ],\n  'bpmn:TimerEventDefinition': [\n    {\n      label: 'Timer start event',\n      actionName: 'replace-with-timer-start',\n      className: 'bpmn-icon-start-event-timer',\n      target: {\n        type: 'bpmn:StartEvent',\n        eventDefinitionType: 'bpmn:TimerEventDefinition'\n      }\n    },\n    {\n      label: 'Timer intermediate catch event',\n      actionName: 'replace-with-timer-intermediate-catch',\n      className: 'bpmn-icon-intermediate-event-catch-timer',\n      target: {\n        type: 'bpmn:IntermediateCatchEvent',\n        eventDefinitionType: 'bpmn:TimerEventDefinition'\n      }\n    }\n  ],\n  'bpmn:ConditionalEventDefinition': [\n    {\n      label: 'Conditional start event',\n      actionName: 'replace-with-conditional-start',\n      className: 'bpmn-icon-start-event-condition',\n      target: {\n        type: 'bpmn:StartEvent',\n        eventDefinitionType: 'bpmn:ConditionalEventDefinition'\n      }\n    },\n    {\n      label: 'Conditional intermediate catch event',\n      actionName: 'replace-with-conditional-intermediate-catch',\n      className: 'bpmn-icon-intermediate-event-catch-condition',\n      target: {\n        type: 'bpmn:IntermediateCatchEvent',\n        eventDefinitionType: 'bpmn:ConditionalEventDefinition'\n      }\n    }\n  ],\n  'bpmn:SignalEventDefinition': [\n    {\n      label: 'Signal start event',\n      actionName: 'replace-with-signal-start',\n      className: 'bpmn-icon-start-event-signal',\n      target: {\n        type: 'bpmn:StartEvent',\n        eventDefinitionType: 'bpmn:SignalEventDefinition'\n      }\n    },\n    {\n      label: 'Signal intermediate catch event',\n      actionName: 'replace-with-signal-intermediate-catch',\n      className: 'bpmn-icon-intermediate-event-catch-signal',\n      target: {\n        type: 'bpmn:IntermediateCatchEvent',\n        eventDefinitionType: 'bpmn:SignalEventDefinition'\n      }\n    },\n    {\n      label: 'Signal intermediate throw event',\n      actionName: 'replace-with-signal-intermediate-throw',\n      className: 'bpmn-icon-intermediate-event-throw-signal',\n      target: {\n        type: 'bpmn:IntermediateThrowEvent',\n        eventDefinitionType: 'bpmn:SignalEventDefinition'\n      }\n    },\n    {\n      label: 'Signal end event',\n      actionName: 'replace-with-signal-end',\n      className: 'bpmn-icon-end-event-signal',\n      target: {\n        type: 'bpmn:EndEvent',\n        eventDefinitionType: 'bpmn:SignalEventDefinition'\n      }\n    }\n  ],\n  'bpmn:ErrorEventDefinition': [\n    {\n      label: 'Error start event',\n      actionName: 'replace-with-error-start',\n      className: 'bpmn-icon-start-event-error',\n      target: {\n        type: 'bpmn:StartEvent',\n        eventDefinitionType: 'bpmn:ErrorEventDefinition'\n      }\n    },\n    {\n      label: 'Error end event',\n      actionName: 'replace-with-error-end',\n      className: 'bpmn-icon-end-event-error',\n      target: {\n        type: 'bpmn:EndEvent',\n        eventDefinitionType: 'bpmn:ErrorEventDefinition'\n      }\n    }\n  ],\n  'bpmn:EscalationEventDefinition': [\n    {\n      label: 'Escalation start event',\n      actionName: 'replace-with-escalation-start',\n      className: 'bpmn-icon-start-event-escalation',\n      target: {\n        type: 'bpmn:StartEvent',\n        eventDefinitionType: 'bpmn:EscalationEventDefinition'\n      }\n    },\n    {\n      label: 'Escalation intermediate throw event',\n      actionName: 'replace-with-escalation-intermediate-throw',\n      className: 'bpmn-icon-intermediate-event-throw-escalation',\n      target: {\n        type: 'bpmn:IntermediateThrowEvent',\n        eventDefinitionType: 'bpmn:EscalationEventDefinition'\n      }\n    },\n    {\n      label: 'Escalation end event',\n      actionName: 'replace-with-escalation-end',\n      className: 'bpmn-icon-end-event-escalation',\n      target: {\n        type: 'bpmn:EndEvent',\n        eventDefinitionType: 'bpmn:EscalationEventDefinition'\n      }\n    }\n  ],\n  'bpmn:CompensateEventDefinition': [\n    {\n      label: 'Compensation start event',\n      actionName: 'replace-with-compensation-start',\n      className: 'bpmn-icon-start-event-compensation',\n      target: {\n        type: 'bpmn:StartEvent',\n        eventDefinitionType: 'bpmn:CompensateEventDefinition'\n      }\n    },\n    {\n      label: 'Compensation intermediate throw event',\n      actionName: 'replace-with-compensation-intermediate-throw',\n      className: 'bpmn-icon-intermediate-event-throw-compensation',\n      target: {\n        type: 'bpmn:IntermediateThrowEvent',\n        eventDefinitionType: 'bpmn:CompensateEventDefinition'\n      }\n    },\n    {\n      label: 'Compensation end event',\n      actionName: 'replace-with-compensation-end',\n      className: 'bpmn-icon-end-event-compensation',\n      target: {\n        type: 'bpmn:EndEvent',\n        eventDefinitionType: 'bpmn:CompensateEventDefinition'\n      }\n    }\n  ]\n};\n\nvar replaceOptions = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  AD_HOC_SUBPROCESS_EXPANDED: AD_HOC_SUBPROCESS_EXPANDED,\n  BOUNDARY_EVENT: BOUNDARY_EVENT,\n  DATA_OBJECT_REFERENCE: DATA_OBJECT_REFERENCE,\n  DATA_STORE_REFERENCE: DATA_STORE_REFERENCE,\n  END_EVENT: END_EVENT,\n  EVENT_SUB_PROCESS: EVENT_SUB_PROCESS,\n  EVENT_SUB_PROCESS_START_EVENT: EVENT_SUB_PROCESS_START_EVENT,\n  GATEWAY: GATEWAY,\n  INTERMEDIATE_EVENT: INTERMEDIATE_EVENT,\n  PARTICIPANT: PARTICIPANT,\n  SEQUENCE_FLOW: SEQUENCE_FLOW,\n  START_EVENT: START_EVENT,\n  START_EVENT_SUB_PROCESS: START_EVENT_SUB_PROCESS,\n  SUBPROCESS_EXPANDED: SUBPROCESS_EXPANDED,\n  TASK: TASK,\n  TRANSACTION: TRANSACTION,\n  TYPED_EVENT: TYPED_EVENT\n});\n\nconst ALL_OPTIONS = Object.values(replaceOptions);\n\nfunction getReplaceOptionGroups() {\n  return ALL_OPTIONS;\n}\n\n/**\n * A replace menu provider that allows to replace elements with\n * templates applied with the correspondent plain element.\n */\nfunction RemoveTemplateReplaceProvider(popupMenu, translate, elementTemplates) {\n\n  this._popupMenu = popupMenu;\n  this._translate = translate;\n  this._elementTemplates = elementTemplates;\n\n  this.register();\n}\n\nRemoveTemplateReplaceProvider.$inject = [\n  'popupMenu',\n  'translate',\n  'elementTemplates'\n];\n\n/**\n * Register replace menu provider in the popup menu\n */\nRemoveTemplateReplaceProvider.prototype.register = function() {\n  this._popupMenu.registerProvider('bpmn-replace', this);\n};\n\n/**\n * Adds the element templates to the replace menu.\n * @param {djs.model.Base} element\n *\n * @returns {Object}\n */\nRemoveTemplateReplaceProvider.prototype.getPopupMenuEntries = function(element) {\n\n  return (entries) => {\n\n    // convert our entries into something sortable\n    let entrySet = Object.entries(entries);\n\n    if (this._elementTemplates && this._elementTemplates.get(element)) {\n\n      // add remove template option\n      this.addPlainElementEntry(element, entrySet, this._translate, this._elementTemplates);\n    }\n\n    // convert back to object\n    return entrySet.reduce((entries, [ key, value ]) => {\n      entries[key] = value;\n\n      return entries;\n    }, {});\n  };\n};\n\n\n/**\n * Adds the option to replace with plain element (remove template).\n *\n * @param {djs.model.Base} element\n * @param {Array<Object>} entries\n */\nRemoveTemplateReplaceProvider.prototype.addPlainElementEntry = function(element, entries, translate, elementTemplates) {\n\n  const replaceOption = this.getPlainEntry(element, entries, translate, elementTemplates);\n\n  if (!replaceOption) {\n    return;\n  }\n\n  const [\n    insertIndex,\n    entry\n  ] = replaceOption;\n\n  // insert remove entry\n  entries.splice(insertIndex, 0, [ entry.id, entry ]);\n};\n\n/**\n * Returns the option to replace with plain element and the index where it should be inserted.\n *\n * @param {djs.model.Base} element\n * @param {Array<Object>} entries\n *\n * @returns {Array<Object, number>}\n */\nRemoveTemplateReplaceProvider.prototype.getPlainEntry = function(element, entries, translate, elementTemplates) {\n\n  const {\n    options,\n    option,\n    optionIndex\n  } = findReplaceOptions(element) || { };\n\n  if (!options) {\n    return null;\n  }\n\n  const entry = {\n    id: 'replace-remove-element-template',\n    action: () => {\n      elementTemplates.removeTemplate(element);\n    },\n    label: translate(option.label),\n    className: option.className\n  };\n\n  // insert after previous option, if it exists\n  const previousIndex = getOptionIndex(options, optionIndex - 1, entries);\n\n  if (previousIndex) {\n    return [\n      previousIndex + 1,\n      entry\n    ];\n  }\n\n  // insert before next option, if it exists\n  const nextIndex = getOptionIndex(options, optionIndex + 1, entries);\n\n  if (nextIndex) {\n    return [\n      nextIndex,\n      entry\n    ];\n  }\n\n  // fallback to insert at start\n  return [\n    0,\n    entry\n  ];\n};\n\n\n/**\n * @param {ModdleElement} element\n *\n * @return { { options: Array<any>, option: any, optionIndex: number } | null }\n */\nfunction findReplaceOptions(element) {\n\n  const isSameType = (element, option) => option.target && !isDifferentType(element)(option);\n\n  return getReplaceOptionGroups().reduce((result, options) => {\n\n    if (result) {\n      return result;\n    }\n\n    const optionIndex = options.findIndex(option => isSameType(element, option));\n\n    if (optionIndex === -1) {\n      return;\n    }\n\n    return {\n      options,\n      option: options[optionIndex],\n      optionIndex\n    };\n  }, null);\n}\n\nfunction getOptionIndex(options, index, entries) {\n  const option = options[index];\n\n  if (!option) {\n    return false;\n  }\n\n  return entries.findIndex(\n    ([ key ]) => key === option.actionName\n  );\n}\n\nvar RemoveTemplatesModule = {\n  __init__: [ 'removeTemplateReplaceProvider' ],\n  removeTemplateReplaceProvider: [ 'type', RemoveTemplateReplaceProvider ]\n};\n\nvar index = {\n  __depends__: [\n    AppendElementTemplatesModule,\n    CreateElementTemplatesModule,\n    ReplaceElementTemplatesModule,\n    RemoveTemplatesModule\n  ]\n};\n\nexport { index$1 as CreateAppendAnythingModule, index as CreateAppendElementTemplatesModule, RemoveTemplatesModule };\n","export function getEventType(event) {\r\n\r\n  if (event instanceof PointerEvent) {\r\n    return 'click';\r\n  } else if (event instanceof DragEvent) {\r\n    return 'drag';\r\n  } else if (event instanceof KeyboardEvent) {\r\n    return 'keyboard';\r\n  }\r\n}","import { getEventType } from '../Util';\r\n\r\nexport default class ContextPadTracking {\r\n  constructor(eventBus, bpmnJSTracking, selection) {\r\n    this._eventBus = eventBus;\r\n    this._bpmnJSTracking = bpmnJSTracking;\r\n    this._selection = selection;\r\n\r\n    this._eventBus.on('contextPad.trigger', this.trackTrigger.bind(this));\r\n  }\r\n\r\n  trackTrigger(e) {\r\n    const { entry, event } = e;\r\n    const { target } = event;\r\n\r\n    if (!target) {\r\n      return;\r\n    }\r\n\r\n    const entryElement = target.closest('[data-action]');\r\n    const entryAction = entryElement && entryElement.getAttribute('data-action');\r\n\r\n    if (!entryAction) {\r\n      return;\r\n    }\r\n\r\n    const type = getEventType(event);\r\n\r\n    this._bpmnJSTracking.track({\r\n      name: 'contextPad.trigger',\r\n      data: {\r\n        entryId: entryAction,\r\n        entryGroup: entry.group || 'default',\r\n        entryTitle: entry.title,\r\n        selection: this._selection.get(),\r\n        triggerType: type\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nContextPadTracking.$inject = [\r\n  'eventBus',\r\n  'bpmnJSTracking',\r\n  'selection'\r\n];\r\n","import ContextPadTracking from './ContextPadTracking';\r\n\r\nexport default {\r\n  __init__: [\r\n    'contextPadTracking'\r\n  ],\r\n  contextPadTracking: [ 'type', ContextPadTracking ]\r\n};","export default class ElementTemplatesTracking {\r\n  constructor(eventBus, bpmnJSTracking, selection) {\r\n    this._eventBus = eventBus;\r\n    this._bpmnJSTracking = bpmnJSTracking;\r\n    this._selection = selection;\r\n\r\n    this._eventBus.on('elementTemplates.select', this.trackTemplateSelect.bind(this));\r\n    this._eventBus.on('elementTemplates.update', this.trackTemplateUpdate.bind(this));\r\n    this._eventBus.on('elementTemplates.unlink', this.trackTemplateUnlink.bind(this));\r\n    this._eventBus.on('elementTemplates.remove', this.trackTemplateRemove.bind(this));\r\n  }\r\n\r\n  trackTemplateSelect(e) {\r\n    const { element } = e;\r\n\r\n    this._bpmnJSTracking.track({\r\n      name: 'elementTemplates.select',\r\n      data: {\r\n        element\r\n      }\r\n    });\r\n  }\r\n\r\n  trackTemplateUpdate(e) {\r\n    const { element, newTemplate } = e;\r\n\r\n    this._bpmnJSTracking.track({\r\n      name: 'elementTemplates.update',\r\n      data: {\r\n        element,\r\n        newTemplate\r\n      }\r\n    });\r\n  }\r\n\r\n  trackTemplateUnlink(e) {\r\n    const { element } = e;\r\n\r\n    this._bpmnJSTracking.track({\r\n      name: 'elementTemplates.unlink',\r\n      data: {\r\n        element\r\n      }\r\n    });\r\n  }\r\n\r\n  trackTemplateRemove(e) {\r\n    const { element } = e;\r\n\r\n    this._bpmnJSTracking.track({\r\n      name: 'elementTemplates.remove',\r\n      data: {\r\n        element\r\n      }\r\n    });\r\n  }\r\n\r\n}\r\n\r\nElementTemplatesTracking.$inject = [\r\n  'eventBus',\r\n  'bpmnJSTracking',\r\n  'selection'\r\n];\r\n","import ElementTemplatesTracking from './ElementTemplatesTracking';\r\n\r\nexport default {\r\n  __init__: [\r\n    'elementTemplatesTracking'\r\n  ],\r\n  elementTemplatesTracking: [ 'type', ElementTemplatesTracking ]\r\n};","export default class PopupEditorTracking {\r\n  constructor(eventBus, bpmnJSTracking, selection) {\r\n    this._eventBus = eventBus;\r\n    this._bpmnJSTracking = bpmnJSTracking;\r\n    this._selection = selection;\r\n\r\n    this._eventBus.on('feelPopup.opened', this.trackOpen.bind(this));\r\n    this._eventBus.on('feelPopup.closed', this.trackClosed.bind(this));\r\n  }\r\n\r\n  trackOpen() {\r\n    this._bpmnJSTracking.track({\r\n      name: 'feelPopup.opened',\r\n      data: {\r\n        selection: this._selection.get(),\r\n      }\r\n    });\r\n  }\r\n\r\n  trackClosed() {\r\n    this._bpmnJSTracking.track({\r\n      name: 'feelPopup.closed',\r\n      data: {\r\n        selection: this._selection.get(),\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nPopupEditorTracking.$inject = [\r\n  'eventBus',\r\n  'bpmnJSTracking',\r\n  'selection'\r\n];\r\n","import FeelPopupTracking from './FeelPopupTracking';\r\n\r\nexport default {\r\n  __init__: [\r\n    'feelPopupTracking'\r\n  ],\r\n  feelPopupTracking: [ 'type', FeelPopupTracking ]\r\n};","export default class ModelingTracking {\r\n  constructor(eventBus, bpmnJSTracking, elementRegistry, selection) {\r\n    this._eventBus = eventBus;\r\n    this._bpmnJSTracking = bpmnJSTracking;\r\n    this._elementRegistry = elementRegistry;\r\n    this._selection = selection;\r\n\r\n    this._eventBus.on(\r\n      'commandStack.elements.create.postExecuted',\r\n      this.trackElementsCreate.bind(this)\r\n    );\r\n\r\n    this._eventBus.on(\r\n      'commandStack.shape.append.postExecuted',\r\n      this.trackElementAppend.bind(this)\r\n    );\r\n\r\n    this._eventBus.on(\r\n      'commandStack.shape.replace.postExecuted',\r\n      this.trackElementReplace.bind(this)\r\n    );\r\n  }\r\n\r\n  trackElementsCreate(e) {\r\n    const { context } = e;\r\n\r\n    this._bpmnJSTracking.track({\r\n      name: 'modeling.createElements',\r\n      data: {\r\n        elements: context.elements\r\n      }\r\n    });\r\n  }\r\n\r\n  trackElementAppend(e) {\r\n    const { shape, source } = e.context;\r\n\r\n    this._bpmnJSTracking.track({\r\n      name: 'modeling.appendElement',\r\n      data: {\r\n        element: shape,\r\n        sourceElement: source\r\n      }\r\n    });\r\n  }\r\n\r\n  trackElementReplace(e) {\r\n    const { oldShape, newShape } = e.context;\r\n\r\n    this._bpmnJSTracking.track({\r\n      name: 'modeling.replaceElement',\r\n      data: {\r\n        newElement: newShape,\r\n        oldElement: oldShape\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nModelingTracking.$inject = [\r\n  'eventBus',\r\n  'bpmnJSTracking',\r\n  'elementRegistry',\r\n  'selection'\r\n];\r\n","import ModelingTracking from './ModelingTracking.js';\r\n\r\nexport default {\r\n  __init__: [\r\n    'modelingTracking'\r\n  ],\r\n  modelingTracking: [ 'type', ModelingTracking ]\r\n};","import { getEventType } from '../Util';\r\n\r\nexport default class PaletteTracking {\r\n  constructor(eventBus, bpmnJSTracking, selection) {\r\n    this._eventBus = eventBus;\r\n    this._bpmnJSTracking = bpmnJSTracking;\r\n    this._selection = selection;\r\n\r\n    this._eventBus.on('palette.trigger', this.trackTrigger.bind(this));\r\n  }\r\n\r\n  trackTrigger(e) {\r\n    const { entry, event } = e;\r\n    const { target } = event;\r\n\r\n    if (!target) {\r\n      return;\r\n    }\r\n\r\n    const entryElement = target.closest('[data-action]');\r\n    const entryAction = entryElement && entryElement.getAttribute('data-action');\r\n\r\n    if (!entryAction) {\r\n      return;\r\n    }\r\n\r\n    const type = getEventType(event);\r\n\r\n    this._bpmnJSTracking.track({\r\n      name: 'palette.trigger',\r\n      data: {\r\n        entryId: entryAction,\r\n        entryGroup: entry.group || 'default',\r\n        entryTitle: entry.title,\r\n        selection: this._selection.get(),\r\n        triggerType: type\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nPaletteTracking.$inject = [\r\n  'eventBus',\r\n  'bpmnJSTracking',\r\n  'selection'\r\n];\r\n","import PaletteTracking from './PaletteTracking.js';\r\n\r\nexport default {\r\n  __init__: [\r\n    'paletteTracking'\r\n  ],\r\n  paletteTracking: [ 'type', PaletteTracking ]\r\n};","import { getEventType } from '../Util';\r\n\r\nexport default class PopupMenuTracking {\r\n  constructor(eventBus, bpmnJSTracking, selection) {\r\n    this._eventBus = eventBus;\r\n    this._bpmnJSTracking = bpmnJSTracking;\r\n    this._selection = selection;\r\n\r\n    this._eventBus.on('popupMenu.open', this.trackOpen.bind(this));\r\n    this._eventBus.on('popupMenu.trigger', this.trackTrigger.bind(this));\r\n  }\r\n\r\n  trackOpen() {\r\n    this._bpmnJSTracking.track({\r\n      name: 'popupMenu.open',\r\n      data: {\r\n        selection: this._selection.get(),\r\n      }\r\n    });\r\n  }\r\n\r\n  trackTrigger(e) {\r\n    const { entry, event } = e;\r\n\r\n    const type = getEventType(event);\r\n\r\n    this._bpmnJSTracking.track({\r\n      name: 'popupMenu.trigger',\r\n      data: {\r\n        entryId: entry.id,\r\n        entryGroup: entry.group || 'default',\r\n        entryLabel: entry.label,\r\n        triggerType: type\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nPopupMenuTracking.$inject = [\r\n  'eventBus',\r\n  'bpmnJSTracking',\r\n  'selection'\r\n];\r\n","import PopupMenuTracking from './PopupMenuTracking';\r\n\r\nexport default {\r\n  __init__: [\r\n    'popupMenuTracking'\r\n  ],\r\n  popupMenuTracking: [ 'type', PopupMenuTracking ]\r\n};","\r\nclass BpmnJSTracking {\r\n\r\n  constructor(config, eventBus) {\r\n    this._eventBus = eventBus;\r\n\r\n    this._isEnabled = false;\r\n\r\n    // setup tracking if configured\r\n    if (config && config.track)\r\n      this.on('tracking.event', config.track);\r\n\r\n  }\r\n\r\n  isEnabled() {\r\n    return this._isEnabled;\r\n  }\r\n\r\n  enable() {\r\n    this._isEnabled = true;\r\n\r\n    this._eventBus.fire('tracking.enabled');\r\n  }\r\n\r\n  disable() {\r\n    this._isEnabled = false;\r\n\r\n    this._eventBus.fire('tracking.disabled');\r\n  }\r\n\r\n  on(...args) {\r\n    return this._eventBus.on(...args);\r\n  }\r\n\r\n  track(event) {\r\n    if (this.isEnabled()) {\r\n      this._eventBus.fire('tracking.event', sanitizeEvent(event));\r\n    }\r\n  }\r\n}\r\n\r\nBpmnJSTracking.$inject = [ 'config.bpmnJSTracking', 'eventBus' ];\r\n\r\nexport default {\r\n  __init__: [\r\n    'bpmnJSTracking'\r\n  ],\r\n  bpmnJSTracking: [ 'type', BpmnJSTracking ]\r\n};\r\n\r\n\r\n// helpers //////////////////////\r\n\r\nexport function sanitizeEvent(event) {\r\n  if (!event.data) {\r\n    event.data = {};\r\n  }\r\n\r\n  for (const [ key, value ] of Object.entries(event.data)) {\r\n    if (Array.isArray(value)) {\r\n      event.data[key] = value.map(sanitizeValue);\r\n    } else {\r\n      event.data[key] = sanitizeValue(value);\r\n    }\r\n  }\r\n\r\n  return event;\r\n}\r\n\r\nfunction sanitizeValue(value) {\r\n  if (!isElement(value)) {\r\n    return value;\r\n  }\r\n\r\n  return {\r\n    type: value.type || value.$type,\r\n    collapsed: value.collapsed,\r\n    attachers: value.attachers && value.attachers.map(sanitizeValue),\r\n    incoming: value.incoming && value.incoming.map(sanitizeValue),\r\n    outgoing: value.outgoing && value.outgoing.map(sanitizeValue),\r\n    parent: value.parent && sanitizeValue(value.parent)\r\n  };\r\n}\r\n\r\nfunction isElement(value) {\r\n  return value && (value.$type || value.type);\r\n}","export default class ContextPadTracking {\r\n  constructor(eventBus, bpmnJSTracking) {\r\n    this._bpmnJSTracking = bpmnJSTracking;\r\n    this._eventBus = eventBus;\r\n\r\n    this._eventBus.on('refactorings.execute', this.trackRefactoring.bind(this));\r\n  }\r\n\r\n  trackRefactoring(event) {\r\n    const { refactoring } = event;\r\n\r\n    this._bpmnJSTracking.track({\r\n      name: 'refactorings.execute',\r\n      data: {\r\n        refactoring\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nContextPadTracking.$inject = [\r\n  'eventBus',\r\n  'bpmnJSTracking'\r\n];\r\n","export default class SelectionTracking {\r\n  constructor(eventBus, bpmnJSTracking) {\r\n    this._eventBus = eventBus;\r\n    this._bpmnJSTracking = bpmnJSTracking;\r\n\r\n    this._eventBus.on('selection.changed', this.trackEvent.bind(this));\r\n  }\r\n\r\n  trackEvent(event) {\r\n    this._bpmnJSTracking.track({\r\n      name: 'selection.select',\r\n      data: {\r\n        oldSelection: event.oldSelection,\r\n        newSelection: event.newSelection\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nSelectionTracking.$inject = [ 'eventBus', 'bpmnJSTracking' ];\r\n","import contextPadTracking from './context-pad';\r\nimport elementTemplates from './element-templates';\r\nimport feelPopupTracking from './feel-popup';\r\nimport modelingTracking from './modeling';\r\nimport paletteTracking from './palette';\r\nimport popupMenuTracking from './popup-menu';\r\nimport refactoringsTracking from './refactorings';\r\nimport selectionTracking from './selection';\r\n\r\nexport default {\r\n  __depends__: [\r\n    contextPadTracking,\r\n    elementTemplates,\r\n    feelPopupTracking,\r\n    modelingTracking,\r\n    paletteTracking,\r\n    popupMenuTracking,\r\n    refactoringsTracking,\r\n    selectionTracking\r\n  ]\r\n};","import CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from 'bpmn-js/lib/util/ModelUtil';\n\nconst LOW_PRIORITY = 250;\n\n/**\n * Camunda-specific behavior ensuring `isExecutable` is kept after deleting\n * the last participant.\n */\nexport default class DeleteParticipantBehaviour extends CommandInterceptor {\n  constructor(eventBus, canvas, modeling) {\n    super(eventBus);\n\n    this.postExecuted('shape.delete', LOW_PRIORITY, function(context) {\n      const {\n        collaborationRoot,\n        shape\n      } = context;\n\n      const newRoot = canvas.getRootElement();\n\n      if (is(shape, 'bpmn:Participant') &&\n          collaborationRoot &&\n          !collaborationRoot.businessObject.get('participants').length &&\n          is(newRoot, 'bpmn:Process')) {\n\n        const oldProcessBusinessObject = shape.businessObject.get('processRef');\n\n        if (!oldProcessBusinessObject) {\n          return;\n        }\n\n        modeling.updateProperties(newRoot, { isExecutable: oldProcessBusinessObject.get('isExecutable') });\n      }\n\n    }, true);\n  }\n}\n\nDeleteParticipantBehaviour.$inject = [\n  'eventBus',\n  'canvas',\n  'modeling'\n];","import {\n  getBusinessObject,\n  is\n} from 'bpmn-js/lib/util/ModelUtil';\n\nimport { isArray } from 'min-dash';\n\n/**\n * Get extension elements of business object. Optionally filter by type.\n *\n * @param  {djs.model.Base|ModdleElement} element\n * @param  {String} [type=undefined]\n * @returns {Array<ModdleElement>}\n */\nexport function getExtensionElementsList(element, type = undefined) {\n  const businessObject = getBusinessObject(element),\n        extensionElements = businessObject.get('extensionElements');\n\n  if (!extensionElements) {\n    return [];\n  }\n\n  const values = extensionElements.get('values');\n\n  if (!values || !values.length) {\n    return [];\n  }\n\n  if (type) {\n    return values.filter(value => is(value, type));\n  }\n\n  return values;\n}\n\n/**\n * Remove one or more extension elements. Remove bpmn:ExtensionElements afterwards if it's empty.\n *\n * @param {ModdleElement} element\n * @param {ModdleElement} businessObject\n * @param {ModdleElement|Array<ModdleElement>} extensionElementsToRemove\n * @param {CommandStack} commandStack\n */\nexport function removeExtensionElements(element, businessObject, extensionElementsToRemove, commandStack) {\n  if (!isArray(extensionElementsToRemove)) {\n    extensionElementsToRemove = [ extensionElementsToRemove ];\n  }\n\n  const extensionElements = businessObject.get('extensionElements'),\n        values = extensionElements.get('values').filter(value => !extensionElementsToRemove.includes(value));\n\n  commandStack.execute('element.updateModdleProperties', {\n    element,\n    moddleElement: extensionElements,\n    properties: {\n      values\n    }\n  });\n}\n","function getDefaultExportFromCjs (x) {\n\treturn x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n}\n\nvar hat$1 = {exports: {}};\n\nvar hasRequiredHat;\n\nfunction requireHat () {\n\tif (hasRequiredHat) return hat$1.exports;\n\thasRequiredHat = 1;\n\tvar hat = hat$1.exports = function (bits, base) {\n\t    if (!base) base = 16;\n\t    if (bits === undefined) bits = 128;\n\t    if (bits <= 0) return '0';\n\t    \n\t    var digits = Math.log(Math.pow(2, bits)) / Math.log(base);\n\t    for (var i = 2; digits === Infinity; i *= 2) {\n\t        digits = Math.log(Math.pow(2, bits / i)) / Math.log(base) * i;\n\t    }\n\t    \n\t    var rem = digits - Math.floor(digits);\n\t    \n\t    var res = '';\n\t    \n\t    for (var i = 0; i < Math.floor(digits); i++) {\n\t        var x = Math.floor(Math.random() * base).toString(base);\n\t        res = x + res;\n\t    }\n\t    \n\t    if (rem) {\n\t        var b = Math.pow(base, rem);\n\t        var x = Math.floor(Math.random() * b).toString(base);\n\t        res = x + res;\n\t    }\n\t    \n\t    var parsed = parseInt(res, base);\n\t    if (parsed !== Infinity && parsed >= Math.pow(2, bits)) {\n\t        return hat(bits, base)\n\t    }\n\t    else return res;\n\t};\n\n\that.rack = function (bits, base, expandBy) {\n\t    var fn = function (data) {\n\t        var iters = 0;\n\t        do {\n\t            if (iters ++ > 10) {\n\t                if (expandBy) bits += expandBy;\n\t                else throw new Error('too many ID collisions, use more bits')\n\t            }\n\t            \n\t            var id = hat(bits, base);\n\t        } while (Object.hasOwnProperty.call(hats, id));\n\t        \n\t        hats[id] = data;\n\t        return id;\n\t    };\n\t    var hats = fn.hats = {};\n\t    \n\t    fn.get = function (id) {\n\t        return fn.hats[id];\n\t    };\n\t    \n\t    fn.set = function (id, value) {\n\t        fn.hats[id] = value;\n\t        return fn;\n\t    };\n\t    \n\t    fn.bits = bits || 128;\n\t    fn.base = base || 16;\n\t    return fn;\n\t};\n\treturn hat$1.exports;\n}\n\nvar hatExports = requireHat();\nvar hat = /*@__PURE__*/getDefaultExportFromCjs(hatExports);\n\n/**\n * @typedef { [ number, number ] | [ number, number, number ] } Seed\n */\n\n/**\n * Create a new id generator / cache instance.\n *\n * You may optionally provide a seed that is used internally.\n *\n * @param {Seed} [seed]\n */\nfunction Ids(seed) {\n\n  if (!(this instanceof Ids)) {\n    return new Ids(seed);\n  }\n\n  seed = seed || [ 128, 36, 1 ];\n  this._seed = seed.length ? hat.rack(seed[0], seed[1], seed[2]) : seed;\n}\n\n/**\n * Generate a next id.\n *\n * @param {Object} [element] element to bind the id to\n *\n * @return {String} id\n */\nIds.prototype.next = function(element) {\n  return this._seed(element || true);\n};\n\n/**\n * Generate a next id with a given prefix.\n *\n * @param {Object} [element] element to bind the id to\n *\n * @return {String} id\n */\nIds.prototype.nextPrefixed = function(prefix, element) {\n  var id;\n\n  do {\n    id = prefix + this.next(true);\n  } while (this.assigned(id));\n\n  // claim {prefix}{random}\n  this.claim(id, element);\n\n  // return\n  return id;\n};\n\n/**\n * Manually claim an existing id.\n *\n * @param {String} id\n * @param {String} [element] element the id is claimed by\n */\nIds.prototype.claim = function(id, element) {\n  this._seed.set(id, element || true);\n};\n\n/**\n * Returns true if the given id has already been assigned.\n *\n * @param  {String} id\n * @return {Boolean}\n */\nIds.prototype.assigned = function(id) {\n  return this._seed.get(id) || false;\n};\n\n/**\n * Unclaim an id.\n *\n * @param  {String} id the id to unclaim\n */\nIds.prototype.unclaim = function(id) {\n  delete this._seed.hats[id];\n};\n\n\n/**\n * Clear all claimed ids.\n */\nIds.prototype.clear = function() {\n\n  var hats = this._seed.hats,\n      id;\n\n  for (id in hats) {\n    this.unclaim(id);\n  }\n};\n\nexport { Ids };\n","import { forEach, bind, pick, assign, isString, isObject, set } from 'min-dash';\n\n/**\n * Moddle base element.\n */\nfunction Base() { }\n\nBase.prototype.get = function(name) {\n  return this.$model.properties.get(this, name);\n};\n\nBase.prototype.set = function(name, value) {\n  this.$model.properties.set(this, name, value);\n};\n\n/**\n * A model element factory.\n *\n * @param {Moddle} model\n * @param {Properties} properties\n */\nfunction Factory(model, properties) {\n  this.model = model;\n  this.properties = properties;\n}\n\n\nFactory.prototype.createType = function(descriptor) {\n\n  var model = this.model;\n\n  var props = this.properties,\n      prototype = Object.create(Base.prototype);\n\n  // initialize default values\n  forEach(descriptor.properties, function(p) {\n    if (!p.isMany && p.default !== undefined) {\n      prototype[p.name] = p.default;\n    }\n  });\n\n  props.defineModel(prototype, model);\n  props.defineDescriptor(prototype, descriptor);\n\n  var name = descriptor.ns.name;\n\n  /**\n   * The new type constructor\n   */\n  function ModdleElement(attrs) {\n    props.define(this, '$type', { value: name, enumerable: true });\n    props.define(this, '$attrs', { value: {} });\n    props.define(this, '$parent', { writable: true });\n\n    forEach(attrs, bind(function(val, key) {\n      this.set(key, val);\n    }, this));\n  }\n\n  ModdleElement.prototype = prototype;\n\n  ModdleElement.hasType = prototype.$instanceOf = this.model.hasType;\n\n  // static links\n  props.defineModel(ModdleElement, model);\n  props.defineDescriptor(ModdleElement, descriptor);\n\n  return ModdleElement;\n};\n\n/**\n * Built-in moddle types\n */\nvar BUILTINS = {\n  String: true,\n  Boolean: true,\n  Integer: true,\n  Real: true,\n  Element: true\n};\n\n/**\n * Converters for built in types from string representations\n */\nvar TYPE_CONVERTERS = {\n  String: function(s) { return s; },\n  Boolean: function(s) { return s === 'true'; },\n  Integer: function(s) { return parseInt(s, 10); },\n  Real: function(s) { return parseFloat(s); }\n};\n\n/**\n * Convert a type to its real representation\n */\nfunction coerceType(type, value) {\n\n  var converter = TYPE_CONVERTERS[type];\n\n  if (converter) {\n    return converter(value);\n  } else {\n    return value;\n  }\n}\n\n/**\n * Return whether the given type is built-in\n */\nfunction isBuiltIn(type) {\n  return !!BUILTINS[type];\n}\n\n/**\n * Return whether the given type is simple\n */\nfunction isSimple(type) {\n  return !!TYPE_CONVERTERS[type];\n}\n\n/**\n * Parses a namespaced attribute name of the form (ns:)localName to an object,\n * given a default prefix to assume in case no explicit namespace is given.\n *\n * @param {String} name\n * @param {String} [defaultPrefix] the default prefix to take, if none is present.\n *\n * @return {Object} the parsed name\n */\nfunction parseName(name, defaultPrefix) {\n  var parts = name.split(/:/),\n      localName, prefix;\n\n  // no prefix (i.e. only local name)\n  if (parts.length === 1) {\n    localName = name;\n    prefix = defaultPrefix;\n  }\n\n  // prefix + local name\n  else if (parts.length === 2) {\n    localName = parts[1];\n    prefix = parts[0];\n  }\n\n  else {\n    throw new Error('expected <prefix:localName> or <localName>, got ' + name);\n  }\n\n  name = (prefix ? prefix + ':' : '') + localName;\n\n  return {\n    name: name,\n    prefix: prefix,\n    localName: localName\n  };\n}\n\n/**\n * A utility to build element descriptors.\n */\nfunction DescriptorBuilder(nameNs) {\n  this.ns = nameNs;\n  this.name = nameNs.name;\n  this.allTypes = [];\n  this.allTypesByName = {};\n  this.properties = [];\n  this.propertiesByName = {};\n}\n\n\nDescriptorBuilder.prototype.build = function() {\n  return pick(this, [\n    'ns',\n    'name',\n    'allTypes',\n    'allTypesByName',\n    'properties',\n    'propertiesByName',\n    'bodyProperty',\n    'idProperty'\n  ]);\n};\n\n/**\n * Add property at given index.\n *\n * @param {Object} p\n * @param {Number} [idx]\n * @param {Boolean} [validate=true]\n */\nDescriptorBuilder.prototype.addProperty = function(p, idx, validate) {\n\n  if (typeof idx === 'boolean') {\n    validate = idx;\n    idx = undefined;\n  }\n\n  this.addNamedProperty(p, validate !== false);\n\n  var properties = this.properties;\n\n  if (idx !== undefined) {\n    properties.splice(idx, 0, p);\n  } else {\n    properties.push(p);\n  }\n};\n\n\nDescriptorBuilder.prototype.replaceProperty = function(oldProperty, newProperty, replace) {\n  var oldNameNs = oldProperty.ns;\n\n  var props = this.properties,\n      propertiesByName = this.propertiesByName,\n      rename = oldProperty.name !== newProperty.name;\n\n  if (oldProperty.isId) {\n    if (!newProperty.isId) {\n      throw new Error(\n        'property <' + newProperty.ns.name + '> must be id property ' +\n        'to refine <' + oldProperty.ns.name + '>');\n    }\n\n    this.setIdProperty(newProperty, false);\n  }\n\n  if (oldProperty.isBody) {\n\n    if (!newProperty.isBody) {\n      throw new Error(\n        'property <' + newProperty.ns.name + '> must be body property ' +\n        'to refine <' + oldProperty.ns.name + '>');\n    }\n\n    // TODO: Check compatibility\n    this.setBodyProperty(newProperty, false);\n  }\n\n  // validate existence and get location of old property\n  var idx = props.indexOf(oldProperty);\n  if (idx === -1) {\n    throw new Error('property <' + oldNameNs.name + '> not found in property list');\n  }\n\n  // remove old property\n  props.splice(idx, 1);\n\n  // replacing the named property is intentional\n  //\n  //  * validate only if this is a \"rename\" operation\n  //  * add at specific index unless we \"replace\"\n  //\n  this.addProperty(newProperty, replace ? undefined : idx, rename);\n\n  // make new property available under old name\n  propertiesByName[oldNameNs.name] = propertiesByName[oldNameNs.localName] = newProperty;\n};\n\n\nDescriptorBuilder.prototype.redefineProperty = function(p, targetPropertyName, replace) {\n\n  var nsPrefix = p.ns.prefix;\n  var parts = targetPropertyName.split('#');\n\n  var name = parseName(parts[0], nsPrefix);\n  var attrName = parseName(parts[1], name.prefix).name;\n\n  var redefinedProperty = this.propertiesByName[attrName];\n  if (!redefinedProperty) {\n    throw new Error('refined property <' + attrName + '> not found');\n  } else {\n    this.replaceProperty(redefinedProperty, p, replace);\n  }\n\n  delete p.redefines;\n};\n\nDescriptorBuilder.prototype.addNamedProperty = function(p, validate) {\n  var ns = p.ns,\n      propsByName = this.propertiesByName;\n\n  if (validate) {\n    this.assertNotDefined(p, ns.name);\n    this.assertNotDefined(p, ns.localName);\n  }\n\n  propsByName[ns.name] = propsByName[ns.localName] = p;\n};\n\nDescriptorBuilder.prototype.removeNamedProperty = function(p) {\n  var ns = p.ns,\n      propsByName = this.propertiesByName;\n\n  delete propsByName[ns.name];\n  delete propsByName[ns.localName];\n};\n\nDescriptorBuilder.prototype.setBodyProperty = function(p, validate) {\n\n  if (validate && this.bodyProperty) {\n    throw new Error(\n      'body property defined multiple times ' +\n      '(<' + this.bodyProperty.ns.name + '>, <' + p.ns.name + '>)');\n  }\n\n  this.bodyProperty = p;\n};\n\nDescriptorBuilder.prototype.setIdProperty = function(p, validate) {\n\n  if (validate && this.idProperty) {\n    throw new Error(\n      'id property defined multiple times ' +\n      '(<' + this.idProperty.ns.name + '>, <' + p.ns.name + '>)');\n  }\n\n  this.idProperty = p;\n};\n\nDescriptorBuilder.prototype.assertNotTrait = function(typeDescriptor) {\n\n  const _extends = typeDescriptor.extends || [];\n\n  if (_extends.length) {\n    throw new Error(\n      `cannot create <${ typeDescriptor.name }> extending <${ typeDescriptor.extends }>`\n    );\n  }\n};\n\nDescriptorBuilder.prototype.assertNotDefined = function(p, name) {\n  var propertyName = p.name,\n      definedProperty = this.propertiesByName[propertyName];\n\n  if (definedProperty) {\n    throw new Error(\n      'property <' + propertyName + '> already defined; ' +\n      'override of <' + definedProperty.definedBy.ns.name + '#' + definedProperty.ns.name + '> by ' +\n      '<' + p.definedBy.ns.name + '#' + p.ns.name + '> not allowed without redefines');\n  }\n};\n\nDescriptorBuilder.prototype.hasProperty = function(name) {\n  return this.propertiesByName[name];\n};\n\nDescriptorBuilder.prototype.addTrait = function(t, inherited) {\n\n  if (inherited) {\n    this.assertNotTrait(t);\n  }\n\n  var typesByName = this.allTypesByName,\n      types = this.allTypes;\n\n  var typeName = t.name;\n\n  if (typeName in typesByName) {\n    return;\n  }\n\n  forEach(t.properties, bind(function(p) {\n\n    // clone property to allow extensions\n    p = assign({}, p, {\n      name: p.ns.localName,\n      inherited: inherited\n    });\n\n    Object.defineProperty(p, 'definedBy', {\n      value: t\n    });\n\n    var replaces = p.replaces,\n        redefines = p.redefines;\n\n    // add replace/redefine support\n    if (replaces || redefines) {\n      this.redefineProperty(p, replaces || redefines, replaces);\n    } else {\n      if (p.isBody) {\n        this.setBodyProperty(p);\n      }\n      if (p.isId) {\n        this.setIdProperty(p);\n      }\n      this.addProperty(p);\n    }\n  }, this));\n\n  types.push(t);\n  typesByName[typeName] = t;\n};\n\n/**\n * A registry of Moddle packages.\n *\n * @param {Array<Package>} packages\n * @param {Properties} properties\n */\nfunction Registry(packages, properties) {\n  this.packageMap = {};\n  this.typeMap = {};\n\n  this.packages = [];\n\n  this.properties = properties;\n\n  forEach(packages, bind(this.registerPackage, this));\n}\n\n\nRegistry.prototype.getPackage = function(uriOrPrefix) {\n  return this.packageMap[uriOrPrefix];\n};\n\nRegistry.prototype.getPackages = function() {\n  return this.packages;\n};\n\n\nRegistry.prototype.registerPackage = function(pkg) {\n\n  // copy package\n  pkg = assign({}, pkg);\n\n  var pkgMap = this.packageMap;\n\n  ensureAvailable(pkgMap, pkg, 'prefix');\n  ensureAvailable(pkgMap, pkg, 'uri');\n\n  // register types\n  forEach(pkg.types, bind(function(descriptor) {\n    this.registerType(descriptor, pkg);\n  }, this));\n\n  pkgMap[pkg.uri] = pkgMap[pkg.prefix] = pkg;\n  this.packages.push(pkg);\n};\n\n\n/**\n * Register a type from a specific package with us\n */\nRegistry.prototype.registerType = function(type, pkg) {\n\n  type = assign({}, type, {\n    superClass: (type.superClass || []).slice(),\n    extends: (type.extends || []).slice(),\n    properties: (type.properties || []).slice(),\n    meta: assign((type.meta || {}))\n  });\n\n  var ns = parseName(type.name, pkg.prefix),\n      name = ns.name,\n      propertiesByName = {};\n\n  // parse properties\n  forEach(type.properties, bind(function(p) {\n\n    // namespace property names\n    var propertyNs = parseName(p.name, ns.prefix),\n        propertyName = propertyNs.name;\n\n    // namespace property types\n    if (!isBuiltIn(p.type)) {\n      p.type = parseName(p.type, propertyNs.prefix).name;\n    }\n\n    assign(p, {\n      ns: propertyNs,\n      name: propertyName\n    });\n\n    propertiesByName[propertyName] = p;\n  }, this));\n\n  // update ns + name\n  assign(type, {\n    ns: ns,\n    name: name,\n    propertiesByName: propertiesByName\n  });\n\n  forEach(type.extends, bind(function(extendsName) {\n    var extendsNameNs = parseName(extendsName, ns.prefix);\n\n    var extended = this.typeMap[extendsNameNs.name];\n\n    extended.traits = extended.traits || [];\n    extended.traits.push(name);\n  }, this));\n\n  // link to package\n  this.definePackage(type, pkg);\n\n  // register\n  this.typeMap[name] = type;\n};\n\n\n/**\n * Traverse the type hierarchy from bottom to top,\n * calling iterator with (type, inherited) for all elements in\n * the inheritance chain.\n *\n * @param {Object} nsName\n * @param {Function} iterator\n * @param {Boolean} [trait=false]\n */\nRegistry.prototype.mapTypes = function(nsName, iterator, trait) {\n\n  var type = isBuiltIn(nsName.name) ? { name: nsName.name } : this.typeMap[nsName.name];\n\n  var self = this;\n\n  /**\n   * Traverse the selected super type or trait\n   *\n   * @param {String} cls\n   * @param {Boolean} [trait=false]\n   */\n  function traverse(cls, trait) {\n    var parentNs = parseName(cls, isBuiltIn(cls) ? '' : nsName.prefix);\n    self.mapTypes(parentNs, iterator, trait);\n  }\n\n  /**\n   * Traverse the selected trait.\n   *\n   * @param {String} cls\n   */\n  function traverseTrait(cls) {\n    return traverse(cls, true);\n  }\n\n  /**\n   * Traverse the selected super type\n   *\n   * @param {String} cls\n   */\n  function traverseSuper(cls) {\n    return traverse(cls, false);\n  }\n\n  if (!type) {\n    throw new Error('unknown type <' + nsName.name + '>');\n  }\n\n  forEach(type.superClass, trait ? traverseTrait : traverseSuper);\n\n  // call iterator with (type, inherited=!trait)\n  iterator(type, !trait);\n\n  forEach(type.traits, traverseTrait);\n};\n\n\n/**\n * Returns the effective descriptor for a type.\n *\n * @param  {String} type the namespaced name (ns:localName) of the type\n *\n * @return {Descriptor} the resulting effective descriptor\n */\nRegistry.prototype.getEffectiveDescriptor = function(name) {\n\n  var nsName = parseName(name);\n\n  var builder = new DescriptorBuilder(nsName);\n\n  this.mapTypes(nsName, function(type, inherited) {\n    builder.addTrait(type, inherited);\n  });\n\n  var descriptor = builder.build();\n\n  // define package link\n  this.definePackage(descriptor, descriptor.allTypes[descriptor.allTypes.length - 1].$pkg);\n\n  return descriptor;\n};\n\n\nRegistry.prototype.definePackage = function(target, pkg) {\n  this.properties.define(target, '$pkg', { value: pkg });\n};\n\n\n\n// helpers ////////////////////////////\n\nfunction ensureAvailable(packageMap, pkg, identifierKey) {\n\n  var value = pkg[identifierKey];\n\n  if (value in packageMap) {\n    throw new Error('package with ' + identifierKey + ' <' + value + '> already defined');\n  }\n}\n\n/**\n * A utility that gets and sets properties of model elements.\n *\n * @param {Model} model\n */\nfunction Properties(model) {\n  this.model = model;\n}\n\n\n/**\n * Sets a named property on the target element.\n * If the value is undefined, the property gets deleted.\n *\n * @param {Object} target\n * @param {String} name\n * @param {Object} value\n */\nProperties.prototype.set = function(target, name, value) {\n\n  if (!isString(name) || !name.length) {\n    throw new TypeError('property name must be a non-empty string');\n  }\n\n  var property = this.getProperty(target, name);\n\n  var propertyName = property && property.name;\n\n  if (isUndefined(value)) {\n\n    // unset the property, if the specified value is undefined;\n    // delete from $attrs (for extensions) or the target itself\n    if (property) {\n      delete target[propertyName];\n    } else {\n      delete target.$attrs[stripGlobal(name)];\n    }\n  } else {\n\n    // set the property, defining well defined properties on the fly\n    // or simply updating them in target.$attrs (for extensions)\n    if (property) {\n      if (propertyName in target) {\n        target[propertyName] = value;\n      } else {\n        defineProperty(target, property, value);\n      }\n    } else {\n      target.$attrs[stripGlobal(name)] = value;\n    }\n  }\n};\n\n/**\n * Returns the named property of the given element\n *\n * @param  {Object} target\n * @param  {String} name\n *\n * @return {Object}\n */\nProperties.prototype.get = function(target, name) {\n\n  var property = this.getProperty(target, name);\n\n  if (!property) {\n    return target.$attrs[stripGlobal(name)];\n  }\n\n  var propertyName = property.name;\n\n  // check if access to collection property and lazily initialize it\n  if (!target[propertyName] && property.isMany) {\n    defineProperty(target, property, []);\n  }\n\n  return target[propertyName];\n};\n\n\n/**\n * Define a property on the target element\n *\n * @param  {Object} target\n * @param  {String} name\n * @param  {Object} options\n */\nProperties.prototype.define = function(target, name, options) {\n\n  if (!options.writable) {\n\n    var value = options.value;\n\n    // use getters for read-only variables to support ES6 proxies\n    // cf. https://github.com/bpmn-io/internal-docs/issues/386\n    options = assign({}, options, {\n      get: function() { return value; }\n    });\n\n    delete options.value;\n  }\n\n  Object.defineProperty(target, name, options);\n};\n\n\n/**\n * Define the descriptor for an element\n */\nProperties.prototype.defineDescriptor = function(target, descriptor) {\n  this.define(target, '$descriptor', { value: descriptor });\n};\n\n/**\n * Define the model for an element\n */\nProperties.prototype.defineModel = function(target, model) {\n  this.define(target, '$model', { value: model });\n};\n\n/**\n * Return property with the given name on the element.\n *\n * @param {any} target\n * @param {string} name\n *\n * @return {object | null} property\n */\nProperties.prototype.getProperty = function(target, name) {\n\n  var model = this.model;\n\n  var property = model.getPropertyDescriptor(target, name);\n\n  if (property) {\n    return property;\n  }\n\n  if (name.includes(':')) {\n    return null;\n  }\n\n  const strict = model.config.strict;\n\n  if (typeof strict !== 'undefined') {\n    const error = new TypeError(`unknown property <${ name }> on <${ target.$type }>`);\n\n    if (strict) {\n      throw error;\n    } else {\n\n      typeof console !== 'undefined' && console.warn(error);\n    }\n  }\n\n  return null;\n};\n\nfunction isUndefined(val) {\n  return typeof val === 'undefined';\n}\n\nfunction defineProperty(target, property, value) {\n  Object.defineProperty(target, property.name, {\n    enumerable: !property.isReference,\n    writable: true,\n    value: value,\n    configurable: true\n  });\n}\n\nfunction stripGlobal(name) {\n  return name.replace(/^:/, '');\n}\n\n// Moddle implementation /////////////////////////////////////////////////\n\n/**\n * @class Moddle\n *\n * A model that can be used to create elements of a specific type.\n *\n * @example\n *\n * var Moddle = require('moddle');\n *\n * var pkg = {\n *   name: 'mypackage',\n *   prefix: 'my',\n *   types: [\n *     { name: 'Root' }\n *   ]\n * };\n *\n * var moddle = new Moddle([pkg]);\n *\n * @param {Array<Package>} packages the packages to contain\n *\n * @param { { strict?: boolean } } [config] moddle configuration\n */\nfunction Moddle(packages, config = {}) {\n\n  this.properties = new Properties(this);\n\n  this.factory = new Factory(this, this.properties);\n  this.registry = new Registry(packages, this.properties);\n\n  this.typeCache = {};\n\n  this.config = config;\n}\n\n\n/**\n * Create an instance of the specified type.\n *\n * @method Moddle#create\n *\n * @example\n *\n * var foo = moddle.create('my:Foo');\n * var bar = moddle.create('my:Bar', { id: 'BAR_1' });\n *\n * @param  {String|Object} descriptor the type descriptor or name know to the model\n * @param  {Object} attrs   a number of attributes to initialize the model instance with\n * @return {Object}         model instance\n */\nModdle.prototype.create = function(descriptor, attrs) {\n  var Type = this.getType(descriptor);\n\n  if (!Type) {\n    throw new Error('unknown type <' + descriptor + '>');\n  }\n\n  return new Type(attrs);\n};\n\n\n/**\n * Returns the type representing a given descriptor\n *\n * @method Moddle#getType\n *\n * @example\n *\n * var Foo = moddle.getType('my:Foo');\n * var foo = new Foo({ 'id' : 'FOO_1' });\n *\n * @param  {String|Object} descriptor the type descriptor or name know to the model\n * @return {Object}         the type representing the descriptor\n */\nModdle.prototype.getType = function(descriptor) {\n\n  var cache = this.typeCache;\n\n  var name = isString(descriptor) ? descriptor : descriptor.ns.name;\n\n  var type = cache[name];\n\n  if (!type) {\n    descriptor = this.registry.getEffectiveDescriptor(name);\n    type = cache[name] = this.factory.createType(descriptor);\n  }\n\n  return type;\n};\n\n\n/**\n * Creates an any-element type to be used within model instances.\n *\n * This can be used to create custom elements that lie outside the meta-model.\n * The created element contains all the meta-data required to serialize it\n * as part of meta-model elements.\n *\n * @method Moddle#createAny\n *\n * @example\n *\n * var foo = moddle.createAny('vendor:Foo', 'http://vendor', {\n *   value: 'bar'\n * });\n *\n * var container = moddle.create('my:Container', 'http://my', {\n *   any: [ foo ]\n * });\n *\n * // go ahead and serialize the stuff\n *\n *\n * @param  {String} name  the name of the element\n * @param  {String} nsUri the namespace uri of the element\n * @param  {Object} [properties] a map of properties to initialize the instance with\n * @return {Object} the any type instance\n */\nModdle.prototype.createAny = function(name, nsUri, properties) {\n\n  var nameNs = parseName(name);\n\n  var element = {\n    $type: name,\n    $instanceOf: function(type) {\n      return type === this.$type;\n    },\n    get: function(key) {\n      return this[key];\n    },\n    set: function(key, value) {\n      set(this, [ key ], value);\n    }\n  };\n\n  var descriptor = {\n    name: name,\n    isGeneric: true,\n    ns: {\n      prefix: nameNs.prefix,\n      localName: nameNs.localName,\n      uri: nsUri\n    }\n  };\n\n  this.properties.defineDescriptor(element, descriptor);\n  this.properties.defineModel(element, this);\n  this.properties.define(element, 'get', { enumerable: false, writable: true });\n  this.properties.define(element, 'set', { enumerable: false, writable: true });\n  this.properties.define(element, '$parent', { enumerable: false, writable: true });\n  this.properties.define(element, '$instanceOf', { enumerable: false, writable: true });\n\n  forEach(properties, function(a, key) {\n    if (isObject(a) && a.value !== undefined) {\n      element[a.name] = a.value;\n    } else {\n      element[key] = a;\n    }\n  });\n\n  return element;\n};\n\n/**\n * Returns a registered package by uri or prefix\n *\n * @return {Object} the package\n */\nModdle.prototype.getPackage = function(uriOrPrefix) {\n  return this.registry.getPackage(uriOrPrefix);\n};\n\n/**\n * Returns a snapshot of all known packages\n *\n * @return {Object} the package\n */\nModdle.prototype.getPackages = function() {\n  return this.registry.getPackages();\n};\n\n/**\n * Returns the descriptor for an element\n */\nModdle.prototype.getElementDescriptor = function(element) {\n  return element.$descriptor;\n};\n\n/**\n * Returns true if the given descriptor or instance\n * represents the given type.\n *\n * May be applied to this, if element is omitted.\n */\nModdle.prototype.hasType = function(element, type) {\n  if (type === undefined) {\n    type = element;\n    element = this;\n  }\n\n  var descriptor = element.$model.getElementDescriptor(element);\n\n  return (type in descriptor.allTypesByName);\n};\n\n/**\n * Returns the descriptor of an elements named property\n */\nModdle.prototype.getPropertyDescriptor = function(element, property) {\n  return this.getElementDescriptor(element).propertiesByName[property];\n};\n\n/**\n * Returns a mapped type's descriptor\n */\nModdle.prototype.getTypeDescriptor = function(type) {\n  return this.registry.typeMap[type];\n};\n\nexport { Moddle, coerceType, isBuiltIn as isBuiltInType, isSimple as isSimpleType, parseName as parseNameNS };\n//# sourceMappingURL=index.js.map\n","import { forEach, assign, find, isString, findIndex, filter, has } from 'min-dash';\nimport { Parser } from 'saxen';\nimport { coerceType, parseNameNS, isSimpleType, Moddle } from 'moddle';\n\nfunction hasLowerCaseAlias(pkg) {\n  return pkg.xml && pkg.xml.tagAlias === 'lowerCase';\n}\n\nvar DEFAULT_NS_MAP = {\n  'xsi': 'http://www.w3.org/2001/XMLSchema-instance',\n  'xml': 'http://www.w3.org/XML/1998/namespace'\n};\n\nvar SERIALIZE_PROPERTY = 'property';\n\nfunction getSerialization(element) {\n  return element.xml && element.xml.serialize;\n}\n\nfunction getSerializationType(element) {\n  const type = getSerialization(element);\n\n  return type !== SERIALIZE_PROPERTY && (type || null);\n}\n\nfunction capitalize(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nfunction aliasToName(aliasNs, pkg) {\n\n  if (!hasLowerCaseAlias(pkg)) {\n    return aliasNs.name;\n  }\n\n  return aliasNs.prefix + ':' + capitalize(aliasNs.localName);\n}\n\n/**\n * Un-prefix a potentially prefixed type name.\n *\n * @param {NsName} nameNs\n * @param {Object} [pkg]\n *\n * @return {string}\n */\nfunction prefixedToName(nameNs, pkg) {\n\n  var name = nameNs.name,\n      localName = nameNs.localName;\n\n  var typePrefix = pkg && pkg.xml && pkg.xml.typePrefix;\n\n  if (typePrefix && localName.indexOf(typePrefix) === 0) {\n    return nameNs.prefix + ':' + localName.slice(typePrefix.length);\n  } else {\n    return name;\n  }\n}\n\nfunction normalizeTypeName(name, nsMap, model) {\n\n  // normalize against actual NS\n  const nameNs = parseNameNS(name, nsMap.xmlns);\n\n  const normalizedName = `${ nsMap[nameNs.prefix] || nameNs.prefix }:${ nameNs.localName }`;\n\n  const normalizedNameNs = parseNameNS(normalizedName);\n\n  // determine actual type name, based on package-defined prefix\n  var pkg = model.getPackage(normalizedNameNs.prefix);\n\n  return prefixedToName(normalizedNameNs, pkg);\n}\n\nfunction error(message) {\n  return new Error(message);\n}\n\n/**\n * Get the moddle descriptor for a given instance or type.\n *\n * @param  {ModdleElement|Function} element\n *\n * @return {Object} the moddle descriptor\n */\nfunction getModdleDescriptor(element) {\n  return element.$descriptor;\n}\n\n\n/**\n * A parse context.\n *\n * @class\n *\n * @param {Object} options\n * @param {ElementHandler} options.rootHandler the root handler for parsing a document\n * @param {boolean} [options.lax=false] whether or not to ignore invalid elements\n */\nfunction Context(options) {\n\n  /**\n   * @property {ElementHandler} rootHandler\n   */\n\n  /**\n   * @property {Boolean} lax\n   */\n\n  assign(this, options);\n\n  this.elementsById = {};\n  this.references = [];\n  this.warnings = [];\n\n  /**\n   * Add an unresolved reference.\n   *\n   * @param {Object} reference\n   */\n  this.addReference = function(reference) {\n    this.references.push(reference);\n  };\n\n  /**\n   * Add a processed element.\n   *\n   * @param {ModdleElement} element\n   */\n  this.addElement = function(element) {\n\n    if (!element) {\n      throw error('expected element');\n    }\n\n    var elementsById = this.elementsById;\n\n    var descriptor = getModdleDescriptor(element);\n\n    var idProperty = descriptor.idProperty,\n        id;\n\n    if (idProperty) {\n      id = element.get(idProperty.name);\n\n      if (id) {\n\n        // for QName validation as per http://www.w3.org/TR/REC-xml/#NT-NameChar\n        if (!/^([a-z][\\w-.]*:)?[a-z_][\\w-.]*$/i.test(id)) {\n          throw new Error('illegal ID <' + id + '>');\n        }\n\n        if (elementsById[id]) {\n          throw error('duplicate ID <' + id + '>');\n        }\n\n        elementsById[id] = element;\n      }\n    }\n  };\n\n  /**\n   * Add an import warning.\n   *\n   * @param {Object} warning\n   * @param {String} warning.message\n   * @param {Error} [warning.error]\n   */\n  this.addWarning = function(warning) {\n    this.warnings.push(warning);\n  };\n}\n\nfunction BaseHandler() {}\n\nBaseHandler.prototype.handleEnd = function() {};\nBaseHandler.prototype.handleText = function() {};\nBaseHandler.prototype.handleNode = function() {};\n\n\n/**\n * A simple pass through handler that does nothing except for\n * ignoring all input it receives.\n *\n * This is used to ignore unknown elements and\n * attributes.\n */\nfunction NoopHandler() { }\n\nNoopHandler.prototype = Object.create(BaseHandler.prototype);\n\nNoopHandler.prototype.handleNode = function() {\n  return this;\n};\n\nfunction BodyHandler() {}\n\nBodyHandler.prototype = Object.create(BaseHandler.prototype);\n\nBodyHandler.prototype.handleText = function(text) {\n  this.body = (this.body || '') + text;\n};\n\nfunction ReferenceHandler(property, context) {\n  this.property = property;\n  this.context = context;\n}\n\nReferenceHandler.prototype = Object.create(BodyHandler.prototype);\n\nReferenceHandler.prototype.handleNode = function(node) {\n\n  if (this.element) {\n    throw error('expected no sub nodes');\n  } else {\n    this.element = this.createReference(node);\n  }\n\n  return this;\n};\n\nReferenceHandler.prototype.handleEnd = function() {\n  this.element.id = this.body;\n};\n\nReferenceHandler.prototype.createReference = function(node) {\n  return {\n    property: this.property.ns.name,\n    id: ''\n  };\n};\n\nfunction ValueHandler(propertyDesc, element) {\n  this.element = element;\n  this.propertyDesc = propertyDesc;\n}\n\nValueHandler.prototype = Object.create(BodyHandler.prototype);\n\nValueHandler.prototype.handleEnd = function() {\n\n  var value = this.body || '',\n      element = this.element,\n      propertyDesc = this.propertyDesc;\n\n  value = coerceType(propertyDesc.type, value);\n\n  if (propertyDesc.isMany) {\n    element.get(propertyDesc.name).push(value);\n  } else {\n    element.set(propertyDesc.name, value);\n  }\n};\n\n\nfunction BaseElementHandler() {}\n\nBaseElementHandler.prototype = Object.create(BodyHandler.prototype);\n\nBaseElementHandler.prototype.handleNode = function(node) {\n  var parser = this,\n      element = this.element;\n\n  if (!element) {\n    element = this.element = this.createElement(node);\n\n    this.context.addElement(element);\n  } else {\n    parser = this.handleChild(node);\n  }\n\n  return parser;\n};\n\n/**\n * @class Reader.ElementHandler\n *\n */\nfunction ElementHandler(model, typeName, context) {\n  this.model = model;\n  this.type = model.getType(typeName);\n  this.context = context;\n}\n\nElementHandler.prototype = Object.create(BaseElementHandler.prototype);\n\nElementHandler.prototype.addReference = function(reference) {\n  this.context.addReference(reference);\n};\n\nElementHandler.prototype.handleText = function(text) {\n\n  var element = this.element,\n      descriptor = getModdleDescriptor(element),\n      bodyProperty = descriptor.bodyProperty;\n\n  if (!bodyProperty) {\n    throw error('unexpected body text <' + text + '>');\n  }\n\n  BodyHandler.prototype.handleText.call(this, text);\n};\n\nElementHandler.prototype.handleEnd = function() {\n\n  var value = this.body,\n      element = this.element,\n      descriptor = getModdleDescriptor(element),\n      bodyProperty = descriptor.bodyProperty;\n\n  if (bodyProperty && value !== undefined) {\n    value = coerceType(bodyProperty.type, value);\n    element.set(bodyProperty.name, value);\n  }\n};\n\n/**\n * Create an instance of the model from the given node.\n *\n * @param  {Element} node the xml node\n */\nElementHandler.prototype.createElement = function(node) {\n  var attributes = node.attributes,\n      Type = this.type,\n      descriptor = getModdleDescriptor(Type),\n      context = this.context,\n      instance = new Type({}),\n      model = this.model,\n      propNameNs;\n\n  forEach(attributes, function(value, name) {\n\n    var prop = descriptor.propertiesByName[name],\n        values;\n\n    if (prop && prop.isReference) {\n\n      if (!prop.isMany) {\n        context.addReference({\n          element: instance,\n          property: prop.ns.name,\n          id: value\n        });\n      } else {\n\n        // IDREFS: parse references as whitespace-separated list\n        values = value.split(' ');\n\n        forEach(values, function(v) {\n          context.addReference({\n            element: instance,\n            property: prop.ns.name,\n            id: v\n          });\n        });\n      }\n\n    } else {\n      if (prop) {\n        value = coerceType(prop.type, value);\n      } else if (name === 'xmlns') {\n        name = ':' + name;\n      } else {\n        propNameNs = parseNameNS(name, descriptor.ns.prefix);\n\n        // check whether attribute is defined in a well-known namespace\n        // if that is the case we emit a warning to indicate potential misuse\n        if (model.getPackage(propNameNs.prefix)) {\n\n          context.addWarning({\n            message: 'unknown attribute <' + name + '>',\n            element: instance,\n            property: name,\n            value: value\n          });\n        }\n      }\n\n      instance.set(name, value);\n    }\n  });\n\n  return instance;\n};\n\nElementHandler.prototype.getPropertyForNode = function(node) {\n\n  var name = node.name;\n  var nameNs = parseNameNS(name);\n\n  var type = this.type,\n      model = this.model,\n      descriptor = getModdleDescriptor(type);\n\n  var propertyName = nameNs.name,\n      property = descriptor.propertiesByName[propertyName];\n\n  // search for properties by name first\n\n  if (property && !property.isAttr) {\n\n    const serializationType = getSerializationType(property);\n\n    if (serializationType) {\n      const elementTypeName = node.attributes[serializationType];\n\n      // type is optional, if it does not exists the\n      // default type is assumed\n      if (elementTypeName) {\n\n        // convert the prefix used to the mapped form, but also\n        // take possible type prefixes from XML\n        // into account, i.e.: xsi:type=\"t{ActualType}\",\n        const normalizedTypeName = normalizeTypeName(elementTypeName, node.ns, model);\n\n        const elementType = model.getType(normalizedTypeName);\n\n        return assign({}, property, {\n          effectiveType: getModdleDescriptor(elementType).name\n        });\n      }\n    }\n\n    // search for properties by name first\n    return property;\n  }\n\n  var pkg = model.getPackage(nameNs.prefix);\n\n  if (pkg) {\n    const elementTypeName = aliasToName(nameNs, pkg);\n    const elementType = model.getType(elementTypeName);\n\n    // search for collection members later\n    property = find(descriptor.properties, function(p) {\n      return !p.isVirtual && !p.isReference && !p.isAttribute && elementType.hasType(p.type);\n    });\n\n    if (property) {\n      return assign({}, property, {\n        effectiveType: getModdleDescriptor(elementType).name\n      });\n    }\n  } else {\n\n    // parse unknown element (maybe extension)\n    property = find(descriptor.properties, function(p) {\n      return !p.isReference && !p.isAttribute && p.type === 'Element';\n    });\n\n    if (property) {\n      return property;\n    }\n  }\n\n  throw error('unrecognized element <' + nameNs.name + '>');\n};\n\nElementHandler.prototype.toString = function() {\n  return 'ElementDescriptor[' + getModdleDescriptor(this.type).name + ']';\n};\n\nElementHandler.prototype.valueHandler = function(propertyDesc, element) {\n  return new ValueHandler(propertyDesc, element);\n};\n\nElementHandler.prototype.referenceHandler = function(propertyDesc) {\n  return new ReferenceHandler(propertyDesc, this.context);\n};\n\nElementHandler.prototype.handler = function(type) {\n  if (type === 'Element') {\n    return new GenericElementHandler(this.model, type, this.context);\n  } else {\n    return new ElementHandler(this.model, type, this.context);\n  }\n};\n\n/**\n * Handle the child element parsing\n *\n * @param  {Element} node the xml node\n */\nElementHandler.prototype.handleChild = function(node) {\n  var propertyDesc, type, element, childHandler;\n\n  propertyDesc = this.getPropertyForNode(node);\n  element = this.element;\n\n  type = propertyDesc.effectiveType || propertyDesc.type;\n\n  if (isSimpleType(type)) {\n    return this.valueHandler(propertyDesc, element);\n  }\n\n  if (propertyDesc.isReference) {\n    childHandler = this.referenceHandler(propertyDesc).handleNode(node);\n  } else {\n    childHandler = this.handler(type).handleNode(node);\n  }\n\n  var newElement = childHandler.element;\n\n  // child handles may decide to skip elements\n  // by not returning anything\n  if (newElement !== undefined) {\n\n    if (propertyDesc.isMany) {\n      element.get(propertyDesc.name).push(newElement);\n    } else {\n      element.set(propertyDesc.name, newElement);\n    }\n\n    if (propertyDesc.isReference) {\n      assign(newElement, {\n        element: element\n      });\n\n      this.context.addReference(newElement);\n    } else {\n\n      // establish child -> parent relationship\n      newElement.$parent = element;\n    }\n  }\n\n  return childHandler;\n};\n\n/**\n * An element handler that performs special validation\n * to ensure the node it gets initialized with matches\n * the handlers type (namespace wise).\n *\n * @param {Moddle} model\n * @param {String} typeName\n * @param {Context} context\n */\nfunction RootElementHandler(model, typeName, context) {\n  ElementHandler.call(this, model, typeName, context);\n}\n\nRootElementHandler.prototype = Object.create(ElementHandler.prototype);\n\nRootElementHandler.prototype.createElement = function(node) {\n\n  var name = node.name,\n      nameNs = parseNameNS(name),\n      model = this.model,\n      type = this.type,\n      pkg = model.getPackage(nameNs.prefix),\n      typeName = pkg && aliasToName(nameNs, pkg) || name;\n\n  // verify the correct namespace if we parse\n  // the first element in the handler tree\n  //\n  // this ensures we don't mistakenly import wrong namespace elements\n  if (!type.hasType(typeName)) {\n    throw error('unexpected element <' + node.originalName + '>');\n  }\n\n  return ElementHandler.prototype.createElement.call(this, node);\n};\n\n\nfunction GenericElementHandler(model, typeName, context) {\n  this.model = model;\n  this.context = context;\n}\n\nGenericElementHandler.prototype = Object.create(BaseElementHandler.prototype);\n\nGenericElementHandler.prototype.createElement = function(node) {\n\n  var name = node.name,\n      ns = parseNameNS(name),\n      prefix = ns.prefix,\n      uri = node.ns[prefix + '$uri'],\n      attributes = node.attributes;\n\n  return this.model.createAny(name, uri, attributes);\n};\n\nGenericElementHandler.prototype.handleChild = function(node) {\n\n  var handler = new GenericElementHandler(this.model, 'Element', this.context).handleNode(node),\n      element = this.element;\n\n  var newElement = handler.element,\n      children;\n\n  if (newElement !== undefined) {\n    children = element.$children = element.$children || [];\n    children.push(newElement);\n\n    // establish child -> parent relationship\n    newElement.$parent = element;\n  }\n\n  return handler;\n};\n\nGenericElementHandler.prototype.handleEnd = function() {\n  if (this.body) {\n    this.element.$body = this.body;\n  }\n};\n\n/**\n * A reader for a meta-model\n *\n * @param {Object} options\n * @param {Model} options.model used to read xml files\n * @param {Boolean} options.lax whether to make parse errors warnings\n */\nfunction Reader(options) {\n\n  if (options instanceof Moddle) {\n    options = {\n      model: options\n    };\n  }\n\n  assign(this, { lax: false }, options);\n}\n\n/**\n * The fromXML result.\n *\n * @typedef {Object} ParseResult\n *\n * @property {ModdleElement} rootElement\n * @property {Array<Object>} references\n * @property {Array<Error>} warnings\n * @property {Object} elementsById - a mapping containing each ID -> ModdleElement\n */\n\n/**\n * The fromXML result.\n *\n * @typedef {Error} ParseError\n *\n * @property {Array<Error>} warnings\n */\n\n/**\n * Parse the given XML into a moddle document tree.\n *\n * @param {String} xml\n * @param {ElementHandler|Object} options or rootHandler\n *\n * @returns {Promise<ParseResult, ParseError>}\n */\nReader.prototype.fromXML = function(xml, options, done) {\n\n  var rootHandler = options.rootHandler;\n\n  if (options instanceof ElementHandler) {\n\n    // root handler passed via (xml, { rootHandler: ElementHandler }, ...)\n    rootHandler = options;\n    options = {};\n  } else {\n    if (typeof options === 'string') {\n\n      // rootHandler passed via (xml, 'someString', ...)\n      rootHandler = this.handler(options);\n      options = {};\n    } else if (typeof rootHandler === 'string') {\n\n      // rootHandler passed via (xml, { rootHandler: 'someString' }, ...)\n      rootHandler = this.handler(rootHandler);\n    }\n  }\n\n  var model = this.model,\n      lax = this.lax;\n\n  var context = new Context(assign({}, options, { rootHandler: rootHandler })),\n      parser = new Parser({ proxy: true }),\n      stack = createStack();\n\n  rootHandler.context = context;\n\n  // push root handler\n  stack.push(rootHandler);\n\n\n  /**\n   * Handle error.\n   *\n   * @param  {Error} err\n   * @param  {Function} getContext\n   * @param  {boolean} lax\n   *\n   * @return {boolean} true if handled\n   */\n  function handleError(err, getContext, lax) {\n\n    var ctx = getContext();\n\n    var line = ctx.line,\n        column = ctx.column,\n        data = ctx.data;\n\n    // we receive the full context data here,\n    // for elements trim down the information\n    // to the tag name, only\n    if (data.charAt(0) === '<' && data.indexOf(' ') !== -1) {\n      data = data.slice(0, data.indexOf(' ')) + '>';\n    }\n\n    var message =\n      'unparsable content ' + (data ? data + ' ' : '') + 'detected\\n\\t' +\n        'line: ' + line + '\\n\\t' +\n        'column: ' + column + '\\n\\t' +\n        'nested error: ' + err.message;\n\n    if (lax) {\n      context.addWarning({\n        message: message,\n        error: err\n      });\n\n      return true;\n    } else {\n      throw error(message);\n    }\n  }\n\n  function handleWarning(err, getContext) {\n\n    // just like handling errors in <lax=true> mode\n    return handleError(err, getContext, true);\n  }\n\n  /**\n   * Resolve collected references on parse end.\n   */\n  function resolveReferences() {\n\n    var elementsById = context.elementsById;\n    var references = context.references;\n\n    var i, r;\n\n    for (i = 0; (r = references[i]); i++) {\n      var element = r.element;\n      var reference = elementsById[r.id];\n      var property = getModdleDescriptor(element).propertiesByName[r.property];\n\n      if (!reference) {\n        context.addWarning({\n          message: 'unresolved reference <' + r.id + '>',\n          element: r.element,\n          property: r.property,\n          value: r.id\n        });\n      }\n\n      if (property.isMany) {\n        var collection = element.get(property.name),\n            idx = collection.indexOf(r);\n\n        // we replace an existing place holder (idx != -1) or\n        // append to the collection instead\n        if (idx === -1) {\n          idx = collection.length;\n        }\n\n        if (!reference) {\n\n          // remove unresolvable reference\n          collection.splice(idx, 1);\n        } else {\n\n          // add or update reference in collection\n          collection[idx] = reference;\n        }\n      } else {\n        element.set(property.name, reference);\n      }\n    }\n  }\n\n  function handleClose() {\n    stack.pop().handleEnd();\n  }\n\n  var PREAMBLE_START_PATTERN = /^<\\?xml /i;\n\n  var ENCODING_PATTERN = / encoding=\"([^\"]+)\"/i;\n\n  var UTF_8_PATTERN = /^utf-8$/i;\n\n  function handleQuestion(question) {\n\n    if (!PREAMBLE_START_PATTERN.test(question)) {\n      return;\n    }\n\n    var match = ENCODING_PATTERN.exec(question);\n    var encoding = match && match[1];\n\n    if (!encoding || UTF_8_PATTERN.test(encoding)) {\n      return;\n    }\n\n    context.addWarning({\n      message:\n        'unsupported document encoding <' + encoding + '>, ' +\n        'falling back to UTF-8'\n    });\n  }\n\n  function handleOpen(node, getContext) {\n    var handler = stack.peek();\n\n    try {\n      stack.push(handler.handleNode(node));\n    } catch (err) {\n\n      if (handleError(err, getContext, lax)) {\n        stack.push(new NoopHandler());\n      }\n    }\n  }\n\n  function handleCData(text, getContext) {\n\n    try {\n      stack.peek().handleText(text);\n    } catch (err) {\n      handleWarning(err, getContext);\n    }\n  }\n\n  function handleText(text, getContext) {\n\n    // strip whitespace only nodes, i.e. before\n    // <!CDATA[ ... ]> sections and in between tags\n\n    if (!text.trim()) {\n      return;\n    }\n\n    handleCData(text, getContext);\n  }\n\n  var uriMap = model.getPackages().reduce(function(uriMap, p) {\n    uriMap[p.uri] = p.prefix;\n\n    return uriMap;\n  }, Object.entries(DEFAULT_NS_MAP).reduce(function(map, [ prefix, url ]) {\n    map[url] = prefix;\n\n    return map;\n  }, model.config && model.config.nsMap || {}));\n\n  parser\n    .ns(uriMap)\n    .on('openTag', function(obj, decodeStr, selfClosing, getContext) {\n\n      // gracefully handle unparsable attributes (attrs=false)\n      var attrs = obj.attrs || {};\n\n      var decodedAttrs = Object.keys(attrs).reduce(function(d, key) {\n        var value = decodeStr(attrs[key]);\n\n        d[key] = value;\n\n        return d;\n      }, {});\n\n      var node = {\n        name: obj.name,\n        originalName: obj.originalName,\n        attributes: decodedAttrs,\n        ns: obj.ns\n      };\n\n      handleOpen(node, getContext);\n    })\n    .on('question', handleQuestion)\n    .on('closeTag', handleClose)\n    .on('cdata', handleCData)\n    .on('text', function(text, decodeEntities, getContext) {\n      handleText(decodeEntities(text), getContext);\n    })\n    .on('error', handleError)\n    .on('warn', handleWarning);\n\n  // async XML parsing to make sure the execution environment\n  // (node or brower) is kept responsive and that certain optimization\n  // strategies can kick in.\n  return new Promise(function(resolve, reject) {\n\n    var err;\n\n    try {\n      parser.parse(xml);\n\n      resolveReferences();\n    } catch (e) {\n      err = e;\n    }\n\n    var rootElement = rootHandler.element;\n\n    if (!err && !rootElement) {\n      err = error('failed to parse document as <' + rootHandler.type.$descriptor.name + '>');\n    }\n\n    var warnings = context.warnings;\n    var references = context.references;\n    var elementsById = context.elementsById;\n\n    if (err) {\n      err.warnings = warnings;\n\n      return reject(err);\n    } else {\n      return resolve({\n        rootElement: rootElement,\n        elementsById: elementsById,\n        references: references,\n        warnings: warnings\n      });\n    }\n  });\n};\n\nReader.prototype.handler = function(name) {\n  return new RootElementHandler(this.model, name);\n};\n\n\n// helpers //////////////////////////\n\nfunction createStack() {\n  var stack = [];\n\n  Object.defineProperty(stack, 'peek', {\n    value: function() {\n      return this[this.length - 1];\n    }\n  });\n\n  return stack;\n}\n\nvar XML_PREAMBLE = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n';\n\nvar ESCAPE_ATTR_CHARS = /<|>|'|\"|&|\\n\\r|\\n/g;\nvar ESCAPE_CHARS = /<|>|&/g;\n\n\nfunction Namespaces(parent) {\n\n  this.prefixMap = {};\n  this.uriMap = {};\n  this.used = {};\n\n  this.wellknown = [];\n  this.custom = [];\n  this.parent = parent;\n\n  this.defaultPrefixMap = parent && parent.defaultPrefixMap || {};\n}\n\nNamespaces.prototype.mapDefaultPrefixes = function(defaultPrefixMap) {\n  this.defaultPrefixMap = defaultPrefixMap;\n};\n\nNamespaces.prototype.defaultUriByPrefix = function(prefix) {\n  return this.defaultPrefixMap[prefix];\n};\n\nNamespaces.prototype.byUri = function(uri) {\n  return this.uriMap[uri] || (\n    this.parent && this.parent.byUri(uri)\n  );\n};\n\nNamespaces.prototype.add = function(ns, isWellknown) {\n\n  this.uriMap[ns.uri] = ns;\n\n  if (isWellknown) {\n    this.wellknown.push(ns);\n  } else {\n    this.custom.push(ns);\n  }\n\n  this.mapPrefix(ns.prefix, ns.uri);\n};\n\nNamespaces.prototype.uriByPrefix = function(prefix) {\n  return this.prefixMap[prefix || 'xmlns'] || (\n    this.parent && this.parent.uriByPrefix(prefix)\n  );\n};\n\nNamespaces.prototype.mapPrefix = function(prefix, uri) {\n  this.prefixMap[prefix || 'xmlns'] = uri;\n};\n\nNamespaces.prototype.getNSKey = function(ns) {\n  return (ns.prefix !== undefined) ? (ns.uri + '|' + ns.prefix) : ns.uri;\n};\n\nNamespaces.prototype.logUsed = function(ns) {\n\n  var uri = ns.uri;\n  var nsKey = this.getNSKey(ns);\n\n  this.used[nsKey] = this.byUri(uri);\n\n  // Inform parent recursively about the usage of this NS\n  if (this.parent) {\n    this.parent.logUsed(ns);\n  }\n};\n\nNamespaces.prototype.getUsed = function(ns) {\n\n  var allNs = [].concat(this.wellknown, this.custom);\n\n  return allNs.filter(ns => {\n    var nsKey = this.getNSKey(ns);\n\n    return this.used[nsKey];\n  });\n};\n\n\nfunction lower(string) {\n  return string.charAt(0).toLowerCase() + string.slice(1);\n}\n\nfunction nameToAlias(name, pkg) {\n  if (hasLowerCaseAlias(pkg)) {\n    return lower(name);\n  } else {\n    return name;\n  }\n}\n\nfunction inherits(ctor, superCtor) {\n  ctor.super_ = superCtor;\n  ctor.prototype = Object.create(superCtor.prototype, {\n    constructor: {\n      value: ctor,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n}\n\nfunction nsName(ns) {\n  if (isString(ns)) {\n    return ns;\n  } else {\n    return (ns.prefix ? ns.prefix + ':' : '') + ns.localName;\n  }\n}\n\nfunction getNsAttrs(namespaces) {\n\n  return namespaces.getUsed().filter(function(ns) {\n\n    // do not serialize built in <xml> namespace\n    return ns.prefix !== 'xml';\n  }).map(function(ns) {\n    var name = 'xmlns' + (ns.prefix ? ':' + ns.prefix : '');\n    return { name: name, value: ns.uri };\n  });\n\n}\n\nfunction getElementNs(ns, descriptor) {\n  if (descriptor.isGeneric) {\n    return assign({ localName: descriptor.ns.localName }, ns);\n  } else {\n    return assign({ localName: nameToAlias(descriptor.ns.localName, descriptor.$pkg) }, ns);\n  }\n}\n\nfunction getPropertyNs(ns, descriptor) {\n  return assign({ localName: descriptor.ns.localName }, ns);\n}\n\nfunction getSerializableProperties(element) {\n  var descriptor = element.$descriptor;\n\n  return filter(descriptor.properties, function(p) {\n    var name = p.name;\n\n    if (p.isVirtual) {\n      return false;\n    }\n\n    // do not serialize defaults\n    if (!has(element, name)) {\n      return false;\n    }\n\n    var value = element[name];\n\n    // do not serialize default equals\n    if (value === p.default) {\n      return false;\n    }\n\n    // do not serialize null properties\n    if (value === null) {\n      return false;\n    }\n\n    return p.isMany ? value.length : true;\n  });\n}\n\nvar ESCAPE_ATTR_MAP = {\n  '\\n': '#10',\n  '\\n\\r': '#10',\n  '\"': '#34',\n  '\\'': '#39',\n  '<': '#60',\n  '>': '#62',\n  '&': '#38'\n};\n\nvar ESCAPE_MAP = {\n  '<': 'lt',\n  '>': 'gt',\n  '&': 'amp'\n};\n\nfunction escape(str, charPattern, replaceMap) {\n\n  // ensure we are handling strings here\n  str = isString(str) ? str : '' + str;\n\n  return str.replace(charPattern, function(s) {\n    return '&' + replaceMap[s] + ';';\n  });\n}\n\n/**\n * Escape a string attribute to not contain any bad values (line breaks, '\"', ...)\n *\n * @param {String} str the string to escape\n * @return {String} the escaped string\n */\nfunction escapeAttr(str) {\n  return escape(str, ESCAPE_ATTR_CHARS, ESCAPE_ATTR_MAP);\n}\n\nfunction escapeBody(str) {\n  return escape(str, ESCAPE_CHARS, ESCAPE_MAP);\n}\n\nfunction filterAttributes(props) {\n  return filter(props, function(p) { return p.isAttr; });\n}\n\nfunction filterContained(props) {\n  return filter(props, function(p) { return !p.isAttr; });\n}\n\n\nfunction ReferenceSerializer(tagName) {\n  this.tagName = tagName;\n}\n\nReferenceSerializer.prototype.build = function(element) {\n  this.element = element;\n  return this;\n};\n\nReferenceSerializer.prototype.serializeTo = function(writer) {\n  writer\n    .appendIndent()\n    .append('<' + this.tagName + '>' + this.element.id + '</' + this.tagName + '>')\n    .appendNewLine();\n};\n\nfunction BodySerializer() {}\n\nBodySerializer.prototype.serializeValue =\nBodySerializer.prototype.serializeTo = function(writer) {\n  writer.append(\n    this.escape\n      ? escapeBody(this.value)\n      : this.value\n  );\n};\n\nBodySerializer.prototype.build = function(prop, value) {\n  this.value = value;\n\n  if (prop.type === 'String' && value.search(ESCAPE_CHARS) !== -1) {\n    this.escape = true;\n  }\n\n  return this;\n};\n\nfunction ValueSerializer(tagName) {\n  this.tagName = tagName;\n}\n\ninherits(ValueSerializer, BodySerializer);\n\nValueSerializer.prototype.serializeTo = function(writer) {\n\n  writer\n    .appendIndent()\n    .append('<' + this.tagName + '>');\n\n  this.serializeValue(writer);\n\n  writer\n    .append('</' + this.tagName + '>')\n    .appendNewLine();\n};\n\nfunction ElementSerializer(parent, propertyDescriptor) {\n  this.body = [];\n  this.attrs = [];\n\n  this.parent = parent;\n  this.propertyDescriptor = propertyDescriptor;\n}\n\nElementSerializer.prototype.build = function(element) {\n  this.element = element;\n\n  var elementDescriptor = element.$descriptor,\n      propertyDescriptor = this.propertyDescriptor;\n\n  var otherAttrs,\n      properties;\n\n  var isGeneric = elementDescriptor.isGeneric;\n\n  if (isGeneric) {\n    otherAttrs = this.parseGenericNsAttributes(element);\n  } else {\n    otherAttrs = this.parseNsAttributes(element);\n  }\n\n  if (propertyDescriptor) {\n    this.ns = this.nsPropertyTagName(propertyDescriptor);\n  } else {\n    this.ns = this.nsTagName(elementDescriptor);\n  }\n\n  // compute tag name\n  this.tagName = this.addTagName(this.ns);\n\n  if (isGeneric) {\n    this.parseGenericContainments(element);\n  } else {\n    properties = getSerializableProperties(element);\n\n    this.parseAttributes(filterAttributes(properties));\n    this.parseContainments(filterContained(properties));\n  }\n\n  this.parseGenericAttributes(element, otherAttrs);\n\n  return this;\n};\n\nElementSerializer.prototype.nsTagName = function(descriptor) {\n  var effectiveNs = this.logNamespaceUsed(descriptor.ns);\n  return getElementNs(effectiveNs, descriptor);\n};\n\nElementSerializer.prototype.nsPropertyTagName = function(descriptor) {\n  var effectiveNs = this.logNamespaceUsed(descriptor.ns);\n  return getPropertyNs(effectiveNs, descriptor);\n};\n\nElementSerializer.prototype.isLocalNs = function(ns) {\n  return ns.uri === this.ns.uri;\n};\n\n/**\n * Get the actual ns attribute name for the given element.\n *\n * @param {Object} element\n * @param {Boolean} [element.inherited=false]\n *\n * @return {Object} nsName\n */\nElementSerializer.prototype.nsAttributeName = function(element) {\n\n  var ns;\n\n  if (isString(element)) {\n    ns = parseNameNS(element);\n  } else {\n    ns = element.ns;\n  }\n\n  // return just local name for inherited attributes\n  if (element.inherited) {\n    return { localName: ns.localName };\n  }\n\n  // parse + log effective ns\n  var effectiveNs = this.logNamespaceUsed(ns);\n\n  // LOG ACTUAL namespace use\n  this.getNamespaces().logUsed(effectiveNs);\n\n  // strip prefix if same namespace like parent\n  if (this.isLocalNs(effectiveNs)) {\n    return { localName: ns.localName };\n  } else {\n    return assign({ localName: ns.localName }, effectiveNs);\n  }\n};\n\nElementSerializer.prototype.parseGenericNsAttributes = function(element) {\n\n  return Object.entries(element).filter(\n    ([ key, value ]) => !key.startsWith('$') && this.parseNsAttribute(element, key, value)\n  ).map(\n    ([ key, value ]) => ({ name: key, value: value })\n  );\n};\n\nElementSerializer.prototype.parseGenericContainments = function(element) {\n  var body = element.$body;\n\n  if (body) {\n    this.body.push(new BodySerializer().build({ type: 'String' }, body));\n  }\n\n  var children = element.$children;\n\n  if (children) {\n    forEach(children, child => {\n      this.body.push(new ElementSerializer(this).build(child));\n    });\n  }\n};\n\nElementSerializer.prototype.parseNsAttribute = function(element, name, value) {\n  var model = element.$model;\n\n  var nameNs = parseNameNS(name);\n\n  var ns;\n\n  // parse xmlns:foo=\"http://foo.bar\"\n  if (nameNs.prefix === 'xmlns') {\n    ns = { prefix: nameNs.localName, uri: value };\n  }\n\n  // parse xmlns=\"http://foo.bar\"\n  if (!nameNs.prefix && nameNs.localName === 'xmlns') {\n    ns = { uri: value };\n  }\n\n  if (!ns) {\n    return {\n      name: name,\n      value: value\n    };\n  }\n\n  if (model && model.getPackage(value)) {\n\n    // register well known namespace\n    this.logNamespace(ns, true, true);\n  } else {\n\n    // log custom namespace directly as used\n    var actualNs = this.logNamespaceUsed(ns, true);\n\n    this.getNamespaces().logUsed(actualNs);\n  }\n};\n\n\n/**\n * Parse namespaces and return a list of left over generic attributes\n *\n * @param  {Object} element\n * @return {Array<Object>}\n */\nElementSerializer.prototype.parseNsAttributes = function(element) {\n  var self = this;\n\n  var genericAttrs = element.$attrs;\n\n  var attributes = [];\n\n  // parse namespace attributes first\n  // and log them. push non namespace attributes to a list\n  // and process them later\n  forEach(genericAttrs, function(value, name) {\n\n    var nonNsAttr = self.parseNsAttribute(element, name, value);\n\n    if (nonNsAttr) {\n      attributes.push(nonNsAttr);\n    }\n  });\n\n  return attributes;\n};\n\nElementSerializer.prototype.parseGenericAttributes = function(element, attributes) {\n\n  var self = this;\n\n  forEach(attributes, function(attr) {\n\n    try {\n      self.addAttribute(self.nsAttributeName(attr.name), attr.value);\n    } catch (e) {\n\n      // eslint-disable-next-line no-undef\n      typeof console !== 'undefined' && console.warn(\n        `missing namespace information for <${\n          attr.name\n        }=${ attr.value }> on`, element, e\n      );\n    }\n  });\n};\n\nElementSerializer.prototype.parseContainments = function(properties) {\n\n  var self = this,\n      body = this.body,\n      element = this.element;\n\n  forEach(properties, function(p) {\n    var value = element.get(p.name),\n        isReference = p.isReference,\n        isMany = p.isMany;\n\n    if (!isMany) {\n      value = [ value ];\n    }\n\n    if (p.isBody) {\n      body.push(new BodySerializer().build(p, value[0]));\n    } else if (isSimpleType(p.type)) {\n      forEach(value, function(v) {\n        body.push(new ValueSerializer(self.addTagName(self.nsPropertyTagName(p))).build(p, v));\n      });\n    } else if (isReference) {\n      forEach(value, function(v) {\n        body.push(new ReferenceSerializer(self.addTagName(self.nsPropertyTagName(p))).build(v));\n      });\n    } else {\n\n      // allow serialization via type\n      // rather than element name\n      var serialization = getSerialization(p);\n\n      forEach(value, function(v) {\n        var serializer;\n\n        if (serialization) {\n          if (serialization === SERIALIZE_PROPERTY) {\n            serializer = new ElementSerializer(self, p);\n          } else {\n            serializer = new TypeSerializer(self, p, serialization);\n          }\n        } else {\n          serializer = new ElementSerializer(self);\n        }\n\n        body.push(serializer.build(v));\n      });\n    }\n  });\n};\n\nElementSerializer.prototype.getNamespaces = function(local) {\n\n  var namespaces = this.namespaces,\n      parent = this.parent,\n      parentNamespaces;\n\n  if (!namespaces) {\n    parentNamespaces = parent && parent.getNamespaces();\n\n    if (local || !parentNamespaces) {\n      this.namespaces = namespaces = new Namespaces(parentNamespaces);\n    } else {\n      namespaces = parentNamespaces;\n    }\n  }\n\n  return namespaces;\n};\n\nElementSerializer.prototype.logNamespace = function(ns, wellknown, local) {\n  var namespaces = this.getNamespaces(local);\n\n  var nsUri = ns.uri,\n      nsPrefix = ns.prefix;\n\n  var existing = namespaces.byUri(nsUri);\n\n  if (!existing || local) {\n    namespaces.add(ns, wellknown);\n  }\n\n  namespaces.mapPrefix(nsPrefix, nsUri);\n\n  return ns;\n};\n\nElementSerializer.prototype.logNamespaceUsed = function(ns, local) {\n  var namespaces = this.getNamespaces(local);\n\n  // ns may be\n  //\n  //   * prefix only\n  //   * prefix:uri\n  //   * localName only\n\n  var prefix = ns.prefix,\n      uri = ns.uri,\n      newPrefix, idx,\n      wellknownUri;\n\n  // handle anonymous namespaces (elementForm=unqualified), cf. #23\n  if (!prefix && !uri) {\n    return { localName: ns.localName };\n  }\n\n  wellknownUri = namespaces.defaultUriByPrefix(prefix);\n\n  uri = uri || wellknownUri || namespaces.uriByPrefix(prefix);\n\n  if (!uri) {\n    throw new Error('no namespace uri given for prefix <' + prefix + '>');\n  }\n\n  ns = namespaces.byUri(uri);\n\n  // register new default prefix <xmlns> in local scope\n  if (!ns && !prefix) {\n    ns = this.logNamespace({ uri }, wellknownUri === uri, true);\n  }\n\n  if (!ns) {\n    newPrefix = prefix;\n    idx = 1;\n\n    // find a prefix that is not mapped yet\n    while (namespaces.uriByPrefix(newPrefix)) {\n      newPrefix = prefix + '_' + idx++;\n    }\n\n    ns = this.logNamespace({ prefix: newPrefix, uri: uri }, wellknownUri === uri);\n  }\n\n  if (prefix) {\n    namespaces.mapPrefix(prefix, uri);\n  }\n\n  return ns;\n};\n\nElementSerializer.prototype.parseAttributes = function(properties) {\n  var self = this,\n      element = this.element;\n\n  forEach(properties, function(p) {\n\n    var value = element.get(p.name);\n\n    if (p.isReference) {\n\n      if (!p.isMany) {\n        value = value.id;\n      } else {\n        var values = [];\n        forEach(value, function(v) {\n          values.push(v.id);\n        });\n\n        // IDREFS is a whitespace-separated list of references.\n        value = values.join(' ');\n      }\n\n    }\n\n    self.addAttribute(self.nsAttributeName(p), value);\n  });\n};\n\nElementSerializer.prototype.addTagName = function(nsTagName) {\n  var actualNs = this.logNamespaceUsed(nsTagName);\n\n  this.getNamespaces().logUsed(actualNs);\n\n  return nsName(nsTagName);\n};\n\nElementSerializer.prototype.addAttribute = function(name, value) {\n  var attrs = this.attrs;\n\n  if (isString(value)) {\n    value = escapeAttr(value);\n  }\n\n  // de-duplicate attributes\n  // https://github.com/bpmn-io/moddle-xml/issues/66\n  var idx = findIndex(attrs, function(element) {\n    return (\n      element.name.localName === name.localName &&\n      element.name.uri === name.uri &&\n      element.name.prefix === name.prefix\n    );\n  });\n\n  var attr = { name: name, value: value };\n\n  if (idx !== -1) {\n    attrs.splice(idx, 1, attr);\n  } else {\n    attrs.push(attr);\n  }\n};\n\nElementSerializer.prototype.serializeAttributes = function(writer) {\n  var attrs = this.attrs,\n      namespaces = this.namespaces;\n\n  if (namespaces) {\n    attrs = getNsAttrs(namespaces).concat(attrs);\n  }\n\n  forEach(attrs, function(a) {\n    writer\n      .append(' ')\n      .append(nsName(a.name)).append('=\"').append(a.value).append('\"');\n  });\n};\n\nElementSerializer.prototype.serializeTo = function(writer) {\n  var firstBody = this.body[0],\n      indent = firstBody && firstBody.constructor !== BodySerializer;\n\n  writer\n    .appendIndent()\n    .append('<' + this.tagName);\n\n  this.serializeAttributes(writer);\n\n  writer.append(firstBody ? '>' : ' />');\n\n  if (firstBody) {\n\n    if (indent) {\n      writer\n        .appendNewLine()\n        .indent();\n    }\n\n    forEach(this.body, function(b) {\n      b.serializeTo(writer);\n    });\n\n    if (indent) {\n      writer\n        .unindent()\n        .appendIndent();\n    }\n\n    writer.append('</' + this.tagName + '>');\n  }\n\n  writer.appendNewLine();\n};\n\n/**\n * A serializer for types that handles serialization of data types\n */\nfunction TypeSerializer(parent, propertyDescriptor, serialization) {\n  ElementSerializer.call(this, parent, propertyDescriptor);\n\n  this.serialization = serialization;\n}\n\ninherits(TypeSerializer, ElementSerializer);\n\nTypeSerializer.prototype.parseNsAttributes = function(element) {\n\n  // extracted attributes with serialization attribute\n  // <type=typeName> stripped; it may be later\n  var attributes = ElementSerializer.prototype.parseNsAttributes.call(this, element).filter(\n    attr => attr.name !== this.serialization\n  );\n\n  var descriptor = element.$descriptor;\n\n  // only serialize <type=typeName> if necessary\n  if (descriptor.name === this.propertyDescriptor.type) {\n    return attributes;\n  }\n\n  var typeNs = this.typeNs = this.nsTagName(descriptor);\n  this.getNamespaces().logUsed(this.typeNs);\n\n  // add xsi:type attribute to represent the elements\n  // actual type\n\n  var pkg = element.$model.getPackage(typeNs.uri),\n      typePrefix = (pkg.xml && pkg.xml.typePrefix) || '';\n\n  this.addAttribute(\n    this.nsAttributeName(this.serialization),\n    (typeNs.prefix ? typeNs.prefix + ':' : '') + typePrefix + descriptor.ns.localName\n  );\n\n  return attributes;\n};\n\nTypeSerializer.prototype.isLocalNs = function(ns) {\n  return ns.uri === (this.typeNs || this.ns).uri;\n};\n\nfunction SavingWriter() {\n  this.value = '';\n\n  this.write = function(str) {\n    this.value += str;\n  };\n}\n\nfunction FormatingWriter(out, format) {\n\n  var indent = [ '' ];\n\n  this.append = function(str) {\n    out.write(str);\n\n    return this;\n  };\n\n  this.appendNewLine = function() {\n    if (format) {\n      out.write('\\n');\n    }\n\n    return this;\n  };\n\n  this.appendIndent = function() {\n    if (format) {\n      out.write(indent.join('  '));\n    }\n\n    return this;\n  };\n\n  this.indent = function() {\n    indent.push('');\n    return this;\n  };\n\n  this.unindent = function() {\n    indent.pop();\n    return this;\n  };\n}\n\n/**\n * A writer for meta-model backed document trees\n *\n * @param {Object} options output options to pass into the writer\n */\nfunction Writer(options) {\n\n  options = assign({ format: false, preamble: true }, options || {});\n\n  function toXML(tree, writer) {\n    var internalWriter = writer || new SavingWriter();\n    var formatingWriter = new FormatingWriter(internalWriter, options.format);\n\n    if (options.preamble) {\n      formatingWriter.append(XML_PREAMBLE);\n    }\n\n    var serializer = new ElementSerializer();\n\n    var model = tree.$model;\n\n    serializer.getNamespaces().mapDefaultPrefixes(getDefaultPrefixMappings(model));\n\n    serializer.build(tree).serializeTo(formatingWriter);\n\n    if (!writer) {\n      return internalWriter.value;\n    }\n  }\n\n  return {\n    toXML: toXML\n  };\n}\n\n\n// helpers ///////////\n\n/**\n * @param {Moddle} model\n *\n * @return { Record<string, string> } map from prefix to URI\n */\nfunction getDefaultPrefixMappings(model) {\n\n  const nsMap = model.config && model.config.nsMap || {};\n\n  const prefixMap = {};\n\n  // { prefix -> uri }\n  for (const prefix in DEFAULT_NS_MAP) {\n    prefixMap[prefix] = DEFAULT_NS_MAP[prefix];\n  }\n\n  // { uri -> prefix }\n  for (const uri in nsMap) {\n    const prefix = nsMap[uri];\n\n    prefixMap[prefix] = uri;\n  }\n\n  for (const pkg of model.getPackages()) {\n    prefixMap[pkg.prefix] = pkg.uri;\n  }\n\n  return prefixMap;\n}\n\nexport { Reader, Writer };\n//# sourceMappingURL=index.js.map\n","import { isString, assign } from 'min-dash';\nimport { Moddle } from 'moddle';\nimport { Reader, Writer } from 'moddle-xml';\n\n/**\n * A sub class of {@link Moddle} with support for import and export of BPMN 2.0 xml files.\n *\n * @class BpmnModdle\n * @extends Moddle\n *\n * @param {Object|Array} packages to use for instantiating the model\n * @param {Object} [options] additional options to pass over\n */\nfunction BpmnModdle(packages, options) {\n  Moddle.call(this, packages, options);\n}\n\nBpmnModdle.prototype = Object.create(Moddle.prototype);\n\n/**\n * The fromXML result.\n *\n * @typedef {Object} ParseResult\n *\n * @property {ModdleElement} rootElement\n * @property {Array<Object>} references\n * @property {Array<Error>} warnings\n * @property {Object} elementsById - a mapping containing each ID -> ModdleElement\n */\n\n/**\n * The fromXML error.\n *\n * @typedef {Error} ParseError\n *\n * @property {Array<Error>} warnings\n */\n\n/**\n * Instantiates a BPMN model tree from a given xml string.\n *\n * @param {String}   xmlStr\n * @param {String}   [typeName='bpmn:Definitions'] name of the root element\n * @param {Object}   [options]  options to pass to the underlying reader\n *\n * @returns {Promise<ParseResult, ParseError>}\n */\nBpmnModdle.prototype.fromXML = function(xmlStr, typeName, options) {\n\n  if (!isString(typeName)) {\n    options = typeName;\n    typeName = 'bpmn:Definitions';\n  }\n\n  var reader = new Reader(assign({ model: this, lax: true }, options));\n  var rootHandler = reader.handler(typeName);\n\n  return reader.fromXML(xmlStr, rootHandler);\n};\n\n\n/**\n * The toXML result.\n *\n * @typedef {Object} SerializationResult\n *\n * @property {String} xml\n */\n\n/**\n * Serializes a BPMN 2.0 object tree to XML.\n *\n * @param {String}   element    the root element, typically an instance of `bpmn:Definitions`\n * @param {Object}   [options]  to pass to the underlying writer\n *\n * @returns {Promise<SerializationResult, Error>}\n */\nBpmnModdle.prototype.toXML = function(element, options) {\n\n  var writer = new Writer(options);\n\n  return new Promise(function(resolve, reject) {\n    try {\n      var result = writer.toXML(element);\n\n      return resolve({\n        xml: result\n      });\n    } catch (err) {\n      return reject(err);\n    }\n  });\n};\n\nvar name$5 = \"BPMN20\";\nvar uri$5 = \"http://www.omg.org/spec/BPMN/20100524/MODEL\";\nvar prefix$5 = \"bpmn\";\nvar associations$5 = [\n];\nvar types$5 = [\n\t{\n\t\tname: \"Interface\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"operations\",\n\t\t\t\ttype: \"Operation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"implementationRef\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Operation\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inMessageRef\",\n\t\t\t\ttype: \"Message\",\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outMessageRef\",\n\t\t\t\ttype: \"Message\",\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"errorRef\",\n\t\t\t\ttype: \"Error\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"implementationRef\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"EndPoint\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"Auditing\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"GlobalTask\",\n\t\tsuperClass: [\n\t\t\t\"CallableElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"resources\",\n\t\t\t\ttype: \"ResourceRole\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Monitoring\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"Performer\",\n\t\tsuperClass: [\n\t\t\t\"ResourceRole\"\n\t\t]\n\t},\n\t{\n\t\tname: \"Process\",\n\t\tsuperClass: [\n\t\t\t\"FlowElementsContainer\",\n\t\t\t\"CallableElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"processType\",\n\t\t\t\ttype: \"ProcessType\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isClosed\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"auditing\",\n\t\t\t\ttype: \"Auditing\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"monitoring\",\n\t\t\t\ttype: \"Monitoring\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"properties\",\n\t\t\t\ttype: \"Property\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"laneSets\",\n\t\t\t\tisMany: true,\n\t\t\t\treplaces: \"FlowElementsContainer#laneSets\",\n\t\t\t\ttype: \"LaneSet\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"flowElements\",\n\t\t\t\tisMany: true,\n\t\t\t\treplaces: \"FlowElementsContainer#flowElements\",\n\t\t\t\ttype: \"FlowElement\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"artifacts\",\n\t\t\t\ttype: \"Artifact\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"resources\",\n\t\t\t\ttype: \"ResourceRole\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"correlationSubscriptions\",\n\t\t\t\ttype: \"CorrelationSubscription\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"supports\",\n\t\t\t\ttype: \"Process\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"definitionalCollaborationRef\",\n\t\t\t\ttype: \"Collaboration\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isExecutable\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"LaneSet\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"lanes\",\n\t\t\t\ttype: \"Lane\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Lane\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"partitionElementRef\",\n\t\t\t\ttype: \"BaseElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"partitionElement\",\n\t\t\t\ttype: \"BaseElement\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"flowNodeRef\",\n\t\t\t\ttype: \"FlowNode\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"childLaneSet\",\n\t\t\t\ttype: \"LaneSet\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"GlobalManualTask\",\n\t\tsuperClass: [\n\t\t\t\"GlobalTask\"\n\t\t]\n\t},\n\t{\n\t\tname: \"ManualTask\",\n\t\tsuperClass: [\n\t\t\t\"Task\"\n\t\t]\n\t},\n\t{\n\t\tname: \"UserTask\",\n\t\tsuperClass: [\n\t\t\t\"Task\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"renderings\",\n\t\t\t\ttype: \"Rendering\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"implementation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Rendering\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"HumanPerformer\",\n\t\tsuperClass: [\n\t\t\t\"Performer\"\n\t\t]\n\t},\n\t{\n\t\tname: \"PotentialOwner\",\n\t\tsuperClass: [\n\t\t\t\"HumanPerformer\"\n\t\t]\n\t},\n\t{\n\t\tname: \"GlobalUserTask\",\n\t\tsuperClass: [\n\t\t\t\"GlobalTask\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"implementation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"renderings\",\n\t\t\t\ttype: \"Rendering\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Gateway\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"FlowNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"gatewayDirection\",\n\t\t\t\ttype: \"GatewayDirection\",\n\t\t\t\t\"default\": \"Unspecified\",\n\t\t\t\tisAttr: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"EventBasedGateway\",\n\t\tsuperClass: [\n\t\t\t\"Gateway\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"instantiate\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"eventGatewayType\",\n\t\t\t\ttype: \"EventBasedGatewayType\",\n\t\t\t\tisAttr: true,\n\t\t\t\t\"default\": \"Exclusive\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ComplexGateway\",\n\t\tsuperClass: [\n\t\t\t\"Gateway\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"activationCondition\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"default\",\n\t\t\t\ttype: \"SequenceFlow\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ExclusiveGateway\",\n\t\tsuperClass: [\n\t\t\t\"Gateway\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"default\",\n\t\t\t\ttype: \"SequenceFlow\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"InclusiveGateway\",\n\t\tsuperClass: [\n\t\t\t\"Gateway\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"default\",\n\t\t\t\ttype: \"SequenceFlow\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ParallelGateway\",\n\t\tsuperClass: [\n\t\t\t\"Gateway\"\n\t\t]\n\t},\n\t{\n\t\tname: \"RootElement\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"Relationship\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"type\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"direction\",\n\t\t\t\ttype: \"RelationshipDirection\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"source\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"Element\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"target\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"Element\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"BaseElement\",\n\t\tisAbstract: true,\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"id\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\",\n\t\t\t\tisId: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"documentation\",\n\t\t\t\ttype: \"Documentation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"extensionDefinitions\",\n\t\t\t\ttype: \"ExtensionDefinition\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"extensionElements\",\n\t\t\t\ttype: \"ExtensionElements\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Extension\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"mustUnderstand\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"definition\",\n\t\t\t\ttype: \"ExtensionDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ExtensionDefinition\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"extensionAttributeDefinitions\",\n\t\t\t\ttype: \"ExtensionAttributeDefinition\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ExtensionAttributeDefinition\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"type\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isReference\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"extensionDefinition\",\n\t\t\t\ttype: \"ExtensionDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ExtensionElements\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"valueRef\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"Element\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"values\",\n\t\t\t\ttype: \"Element\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"extensionAttributeDefinition\",\n\t\t\t\ttype: \"ExtensionAttributeDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Documentation\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"text\",\n\t\t\t\ttype: \"String\",\n\t\t\t\tisBody: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"textFormat\",\n\t\t\t\t\"default\": \"text/plain\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Event\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"FlowNode\",\n\t\t\t\"InteractionNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"properties\",\n\t\t\t\ttype: \"Property\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"IntermediateCatchEvent\",\n\t\tsuperClass: [\n\t\t\t\"CatchEvent\"\n\t\t]\n\t},\n\t{\n\t\tname: \"IntermediateThrowEvent\",\n\t\tsuperClass: [\n\t\t\t\"ThrowEvent\"\n\t\t]\n\t},\n\t{\n\t\tname: \"EndEvent\",\n\t\tsuperClass: [\n\t\t\t\"ThrowEvent\"\n\t\t]\n\t},\n\t{\n\t\tname: \"StartEvent\",\n\t\tsuperClass: [\n\t\t\t\"CatchEvent\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"isInterrupting\",\n\t\t\t\t\"default\": true,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ThrowEvent\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"Event\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"dataInputs\",\n\t\t\t\ttype: \"DataInput\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataInputAssociations\",\n\t\t\t\ttype: \"DataInputAssociation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inputSet\",\n\t\t\t\ttype: \"InputSet\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"eventDefinitions\",\n\t\t\t\ttype: \"EventDefinition\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"eventDefinitionRef\",\n\t\t\t\ttype: \"EventDefinition\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CatchEvent\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"Event\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"parallelMultiple\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\",\n\t\t\t\t\"default\": false\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataOutputs\",\n\t\t\t\ttype: \"DataOutput\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataOutputAssociations\",\n\t\t\t\ttype: \"DataOutputAssociation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputSet\",\n\t\t\t\ttype: \"OutputSet\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"eventDefinitions\",\n\t\t\t\ttype: \"EventDefinition\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"eventDefinitionRef\",\n\t\t\t\ttype: \"EventDefinition\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"BoundaryEvent\",\n\t\tsuperClass: [\n\t\t\t\"CatchEvent\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"cancelActivity\",\n\t\t\t\t\"default\": true,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"attachedToRef\",\n\t\t\t\ttype: \"Activity\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"EventDefinition\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"CancelEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t]\n\t},\n\t{\n\t\tname: \"ErrorEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"errorRef\",\n\t\t\t\ttype: \"Error\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"TerminateEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t]\n\t},\n\t{\n\t\tname: \"EscalationEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"escalationRef\",\n\t\t\t\ttype: \"Escalation\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Escalation\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"structureRef\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"escalationCode\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"CompensateEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"waitForCompletion\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\",\n\t\t\t\t\"default\": true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"activityRef\",\n\t\t\t\ttype: \"Activity\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"TimerEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"timeDate\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"timeCycle\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"timeDuration\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"LinkEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"target\",\n\t\t\t\ttype: \"LinkEventDefinition\",\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"source\",\n\t\t\t\ttype: \"LinkEventDefinition\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"MessageEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"messageRef\",\n\t\t\t\ttype: \"Message\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"operationRef\",\n\t\t\t\ttype: \"Operation\",\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ConditionalEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"condition\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"SignalEventDefinition\",\n\t\tsuperClass: [\n\t\t\t\"EventDefinition\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"signalRef\",\n\t\t\t\ttype: \"Signal\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Signal\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"structureRef\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ImplicitThrowEvent\",\n\t\tsuperClass: [\n\t\t\t\"ThrowEvent\"\n\t\t]\n\t},\n\t{\n\t\tname: \"DataState\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ItemAwareElement\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"itemSubjectRef\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataState\",\n\t\t\t\ttype: \"DataState\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataAssociation\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"sourceRef\",\n\t\t\t\ttype: \"ItemAwareElement\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"targetRef\",\n\t\t\t\ttype: \"ItemAwareElement\",\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"transformation\",\n\t\t\t\ttype: \"FormalExpression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"property\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"assignment\",\n\t\t\t\ttype: \"Assignment\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataInput\",\n\t\tsuperClass: [\n\t\t\t\"ItemAwareElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isCollection\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inputSetRef\",\n\t\t\t\ttype: \"InputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inputSetWithOptional\",\n\t\t\t\ttype: \"InputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inputSetWithWhileExecuting\",\n\t\t\t\ttype: \"InputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataOutput\",\n\t\tsuperClass: [\n\t\t\t\"ItemAwareElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isCollection\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputSetRef\",\n\t\t\t\ttype: \"OutputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputSetWithOptional\",\n\t\t\t\ttype: \"OutputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputSetWithWhileExecuting\",\n\t\t\t\ttype: \"OutputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"InputSet\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataInputRefs\",\n\t\t\t\ttype: \"DataInput\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"optionalInputRefs\",\n\t\t\t\ttype: \"DataInput\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"whileExecutingInputRefs\",\n\t\t\t\ttype: \"DataInput\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputSetRefs\",\n\t\t\t\ttype: \"OutputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"OutputSet\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"dataOutputRefs\",\n\t\t\t\ttype: \"DataOutput\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inputSetRefs\",\n\t\t\t\ttype: \"InputSet\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"optionalOutputRefs\",\n\t\t\t\ttype: \"DataOutput\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"whileExecutingOutputRefs\",\n\t\t\t\ttype: \"DataOutput\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Property\",\n\t\tsuperClass: [\n\t\t\t\"ItemAwareElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataInputAssociation\",\n\t\tsuperClass: [\n\t\t\t\"DataAssociation\"\n\t\t]\n\t},\n\t{\n\t\tname: \"DataOutputAssociation\",\n\t\tsuperClass: [\n\t\t\t\"DataAssociation\"\n\t\t]\n\t},\n\t{\n\t\tname: \"InputOutputSpecification\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"dataInputs\",\n\t\t\t\ttype: \"DataInput\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataOutputs\",\n\t\t\t\ttype: \"DataOutput\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inputSets\",\n\t\t\t\ttype: \"InputSet\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputSets\",\n\t\t\t\ttype: \"OutputSet\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataObject\",\n\t\tsuperClass: [\n\t\t\t\"FlowElement\",\n\t\t\t\"ItemAwareElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"isCollection\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"InputOutputBinding\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"inputDataRef\",\n\t\t\t\ttype: \"InputSet\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputDataRef\",\n\t\t\t\ttype: \"OutputSet\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"operationRef\",\n\t\t\t\ttype: \"Operation\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Assignment\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"from\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"to\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataStore\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\",\n\t\t\t\"ItemAwareElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"capacity\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Integer\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isUnlimited\",\n\t\t\t\t\"default\": true,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataStoreReference\",\n\t\tsuperClass: [\n\t\t\t\"ItemAwareElement\",\n\t\t\t\"FlowElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"dataStoreRef\",\n\t\t\t\ttype: \"DataStore\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"DataObjectReference\",\n\t\tsuperClass: [\n\t\t\t\"ItemAwareElement\",\n\t\t\t\"FlowElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"dataObjectRef\",\n\t\t\t\ttype: \"DataObject\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ConversationLink\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"sourceRef\",\n\t\t\t\ttype: \"InteractionNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"targetRef\",\n\t\t\t\ttype: \"InteractionNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ConversationAssociation\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"innerConversationNodeRef\",\n\t\t\t\ttype: \"ConversationNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outerConversationNodeRef\",\n\t\t\t\ttype: \"ConversationNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CallConversation\",\n\t\tsuperClass: [\n\t\t\t\"ConversationNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"calledCollaborationRef\",\n\t\t\t\ttype: \"Collaboration\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantAssociations\",\n\t\t\t\ttype: \"ParticipantAssociation\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Conversation\",\n\t\tsuperClass: [\n\t\t\t\"ConversationNode\"\n\t\t]\n\t},\n\t{\n\t\tname: \"SubConversation\",\n\t\tsuperClass: [\n\t\t\t\"ConversationNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"conversationNodes\",\n\t\t\t\ttype: \"ConversationNode\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ConversationNode\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"InteractionNode\",\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageFlowRefs\",\n\t\t\t\ttype: \"MessageFlow\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"correlationKeys\",\n\t\t\t\ttype: \"CorrelationKey\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"GlobalConversation\",\n\t\tsuperClass: [\n\t\t\t\"Collaboration\"\n\t\t]\n\t},\n\t{\n\t\tname: \"PartnerEntity\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"PartnerRole\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CorrelationProperty\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"correlationPropertyRetrievalExpression\",\n\t\t\t\ttype: \"CorrelationPropertyRetrievalExpression\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"type\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Error\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"structureRef\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"errorCode\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CorrelationKey\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"correlationPropertyRef\",\n\t\t\t\ttype: \"CorrelationProperty\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Expression\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tisAbstract: false,\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"body\",\n\t\t\t\tisBody: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"FormalExpression\",\n\t\tsuperClass: [\n\t\t\t\"Expression\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"language\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"evaluatesToTypeRef\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Message\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"itemRef\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ItemDefinition\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"itemKind\",\n\t\t\t\ttype: \"ItemKind\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"structureRef\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isCollection\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"import\",\n\t\t\t\ttype: \"Import\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"FlowElement\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"auditing\",\n\t\t\t\ttype: \"Auditing\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"monitoring\",\n\t\t\t\ttype: \"Monitoring\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"categoryValueRef\",\n\t\t\t\ttype: \"CategoryValue\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"SequenceFlow\",\n\t\tsuperClass: [\n\t\t\t\"FlowElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"isImmediate\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"conditionExpression\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"sourceRef\",\n\t\t\t\ttype: \"FlowNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"targetRef\",\n\t\t\t\ttype: \"FlowNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"FlowElementsContainer\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"laneSets\",\n\t\t\t\ttype: \"LaneSet\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"flowElements\",\n\t\t\t\ttype: \"FlowElement\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CallableElement\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"ioSpecification\",\n\t\t\t\ttype: \"InputOutputSpecification\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"property\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"supportedInterfaceRef\",\n\t\t\t\ttype: \"Interface\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"ioBinding\",\n\t\t\t\ttype: \"InputOutputBinding\",\n\t\t\t\tisMany: true,\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"property\"\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"FlowNode\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"FlowElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"incoming\",\n\t\t\t\ttype: \"SequenceFlow\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outgoing\",\n\t\t\t\ttype: \"SequenceFlow\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"lanes\",\n\t\t\t\ttype: \"Lane\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CorrelationPropertyRetrievalExpression\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"messagePath\",\n\t\t\t\ttype: \"FormalExpression\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageRef\",\n\t\t\t\ttype: \"Message\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CorrelationPropertyBinding\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"dataPath\",\n\t\t\t\ttype: \"FormalExpression\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"correlationPropertyRef\",\n\t\t\t\ttype: \"CorrelationProperty\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Resource\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"resourceParameters\",\n\t\t\t\ttype: \"ResourceParameter\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ResourceParameter\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isRequired\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"type\",\n\t\t\t\ttype: \"ItemDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CorrelationSubscription\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"correlationKeyRef\",\n\t\t\t\ttype: \"CorrelationKey\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"correlationPropertyBinding\",\n\t\t\t\ttype: \"CorrelationPropertyBinding\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"MessageFlow\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"sourceRef\",\n\t\t\t\ttype: \"InteractionNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"targetRef\",\n\t\t\t\ttype: \"InteractionNode\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageRef\",\n\t\t\t\ttype: \"Message\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"MessageFlowAssociation\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"innerMessageFlowRef\",\n\t\t\t\ttype: \"MessageFlow\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outerMessageFlowRef\",\n\t\t\t\ttype: \"MessageFlow\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"InteractionNode\",\n\t\tisAbstract: true,\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"incomingConversationLinks\",\n\t\t\t\ttype: \"ConversationLink\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outgoingConversationLinks\",\n\t\t\t\ttype: \"ConversationLink\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Participant\",\n\t\tsuperClass: [\n\t\t\t\"InteractionNode\",\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"interfaceRef\",\n\t\t\t\ttype: \"Interface\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantMultiplicity\",\n\t\t\t\ttype: \"ParticipantMultiplicity\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"endPointRefs\",\n\t\t\t\ttype: \"EndPoint\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"processRef\",\n\t\t\t\ttype: \"Process\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ParticipantAssociation\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"innerParticipantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outerParticipantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ParticipantMultiplicity\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"minimum\",\n\t\t\t\t\"default\": 0,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Integer\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"maximum\",\n\t\t\t\t\"default\": 1,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Integer\"\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"Collaboration\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isClosed\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participants\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageFlows\",\n\t\t\t\ttype: \"MessageFlow\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"artifacts\",\n\t\t\t\ttype: \"Artifact\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"conversations\",\n\t\t\t\ttype: \"ConversationNode\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"conversationAssociations\",\n\t\t\t\ttype: \"ConversationAssociation\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantAssociations\",\n\t\t\t\ttype: \"ParticipantAssociation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageFlowAssociations\",\n\t\t\t\ttype: \"MessageFlowAssociation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"correlationKeys\",\n\t\t\t\ttype: \"CorrelationKey\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"choreographyRef\",\n\t\t\t\ttype: \"Choreography\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"conversationLinks\",\n\t\t\t\ttype: \"ConversationLink\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ChoreographyActivity\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"FlowNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"participantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"initiatingParticipantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"correlationKeys\",\n\t\t\t\ttype: \"CorrelationKey\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"loopType\",\n\t\t\t\ttype: \"ChoreographyLoopType\",\n\t\t\t\t\"default\": \"None\",\n\t\t\t\tisAttr: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CallChoreography\",\n\t\tsuperClass: [\n\t\t\t\"ChoreographyActivity\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"calledChoreographyRef\",\n\t\t\t\ttype: \"Choreography\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantAssociations\",\n\t\t\t\ttype: \"ParticipantAssociation\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"SubChoreography\",\n\t\tsuperClass: [\n\t\t\t\"ChoreographyActivity\",\n\t\t\t\"FlowElementsContainer\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"artifacts\",\n\t\t\t\ttype: \"Artifact\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ChoreographyTask\",\n\t\tsuperClass: [\n\t\t\t\"ChoreographyActivity\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"messageFlowRef\",\n\t\t\t\ttype: \"MessageFlow\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Choreography\",\n\t\tsuperClass: [\n\t\t\t\"Collaboration\",\n\t\t\t\"FlowElementsContainer\"\n\t\t]\n\t},\n\t{\n\t\tname: \"GlobalChoreographyTask\",\n\t\tsuperClass: [\n\t\t\t\"Choreography\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"initiatingParticipantRef\",\n\t\t\t\ttype: \"Participant\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"TextAnnotation\",\n\t\tsuperClass: [\n\t\t\t\"Artifact\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"text\",\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"textFormat\",\n\t\t\t\t\"default\": \"text/plain\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Group\",\n\t\tsuperClass: [\n\t\t\t\"Artifact\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"categoryValueRef\",\n\t\t\t\ttype: \"CategoryValue\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Association\",\n\t\tsuperClass: [\n\t\t\t\"Artifact\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"associationDirection\",\n\t\t\t\ttype: \"AssociationDirection\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"sourceRef\",\n\t\t\t\ttype: \"BaseElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"targetRef\",\n\t\t\t\ttype: \"BaseElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Category\",\n\t\tsuperClass: [\n\t\t\t\"RootElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"categoryValue\",\n\t\t\t\ttype: \"CategoryValue\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Artifact\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"CategoryValue\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"categorizedFlowElements\",\n\t\t\t\ttype: \"FlowElement\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"value\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Activity\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"FlowNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"isForCompensation\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"default\",\n\t\t\t\ttype: \"SequenceFlow\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"ioSpecification\",\n\t\t\t\ttype: \"InputOutputSpecification\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"property\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"boundaryEventRefs\",\n\t\t\t\ttype: \"BoundaryEvent\",\n\t\t\t\tisMany: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"properties\",\n\t\t\t\ttype: \"Property\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataInputAssociations\",\n\t\t\t\ttype: \"DataInputAssociation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"dataOutputAssociations\",\n\t\t\t\ttype: \"DataOutputAssociation\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"startQuantity\",\n\t\t\t\t\"default\": 1,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Integer\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"resources\",\n\t\t\t\ttype: \"ResourceRole\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"completionQuantity\",\n\t\t\t\t\"default\": 1,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Integer\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"loopCharacteristics\",\n\t\t\t\ttype: \"LoopCharacteristics\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ServiceTask\",\n\t\tsuperClass: [\n\t\t\t\"Task\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"implementation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"operationRef\",\n\t\t\t\ttype: \"Operation\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"SubProcess\",\n\t\tsuperClass: [\n\t\t\t\"Activity\",\n\t\t\t\"FlowElementsContainer\",\n\t\t\t\"InteractionNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"triggeredByEvent\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"artifacts\",\n\t\t\t\ttype: \"Artifact\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"LoopCharacteristics\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"MultiInstanceLoopCharacteristics\",\n\t\tsuperClass: [\n\t\t\t\"LoopCharacteristics\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"isSequential\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"behavior\",\n\t\t\t\ttype: \"MultiInstanceBehavior\",\n\t\t\t\t\"default\": \"All\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"loopCardinality\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"loopDataInputRef\",\n\t\t\t\ttype: \"ItemAwareElement\",\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"loopDataOutputRef\",\n\t\t\t\ttype: \"ItemAwareElement\",\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"inputDataItem\",\n\t\t\t\ttype: \"DataInput\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"property\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"outputDataItem\",\n\t\t\t\ttype: \"DataOutput\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"property\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"complexBehaviorDefinition\",\n\t\t\t\ttype: \"ComplexBehaviorDefinition\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"completionCondition\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"oneBehaviorEventRef\",\n\t\t\t\ttype: \"EventDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"noneBehaviorEventRef\",\n\t\t\t\ttype: \"EventDefinition\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"StandardLoopCharacteristics\",\n\t\tsuperClass: [\n\t\t\t\"LoopCharacteristics\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"testBefore\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"loopCondition\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"loopMaximum\",\n\t\t\t\ttype: \"Integer\",\n\t\t\t\tisAttr: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"CallActivity\",\n\t\tsuperClass: [\n\t\t\t\"Activity\",\n\t\t\t\"InteractionNode\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"calledElement\",\n\t\t\t\ttype: \"String\",\n\t\t\t\tisAttr: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Task\",\n\t\tsuperClass: [\n\t\t\t\"Activity\",\n\t\t\t\"InteractionNode\"\n\t\t]\n\t},\n\t{\n\t\tname: \"SendTask\",\n\t\tsuperClass: [\n\t\t\t\"Task\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"implementation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"operationRef\",\n\t\t\t\ttype: \"Operation\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageRef\",\n\t\t\t\ttype: \"Message\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ReceiveTask\",\n\t\tsuperClass: [\n\t\t\t\"Task\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"implementation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"instantiate\",\n\t\t\t\t\"default\": false,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"operationRef\",\n\t\t\t\ttype: \"Operation\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageRef\",\n\t\t\t\ttype: \"Message\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ScriptTask\",\n\t\tsuperClass: [\n\t\t\t\"Task\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"scriptFormat\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"script\",\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"BusinessRuleTask\",\n\t\tsuperClass: [\n\t\t\t\"Task\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"implementation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"AdHocSubProcess\",\n\t\tsuperClass: [\n\t\t\t\"SubProcess\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"completionCondition\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"ordering\",\n\t\t\t\ttype: \"AdHocOrdering\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"cancelRemainingInstances\",\n\t\t\t\t\"default\": true,\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Transaction\",\n\t\tsuperClass: [\n\t\t\t\"SubProcess\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"protocol\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"method\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"GlobalScriptTask\",\n\t\tsuperClass: [\n\t\t\t\"GlobalTask\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"scriptLanguage\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"script\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"GlobalBusinessRuleTask\",\n\t\tsuperClass: [\n\t\t\t\"GlobalTask\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"implementation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ComplexBehaviorDefinition\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"condition\",\n\t\t\t\ttype: \"FormalExpression\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"event\",\n\t\t\t\ttype: \"ImplicitThrowEvent\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ResourceRole\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"resourceRef\",\n\t\t\t\ttype: \"Resource\",\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"resourceParameterBindings\",\n\t\t\t\ttype: \"ResourceParameterBinding\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"resourceAssignmentExpression\",\n\t\t\t\ttype: \"ResourceAssignmentExpression\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ResourceParameterBinding\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"expression\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"parameterRef\",\n\t\t\t\ttype: \"ResourceParameter\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"ResourceAssignmentExpression\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"expression\",\n\t\t\t\ttype: \"Expression\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"Import\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"importType\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"location\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"namespace\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Definitions\",\n\t\tsuperClass: [\n\t\t\t\"BaseElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"targetNamespace\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"expressionLanguage\",\n\t\t\t\t\"default\": \"http://www.w3.org/1999/XPath\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"typeLanguage\",\n\t\t\t\t\"default\": \"http://www.w3.org/2001/XMLSchema\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"imports\",\n\t\t\t\ttype: \"Import\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"extensions\",\n\t\t\t\ttype: \"Extension\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"rootElements\",\n\t\t\t\ttype: \"RootElement\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"diagrams\",\n\t\t\t\tisMany: true,\n\t\t\t\ttype: \"bpmndi:BPMNDiagram\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"exporter\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"relationships\",\n\t\t\t\ttype: \"Relationship\",\n\t\t\t\tisMany: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"exporterVersion\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t}\n];\nvar enumerations$3 = [\n\t{\n\t\tname: \"ProcessType\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"None\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Public\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Private\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"GatewayDirection\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"Unspecified\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Converging\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Diverging\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Mixed\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"EventBasedGatewayType\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"Parallel\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Exclusive\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"RelationshipDirection\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"None\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Forward\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Backward\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Both\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ItemKind\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"Physical\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Information\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ChoreographyLoopType\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"None\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Standard\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"MultiInstanceSequential\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"MultiInstanceParallel\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"AssociationDirection\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"None\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"One\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Both\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"MultiInstanceBehavior\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"None\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"One\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"All\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Complex\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"AdHocOrdering\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"Parallel\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"Sequential\"\n\t\t\t}\n\t\t]\n\t}\n];\nvar xml$1 = {\n\ttagAlias: \"lowerCase\",\n\ttypePrefix: \"t\"\n};\nvar BpmnPackage = {\n\tname: name$5,\n\turi: uri$5,\n\tprefix: prefix$5,\n\tassociations: associations$5,\n\ttypes: types$5,\n\tenumerations: enumerations$3,\n\txml: xml$1\n};\n\nvar name$4 = \"BPMNDI\";\nvar uri$4 = \"http://www.omg.org/spec/BPMN/20100524/DI\";\nvar prefix$4 = \"bpmndi\";\nvar types$4 = [\n\t{\n\t\tname: \"BPMNDiagram\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"plane\",\n\t\t\t\ttype: \"BPMNPlane\",\n\t\t\t\tredefines: \"di:Diagram#rootElement\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"labelStyle\",\n\t\t\t\ttype: \"BPMNLabelStyle\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"di:Diagram\"\n\t\t]\n\t},\n\t{\n\t\tname: \"BPMNPlane\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"bpmnElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"bpmn:BaseElement\",\n\t\t\t\tredefines: \"di:DiagramElement#modelElement\"\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"di:Plane\"\n\t\t]\n\t},\n\t{\n\t\tname: \"BPMNShape\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"bpmnElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"bpmn:BaseElement\",\n\t\t\t\tredefines: \"di:DiagramElement#modelElement\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isHorizontal\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isExpanded\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isMarkerVisible\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"label\",\n\t\t\t\ttype: \"BPMNLabel\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isMessageVisible\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Boolean\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"participantBandKind\",\n\t\t\t\ttype: \"ParticipantBandKind\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"choreographyActivityShape\",\n\t\t\t\ttype: \"BPMNShape\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"di:LabeledShape\"\n\t\t]\n\t},\n\t{\n\t\tname: \"BPMNEdge\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"label\",\n\t\t\t\ttype: \"BPMNLabel\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"bpmnElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"bpmn:BaseElement\",\n\t\t\t\tredefines: \"di:DiagramElement#modelElement\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"sourceElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"di:DiagramElement\",\n\t\t\t\tredefines: \"di:Edge#source\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"targetElement\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"di:DiagramElement\",\n\t\t\t\tredefines: \"di:Edge#target\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"messageVisibleKind\",\n\t\t\t\ttype: \"MessageVisibleKind\",\n\t\t\t\tisAttr: true,\n\t\t\t\t\"default\": \"initiating\"\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"di:LabeledEdge\"\n\t\t]\n\t},\n\t{\n\t\tname: \"BPMNLabel\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"labelStyle\",\n\t\t\t\ttype: \"BPMNLabelStyle\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisReference: true,\n\t\t\t\tredefines: \"di:DiagramElement#style\"\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"di:Label\"\n\t\t]\n\t},\n\t{\n\t\tname: \"BPMNLabelStyle\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"font\",\n\t\t\t\ttype: \"dc:Font\"\n\t\t\t}\n\t\t],\n\t\tsuperClass: [\n\t\t\t\"di:Style\"\n\t\t]\n\t}\n];\nvar enumerations$2 = [\n\t{\n\t\tname: \"ParticipantBandKind\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"top_initiating\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"middle_initiating\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"bottom_initiating\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"top_non_initiating\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"middle_non_initiating\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"bottom_non_initiating\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"MessageVisibleKind\",\n\t\tliteralValues: [\n\t\t\t{\n\t\t\t\tname: \"initiating\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"non_initiating\"\n\t\t\t}\n\t\t]\n\t}\n];\nvar associations$4 = [\n];\nvar BpmnDiPackage = {\n\tname: name$4,\n\turi: uri$4,\n\tprefix: prefix$4,\n\ttypes: types$4,\n\tenumerations: enumerations$2,\n\tassociations: associations$4\n};\n\nvar name$3 = \"DC\";\nvar uri$3 = \"http://www.omg.org/spec/DD/20100524/DC\";\nvar prefix$3 = \"dc\";\nvar types$3 = [\n\t{\n\t\tname: \"Boolean\"\n\t},\n\t{\n\t\tname: \"Integer\"\n\t},\n\t{\n\t\tname: \"Real\"\n\t},\n\t{\n\t\tname: \"String\"\n\t},\n\t{\n\t\tname: \"Font\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\ttype: \"String\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"size\",\n\t\t\t\ttype: \"Real\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isBold\",\n\t\t\t\ttype: \"Boolean\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isItalic\",\n\t\t\t\ttype: \"Boolean\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isUnderline\",\n\t\t\t\ttype: \"Boolean\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"isStrikeThrough\",\n\t\t\t\ttype: \"Boolean\",\n\t\t\t\tisAttr: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Point\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"x\",\n\t\t\t\ttype: \"Real\",\n\t\t\t\t\"default\": \"0\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"y\",\n\t\t\t\ttype: \"Real\",\n\t\t\t\t\"default\": \"0\",\n\t\t\t\tisAttr: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Bounds\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"x\",\n\t\t\t\ttype: \"Real\",\n\t\t\t\t\"default\": \"0\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"y\",\n\t\t\t\ttype: \"Real\",\n\t\t\t\t\"default\": \"0\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"width\",\n\t\t\t\ttype: \"Real\",\n\t\t\t\tisAttr: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"height\",\n\t\t\t\ttype: \"Real\",\n\t\t\t\tisAttr: true\n\t\t\t}\n\t\t]\n\t}\n];\nvar associations$3 = [\n];\nvar DcPackage = {\n\tname: name$3,\n\turi: uri$3,\n\tprefix: prefix$3,\n\ttypes: types$3,\n\tassociations: associations$3\n};\n\nvar name$2 = \"DI\";\nvar uri$2 = \"http://www.omg.org/spec/DD/20100524/DI\";\nvar prefix$2 = \"di\";\nvar types$2 = [\n\t{\n\t\tname: \"DiagramElement\",\n\t\tisAbstract: true,\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"id\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisId: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"extension\",\n\t\t\t\ttype: \"Extension\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"owningDiagram\",\n\t\t\t\ttype: \"Diagram\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"owningElement\",\n\t\t\t\ttype: \"DiagramElement\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"modelElement\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true,\n\t\t\t\ttype: \"Element\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"style\",\n\t\t\t\ttype: \"Style\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"ownedElement\",\n\t\t\t\ttype: \"DiagramElement\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Node\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"DiagramElement\"\n\t\t]\n\t},\n\t{\n\t\tname: \"Edge\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"DiagramElement\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"source\",\n\t\t\t\ttype: \"DiagramElement\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"target\",\n\t\t\t\ttype: \"DiagramElement\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisVirtual: true,\n\t\t\t\tisReference: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"waypoint\",\n\t\t\t\tisUnique: false,\n\t\t\t\tisMany: true,\n\t\t\t\ttype: \"dc:Point\",\n\t\t\t\txml: {\n\t\t\t\t\tserialize: \"xsi:type\"\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Diagram\",\n\t\tisAbstract: true,\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"id\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisId: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"rootElement\",\n\t\t\t\ttype: \"DiagramElement\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisVirtual: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"name\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"documentation\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"resolution\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"Real\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"ownedStyle\",\n\t\t\t\ttype: \"Style\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Shape\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"Node\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"bounds\",\n\t\t\t\ttype: \"dc:Bounds\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Plane\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"Node\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"planeElement\",\n\t\t\t\ttype: \"DiagramElement\",\n\t\t\t\tsubsettedProperty: \"DiagramElement-ownedElement\",\n\t\t\t\tisMany: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"LabeledEdge\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"Edge\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"ownedLabel\",\n\t\t\t\ttype: \"Label\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tsubsettedProperty: \"DiagramElement-ownedElement\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"LabeledShape\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"Shape\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"ownedLabel\",\n\t\t\t\ttype: \"Label\",\n\t\t\t\tisReadOnly: true,\n\t\t\t\tsubsettedProperty: \"DiagramElement-ownedElement\",\n\t\t\t\tisMany: true,\n\t\t\t\tisVirtual: true\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Label\",\n\t\tisAbstract: true,\n\t\tsuperClass: [\n\t\t\t\"Node\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"bounds\",\n\t\t\t\ttype: \"dc:Bounds\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Style\",\n\t\tisAbstract: true,\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"id\",\n\t\t\t\tisAttr: true,\n\t\t\t\tisId: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"Extension\",\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"values\",\n\t\t\t\tisMany: true,\n\t\t\t\ttype: \"Element\"\n\t\t\t}\n\t\t]\n\t}\n];\nvar associations$2 = [\n];\nvar xml = {\n\ttagAlias: \"lowerCase\"\n};\nvar DiPackage = {\n\tname: name$2,\n\turi: uri$2,\n\tprefix: prefix$2,\n\ttypes: types$2,\n\tassociations: associations$2,\n\txml: xml\n};\n\nvar name$1 = \"bpmn.io colors for BPMN\";\nvar uri$1 = \"http://bpmn.io/schema/bpmn/biocolor/1.0\";\nvar prefix$1 = \"bioc\";\nvar types$1 = [\n\t{\n\t\tname: \"ColoredShape\",\n\t\t\"extends\": [\n\t\t\t\"bpmndi:BPMNShape\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"stroke\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"fill\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ColoredEdge\",\n\t\t\"extends\": [\n\t\t\t\"bpmndi:BPMNEdge\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"stroke\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"fill\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t}\n];\nvar enumerations$1 = [\n];\nvar associations$1 = [\n];\nvar BiocPackage = {\n\tname: name$1,\n\turi: uri$1,\n\tprefix: prefix$1,\n\ttypes: types$1,\n\tenumerations: enumerations$1,\n\tassociations: associations$1\n};\n\nvar name = \"BPMN in Color\";\nvar uri = \"http://www.omg.org/spec/BPMN/non-normative/color/1.0\";\nvar prefix = \"color\";\nvar types = [\n\t{\n\t\tname: \"ColoredLabel\",\n\t\t\"extends\": [\n\t\t\t\"bpmndi:BPMNLabel\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"color\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ColoredShape\",\n\t\t\"extends\": [\n\t\t\t\"bpmndi:BPMNShape\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"background-color\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"border-color\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t},\n\t{\n\t\tname: \"ColoredEdge\",\n\t\t\"extends\": [\n\t\t\t\"bpmndi:BPMNEdge\"\n\t\t],\n\t\tproperties: [\n\t\t\t{\n\t\t\t\tname: \"border-color\",\n\t\t\t\tisAttr: true,\n\t\t\t\ttype: \"String\"\n\t\t\t}\n\t\t]\n\t}\n];\nvar enumerations = [\n];\nvar associations = [\n];\nvar BpmnInColorPackage = {\n\tname: name,\n\turi: uri,\n\tprefix: prefix,\n\ttypes: types,\n\tenumerations: enumerations,\n\tassociations: associations\n};\n\nconst packages = {\n  bpmn: BpmnPackage,\n  bpmndi: BpmnDiPackage,\n  dc: DcPackage,\n  di: DiPackage,\n  bioc: BiocPackage,\n  color: BpmnInColorPackage\n};\n\nfunction SimpleBpmnModdle(additionalPackages, options) {\n  const pks = assign({}, packages, additionalPackages);\n\n  return new BpmnModdle(pks, options);\n}\n\nexport { SimpleBpmnModdle as BpmnModdle };\n//# sourceMappingURL=index.js.map\n","export function elementToString(e) {\n  if (!e) {\n    return '<null>';\n  }\n\n  return '<' + e.$type + (e.id ? ' id=\"' + e.id : '') + '\" />';\n}","import {\n  has\n} from 'min-dash';\n\n/**\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\n */\n\n\n// TODO(nikku): remove with future bpmn-js version\n\nvar DI_ERROR_MESSAGE = 'Tried to access di from the businessObject. The di is available through the diagram element only. For more information, see https://github.com/bpmn-io/bpmn-js/issues/1472';\n\n/**\n * @private\n *\n * @param {ModdleElement} businessObject\n */\nexport function ensureCompatDiRef(businessObject) {\n\n  // bpmnElement can have multiple independent DIs\n  if (!has(businessObject, 'di')) {\n    Object.defineProperty(businessObject, 'di', {\n      enumerable: false,\n      get: function() {\n        throw new Error(DI_ERROR_MESSAGE);\n      }\n    });\n  }\n}","import {\n  filter,\n  find,\n  forEach\n} from 'min-dash';\n\nimport {\n  elementToString\n} from './Util';\n\nimport {\n  ensureCompatDiRef\n} from '../util/CompatibilityUtil';\n\n/**\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * Returns true if an element is of the given meta-model type.\n *\n * @param {ModdleElement} element\n * @param {string} type\n *\n * @return {boolean}\n */\nfunction is(element, type) {\n  return element.$instanceOf(type);\n}\n\n\n/**\n * Find a suitable display candidate for definitions where the DI does not\n * correctly specify one.\n *\n * @param {ModdleElement} definitions\n *\n * @return {ModdleElement}\n */\nfunction findDisplayCandidate(definitions) {\n  return find(definitions.rootElements, function(e) {\n    return is(e, 'bpmn:Process') || is(e, 'bpmn:Collaboration');\n  });\n}\n\n/**\n * @param {Record<'element' | 'root' | 'error', Function>} handler\n */\nexport default function BpmnTreeWalker(handler) {\n\n  // list of containers already walked\n  var handledElements = {};\n\n  // list of elements to handle deferred to ensure\n  // prerequisites are drawn\n  var deferred = [];\n\n  var diMap = {};\n\n  // Helpers //////////////////////\n\n  function contextual(fn, ctx) {\n    return function(e) {\n      fn(e, ctx);\n    };\n  }\n\n  function handled(element) {\n    handledElements[element.id] = element;\n  }\n\n  function isHandled(element) {\n    return handledElements[element.id];\n  }\n\n  function visit(element, ctx) {\n\n    var gfx = element.gfx;\n\n    // avoid multiple rendering of elements\n    if (gfx) {\n      throw new Error(\n        `already rendered ${ elementToString(element) }`\n      );\n    }\n\n    // call handler\n    return handler.element(element, diMap[element.id], ctx);\n  }\n\n  function visitRoot(element, diagram) {\n    return handler.root(element, diMap[element.id], diagram);\n  }\n\n  function visitIfDi(element, ctx) {\n\n    try {\n      var gfx = diMap[element.id] && visit(element, ctx);\n\n      handled(element);\n\n      return gfx;\n    } catch (error) {\n      logError(error.message, { element, error });\n\n      console.error(`failed to import ${ elementToString(element) }`, error);\n    }\n  }\n\n  function logError(message, context) {\n    handler.error(message, context);\n  }\n\n  // DI handling //////////////////////\n\n  var registerDi = this.registerDi = function registerDi(di) {\n    var bpmnElement = di.bpmnElement;\n\n    if (bpmnElement) {\n      if (diMap[bpmnElement.id]) {\n        logError(\n          `multiple DI elements defined for ${ elementToString(bpmnElement) }`,\n          { element: bpmnElement }\n        );\n      } else {\n        diMap[bpmnElement.id] = di;\n\n        ensureCompatDiRef(bpmnElement);\n      }\n    } else {\n      logError(\n        `no bpmnElement referenced in ${ elementToString(di) }`,\n        { element: di }\n      );\n    }\n  };\n\n  function handleDiagram(diagram) {\n    handlePlane(diagram.plane);\n  }\n\n  function handlePlane(plane) {\n    registerDi(plane);\n\n    forEach(plane.planeElement, handlePlaneElement);\n  }\n\n  function handlePlaneElement(planeElement) {\n    registerDi(planeElement);\n  }\n\n\n  // Semantic handling //////////////////////\n\n  /**\n   * Handle definitions and return the rendered diagram (if any).\n   *\n   * @param {ModdleElement} definitions to walk and import\n   * @param {ModdleElement} [diagram] specific diagram to import and display\n   *\n   * @throws {Error} if no diagram to display could be found\n   */\n  this.handleDefinitions = function handleDefinitions(definitions, diagram) {\n\n    // make sure we walk the correct bpmnElement\n\n    var diagrams = definitions.diagrams;\n\n    if (diagram && diagrams.indexOf(diagram) === -1) {\n      throw new Error('diagram not part of <bpmn:Definitions />');\n    }\n\n    if (!diagram && diagrams && diagrams.length) {\n      diagram = diagrams[0];\n    }\n\n    // no diagram -> nothing to import\n    if (!diagram) {\n      throw new Error('no diagram to display');\n    }\n\n    // load DI from selected diagram only\n    diMap = {};\n    handleDiagram(diagram);\n\n\n    var plane = diagram.plane;\n\n    if (!plane) {\n      throw new Error(\n        `no plane for ${ elementToString(diagram) }`\n      );\n    }\n\n    var rootElement = plane.bpmnElement;\n\n    // ensure we default to a suitable display candidate (process or collaboration),\n    // even if non is specified in DI\n    if (!rootElement) {\n      rootElement = findDisplayCandidate(definitions);\n\n      if (!rootElement) {\n        throw new Error('no process or collaboration to display');\n      } else {\n\n        logError(\n          `correcting missing bpmnElement on ${ elementToString(plane) } to ${ elementToString(rootElement) }`\n        );\n\n        // correct DI on the fly\n        plane.bpmnElement = rootElement;\n        registerDi(plane);\n      }\n    }\n\n\n    var ctx = visitRoot(rootElement, plane);\n\n    if (is(rootElement, 'bpmn:Process') || is(rootElement, 'bpmn:SubProcess')) {\n      handleProcess(rootElement, ctx);\n    } else if (is(rootElement, 'bpmn:Collaboration')) {\n      handleCollaboration(rootElement, ctx);\n\n      // force drawing of everything not yet drawn that is part of the target DI\n      handleUnhandledProcesses(definitions.rootElements, ctx);\n    } else {\n      throw new Error(\n        `unsupported bpmnElement for ${ elementToString(plane) }: ${ elementToString(rootElement) }`\n      );\n    }\n\n    // handle all deferred elements\n    handleDeferred(deferred);\n  };\n\n  var handleDeferred = this.handleDeferred = function handleDeferred() {\n\n    var fn;\n\n    // drain deferred until empty\n    while (deferred.length) {\n      fn = deferred.shift();\n\n      fn();\n    }\n  };\n\n  function handleProcess(process, context) {\n    handleFlowElementsContainer(process, context);\n    handleIoSpecification(process.ioSpecification, context);\n\n    handleArtifacts(process.artifacts, context);\n\n    // log process handled\n    handled(process);\n  }\n\n  function handleUnhandledProcesses(rootElements, ctx) {\n\n    // walk through all processes that have not yet been drawn and draw them\n    // if they contain lanes with DI information.\n    // we do this to pass the free-floating lane test cases in the MIWG test suite\n    var processes = filter(rootElements, function(e) {\n      return !isHandled(e) && is(e, 'bpmn:Process') && e.laneSets;\n    });\n\n    processes.forEach(contextual(handleProcess, ctx));\n  }\n\n  function handleMessageFlow(messageFlow, context) {\n    visitIfDi(messageFlow, context);\n  }\n\n  function handleMessageFlows(messageFlows, context) {\n    forEach(messageFlows, contextual(handleMessageFlow, context));\n  }\n\n  function handleDataAssociation(association, context) {\n    visitIfDi(association, context);\n  }\n\n  function handleDataInput(dataInput, context) {\n    visitIfDi(dataInput, context);\n  }\n\n  function handleDataOutput(dataOutput, context) {\n    visitIfDi(dataOutput, context);\n  }\n\n  function handleArtifact(artifact, context) {\n\n    // bpmn:TextAnnotation\n    // bpmn:Group\n    // bpmn:Association\n\n    visitIfDi(artifact, context);\n  }\n\n  function handleArtifacts(artifacts, context) {\n\n    forEach(artifacts, function(e) {\n      if (is(e, 'bpmn:Association')) {\n        deferred.push(function() {\n          handleArtifact(e, context);\n        });\n      } else {\n        handleArtifact(e, context);\n      }\n    });\n  }\n\n  function handleIoSpecification(ioSpecification, context) {\n\n    if (!ioSpecification) {\n      return;\n    }\n\n    forEach(ioSpecification.dataInputs, contextual(handleDataInput, context));\n    forEach(ioSpecification.dataOutputs, contextual(handleDataOutput, context));\n  }\n\n  var handleSubProcess = this.handleSubProcess = function handleSubProcess(subProcess, context) {\n    handleFlowElementsContainer(subProcess, context);\n    handleArtifacts(subProcess.artifacts, context);\n  };\n\n  function handleFlowNode(flowNode, context) {\n    var childCtx = visitIfDi(flowNode, context);\n\n    if (is(flowNode, 'bpmn:SubProcess')) {\n      handleSubProcess(flowNode, childCtx || context);\n    }\n\n    if (is(flowNode, 'bpmn:Activity')) {\n      handleIoSpecification(flowNode.ioSpecification, context);\n    }\n\n    // defer handling of associations\n    // affected types:\n    //\n    //   * bpmn:Activity\n    //   * bpmn:ThrowEvent\n    //   * bpmn:CatchEvent\n    //\n    deferred.push(function() {\n      forEach(flowNode.dataInputAssociations, contextual(handleDataAssociation, context));\n      forEach(flowNode.dataOutputAssociations, contextual(handleDataAssociation, context));\n    });\n  }\n\n  function handleSequenceFlow(sequenceFlow, context) {\n    visitIfDi(sequenceFlow, context);\n  }\n\n  function handleDataElement(dataObject, context) {\n    visitIfDi(dataObject, context);\n  }\n\n  function handleLane(lane, context) {\n\n    deferred.push(function() {\n\n      var newContext = visitIfDi(lane, context);\n\n      if (lane.childLaneSet) {\n        handleLaneSet(lane.childLaneSet, newContext || context);\n      }\n\n      wireFlowNodeRefs(lane);\n    });\n  }\n\n  function handleLaneSet(laneSet, context) {\n    forEach(laneSet.lanes, contextual(handleLane, context));\n  }\n\n  function handleLaneSets(laneSets, context) {\n    forEach(laneSets, contextual(handleLaneSet, context));\n  }\n\n  function handleFlowElementsContainer(container, context) {\n    handleFlowElements(container.flowElements, context);\n\n    if (container.laneSets) {\n      handleLaneSets(container.laneSets, context);\n    }\n  }\n\n  function handleFlowElements(flowElements, context) {\n    forEach(flowElements, function(flowElement) {\n      if (is(flowElement, 'bpmn:SequenceFlow')) {\n        deferred.push(function() {\n          handleSequenceFlow(flowElement, context);\n        });\n      } else if (is(flowElement, 'bpmn:BoundaryEvent')) {\n        deferred.unshift(function() {\n          handleFlowNode(flowElement, context);\n        });\n      } else if (is(flowElement, 'bpmn:FlowNode')) {\n        handleFlowNode(flowElement, context);\n      } else if (is(flowElement, 'bpmn:DataObject')) {\n\n        // SKIP (assume correct referencing via DataObjectReference)\n      } else if (is(flowElement, 'bpmn:DataStoreReference')) {\n        handleDataElement(flowElement, context);\n      } else if (is(flowElement, 'bpmn:DataObjectReference')) {\n        handleDataElement(flowElement, context);\n      } else {\n        logError(\n          `unrecognized flowElement ${ elementToString(flowElement) } in context ${ elementToString(context && context.businessObject) }`,\n          {\n            element: flowElement,\n            context\n          }\n        );\n      }\n    });\n  }\n\n  function handleParticipant(participant, context) {\n    var newCtx = visitIfDi(participant, context);\n\n    var process = participant.processRef;\n    if (process) {\n      handleProcess(process, newCtx || context);\n    }\n  }\n\n  function handleCollaboration(collaboration, context) {\n\n    forEach(collaboration.participants, contextual(handleParticipant, context));\n\n    deferred.push(function() {\n      handleMessageFlows(collaboration.messageFlows, context);\n    });\n\n    handleArtifacts(collaboration.artifacts, context);\n  }\n\n\n  function wireFlowNodeRefs(lane) {\n\n    // wire the virtual flowNodeRefs <-> relationship\n    forEach(lane.flowNodeRef, function(flowNode) {\n      var lanes = flowNode.get('lanes');\n\n      if (lanes) {\n        lanes.push(lane);\n      }\n    });\n  }\n}\n","import {\n  find,\n  forEach,\n  map\n} from 'min-dash';\n\nimport BpmnTreeWalker from './BpmnTreeWalker';\n\nimport { is } from '../util/ModelUtil';\n\n\n/**\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\n *\n * @typedef { {\n *   warnings: string[];\n * } } ImportBPMNDiagramResult\n *\n * @typedef {ImportBPMNDiagramResult & Error} ImportBPMNDiagramError\n */\n\n/**\n * Import the definitions into a diagram.\n *\n * Errors and warnings are reported through the specified callback.\n *\n * @param {ModdleElement} diagram\n * @param {ModdleElement} definitions\n * @param {ModdleElement} [bpmnDiagram] The diagram to be rendered (if not\n * provided, the first one will be rendered).\n *\n * @return {Promise<ImportBPMNDiagramResult>}\n */\nexport function importBpmnDiagram(diagram, definitions, bpmnDiagram) {\n\n  var importer,\n      eventBus,\n      canvas;\n\n  var error,\n      warnings = [];\n\n  /**\n   * Walk the diagram semantically, importing (=drawing)\n   * all elements you encounter.\n   *\n   * @param {ModdleElement} definitions\n   * @param {ModdleElement} bpmnDiagram\n   */\n  function render(definitions, bpmnDiagram) {\n\n    var visitor = {\n\n      root: function(element, di) {\n        return importer.add(element, di);\n      },\n\n      element: function(element, di, parentShape) {\n        return importer.add(element, di, parentShape);\n      },\n\n      error: function(message, context) {\n        warnings.push({ message: message, context: context });\n      }\n    };\n\n    var walker = new BpmnTreeWalker(visitor);\n\n\n    bpmnDiagram = bpmnDiagram || (definitions.diagrams && definitions.diagrams[0]);\n\n    var diagramsToImport = getDiagramsToImport(definitions, bpmnDiagram);\n\n    if (!diagramsToImport) {\n      throw new Error('no diagram to display');\n    }\n\n    // traverse BPMN 2.0 document model,\n    // starting at definitions\n    forEach(diagramsToImport, function(diagram) {\n      walker.handleDefinitions(definitions, diagram);\n    });\n\n    var rootId = bpmnDiagram.plane.bpmnElement.id;\n\n    // we do need to account for different ways we create root elements\n    // each nested imported <root> do have the `_plane` suffix, while\n    // the root <root> is found under the business object ID\n    canvas.setRootElement(\n      canvas.findRoot(rootId + '_plane') || canvas.findRoot(rootId)\n    );\n  }\n\n  return new Promise(function(resolve, reject) {\n    try {\n      importer = diagram.get('bpmnImporter');\n      eventBus = diagram.get('eventBus');\n      canvas = diagram.get('canvas');\n\n      eventBus.fire('import.render.start', { definitions: definitions });\n\n      render(definitions, bpmnDiagram);\n\n      eventBus.fire('import.render.complete', {\n        error: error,\n        warnings: warnings\n      });\n\n      return resolve({ warnings: warnings });\n    } catch (e) {\n\n      e.warnings = warnings;\n      return reject(e);\n    }\n  });\n}\n\n/**\n * Returns all diagrams in the same hierarchy as the requested diagram.\n * Includes all parent and sub process diagrams.\n *\n * @param {ModdleElement} definitions\n * @param {ModdleElement} bpmnDiagram\n *\n * @return {ModdleElement[]}\n */\nfunction getDiagramsToImport(definitions, bpmnDiagram) {\n  if (!bpmnDiagram || !bpmnDiagram.plane) {\n    return;\n  }\n\n  var bpmnElement = bpmnDiagram.plane.bpmnElement,\n      rootElement = bpmnElement;\n\n  if (!is(bpmnElement, 'bpmn:Process') && !is(bpmnElement, 'bpmn:Collaboration')) {\n    rootElement = findRootProcess(bpmnElement);\n  }\n\n  // in case the process is part of a collaboration, the plane references the\n  // collaboration, not the process\n  var collaboration;\n\n  if (is(rootElement, 'bpmn:Collaboration')) {\n    collaboration = rootElement;\n  } else {\n    collaboration = find(definitions.rootElements, function(element) {\n      if (!is(element, 'bpmn:Collaboration')) {\n        return;\n      }\n\n      return find(element.participants, function(participant) {\n        return participant.processRef === rootElement;\n      });\n    });\n  }\n\n  var rootElements = [ rootElement ];\n\n  // all collaboration processes can contain sub-diagrams\n  if (collaboration) {\n    rootElements = map(collaboration.participants, function(participant) {\n      return participant.processRef;\n    });\n\n    rootElements.push(collaboration);\n  }\n\n  var allChildren = selfAndAllFlowElements(rootElements);\n\n  // if we have multiple diagrams referencing the same element, we\n  // use the first in the file\n  var diagramsToImport = [ bpmnDiagram ];\n  var handledElements = [ bpmnElement ];\n\n  forEach(definitions.diagrams, function(diagram) {\n\n    if (!diagram.plane) {\n      return;\n    }\n\n    var businessObject = diagram.plane.bpmnElement;\n\n    if (\n      allChildren.indexOf(businessObject) !== -1 &&\n      handledElements.indexOf(businessObject) === -1\n    ) {\n      diagramsToImport.push(diagram);\n      handledElements.push(businessObject);\n    }\n  });\n\n\n  return diagramsToImport;\n}\n\nfunction selfAndAllFlowElements(elements) {\n  var result = [];\n\n  forEach(elements, function(element) {\n    if (!element) {\n      return;\n    }\n\n    result.push(element);\n\n    result = result.concat(selfAndAllFlowElements(element.flowElements));\n  });\n\n  return result;\n}\n\nfunction findRootProcess(element) {\n  var parent = element;\n\n  while (parent) {\n    if (is(parent, 'bpmn:Process')) {\n      return parent;\n    }\n\n    parent = parent.$parent;\n  }\n}\n","/**\n * This file must not be changed or exchanged.\n *\n * @see http://bpmn.io/license for more information.\n */\n\nimport {\n  assignStyle,\n  domify,\n  delegate as domDelegate,\n  query as domQuery\n} from 'min-dom';\n\n\n// inlined ../../resources/logo.svg\nvar BPMNIO_LOGO_SVG = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 14.02 5.57\" width=\"53\" height=\"21\"><path fill=\"currentColor\" d=\"M1.88.92v.14c0 .41-.13.68-.4.8.33.14.46.44.46.86v.33c0 .61-.33.95-.95.95H0V0h.95c.65 0 .93.3.93.92zM.63.57v1.06h.24c.24 0 .38-.1.38-.43V.98c0-.28-.1-.4-.32-.4zm0 1.63v1.22h.36c.2 0 .32-.1.32-.39v-.35c0-.37-.12-.48-.4-.48H.63zM4.18.99v.52c0 .64-.31.98-.94.98h-.3V4h-.62V0h.92c.63 0 .94.35.94.99zM2.94.57v1.35h.3c.2 0 .3-.09.3-.37v-.6c0-.29-.1-.38-.3-.38h-.3zm2.89 2.27L6.25 0h.88v4h-.6V1.12L6.1 3.99h-.6l-.46-2.82v2.82h-.55V0h.87zM8.14 1.1V4h-.56V0h.79L9 2.4V0h.56v4h-.64zm2.49 2.29v.6h-.6v-.6zM12.12 1c0-.63.33-1 .95-1 .61 0 .95.37.95 1v2.04c0 .64-.34 1-.95 1-.62 0-.95-.37-.95-1zm.62 2.08c0 .28.13.39.33.39s.32-.1.32-.4V.98c0-.29-.12-.4-.32-.4s-.33.11-.33.4z\"/><path fill=\"currentColor\" d=\"M0 4.53h14.02v1.04H0zM11.08 0h.63v.62h-.63zm.63 4V1h-.63v2.98z\"/></svg>';\n\nexport var BPMNIO_IMG = BPMNIO_LOGO_SVG;\n\nexport var LOGO_STYLES = {\n  verticalAlign: 'middle'\n};\n\nexport var LINK_STYLES = {\n  'color': '#404040'\n};\n\nvar LIGHTBOX_STYLES = {\n  'zIndex': '1001',\n  'position': 'fixed',\n  'top': '0',\n  'left': '0',\n  'right': '0',\n  'bottom': '0'\n};\n\nvar BACKDROP_STYLES = {\n  'width': '100%',\n  'height': '100%',\n  'background': 'rgba(40,40,40,0.2)'\n};\n\nvar NOTICE_STYLES = {\n  'position': 'absolute',\n  'left': '50%',\n  'top': '40%',\n  'transform': 'translate(-50%)',\n  'width': '260px',\n  'padding': '10px',\n  'background': 'white',\n  'boxShadow': '0 1px 4px rgba(0,0,0,0.3)',\n  'fontFamily': 'Helvetica, Arial, sans-serif',\n  'fontSize': '14px',\n  'display': 'flex',\n  'lineHeight': '1.3'\n};\n\nvar LIGHTBOX_MARKUP =\n  '<div class=\"bjs-powered-by-lightbox\">' +\n    '<div class=\"backdrop\"></div>' +\n    '<div class=\"notice\">' +\n      '<a href=\"https://bpmn.io\" target=\"_blank\" rel=\"noopener\" class=\"link\">' +\n        BPMNIO_IMG +\n      '</a>' +\n      '<span>' +\n        'Web-based tooling for BPMN, DMN and forms ' +\n        'powered by <a href=\"https://bpmn.io\" target=\"_blank\" rel=\"noopener\">bpmn.io</a>.' +\n      '</span>' +\n    '</div>' +\n  '</div>';\n\n\nvar lightbox;\n\nfunction createLightbox() {\n  lightbox = domify(LIGHTBOX_MARKUP);\n\n  assignStyle(lightbox, LIGHTBOX_STYLES);\n  assignStyle(domQuery('svg', lightbox), LOGO_STYLES);\n  assignStyle(domQuery('.backdrop', lightbox), BACKDROP_STYLES);\n  assignStyle(domQuery('.notice', lightbox), NOTICE_STYLES);\n  assignStyle(domQuery('.link', lightbox), LINK_STYLES, {\n    'margin': '15px 20px 15px 10px',\n    'alignSelf': 'center'\n  });\n}\n\nexport function open() {\n\n  if (!lightbox) {\n    createLightbox();\n\n    domDelegate.bind(lightbox, '.backdrop', 'click', function(event) {\n      document.body.removeChild(lightbox);\n    });\n  }\n\n  document.body.appendChild(lightbox);\n}\n","/**\n * The code in the <project-logo></project-logo> area\n * must not be changed.\n *\n * @see http://bpmn.io/license for more information.\n */\nimport {\n  assign,\n  find,\n  isNumber,\n  omit\n} from 'min-dash';\n\nimport {\n  domify,\n  assignStyle,\n  query as domQuery,\n  remove as domRemove\n} from 'min-dom';\n\nimport {\n  innerSVG\n} from 'tiny-svg';\n\nimport Diagram from 'diagram-js';\nimport { BpmnModdle } from 'bpmn-moddle';\n\nimport inherits from 'inherits-browser';\n\nimport {\n  importBpmnDiagram\n} from './import/Importer';\n\n/**\n * @template T\n *\n * @typedef { import('diagram-js/lib/core/EventBus').default<T> } EventBus\n */\n\n/**\n * @template T\n *\n * @typedef {import('diagram-js/lib/core/EventBus').EventBusEventCallback<T>} EventBusEventCallback\n */\n\n/**\n * @typedef {import('didi').ModuleDeclaration} ModuleDeclaration\n *\n * @typedef {import('./model/Types').Moddle} Moddle\n * @typedef {import('./model/Types').ModdleElement} ModdleElement\n * @typedef {import('./model/Types').ModdleExtension} ModdleExtension\n *\n * @typedef { {\n *   width?: number|string;\n *   height?: number|string;\n *   position?: string;\n *   container?: string|HTMLElement;\n *   moddleExtensions?: ModdleExtensions;\n *   additionalModules?: ModuleDeclaration[];\n * } & Record<string, any> } BaseViewerOptions\n *\n * @typedef {Record<string, ModdleElement>} ModdleElementsById\n *\n * @typedef { {\n *   [key: string]: ModdleExtension;\n * } } ModdleExtensions\n *\n * @typedef { {\n *   warnings: string[];\n * } } ImportXMLResult\n *\n * @typedef {ImportXMLResult & Error} ImportXMLError\n *\n * @typedef {ImportXMLResult} ImportDefinitionsResult\n *\n * @typedef {ImportXMLError} ImportDefinitionsError\n *\n * @typedef {ImportXMLResult} OpenResult\n *\n * @typedef {ImportXMLError} OpenError\n *\n * @typedef { {\n *   format?: boolean;\n *   preamble?: boolean;\n * } } SaveXMLOptions\n *\n * @typedef { {\n *   xml?: string;\n *   error?: Error;\n * } } SaveXMLResult\n *\n * @typedef { {\n *   svg: string;\n * } } SaveSVGResult\n *\n * @typedef { {\n *   xml: string;\n * } } ImportParseStartEvent\n *\n * @typedef { {\n *   error?: ImportXMLError;\n *   definitions?: ModdleElement;\n *   elementsById?: ModdleElementsById;\n *   references?: ModdleElement[];\n *   warnings: string[];\n * } } ImportParseCompleteEvent\n *\n * @typedef { {\n *   error?: ImportXMLError;\n *   warnings: string[];\n * } } ImportDoneEvent\n *\n * @typedef { {\n *   definitions: ModdleElement;\n * } } SaveXMLStartEvent\n *\n * @typedef {SaveXMLResult} SaveXMLDoneEvent\n *\n * @typedef { {\n *   error?: Error;\n *   svg: string;\n * } } SaveSVGDoneEvent\n */\n\n/**\n * @template Type\n *\n * @typedef { Type extends { eventBus: EventBus<infer X> } ? X : never } EventMap\n */\n\n/**\n * A base viewer for BPMN 2.0 diagrams.\n *\n * Have a look at {@link bpmn-js/lib/Viewer}, {@link bpmn-js/lib/NavigatedViewer} or {@link bpmn-js/lib/Modeler} for\n * bundles that include actual features.\n *\n * @template [ServiceMap=null]\n *\n * @extends Diagram<ServiceMap>\n *\n * @param {BaseViewerOptions} [options] The options to configure the viewer.\n */\nexport default function BaseViewer(options) {\n\n  /**\n   * @type {BaseViewerOptions}\n   */\n  options = assign({}, DEFAULT_OPTIONS, options);\n\n  /**\n   * @type {Moddle}\n   */\n  this._moddle = this._createModdle(options);\n\n  /**\n   * @type {HTMLElement}\n   */\n  this._container = this._createContainer(options);\n\n  this._init(this._container, this._moddle, options);\n\n  /* <project-logo> */\n\n  addProjectLogo(this._container);\n\n  /* </project-logo> */\n}\n\ninherits(BaseViewer, Diagram);\n\n/**\n * Parse and render a BPMN 2.0 diagram.\n *\n * Once finished the viewer reports back the result to the\n * provided callback function with (err, warnings).\n *\n * ## Life-Cycle Events\n *\n * During import the viewer will fire life-cycle events:\n *\n *   * import.parse.start (about to read model from XML)\n *   * import.parse.complete (model read; may have worked or not)\n *   * import.render.start (graphical import start)\n *   * import.render.complete (graphical import finished)\n *   * import.done (everything done)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @throws {ImportXMLError} An error thrown during the import of the XML.\n *\n * @fires BaseViewer#ImportParseStartEvent\n * @fires BaseViewer#ImportParseCompleteEvent\n * @fires Importer#ImportRenderStartEvent\n * @fires Importer#ImportRenderCompleteEvent\n * @fires BaseViewer#ImportDoneEvent\n *\n * @param {string} xml The BPMN 2.0 XML to be imported.\n * @param {ModdleElement|string} [bpmnDiagram] The optional diagram or Id of the BPMN diagram to open.\n *\n * @return {Promise<ImportXMLResult>} A promise resolving with warnings that were produced during the import.\n */\nBaseViewer.prototype.importXML = async function importXML(xml, bpmnDiagram) {\n\n  const self = this;\n\n  function ParseCompleteEvent(data) {\n    return self.get('eventBus').createEvent(data);\n  }\n\n  let aggregatedWarnings = [];\n  try {\n\n    // hook in pre-parse listeners +\n    // allow xml manipulation\n\n    /**\n     * A `import.parse.start` event.\n     *\n     * @event BaseViewer#ImportParseStartEvent\n     * @type {ImportParseStartEvent}\n     */\n    xml = this._emit('import.parse.start', { xml: xml }) || xml;\n\n    let parseResult;\n    try {\n      parseResult = await this._moddle.fromXML(xml, 'bpmn:Definitions');\n    } catch (error) {\n      this._emit('import.parse.complete', {\n        error\n      });\n\n      throw error;\n    }\n\n    let definitions = parseResult.rootElement;\n    const references = parseResult.references;\n    const parseWarnings = parseResult.warnings;\n    const elementsById = parseResult.elementsById;\n\n    aggregatedWarnings = aggregatedWarnings.concat(parseWarnings);\n\n    // hook in post parse listeners +\n    // allow definitions manipulation\n\n    /**\n     * A `import.parse.complete` event.\n     *\n     * @event BaseViewer#ImportParseCompleteEvent\n     * @type {ImportParseCompleteEvent}\n     */\n    definitions = this._emit('import.parse.complete', ParseCompleteEvent({\n      error: null,\n      definitions: definitions,\n      elementsById: elementsById,\n      references: references,\n      warnings: aggregatedWarnings\n    })) || definitions;\n\n    const importResult = await this.importDefinitions(definitions, bpmnDiagram);\n\n    aggregatedWarnings = aggregatedWarnings.concat(importResult.warnings);\n\n    /**\n     * A `import.parse.complete` event.\n     *\n     * @event BaseViewer#ImportDoneEvent\n     * @type {ImportDoneEvent}\n     */\n    this._emit('import.done', { error: null, warnings: aggregatedWarnings });\n\n    return { warnings: aggregatedWarnings };\n  } catch (err) {\n    let error = err;\n    aggregatedWarnings = aggregatedWarnings.concat(error.warnings || []);\n    addWarningsToError(error, aggregatedWarnings);\n\n    error = checkValidationError(error);\n\n    this._emit('import.done', { error, warnings: error.warnings });\n\n    throw error;\n  }\n};\n\n\n/**\n * Import parsed definitions and render a BPMN 2.0 diagram.\n *\n * Once finished the viewer reports back the result to the\n * provided callback function with (err, warnings).\n *\n * ## Life-Cycle Events\n *\n * During import the viewer will fire life-cycle events:\n *\n *   * import.render.start (graphical import start)\n *   * import.render.complete (graphical import finished)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @throws {ImportDefinitionsError} An error thrown during the import of the definitions.\n *\n * @param {ModdleElement} definitions The definitions.\n * @param {ModdleElement|string} [bpmnDiagram] The optional diagram or ID of the BPMN diagram to open.\n *\n * @return {Promise<ImportDefinitionsResult>} A promise resolving with warnings that were produced during the import.\n */\nBaseViewer.prototype.importDefinitions = async function importDefinitions(definitions, bpmnDiagram) {\n  this._setDefinitions(definitions);\n  const result = await this.open(bpmnDiagram);\n\n  return { warnings: result.warnings };\n};\n\n\n/**\n * Open diagram of previously imported XML.\n *\n * Once finished the viewer reports back the result to the\n * provided callback function with (err, warnings).\n *\n * ## Life-Cycle Events\n *\n * During switch the viewer will fire life-cycle events:\n *\n *   * import.render.start (graphical import start)\n *   * import.render.complete (graphical import finished)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @throws {OpenError} An error thrown during opening.\n *\n * @param {ModdleElement|string} bpmnDiagramOrId The diagram or Id of the BPMN diagram to open.\n *\n * @return {Promise<OpenResult>} A promise resolving with warnings that were produced during opening.\n */\nBaseViewer.prototype.open = async function open(bpmnDiagramOrId) {\n\n  const definitions = this._definitions;\n  let bpmnDiagram = bpmnDiagramOrId;\n\n  if (!definitions) {\n    const error = new Error('no XML imported');\n    addWarningsToError(error, []);\n\n    throw error;\n  }\n\n  if (typeof bpmnDiagramOrId === 'string') {\n    bpmnDiagram = findBPMNDiagram(definitions, bpmnDiagramOrId);\n\n    if (!bpmnDiagram) {\n      const error = new Error('BPMNDiagram <' + bpmnDiagramOrId + '> not found');\n      addWarningsToError(error, []);\n\n      throw error;\n    }\n  }\n\n  // clear existing rendered diagram\n  // catch synchronous exceptions during #clear()\n  try {\n    this.clear();\n  } catch (error) {\n    addWarningsToError(error, []);\n\n    throw error;\n  }\n\n  // perform graphical import\n  const { warnings } = await importBpmnDiagram(this, definitions, bpmnDiagram);\n\n  return { warnings };\n};\n\n/**\n * Export the currently displayed BPMN 2.0 diagram as\n * a BPMN 2.0 XML document.\n *\n * ## Life-Cycle Events\n *\n * During XML saving the viewer will fire life-cycle events:\n *\n *   * saveXML.start (before serialization)\n *   * saveXML.serialized (after xml generation)\n *   * saveXML.done (everything done)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @throws {Error} An error thrown during export.\n *\n * @fires BaseViewer#SaveXMLStart\n * @fires BaseViewer#SaveXMLDone\n *\n * @param {SaveXMLOptions} [options] The options.\n *\n * @return {Promise<SaveXMLResult>} A promise resolving with the XML.\n */\nBaseViewer.prototype.saveXML = async function saveXML(options) {\n\n  options = options || {};\n\n  let definitions = this._definitions,\n      error, xml;\n\n  try {\n    if (!definitions) {\n      throw new Error('no definitions loaded');\n    }\n\n    // allow to fiddle around with definitions\n\n    /**\n     * A `saveXML.start` event.\n     *\n     * @event BaseViewer#SaveXMLStartEvent\n     * @type {SaveXMLStartEvent}\n     */\n    definitions = this._emit('saveXML.start', {\n      definitions\n    }) || definitions;\n\n    const result = await this._moddle.toXML(definitions, options);\n    xml = result.xml;\n\n    xml = this._emit('saveXML.serialized', {\n      xml\n    }) || xml;\n  } catch (err) {\n    error = err;\n  }\n\n  const result = error ? { error } : { xml };\n\n  /**\n   * A `saveXML.done` event.\n   *\n   * @event BaseViewer#SaveXMLDoneEvent\n   * @type {SaveXMLDoneEvent}\n   */\n  this._emit('saveXML.done', result);\n\n  if (error) {\n    throw error;\n  }\n\n  return result;\n};\n\n\n/**\n * Export the currently displayed BPMN 2.0 diagram as\n * an SVG image.\n *\n * ## Life-Cycle Events\n *\n * During SVG saving the viewer will fire life-cycle events:\n *\n *   * saveSVG.start (before serialization)\n *   * saveSVG.done (everything done)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @throws {Error} An error thrown during export.\n *\n * @fires BaseViewer#SaveSVGDone\n *\n * @return {Promise<SaveSVGResult>} A promise resolving with the SVG.\n */\nBaseViewer.prototype.saveSVG = async function saveSVG() {\n  this._emit('saveSVG.start');\n\n  let svg, err;\n\n  try {\n    const canvas = this.get('canvas');\n\n    const contentNode = canvas.getActiveLayer(),\n          defsNode = domQuery(':scope > defs', canvas._svg);\n\n    const contents = innerSVG(contentNode),\n          defs = defsNode ? '<defs>' + innerSVG(defsNode) + '</defs>' : '';\n\n    const bbox = contentNode.getBBox();\n\n    svg =\n      '<?xml version=\"1.0\" encoding=\"utf-8\"?>\\n' +\n      '<!-- created with bpmn-js / http://bpmn.io -->\\n' +\n      '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n' +\n      '<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" ' +\n      'width=\"' + bbox.width + '\" height=\"' + bbox.height + '\" ' +\n      'viewBox=\"' + bbox.x + ' ' + bbox.y + ' ' + bbox.width + ' ' + bbox.height + '\" version=\"1.1\">' +\n      defs + contents +\n      '</svg>';\n  } catch (e) {\n    err = e;\n  }\n\n  /**\n   * A `saveSVG.done` event.\n   *\n   * @event BaseViewer#SaveSVGDoneEvent\n   * @type {SaveSVGDoneEvent}\n   */\n  this._emit('saveSVG.done', {\n    error: err,\n    svg: svg\n  });\n\n  if (err) {\n    throw err;\n  }\n\n  return { svg };\n};\n\nBaseViewer.prototype._setDefinitions = function(definitions) {\n  this._definitions = definitions;\n};\n\n/**\n * Return modules to instantiate with.\n *\n * @return {ModuleDeclaration[]} The modules.\n */\nBaseViewer.prototype.getModules = function() {\n  return this._modules;\n};\n\n/**\n * Remove all drawn elements from the viewer.\n *\n * After calling this method the viewer can still be reused for opening another\n * diagram.\n */\nBaseViewer.prototype.clear = function() {\n  if (!this.getDefinitions()) {\n\n    // no diagram to clear\n    return;\n  }\n\n  // remove drawn elements\n  Diagram.prototype.clear.call(this);\n};\n\n/**\n * Destroy the viewer instance and remove all its remainders from the document\n * tree.\n */\nBaseViewer.prototype.destroy = function() {\n\n  // diagram destroy\n  Diagram.prototype.destroy.call(this);\n\n  // dom detach\n  domRemove(this._container);\n};\n\n/**\n * @overlord\n *\n * Register an event listener for events with the given name.\n *\n * The callback will be invoked with `event, ...additionalArguments`\n * that have been passed to {@link EventBus#fire}.\n *\n * Returning false from a listener will prevent the events default action\n * (if any is specified). To stop an event from being processed further in\n * other listeners execute {@link Event#stopPropagation}.\n *\n * Returning anything but `undefined` from a listener will stop the listener propagation.\n *\n * @template T\n *\n * @param {string|string[]} events The event(s) to listen to.\n * @param {number} [priority] The priority with which to listen.\n * @param {EventBusEventCallback<T>} callback The callback.\n * @param {any} [that] Value of `this` the callback will be called with.\n */\n/**\n * Register an event listener for events with the given name.\n *\n * The callback will be invoked with `event, ...additionalArguments`\n * that have been passed to {@link EventBus#fire}.\n *\n * Returning false from a listener will prevent the events default action\n * (if any is specified). To stop an event from being processed further in\n * other listeners execute {@link Event#stopPropagation}.\n *\n * Returning anything but `undefined` from a listener will stop the listener propagation.\n *\n * @template {keyof EventMap<ServiceMap>} EventName\n *\n * @param {EventName} events to subscribe to\n * @param {number} [priority=1000] listen priority\n * @param {EventBusEventCallback<(EventMap<ServiceMap>)[EventName]>} callback\n * @param {any} [that] callback context\n */\nBaseViewer.prototype.on = function(events, priority, callback, that) {\n  return this.get('eventBus').on(events, priority, callback, that);\n};\n\n/**\n * Remove an event listener.\n *\n * @param {string|string[]} events The event(s).\n * @param {Function} [callback] The callback.\n */\nBaseViewer.prototype.off = function(events, callback) {\n  this.get('eventBus').off(events, callback);\n};\n\n/**\n * Attach the viewer to an HTML element.\n *\n * @param {HTMLElement} parentNode The parent node to attach to.\n */\nBaseViewer.prototype.attachTo = function(parentNode) {\n\n  if (!parentNode) {\n    throw new Error('parentNode required');\n  }\n\n  // ensure we detach from the\n  // previous, old parent\n  this.detach();\n\n  // unwrap jQuery if provided\n  if (parentNode.get && parentNode.constructor.prototype.jquery) {\n    parentNode = parentNode.get(0);\n  }\n\n  if (typeof parentNode === 'string') {\n    parentNode = domQuery(parentNode);\n  }\n\n  parentNode.appendChild(this._container);\n\n  this._emit('attach', {});\n\n  this.get('canvas').resized();\n};\n\n/**\n * Get the definitions model element.\n *\n * @return {ModdleElement} The definitions model element.\n */\nBaseViewer.prototype.getDefinitions = function() {\n  return this._definitions;\n};\n\n/**\n * Detach the viewer.\n *\n * @fires BaseViewer#DetachEvent\n */\nBaseViewer.prototype.detach = function() {\n\n  const container = this._container,\n        parentNode = container.parentNode;\n\n  if (!parentNode) {\n    return;\n  }\n\n  /**\n   * A `detach` event.\n   *\n   * @event BaseViewer#DetachEvent\n   * @type {Object}\n   */\n  this._emit('detach', {});\n\n  parentNode.removeChild(container);\n};\n\nBaseViewer.prototype._init = function(container, moddle, options) {\n\n  const baseModules = options.modules || this.getModules(options),\n        additionalModules = options.additionalModules || [],\n        staticModules = [\n          {\n            bpmnjs: [ 'value', this ],\n            moddle: [ 'value', moddle ]\n          }\n        ];\n\n  const diagramModules = [].concat(staticModules, baseModules, additionalModules);\n\n  const diagramOptions = assign(omit(options, [ 'additionalModules' ]), {\n    canvas: assign({}, options.canvas, { container: container }),\n    modules: diagramModules\n  });\n\n  // invoke diagram constructor\n  Diagram.call(this, diagramOptions);\n\n  if (options && options.container) {\n    this.attachTo(options.container);\n  }\n};\n\n/**\n * Emit an event on the underlying {@link EventBus}\n *\n * @param  {string} type\n * @param  {Object} event\n *\n * @return {Object} The return value after calling all event listeners.\n */\nBaseViewer.prototype._emit = function(type, event) {\n  return this.get('eventBus').fire(type, event);\n};\n\n/**\n * @param {BaseViewerOptions} options\n *\n * @return {HTMLElement}\n */\nBaseViewer.prototype._createContainer = function(options) {\n\n  const container = domify('<div class=\"bjs-container\"></div>');\n\n  assignStyle(container, {\n    width: ensureUnit(options.width),\n    height: ensureUnit(options.height),\n    position: options.position\n  });\n\n  return container;\n};\n\n/**\n * @param {BaseViewerOptions} options\n *\n * @return {Moddle}\n */\nBaseViewer.prototype._createModdle = function(options) {\n  const moddleOptions = assign({}, this._moddleExtensions, options.moddleExtensions);\n\n  return new BpmnModdle(moddleOptions);\n};\n\nBaseViewer.prototype._modules = [];\n\n// helpers ///////////////\n\nfunction addWarningsToError(err, warningsAry) {\n  err.warnings = warningsAry;\n  return err;\n}\n\nfunction checkValidationError(err) {\n\n  // check if we can help the user by indicating wrong BPMN 2.0 xml\n  // (in case he or the exporting tool did not get that right)\n\n  const pattern = /unparsable content <([^>]+)> detected([\\s\\S]*)$/;\n  const match = pattern.exec(err.message);\n\n  if (match) {\n    err.message =\n      'unparsable content <' + match[1] + '> detected; ' +\n      'this may indicate an invalid BPMN 2.0 diagram file' + match[2];\n  }\n\n  return err;\n}\n\nconst DEFAULT_OPTIONS = {\n  width: '100%',\n  height: '100%',\n  position: 'relative'\n};\n\n\n/**\n * Ensure the passed argument is a proper unit (defaulting to px)\n */\nfunction ensureUnit(val) {\n  return val + (isNumber(val) ? 'px' : '');\n}\n\n\n/**\n * Find BPMNDiagram in definitions by ID\n *\n * @param {ModdleElement<Definitions>} definitions\n * @param {string} diagramId\n *\n * @return {ModdleElement<BPMNDiagram>|null}\n */\nfunction findBPMNDiagram(definitions, diagramId) {\n  if (!diagramId) {\n    return null;\n  }\n\n  return find(definitions.diagrams, function(element) {\n    return element.id === diagramId;\n  }) || null;\n}\n\n\n/* <project-logo> */\n\nimport {\n  open as openPoweredBy,\n  BPMNIO_IMG,\n  LOGO_STYLES,\n  LINK_STYLES\n} from './util/PoweredByUtil';\n\nimport {\n  event as domEvent\n} from 'min-dom';\n\n/**\n * Adds the project logo to the diagram container as\n * required by the bpmn.io license.\n *\n * @see http://bpmn.io/license\n *\n * @param {Element} container\n */\nfunction addProjectLogo(container) {\n  const img = BPMNIO_IMG;\n\n  const linkMarkup =\n    '<a href=\"http://bpmn.io\" ' +\n    'target=\"_blank\" ' +\n    'class=\"bjs-powered-by\" ' +\n    'title=\"Powered by bpmn.io\" ' +\n    '>' +\n    img +\n    '</a>';\n\n  const linkElement = domify(linkMarkup);\n\n  assignStyle(domQuery('svg', linkElement), LOGO_STYLES);\n  assignStyle(linkElement, LINK_STYLES, {\n    position: 'absolute',\n    bottom: '15px',\n    right: '15px',\n    zIndex: '100'\n  });\n\n  container.appendChild(linkElement);\n\n  domEvent.bind(linkElement, 'click', function(event) {\n    openPoweredBy();\n\n    event.preventDefault();\n  });\n}\n\n/* </project-logo> */\n","import inherits from 'inherits-browser';\n\nimport { Ids } from 'ids';\n\nimport BaseViewer from './BaseViewer';\n\n\n/**\n * @typedef {import('./BaseViewer').BaseViewerOptions} BaseViewerOptions\n * @typedef {import('./BaseViewer').ModdleElementsById} ModdleElementsById\n *\n * @typedef {import('./model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * A base modeler for BPMN 2.0 diagrams.\n *\n * See {@link bpmn-js/lib/Modeler} for a fully-featured modeler.\n *\n * @template [ServiceMap=null]\n *\n * @extends BaseViewer<ServiceMap>\n *\n * @param {BaseViewerOptions} [options] The options to configure the modeler.\n */\nexport default function BaseModeler(options) {\n  BaseViewer.call(this, options);\n\n  // hook ID collection into the modeler\n  this.on('import.parse.complete', function(event) {\n    if (!event.error) {\n      this._collectIds(event.definitions, event.elementsById);\n    }\n  }, this);\n\n  this.on('diagram.destroy', function() {\n    this.get('moddle').ids.clear();\n  }, this);\n}\n\ninherits(BaseModeler, BaseViewer);\n\n\n/**\n * Create a moddle instance, attaching IDs to it.\n *\n * @param {BaseViewerOptions} options\n *\n * @return {Moddle}\n */\nBaseModeler.prototype._createModdle = function(options) {\n  var moddle = BaseViewer.prototype._createModdle.call(this, options);\n\n  // attach ids to moddle to be able to track and validated ids in the BPMN 2.0\n  // XML document tree\n  moddle.ids = new Ids([ 32, 36, 1 ]);\n\n  return moddle;\n};\n\n/**\n * Collect IDs processed during parsing of the definitions object.\n *\n * @param {ModdleElement} definitions\n * @param {ModdleElementsById} elementsById\n */\nBaseModeler.prototype._collectIds = function(definitions, elementsById) {\n\n  var moddle = definitions.$model,\n      ids = moddle.ids,\n      id;\n\n  // remove references from previous import\n  ids.clear();\n\n  for (id in elementsById) {\n    ids.claim(id, elementsById[ id ]);\n  }\n};\n","import {\n  has,\n  some\n} from 'min-dash';\n\nimport {\n  getDi\n} from '../util/ModelUtil';\n\nimport {\n  componentsToPath\n} from 'diagram-js/lib/util/RenderUtil';\n\n\n/**\n * @typedef {import('../model').ModdleElement} ModdleElement\n * @typedef {import('../model').Element} Element\n *\n * @typedef {import('../model').ShapeLike} ShapeLike\n *\n * @typedef {import('diagram-js/lib/util/Types').Dimensions} Dimensions\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n */\n\n// re-export for compatibility\nexport {\n  getDi,\n  getBusinessObject as getSemantic\n} from '../util/ModelUtil';\n\n\nexport var black = 'hsl(225, 10%, 15%)';\nexport var white = 'white';\n\n// element utils //////////////////////\n\n/**\n * Checks if eventDefinition of the given element matches with semantic type.\n *\n * @param {ModdleElement} event\n * @param {string} eventDefinitionType\n *\n * @return {boolean}\n */\nexport function isTypedEvent(event, eventDefinitionType) {\n  return some(event.eventDefinitions, function(definition) {\n    return definition.$type === eventDefinitionType;\n  });\n}\n\n/**\n * Check if element is a throw event.\n *\n * @param {ModdleElement} event\n *\n * @return {boolean}\n */\nexport function isThrowEvent(event) {\n  return (event.$type === 'bpmn:IntermediateThrowEvent') || (event.$type === 'bpmn:EndEvent');\n}\n\n/**\n * Check if element is a throw event.\n *\n * @param {ModdleElement} element\n *\n * @return {boolean}\n */\nexport function isCollection(element) {\n  var dataObject = element.dataObjectRef;\n\n  return element.isCollection || (dataObject && dataObject.isCollection);\n}\n\n\n// color access //////////////////////\n\n/**\n * @param {Element} element\n * @param {string} [defaultColor]\n * @param {string} [overrideColor]\n *\n * @return {string}\n */\nexport function getFillColor(element, defaultColor, overrideColor) {\n  var di = getDi(element);\n\n  return overrideColor || di.get('color:background-color') || di.get('bioc:fill') || defaultColor || white;\n}\n\n/**\n * @param {Element} element\n * @param {string} [defaultColor]\n * @param {string} [overrideColor]\n *\n * @return {string}\n */\nexport function getStrokeColor(element, defaultColor, overrideColor) {\n  var di = getDi(element);\n\n  return overrideColor || di.get('color:border-color') || di.get('bioc:stroke') || defaultColor || black;\n}\n\n/**\n * @param {Element} element\n * @param {string} [defaultColor]\n * @param {string} [defaultStrokeColor]\n * @param {string} [overrideColor]\n *\n * @return {string}\n */\nexport function getLabelColor(element, defaultColor, defaultStrokeColor, overrideColor) {\n  var di = getDi(element),\n      label = di.get('label');\n\n  return overrideColor || (label && label.get('color:color')) || defaultColor ||\n    getStrokeColor(element, defaultStrokeColor);\n}\n\n// cropping path customizations //////////////////////\n\n/**\n * @param {ShapeLike} shape\n *\n * @return {string} path\n */\nexport function getCirclePath(shape) {\n\n  var cx = shape.x + shape.width / 2,\n      cy = shape.y + shape.height / 2,\n      radius = shape.width / 2;\n\n  var circlePath = [\n    [ 'M', cx, cy ],\n    [ 'm', 0, -radius ],\n    [ 'a', radius, radius, 0, 1, 1, 0, 2 * radius ],\n    [ 'a', radius, radius, 0, 1, 1, 0, -2 * radius ],\n    [ 'z' ]\n  ];\n\n  return componentsToPath(circlePath);\n}\n\n/**\n * @param {ShapeLike} shape\n * @param {number} [borderRadius]\n *\n * @return {string} path\n */\nexport function getRoundRectPath(shape, borderRadius) {\n\n  var x = shape.x,\n      y = shape.y,\n      width = shape.width,\n      height = shape.height;\n\n  var roundRectPath = [\n    [ 'M', x + borderRadius, y ],\n    [ 'l', width - borderRadius * 2, 0 ],\n    [ 'a', borderRadius, borderRadius, 0, 0, 1, borderRadius, borderRadius ],\n    [ 'l', 0, height - borderRadius * 2 ],\n    [ 'a', borderRadius, borderRadius, 0, 0, 1, -borderRadius, borderRadius ],\n    [ 'l', borderRadius * 2 - width, 0 ],\n    [ 'a', borderRadius, borderRadius, 0, 0, 1, -borderRadius, -borderRadius ],\n    [ 'l', 0, borderRadius * 2 - height ],\n    [ 'a', borderRadius, borderRadius, 0, 0, 1, borderRadius, -borderRadius ],\n    [ 'z' ]\n  ];\n\n  return componentsToPath(roundRectPath);\n}\n\n/**\n * @param {ShapeLike} shape\n *\n * @return {string} path\n */\nexport function getDiamondPath(shape) {\n\n  var width = shape.width,\n      height = shape.height,\n      x = shape.x,\n      y = shape.y,\n      halfWidth = width / 2,\n      halfHeight = height / 2;\n\n  var diamondPath = [\n    [ 'M', x + halfWidth, y ],\n    [ 'l', halfWidth, halfHeight ],\n    [ 'l', -halfWidth, halfHeight ],\n    [ 'l', -halfWidth, -halfHeight ],\n    [ 'z' ]\n  ];\n\n  return componentsToPath(diamondPath);\n}\n\n/**\n * @param {ShapeLike} shape\n *\n * @return {string} path\n */\nexport function getRectPath(shape) {\n  var x = shape.x,\n      y = shape.y,\n      width = shape.width,\n      height = shape.height;\n\n  var rectPath = [\n    [ 'M', x, y ],\n    [ 'l', width, 0 ],\n    [ 'l', 0, height ],\n    [ 'l', -width, 0 ],\n    [ 'z' ]\n  ];\n\n  return componentsToPath(rectPath);\n}\n\n/**\n * Get width and height from element or overrides.\n *\n * @param {Dimensions|Rect|ShapeLike} bounds\n * @param {Object} overrides\n *\n * @returns {Dimensions}\n */\nexport function getBounds(bounds, overrides = {}) {\n  return {\n    width: getWidth(bounds, overrides),\n    height: getHeight(bounds, overrides)\n  };\n}\n\n/**\n * Get width from element or overrides.\n *\n * @param {Dimensions|Rect|ShapeLike} bounds\n * @param {Object} overrides\n *\n * @returns {number}\n */\nexport function getWidth(bounds, overrides = {}) {\n  return has(overrides, 'width') ? overrides.width : bounds.width;\n}\n\n/**\n * Get height from element or overrides.\n *\n * @param {Dimensions|Rect|ShapeLike} bounds\n * @param {Object} overrides\n *\n * @returns {number}\n */\nexport function getHeight(bounds, overrides = {}) {\n  return has(overrides, 'height') ? overrides.height : bounds.height;\n}","import inherits from 'inherits-browser';\n\nimport {\n  assign,\n  forEach,\n  isObject\n} from 'min-dash';\n\nimport BaseRenderer from 'diagram-js/lib/draw/BaseRenderer';\n\nimport {\n  isExpanded,\n  isHorizontal,\n  isEventSubProcess\n} from '../util/DiUtil';\n\nimport {\n  getLabel,\n  isLabel\n} from '../util/LabelUtil';\n\nimport {\n  is\n} from '../util/ModelUtil';\n\nimport {\n  createLine\n} from 'diagram-js/lib/util/RenderUtil';\n\nimport {\n  isTypedEvent,\n  isThrowEvent,\n  isCollection,\n  getBounds,\n  getDi,\n  getSemantic,\n  getCirclePath,\n  getRoundRectPath,\n  getDiamondPath,\n  getRectPath,\n  getFillColor,\n  getStrokeColor,\n  getLabelColor,\n  getHeight,\n  getWidth\n} from './BpmnRenderUtil';\n\nimport {\n  query as domQuery\n} from 'min-dom';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  classes as svgClasses\n} from 'tiny-svg';\n\nimport {\n  rotate,\n  transform,\n  translate\n} from 'diagram-js/lib/util/SvgTransformUtil';\n\nimport { Ids } from 'ids';\n\nimport { black } from './BpmnRenderUtil';\n\nvar markerIds = new Ids();\n\nvar ELEMENT_LABEL_DISTANCE = 10,\n    INNER_OUTER_DIST = 3,\n    PARTICIPANT_STROKE_WIDTH = 1.5,\n    TASK_BORDER_RADIUS = 10,\n    EXTERNAL_LABEL_BORDER_RADIUS = 4;\n\nvar DEFAULT_OPACITY = 0.95,\n    FULL_OPACITY = 1,\n    LOW_OPACITY = 0.25;\n\n/**\n * @typedef { Partial<{\n *   defaultFillColor: string,\n *   defaultStrokeColor: string,\n *   defaultLabelColor: string\n * }> } BpmnRendererConfig\n *\n * @typedef { Partial<{\n *   fill: string,\n *   stroke: string,\n *   width: string,\n *   height: string\n * }> } Attrs\n */\n\n/**\n * @typedef { import('../model/Types').Element } Element\n * @typedef { import('../model/Types').Shape } Shape\n * @typedef { import('../model/Types').Connection } Connection\n */\n\n/**\n * A renderer for BPMN elements\n *\n * @param {BpmnRendererConfig} config\n * @param {import('diagram-js/lib/core/EventBus').default} eventBus\n * @param {import('diagram-js/lib/draw/Styles').default} styles\n * @param {import('./PathMap').default} pathMap\n * @param {import('diagram-js/lib/core/Canvas').default} canvas\n * @param {import('./TextRenderer').default} textRenderer\n * @param {number} [priority]\n */\nexport default function BpmnRenderer(\n    config, eventBus, styles, pathMap,\n    canvas, textRenderer, priority) {\n\n  BaseRenderer.call(this, eventBus, priority);\n\n  var defaultFillColor = config && config.defaultFillColor,\n      defaultStrokeColor = config && config.defaultStrokeColor,\n      defaultLabelColor = config && config.defaultLabelColor;\n\n  function shapeStyle(attrs) {\n    return styles.computeStyle(attrs, {\n      strokeLinecap: 'round',\n      strokeLinejoin: 'round',\n      stroke: black,\n      strokeWidth: 2,\n      fill: 'white'\n    });\n  }\n\n  function lineStyle(attrs) {\n    return styles.computeStyle(attrs, [ 'no-fill' ], {\n      strokeLinecap: 'round',\n      strokeLinejoin: 'round',\n      stroke: black,\n      strokeWidth: 2\n    });\n  }\n\n  function addMarker(id, options) {\n    var {\n      ref = { x: 0, y: 0 },\n      scale = 1,\n      element,\n      parentGfx = canvas._svg\n    } = options;\n\n    var marker = svgCreate('marker', {\n      id: id,\n      viewBox: '0 0 20 20',\n      refX: ref.x,\n      refY: ref.y,\n      markerWidth: 20 * scale,\n      markerHeight: 20 * scale,\n      orient: 'auto'\n    });\n\n    svgAppend(marker, element);\n\n    var defs = domQuery(':scope > defs', parentGfx);\n\n    if (!defs) {\n      defs = svgCreate('defs');\n\n      svgAppend(parentGfx, defs);\n    }\n\n    svgAppend(defs, marker);\n  }\n\n  function marker(parentGfx, type, fill, stroke) {\n\n\n    var id = markerIds.nextPrefixed('marker-');\n\n    createMarker(parentGfx, id, type, fill, stroke);\n\n    return 'url(#' + id + ')';\n  }\n\n  function createMarker(parentGfx, id, type, fill, stroke) {\n\n    if (type === 'sequenceflow-end') {\n      var sequenceflowEnd = svgCreate('path', {\n        d: 'M 1 5 L 11 10 L 1 15 Z',\n        ...shapeStyle({\n          fill: stroke,\n          stroke: stroke,\n          strokeWidth: 1\n        })\n      });\n\n      addMarker(id, {\n        element: sequenceflowEnd,\n        ref: { x: 11, y: 10 },\n        scale: 0.5,\n        parentGfx\n      });\n    }\n\n    if (type === 'messageflow-start') {\n      var messageflowStart = svgCreate('circle', {\n        cx: 6,\n        cy: 6,\n        r: 3.5,\n        ...shapeStyle({\n          fill,\n          stroke: stroke,\n          strokeWidth: 1,\n\n          // fix for safari / chrome / firefox bug not correctly\n          // resetting stroke dash array\n          strokeDasharray: [ 10000, 1 ]\n        })\n      });\n\n      addMarker(id, {\n        element: messageflowStart,\n        ref: { x: 6, y: 6 },\n        parentGfx\n      });\n    }\n\n    if (type === 'messageflow-end') {\n      var messageflowEnd = svgCreate('path', {\n        d: 'm 1 5 l 0 -3 l 7 3 l -7 3 z',\n        ...shapeStyle({\n          fill,\n          stroke: stroke,\n          strokeWidth: 1,\n\n          // fix for safari / chrome / firefox bug not correctly\n          // resetting stroke dash array\n          strokeDasharray: [ 10000, 1 ]\n        })\n      });\n\n      addMarker(id, {\n        element: messageflowEnd,\n        ref: { x: 8.5, y: 5 },\n        parentGfx\n      });\n    }\n\n    if (type === 'association-start') {\n      var associationStart = svgCreate('path', {\n        d: 'M 11 5 L 1 10 L 11 15',\n        ...lineStyle({\n          fill: 'none',\n          stroke,\n          strokeWidth: 1.5,\n\n          // fix for safari / chrome / firefox bug not correctly\n          // resetting stroke dash array\n          strokeDasharray: [ 10000, 1 ]\n        })\n      });\n\n      addMarker(id, {\n        element: associationStart,\n        ref: { x: 1, y: 10 },\n        scale: 0.5,\n        parentGfx\n      });\n    }\n\n    if (type === 'association-end') {\n      var associationEnd = svgCreate('path', {\n        d: 'M 1 5 L 11 10 L 1 15',\n        ...lineStyle({\n          fill: 'none',\n          stroke,\n          strokeWidth: 1.5,\n\n          // fix for safari / chrome / firefox bug not correctly\n          // resetting stroke dash array\n          strokeDasharray: [ 10000, 1 ]\n        })\n      });\n\n      addMarker(id, {\n        element: associationEnd,\n        ref: { x: 11, y: 10 },\n        scale: 0.5,\n        parentGfx\n      });\n    }\n\n    if (type === 'conditional-flow-marker') {\n      var conditionalFlowMarker = svgCreate('path', {\n        d: 'M 0 10 L 8 6 L 16 10 L 8 14 Z',\n        ...shapeStyle({\n          fill,\n          stroke: stroke\n        })\n      });\n\n      addMarker(id, {\n        element: conditionalFlowMarker,\n        ref: { x: -1, y: 10 },\n        scale: 0.5,\n        parentGfx\n      });\n    }\n\n    if (type === 'conditional-default-flow-marker') {\n      var defaultFlowMarker = svgCreate('path', {\n        d: 'M 6 4 L 10 16',\n        ...shapeStyle({\n          stroke: stroke,\n          fill: 'none'\n        })\n      });\n\n      addMarker(id, {\n        element: defaultFlowMarker,\n        ref: { x: 0, y: 10 },\n        scale: 0.5,\n        parentGfx\n      });\n    }\n  }\n\n  function drawCircle(parentGfx, width, height, offset, attrs = {}) {\n\n    if (isObject(offset)) {\n      attrs = offset;\n      offset = 0;\n    }\n\n    offset = offset || 0;\n\n    attrs = shapeStyle(attrs);\n\n    var cx = width / 2,\n        cy = height / 2;\n\n    var circle = svgCreate('circle', {\n      cx: cx,\n      cy: cy,\n      r: Math.round((width + height) / 4 - offset),\n      ...attrs\n    });\n\n    svgAppend(parentGfx, circle);\n\n    return circle;\n  }\n\n  function drawRect(parentGfx, width, height, r, offset, attrs) {\n\n    if (isObject(offset)) {\n      attrs = offset;\n      offset = 0;\n    }\n\n    offset = offset || 0;\n\n    attrs = shapeStyle(attrs);\n\n    var rect = svgCreate('rect', {\n      x: offset,\n      y: offset,\n      width: width - offset * 2,\n      height: height - offset * 2,\n      rx: r,\n      ry: r,\n      ...attrs\n    });\n\n    svgAppend(parentGfx, rect);\n\n    return rect;\n  }\n\n  function drawDiamond(parentGfx, width, height, attrs) {\n\n    var x_2 = width / 2;\n    var y_2 = height / 2;\n\n    var points = [\n      { x: x_2, y: 0 },\n      { x: width, y: y_2 },\n      { x: x_2, y: height },\n      { x: 0, y: y_2 }\n    ];\n\n    var pointsString = points.map(function(point) {\n      return point.x + ',' + point.y;\n    }).join(' ');\n\n    attrs = shapeStyle(attrs);\n\n    var polygon = svgCreate('polygon', {\n      ...attrs,\n      points: pointsString\n    });\n\n    svgAppend(parentGfx, polygon);\n\n    return polygon;\n  }\n\n  /**\n   * @param {SVGElement} parentGfx\n   * @param {Point[]} waypoints\n   * @param {any} attrs\n   * @param {number} [radius]\n   *\n   * @return {SVGElement}\n   */\n  function drawLine(parentGfx, waypoints, attrs, radius) {\n    attrs = lineStyle(attrs);\n\n    var line = createLine(waypoints, attrs, radius);\n\n    svgAppend(parentGfx, line);\n\n    return line;\n  }\n\n  /**\n   * @param {SVGElement} parentGfx\n   * @param {Point[]} waypoints\n   * @param {any} attrs\n   *\n   * @return {SVGElement}\n   */\n  function drawConnectionSegments(parentGfx, waypoints, attrs) {\n    return drawLine(parentGfx, waypoints, attrs, 5);\n  }\n\n  function drawPath(parentGfx, d, attrs) {\n    attrs = lineStyle(attrs);\n\n    var path = svgCreate('path', {\n      ...attrs,\n      d\n    });\n\n    svgAppend(parentGfx, path);\n\n    return path;\n  }\n\n  function drawMarker(type, parentGfx, path, attrs) {\n    return drawPath(parentGfx, path, assign({ 'data-marker': type }, attrs));\n  }\n\n  function renderer(type) {\n    return handlers[type];\n  }\n\n  function as(type) {\n    return function(parentGfx, element, attrs) {\n      return renderer(type)(parentGfx, element, attrs);\n    };\n  }\n\n  var eventIconRenderers = {\n    'bpmn:MessageEventDefinition': function(parentGfx, element, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_MESSAGE', {\n        xScaleFactor: 0.9,\n        yScaleFactor: 0.9,\n        containerWidth: attrs.width || element.width,\n        containerHeight: attrs.height || element.height,\n        position: {\n          mx: 0.235,\n          my: 0.315\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n        : getFillColor(element, defaultFillColor, attrs.fill);\n\n      var stroke = isThrowing\n        ? getFillColor(element, defaultFillColor, attrs.fill)\n        : getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n      var messagePath = drawPath(parentGfx, pathData, {\n        fill,\n        stroke,\n        strokeWidth: 1\n      });\n\n      return messagePath;\n    },\n    'bpmn:TimerEventDefinition': function(parentGfx, element, attrs = {}) {\n      var baseWidth = attrs.width || element.width;\n      var baseHeight = attrs.height || element.height;\n\n      // use a lighter stroke for event suprocess icons\n      var strokeWidth = attrs.width ? 1 : 2;\n\n      var circle = drawCircle(parentGfx, baseWidth, baseHeight, 0.2 * baseHeight, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: strokeWidth\n      });\n\n      var pathData = pathMap.getScaledPath('EVENT_TIMER_WH', {\n        xScaleFactor: 0.75,\n        yScaleFactor: 0.75,\n        containerWidth: baseWidth,\n        containerHeight: baseHeight,\n        position: {\n          mx: 0.5,\n          my: 0.5\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: strokeWidth\n      });\n\n      for (var i = 0; i < 12; i++) {\n        var linePathData = pathMap.getScaledPath('EVENT_TIMER_LINE', {\n          xScaleFactor: 0.75,\n          yScaleFactor: 0.75,\n          containerWidth: baseWidth,\n          containerHeight: baseHeight,\n          position: {\n            mx: 0.5,\n            my: 0.5\n          }\n        });\n\n        var width = baseWidth / 2,\n            height = baseHeight / 2;\n\n        drawPath(parentGfx, linePathData, {\n          strokeWidth: 1,\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          transform: 'rotate(' + (i * 30) + ',' + height + ',' + width + ')'\n        });\n      }\n\n      return circle;\n    },\n    'bpmn:EscalationEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_ESCALATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: attrs.width || event.width,\n        containerHeight: attrs.height || event.height,\n        position: {\n          mx: 0.5,\n          my: 0.2\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:ConditionalEventDefinition': function(parentGfx, event, attrs = {}) {\n      var pathData = pathMap.getScaledPath('EVENT_CONDITIONAL', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: attrs.width || event.width,\n        containerHeight: attrs.height || event.height,\n        position: {\n          mx: 0.5,\n          my: 0.222\n        }\n      });\n\n      return drawPath(parentGfx, pathData, {\n        fill: getFillColor(event, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:LinkEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_LINK', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.57,\n          my: 0.263\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:ErrorEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_ERROR', {\n        xScaleFactor: 1.1,\n        yScaleFactor: 1.1,\n        containerWidth: attrs.width || event.width,\n        containerHeight: attrs.height || event.height,\n        position: {\n          mx: 0.2,\n          my: 0.722\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:CancelEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_CANCEL_45', {\n        xScaleFactor: 1.0,\n        yScaleFactor: 1.0,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.638,\n          my: -0.055\n        }\n      });\n\n      var fill = isThrowing ? getStrokeColor(event, defaultStrokeColor, attrs.stroke) : 'none';\n\n      var path = drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      rotate(path, 45);\n\n      return path;\n    },\n    'bpmn:CompensateEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_COMPENSATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: attrs.width || event.width,\n        containerHeight: attrs.height || event.height,\n        position: {\n          mx: 0.22,\n          my: 0.5\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:SignalEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_SIGNAL', {\n        xScaleFactor: 0.9,\n        yScaleFactor: 0.9,\n        containerWidth: attrs.width || event.width,\n        containerHeight: attrs.height || event.height,\n        position: {\n          mx: 0.5,\n          my: 0.2\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'bpmn:MultipleEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_MULTIPLE', {\n        xScaleFactor: 1.1,\n        yScaleFactor: 1.1,\n        containerWidth: attrs.width || event.width,\n        containerHeight: attrs.height || event.height,\n        position: {\n          mx: 0.211,\n          my: 0.36\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:ParallelMultipleEventDefinition': function(parentGfx, event, attrs = {}) {\n      var pathData = pathMap.getScaledPath('EVENT_PARALLEL_MULTIPLE', {\n        xScaleFactor: 1.2,\n        yScaleFactor: 1.2,\n        containerWidth: attrs.width || event.width,\n        containerHeight: attrs.height || event.height,\n        position: {\n          mx: 0.458,\n          my: 0.194\n        }\n      });\n\n      return drawPath(parentGfx, pathData, {\n        fill: getFillColor(event, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:TerminateEventDefinition': function(parentGfx, element, attrs = {}) {\n      var circle = drawCircle(parentGfx, element.width, element.height, 8, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 4\n      });\n\n      return circle;\n    }\n  };\n\n  function renderEventIcon(element, parentGfx, attrs = {}, proxyElement) {\n    var semantic = getSemantic(element),\n        isThrowing = isThrowEvent(semantic);\n\n    var nodeElement = proxyElement || element;\n\n    if (semantic.get('eventDefinitions') && semantic.get('eventDefinitions').length > 1) {\n      if (semantic.get('parallelMultiple')) {\n        return eventIconRenderers[ 'bpmn:ParallelMultipleEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n      }\n      else {\n        return eventIconRenderers[ 'bpmn:MultipleEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n      }\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:MessageEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:MessageEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:TimerEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:TimerEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:ConditionalEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:ConditionalEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:SignalEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:SignalEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:EscalationEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:EscalationEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:LinkEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:LinkEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:ErrorEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:ErrorEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:CancelEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:CancelEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:CompensateEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:CompensateEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:TerminateEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:TerminateEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    return null;\n  }\n\n  var taskMarkerRenderers = {\n    'ParticipantMultiplicityMarker': function(parentGfx, element, attrs = {}) {\n      var width = getWidth(element, attrs),\n          height = getHeight(element, attrs);\n\n      var markerPath = pathMap.getScaledPath('MARKER_PARALLEL', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: ((width / 2 - 6) / width),\n          my: (height - 15) / height\n        }\n      });\n\n      drawMarker('participant-multiplicity', parentGfx, markerPath, {\n        strokeWidth: 2,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'SubProcessMarker': function(parentGfx, element, attrs = {}) {\n      var markerRect = drawRect(parentGfx, 14, 14, 0, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n\n      translate(markerRect, element.width / 2 - 7.5, element.height - 20);\n\n      var markerPath = pathMap.getScaledPath('MARKER_SUB_PROCESS', {\n        xScaleFactor: 1.5,\n        yScaleFactor: 1.5,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: (element.width / 2 - 7.5) / element.width,\n          my: (element.height - 20) / element.height\n        }\n      });\n\n      drawMarker('sub-process', parentGfx, markerPath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'ParallelMarker': function(parentGfx, element, attrs) {\n      var width = getWidth(element, attrs),\n          height = getHeight(element, attrs);\n\n      var markerPath = pathMap.getScaledPath('MARKER_PARALLEL', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: ((width / 2 + attrs.parallel) / width),\n          my: (height - 20) / height\n        }\n      });\n\n      drawMarker('parallel', parentGfx, markerPath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'SequentialMarker': function(parentGfx, element, attrs) {\n      var markerPath = pathMap.getScaledPath('MARKER_SEQUENTIAL', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: ((element.width / 2 + attrs.seq) / element.width),\n          my: (element.height - 19) / element.height\n        }\n      });\n\n      drawMarker('sequential', parentGfx, markerPath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'CompensationMarker': function(parentGfx, element, attrs) {\n      var markerMath = pathMap.getScaledPath('MARKER_COMPENSATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: ((element.width / 2 + attrs.compensation) / element.width),\n          my: (element.height - 13) / element.height\n        }\n      });\n\n      drawMarker('compensation', parentGfx, markerMath, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'LoopMarker': function(parentGfx, element, attrs) {\n      var width = getWidth(element, attrs),\n          height = getHeight(element, attrs);\n\n      var markerPath = pathMap.getScaledPath('MARKER_LOOP', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: ((width / 2 + attrs.loop) / width),\n          my: (height - 7) / height\n        }\n      });\n\n      drawMarker('loop', parentGfx, markerPath, {\n        strokeWidth: 1.5,\n        fill: 'none',\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeMiterlimit: 0.5\n      });\n    },\n    'AdhocMarker': function(parentGfx, element, attrs) {\n      var width = getWidth(element, attrs),\n          height = getHeight(element, attrs);\n\n      var markerPath = pathMap.getScaledPath('MARKER_ADHOC', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: ((width / 2 + attrs.adhoc) / width),\n          my: (height - 15) / height\n        }\n      });\n\n      drawMarker('adhoc', parentGfx, markerPath, {\n        strokeWidth: 1,\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    }\n  };\n\n  function renderTaskMarker(type, parentGfx, element, attrs) {\n    taskMarkerRenderers[ type ](parentGfx, element, attrs);\n  }\n\n  function renderTaskMarkers(parentGfx, element, taskMarkers = [], attrs = {}) {\n    attrs = {\n      fill: attrs.fill,\n      stroke: attrs.stroke,\n      width: getWidth(element, attrs),\n      height: getHeight(element, attrs)\n    };\n\n    var semantic = getSemantic(element);\n\n    var subprocess = taskMarkers.includes('SubProcessMarker');\n\n    if (subprocess) {\n      attrs = {\n        ...attrs,\n        seq: -21,\n        parallel: -22,\n        compensation: -25,\n        loop: -18,\n        adhoc: 10\n      };\n    } else {\n      attrs = {\n        ...attrs,\n        seq: -5,\n        parallel: -6,\n        compensation: -7,\n        loop: 0,\n        adhoc: -8\n      };\n    }\n\n    if (semantic.get('isForCompensation')) {\n      taskMarkers.push('CompensationMarker');\n    }\n\n    if (is(semantic, 'bpmn:AdHocSubProcess')) {\n      taskMarkers.push('AdhocMarker');\n\n      if (!subprocess) {\n        assign(attrs, { compensation: attrs.compensation - 18 });\n      }\n    }\n\n    var loopCharacteristics = semantic.get('loopCharacteristics'),\n        isSequential = loopCharacteristics && loopCharacteristics.get('isSequential');\n\n    if (loopCharacteristics) {\n\n      assign(attrs, {\n        compensation: attrs.compensation - 18,\n      });\n\n      if (taskMarkers.includes('AdhocMarker')) {\n        assign(attrs, {\n          seq: -23,\n          loop: -18,\n          parallel: -24\n        });\n      }\n\n      if (isSequential === undefined) {\n        taskMarkers.push('LoopMarker');\n      }\n\n      if (isSequential === false) {\n        taskMarkers.push('ParallelMarker');\n      }\n\n      if (isSequential === true) {\n        taskMarkers.push('SequentialMarker');\n      }\n    }\n\n    if (taskMarkers.includes('CompensationMarker') && taskMarkers.length === 1) {\n      assign(attrs, {\n        compensation: -8\n      });\n    }\n\n    forEach(taskMarkers, function(marker) {\n      renderTaskMarker(marker, parentGfx, element, attrs);\n    });\n  }\n\n  function renderLabel(parentGfx, label, attrs = {}) {\n    attrs = assign({\n      size: {\n        width: 100\n      }\n    }, attrs);\n\n    var text = textRenderer.createText(label || '', attrs);\n\n    svgClasses(text).add('djs-label');\n\n    svgAppend(parentGfx, text);\n\n    return text;\n  }\n\n  function renderEmbeddedLabel(parentGfx, element, align, attrs = {}) {\n    var semantic = getSemantic(element);\n\n    var box = getBounds({\n      x: element.x,\n      y: element.y,\n      width: element.width,\n      height: element.height\n    }, attrs);\n\n    return renderLabel(parentGfx, semantic.name, {\n      align,\n      box,\n      padding: 7,\n      style: {\n        fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n      }\n    });\n  }\n\n  function renderExternalLabel(parentGfx, element, attrs = {}) {\n    var box = {\n      width: 90,\n      height: 30,\n      x: element.width / 2 + element.x,\n      y: element.height / 2 + element.y\n    };\n\n    return renderLabel(parentGfx, getLabel(element), {\n      box: box,\n      fitBox: true,\n      style: assign(\n        {},\n        textRenderer.getExternalStyle(),\n        {\n          fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n        }\n      )\n    });\n  }\n\n  function renderLaneLabel(parentGfx, text, element, attrs = {}) {\n    var isHorizontalLane = isHorizontal(element);\n\n    var textBox = renderLabel(parentGfx, text, {\n      box: {\n        height: 30,\n        width: isHorizontalLane ? getHeight(element, attrs) : getWidth(element, attrs),\n      },\n      align: 'center-middle',\n      style: {\n        fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n      }\n    });\n\n    if (isHorizontalLane) {\n      var top = -1 * getHeight(element, attrs);\n      transform(textBox, 0, -top, 270);\n    }\n  }\n\n  function renderActivity(parentGfx, element, attrs = {}) {\n    var {\n      width,\n      height\n    } = getBounds(element, attrs);\n\n    return drawRect(parentGfx, width, height, TASK_BORDER_RADIUS, {\n      ...attrs,\n      fill: getFillColor(element, defaultFillColor, attrs.fill),\n      fillOpacity: DEFAULT_OPACITY,\n      stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n    });\n  }\n\n  function renderAssociation(parentGfx, element, attrs = {}) {\n    var semantic = getSemantic(element);\n\n    var fill = getFillColor(element, defaultFillColor, attrs.fill),\n        stroke = getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n    if (semantic.get('associationDirection') === 'One' ||\n        semantic.get('associationDirection') === 'Both') {\n      attrs.markerEnd = marker(parentGfx, 'association-end', fill, stroke);\n    }\n\n    if (semantic.get('associationDirection') === 'Both') {\n      attrs.markerStart = marker(parentGfx, 'association-start', fill, stroke);\n    }\n\n    attrs = pickAttrs(attrs, [\n      'markerStart',\n      'markerEnd'\n    ]);\n\n    return drawConnectionSegments(parentGfx, element.waypoints, {\n      ...attrs,\n      stroke,\n      strokeDasharray: '0, 5'\n    });\n  }\n\n  function renderDataObject(parentGfx, element, attrs = {}) {\n    var fill = getFillColor(element, defaultFillColor, attrs.fill),\n        stroke = getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n    var pathData = pathMap.getScaledPath('DATA_OBJECT_PATH', {\n      xScaleFactor: 1,\n      yScaleFactor: 1,\n      containerWidth: element.width,\n      containerHeight: element.height,\n      position: {\n        mx: 0.474,\n        my: 0.296\n      }\n    });\n\n    var dataObject = drawPath(parentGfx, pathData, {\n      fill,\n      fillOpacity: DEFAULT_OPACITY,\n      stroke\n    });\n\n    var semantic = getSemantic(element);\n\n    if (isCollection(semantic)) {\n      var collectionPathData = pathMap.getScaledPath('DATA_OBJECT_COLLECTION_PATH', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.33,\n          my: (element.height - 18) / element.height\n        }\n      });\n\n      drawPath(parentGfx, collectionPathData, {\n        strokeWidth: 2,\n        fill,\n        stroke\n      });\n    }\n\n    return dataObject;\n  }\n\n  function renderEvent(parentGfx, element, attrs = {}) {\n    return drawCircle(parentGfx, element.width, element.height, {\n      fillOpacity: DEFAULT_OPACITY,\n      ...attrs,\n      fill: getFillColor(element, defaultFillColor, attrs.fill),\n      stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n    });\n  }\n\n  function renderGateway(parentGfx, element, attrs = {}) {\n    return drawDiamond(parentGfx, element.width, element.height, {\n      fill: getFillColor(element, defaultFillColor, attrs.fill),\n      fillOpacity: DEFAULT_OPACITY,\n      stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n    });\n  }\n\n  function renderLane(parentGfx, element, attrs = {}) {\n    var lane = drawRect(parentGfx, getWidth(element, attrs), getHeight(element, attrs), 0, {\n      fill: getFillColor(element, defaultFillColor, attrs.fill),\n      fillOpacity: attrs.fillOpacity || DEFAULT_OPACITY,\n      stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n      strokeWidth: 1.5\n    });\n\n    var semantic = getSemantic(element);\n\n    if (is(semantic, 'bpmn:Lane')) {\n      var text = semantic.get('name');\n\n      renderLaneLabel(parentGfx, text, element, attrs);\n    }\n\n    return lane;\n  }\n\n  function renderSubProcess(parentGfx, element, attrs = {}) {\n    var activity = renderActivity(parentGfx, element, attrs);\n\n    var expanded = isExpanded(element);\n\n    if (isEventSubProcess(element)) {\n      svgAttr(activity, {\n        strokeDasharray: '0, 5.5',\n        strokeWidth: 2.5\n      });\n\n      if (!expanded) {\n        var flowElements = getSemantic(element).flowElements || [];\n        var startEvents = flowElements.filter(e => is(e, 'bpmn:StartEvent'));\n\n        if (startEvents.length === 1) {\n          renderEventSubProcessIcon(startEvents[0], parentGfx, attrs, element);\n        }\n      }\n    }\n\n    renderEmbeddedLabel(parentGfx, element, expanded ? 'center-top' : 'center-middle', attrs);\n\n    if (expanded) {\n      renderTaskMarkers(parentGfx, element, undefined, attrs);\n    } else {\n      renderTaskMarkers(parentGfx, element, [ 'SubProcessMarker' ], attrs);\n    }\n\n    return activity;\n  }\n\n  function renderEventSubProcessIcon(startEvent, parentGfx, attrs, proxyElement) {\n    var iconSize = 22;\n\n    // match the colors of the enclosing subprocess\n    var proxyAttrs = {\n      fill: getFillColor(proxyElement, defaultFillColor, attrs.fill),\n      stroke: getStrokeColor(proxyElement, defaultStrokeColor, attrs.stroke),\n      width: iconSize,\n      height: iconSize\n    };\n\n    var interrupting = getSemantic(startEvent).isInterrupting;\n    var strokeDasharray = interrupting ? 0 : 3;\n\n    // better visibility for non-interrupting events\n    var strokeWidth = interrupting ? 1 : 1.2;\n\n    // make the icon look larger by drawing a smaller circle\n    var circleSize = 20;\n    var shift = (iconSize - circleSize) / 2;\n    var transform = 'translate(' + shift + ',' + shift + ')';\n\n    drawCircle(parentGfx, circleSize, circleSize, {\n      fill: proxyAttrs.fill,\n      stroke: proxyAttrs.stroke,\n      strokeWidth,\n      strokeDasharray,\n      transform\n    });\n\n    renderEventIcon(startEvent, parentGfx, proxyAttrs, proxyElement);\n  }\n\n  function renderTask(parentGfx, element, attrs = {}) {\n    var activity = renderActivity(parentGfx, element, attrs);\n\n    renderEmbeddedLabel(parentGfx, element, 'center-middle', attrs);\n\n    renderTaskMarkers(parentGfx, element, undefined, attrs);\n\n    return activity;\n  }\n\n  var handlers = this.handlers = {\n    'bpmn:AdHocSubProcess': function(parentGfx, element, attrs = {}) {\n      if (isExpanded(element)) {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke',\n          'width',\n          'height'\n        ]);\n      } else {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke'\n        ]);\n      }\n\n      return renderSubProcess(parentGfx, element, attrs);\n    },\n    'bpmn:Association': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderAssociation(parentGfx, element, attrs);\n    },\n    'bpmn:BoundaryEvent': function(parentGfx, element, attrs = {}) {\n      var { renderIcon = true } = attrs;\n\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element),\n          cancelActivity = semantic.get('cancelActivity');\n\n      attrs = {\n        strokeWidth: 1.5,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        fillOpacity: FULL_OPACITY,\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      };\n\n      if (!cancelActivity) {\n        attrs.strokeDasharray = '6';\n      }\n\n      var event = renderEvent(parentGfx, element, attrs);\n\n      drawCircle(parentGfx, element.width, element.height, INNER_OUTER_DIST, {\n        ...attrs,\n        fill: 'none'\n      });\n\n      if (renderIcon) {\n        renderEventIcon(element, parentGfx, attrs);\n      }\n\n      return event;\n    },\n    'bpmn:BusinessRuleTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var headerData = pathMap.getScaledPath('TASK_TYPE_BUSINESS_RULE_MAIN', {\n        abspos: {\n          x: 8,\n          y: 8\n        }\n      });\n\n      var businessPath = drawPath(parentGfx, headerData);\n\n      svgAttr(businessPath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      var headerPathData = pathMap.getScaledPath('TASK_TYPE_BUSINESS_RULE_HEADER', {\n        abspos: {\n          x: 8,\n          y: 8\n        }\n      });\n\n      var businessHeaderPath = drawPath(parentGfx, headerPathData);\n\n      svgAttr(businessHeaderPath, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:CallActivity': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderSubProcess(parentGfx, element, {\n        strokeWidth: 5,\n        ...attrs\n      });\n    },\n    'bpmn:ComplexGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var gateway = renderGateway(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('GATEWAY_COMPLEX', {\n        xScaleFactor: 0.5,\n        yScaleFactor:0.5,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.46,\n          my: 0.26\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return gateway;\n    },\n    'bpmn:DataInput': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var arrowPathData = pathMap.getRawPath('DATA_ARROW');\n\n      var dataObject = renderDataObject(parentGfx, element, attrs);\n\n      drawPath(parentGfx, arrowPathData, {\n        fill: 'none',\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return dataObject;\n    },\n    'bpmn:DataInputAssociation': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderAssociation(parentGfx, element, {\n        ...attrs,\n        markerEnd: marker(parentGfx, 'association-end', getFillColor(element, defaultFillColor, attrs.fill), getStrokeColor(element, defaultStrokeColor, attrs.stroke))\n      });\n    },\n    'bpmn:DataObject': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderDataObject(parentGfx, element, attrs);\n    },\n    'bpmn:DataObjectReference': as('bpmn:DataObject'),\n    'bpmn:DataOutput': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var arrowPathData = pathMap.getRawPath('DATA_ARROW');\n\n      var dataObject = renderDataObject(parentGfx, element, attrs);\n\n      drawPath(parentGfx, arrowPathData, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n\n      return dataObject;\n    },\n    'bpmn:DataOutputAssociation': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderAssociation(parentGfx, element, {\n        ...attrs,\n        markerEnd: marker(parentGfx, 'association-end', getFillColor(element, defaultFillColor, attrs.fill), getStrokeColor(element, defaultStrokeColor, attrs.stroke))\n      });\n    },\n    'bpmn:DataStoreReference': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var dataStorePath = pathMap.getScaledPath('DATA_STORE', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0,\n          my: 0.133\n        }\n      });\n\n      return drawPath(parentGfx, dataStorePath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        fillOpacity: DEFAULT_OPACITY,\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 2\n      });\n    },\n    'bpmn:EndEvent': function(parentGfx, element, attrs = {}) {\n      var { renderIcon = true } = attrs;\n\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var event = renderEvent(parentGfx, element, {\n        ...attrs,\n        strokeWidth: 4\n      });\n\n      if (renderIcon) {\n        renderEventIcon(element, parentGfx, attrs);\n      }\n\n      return event;\n    },\n    'bpmn:EventBasedGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element);\n\n      var diamond = renderGateway(parentGfx, element, attrs);\n\n      drawCircle(parentGfx, element.width, element.height, element.height * 0.20, {\n        fill: getFillColor(element, 'none', attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      var type = semantic.get('eventGatewayType'),\n          instantiate = !!semantic.get('instantiate');\n\n      function drawEvent() {\n\n        var pathData = pathMap.getScaledPath('GATEWAY_EVENT_BASED', {\n          xScaleFactor: 0.18,\n          yScaleFactor: 0.18,\n          containerWidth: element.width,\n          containerHeight: element.height,\n          position: {\n            mx: 0.36,\n            my: 0.44\n          }\n        });\n\n        drawPath(parentGfx, pathData, {\n          fill: 'none',\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: 2\n        });\n      }\n\n      if (type === 'Parallel') {\n        var pathData = pathMap.getScaledPath('GATEWAY_PARALLEL', {\n          xScaleFactor: 0.4,\n          yScaleFactor: 0.4,\n          containerWidth: element.width,\n          containerHeight: element.height,\n          position: {\n            mx: 0.474,\n            my: 0.296\n          }\n        });\n\n        drawPath(parentGfx, pathData, {\n          fill: 'none',\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: 1\n        });\n      } else if (type === 'Exclusive') {\n        if (!instantiate) {\n          drawCircle(parentGfx, element.width, element.height, element.height * 0.26, {\n            fill: 'none',\n            stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n            strokeWidth: 1\n          });\n        }\n\n        drawEvent();\n      }\n\n\n      return diamond;\n    },\n    'bpmn:ExclusiveGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var gateway = renderGateway(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('GATEWAY_EXCLUSIVE', {\n        xScaleFactor: 0.4,\n        yScaleFactor: 0.4,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.32,\n          my: 0.3\n        }\n      });\n\n      var di = getDi(element);\n\n      if (di.get('isMarkerVisible')) {\n        drawPath(parentGfx, pathData, {\n          fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: 1\n        });\n      }\n\n      return gateway;\n    },\n    'bpmn:Gateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderGateway(parentGfx, element, attrs);\n    },\n    'bpmn:Group': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke',\n        'width',\n        'height'\n      ]);\n\n      return drawRect(parentGfx, element.width, element.height, TASK_BORDER_RADIUS, {\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1.5,\n        strokeDasharray: '10, 6, 0, 6',\n        fill: 'none',\n        pointerEvents: 'none',\n        width: getWidth(element, attrs),\n        height: getHeight(element, attrs)\n      });\n    },\n    'bpmn:InclusiveGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var gateway = renderGateway(parentGfx, element, attrs);\n\n      drawCircle(parentGfx, element.width, element.height, element.height * 0.24, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 2.5\n      });\n\n      return gateway;\n    },\n    'bpmn:IntermediateEvent': function(parentGfx, element, attrs = {}) {\n      var { renderIcon = true } = attrs;\n\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var outer = renderEvent(parentGfx, element, {\n        ...attrs,\n        strokeWidth: 1.5\n      });\n\n      drawCircle(parentGfx, element.width, element.height, INNER_OUTER_DIST, {\n        fill: 'none',\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1.5\n      });\n\n      if (renderIcon) {\n        renderEventIcon(element, parentGfx, attrs);\n      }\n\n      return outer;\n    },\n    'bpmn:IntermediateCatchEvent': as('bpmn:IntermediateEvent'),\n    'bpmn:IntermediateThrowEvent': as('bpmn:IntermediateEvent'),\n    'bpmn:Lane': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke',\n        'width',\n        'height'\n      ]);\n\n      return renderLane(parentGfx, element, {\n        ...attrs,\n        fillOpacity: LOW_OPACITY\n      });\n    },\n    'bpmn:ManualTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('TASK_TYPE_MANUAL', {\n        abspos: {\n          x: 17,\n          y: 15\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 0.5\n      });\n\n      return task;\n    },\n    'bpmn:MessageFlow': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element),\n          di = getDi(element);\n\n      var fill = getFillColor(element, defaultFillColor, attrs.fill),\n          stroke = getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n      var path = drawConnectionSegments(parentGfx, element.waypoints, {\n        markerEnd: marker(parentGfx, 'messageflow-end', fill, stroke),\n        markerStart: marker(parentGfx, 'messageflow-start', fill, stroke),\n        stroke,\n        strokeDasharray: '10, 11',\n        strokeWidth: 1.5\n      });\n\n      if (semantic.get('messageRef')) {\n        var midPoint = path.getPointAtLength(path.getTotalLength() / 2);\n\n        var markerPathData = pathMap.getScaledPath('MESSAGE_FLOW_MARKER', {\n          abspos: {\n            x: midPoint.x,\n            y: midPoint.y\n          }\n        });\n\n        var messageAttrs = {\n          strokeWidth: 1\n        };\n\n        if (di.get('messageVisibleKind') === 'initiating') {\n          messageAttrs.fill = fill;\n          messageAttrs.stroke = stroke;\n        } else {\n          messageAttrs.fill = stroke;\n          messageAttrs.stroke = fill;\n        }\n\n        var message = drawPath(parentGfx, markerPathData, messageAttrs);\n\n        var messageRef = semantic.get('messageRef'),\n            name = messageRef.get('name');\n\n        var label = renderLabel(parentGfx, name, {\n          align: 'center-top',\n          fitBox: true,\n          style: {\n            fill: stroke\n          }\n        });\n\n        var messageBounds = message.getBBox(),\n            labelBounds = label.getBBox();\n\n        var translateX = midPoint.x - labelBounds.width / 2,\n            translateY = midPoint.y + messageBounds.height / 2 + ELEMENT_LABEL_DISTANCE;\n\n        transform(label, translateX, translateY, 0);\n      }\n\n      return path;\n    },\n    'bpmn:ParallelGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var diamond = renderGateway(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('GATEWAY_PARALLEL', {\n        xScaleFactor: 0.6,\n        yScaleFactor: 0.6,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.46,\n          my: 0.2\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return diamond;\n    },\n    'bpmn:Participant': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke',\n        'width',\n        'height'\n      ]);\n\n      var participant = renderLane(parentGfx, element, attrs);\n\n      var expandedParticipant = isExpanded(element);\n      var horizontalParticipant = isHorizontal(element);\n\n      var semantic = getSemantic(element),\n          name = semantic.get('name');\n\n      if (expandedParticipant) {\n        var waypoints = horizontalParticipant ? [\n          {\n            x: 30,\n            y: 0\n          },\n          {\n            x: 30,\n            y: getHeight(element, attrs)\n          }\n        ] : [\n          {\n            x: 0,\n            y: 30\n          },\n          {\n            x: getWidth(element, attrs),\n            y: 30\n          }\n        ];\n\n        drawLine(parentGfx, waypoints, {\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: PARTICIPANT_STROKE_WIDTH\n        });\n\n        renderLaneLabel(parentGfx, name, element, attrs);\n      } else {\n        var bounds = getBounds(element, attrs);\n\n        if (!horizontalParticipant) {\n          bounds.height = getWidth(element, attrs);\n          bounds.width = getHeight(element, attrs);\n        }\n\n        var textBox = renderLabel(parentGfx, name, {\n          box: bounds,\n          align: 'center-middle',\n          style: {\n            fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n          }\n        });\n\n        if (!horizontalParticipant) {\n          var top = -1 * getHeight(element, attrs);\n          transform(textBox, 0, -top, 270);\n        }\n      }\n\n      if (semantic.get('participantMultiplicity')) {\n        renderTaskMarker('ParticipantMultiplicityMarker', parentGfx, element, attrs);\n      }\n\n      return participant;\n    },\n    'bpmn:ReceiveTask' : function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var pathData;\n\n      if (semantic.get('instantiate')) {\n        drawCircle(parentGfx, 28, 28, 20 * 0.22, {\n          fill: getFillColor(element, defaultFillColor, attrs.fill),\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: 1\n        });\n\n        pathData = pathMap.getScaledPath('TASK_TYPE_INSTANTIATING_SEND', {\n          abspos: {\n            x: 7.77,\n            y: 9.52\n          }\n        });\n      } else {\n        pathData = pathMap.getScaledPath('TASK_TYPE_SEND', {\n          xScaleFactor: 0.9,\n          yScaleFactor: 0.9,\n          containerWidth: 21,\n          containerHeight: 14,\n          position: {\n            mx: 0.3,\n            my: 0.4\n          }\n        });\n      }\n\n      drawPath(parentGfx, pathData, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:ScriptTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('TASK_TYPE_SCRIPT', {\n        abspos: {\n          x: 15,\n          y: 20\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:SendTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('TASK_TYPE_SEND', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: 21,\n        containerHeight: 14,\n        position: {\n          mx: 0.285,\n          my: 0.357\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getFillColor(element, defaultFillColor, attrs.fill),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:SequenceFlow': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var fill = getFillColor(element, defaultFillColor, attrs.fill),\n          stroke = getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n      var connection = drawConnectionSegments(parentGfx, element.waypoints, {\n        markerEnd: marker(parentGfx, 'sequenceflow-end', fill, stroke),\n        stroke\n      });\n\n      var semantic = getSemantic(element);\n\n      var { source } = element;\n\n      if (source) {\n        var sourceSemantic = getSemantic(source);\n\n        // conditional flow marker\n        if (semantic.get('conditionExpression') && is(sourceSemantic, 'bpmn:Activity')) {\n          svgAttr(connection, {\n            markerStart: marker(parentGfx, 'conditional-flow-marker', fill, stroke)\n          });\n        }\n\n        // default marker\n        if (sourceSemantic.get('default') && (is(sourceSemantic, 'bpmn:Gateway') || is(sourceSemantic, 'bpmn:Activity')) &&\n            sourceSemantic.get('default') === semantic) {\n          svgAttr(connection, {\n            markerStart: marker(parentGfx, 'conditional-default-flow-marker', fill, stroke)\n          });\n        }\n      }\n\n      return connection;\n    },\n    'bpmn:ServiceTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      drawCircle(parentGfx, 10, 10, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: 'none',\n        transform: 'translate(6, 6)'\n      });\n\n      var pathDataService1 = pathMap.getScaledPath('TASK_TYPE_SERVICE', {\n        abspos: {\n          x: 12,\n          y: 18\n        }\n      });\n\n      drawPath(parentGfx, pathDataService1, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      drawCircle(parentGfx, 10, 10, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: 'none',\n        transform: 'translate(11, 10)'\n      });\n\n      var pathDataService2 = pathMap.getScaledPath('TASK_TYPE_SERVICE', {\n        abspos: {\n          x: 17,\n          y: 22\n        }\n      });\n\n      drawPath(parentGfx, pathDataService2, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:StartEvent': function(parentGfx, element, attrs = {}) {\n      var { renderIcon = true } = attrs;\n\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element);\n\n      if (!semantic.get('isInterrupting')) {\n        attrs = {\n          ...attrs,\n          strokeDasharray: '6'\n        };\n      }\n\n      var event = renderEvent(parentGfx, element, attrs);\n\n      if (renderIcon) {\n        renderEventIcon(element, parentGfx, attrs);\n      }\n\n      return event;\n    },\n    'bpmn:SubProcess': function(parentGfx, element, attrs = {}) {\n      if (isExpanded(element)) {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke',\n          'width',\n          'height'\n        ]);\n      } else {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke'\n        ]);\n      }\n\n      return renderSubProcess(parentGfx, element, attrs);\n    },\n    'bpmn:Task': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderTask(parentGfx, element, attrs);\n    },\n    'bpmn:TextAnnotation': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke',\n        'width',\n        'height'\n      ]);\n\n      var {\n        width,\n        height\n      } = getBounds(element, attrs);\n\n      var textElement = drawRect(parentGfx, width, height, 0, 0, {\n        fill: 'none',\n        stroke: 'none'\n      });\n\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n\n      drawPath(parentGfx, textPathData, {\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n\n      var semantic = getSemantic(element),\n          text = semantic.get('text') || '';\n\n      renderLabel(parentGfx, text, {\n        align: 'left-top',\n        box: getBounds(element, attrs),\n        padding: 7,\n        style: {\n          fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n        }\n      });\n\n      return textElement;\n    },\n    'bpmn:Transaction': function(parentGfx, element, attrs = {}) {\n      if (isExpanded(element)) {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke',\n          'width',\n          'height'\n        ]);\n      } else {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke'\n        ]);\n      }\n\n      var outer = renderSubProcess(parentGfx, element, {\n        strokeWidth: 1.5,\n        ...attrs\n      });\n\n      var innerAttrs = styles.style([ 'no-fill', 'no-events' ], {\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1.5\n      });\n\n      var expanded = isExpanded(element);\n\n      if (!expanded) {\n        attrs = {};\n      }\n\n      drawRect(\n        parentGfx,\n        getWidth(element, attrs),\n        getHeight(element, attrs),\n        TASK_BORDER_RADIUS - INNER_OUTER_DIST,\n        INNER_OUTER_DIST,\n        innerAttrs\n      );\n\n      return outer;\n    },\n    'bpmn:UserTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var x = 15;\n      var y = 12;\n\n      var pathDataUser1 = pathMap.getScaledPath('TASK_TYPE_USER_1', {\n        abspos: {\n          x: x,\n          y: y\n        }\n      });\n\n      drawPath(parentGfx, pathDataUser1, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 0.5\n      });\n\n      var pathDataUser2 = pathMap.getScaledPath('TASK_TYPE_USER_2', {\n        abspos: {\n          x: x,\n          y: y\n        }\n      });\n\n      drawPath(parentGfx, pathDataUser2, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 0.5\n      });\n\n      var pathDataUser3 = pathMap.getScaledPath('TASK_TYPE_USER_3', {\n        abspos: {\n          x: x,\n          y: y\n        }\n      });\n\n      drawPath(parentGfx, pathDataUser3, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 0.5\n      });\n\n      return task;\n    },\n    'label': function(parentGfx, element, attrs = {}) {\n      return renderExternalLabel(parentGfx, element, attrs);\n    }\n  };\n\n  // extension API, use at your own risk\n  this._drawPath = drawPath;\n\n  this._renderer = renderer;\n}\n\n\ninherits(BpmnRenderer, BaseRenderer);\n\nBpmnRenderer.$inject = [\n  'config.bpmnRenderer',\n  'eventBus',\n  'styles',\n  'pathMap',\n  'canvas',\n  'textRenderer'\n];\n\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nBpmnRenderer.prototype.canRender = function(element) {\n  return is(element, 'bpmn:BaseElement');\n};\n\n/**\n * Draw shape into parentGfx.\n *\n * @param {SVGElement} parentGfx\n * @param {Shape} shape\n * @param {Attrs} [attrs]\n *\n * @return {SVGElement} mainGfx\n */\nBpmnRenderer.prototype.drawShape = function(parentGfx, shape, attrs = {}) {\n  var { type } = shape;\n\n  var handler = this._renderer(type);\n\n  return handler(parentGfx, shape, attrs);\n};\n\n/**\n * Draw connection into parentGfx.\n *\n * @param {SVGElement} parentGfx\n * @param {Connection} connection\n * @param {Attrs} [attrs]\n *\n * @return {SVGElement} mainGfx\n */\nBpmnRenderer.prototype.drawConnection = function(parentGfx, connection, attrs = {}) {\n  var { type } = connection;\n\n  var handler = this._renderer(type);\n\n  return handler(parentGfx, connection, attrs);\n};\n\n/**\n * Get shape path.\n *\n * @param {Shape} shape\n *\n * @return {string} path\n */\nBpmnRenderer.prototype.getShapePath = function(shape) {\n\n  if (isLabel(shape)) {\n    return getRoundRectPath(shape, EXTERNAL_LABEL_BORDER_RADIUS);\n  }\n\n  if (is(shape, 'bpmn:Event')) {\n    return getCirclePath(shape);\n  }\n\n  if (is(shape, 'bpmn:Activity')) {\n    return getRoundRectPath(shape, TASK_BORDER_RADIUS);\n  }\n\n  if (is(shape, 'bpmn:Gateway')) {\n    return getDiamondPath(shape);\n  }\n\n  return getRectPath(shape);\n};\n\n/**\n * Pick attributes if they exist.\n *\n * @param {Object} attrs\n * @param {string[]} keys\n *\n * @returns {Object}\n */\nfunction pickAttrs(attrs, keys = []) {\n  return keys.reduce((pickedAttrs, key) => {\n    if (attrs[ key ]) {\n      pickedAttrs[ key ] = attrs[ key ];\n    }\n\n    return pickedAttrs;\n  }, {});\n}","import { assign } from 'min-dash';\n\nimport TextUtil from 'diagram-js/lib/util/Text';\n\nvar DEFAULT_FONT_SIZE = 12;\nvar LINE_HEIGHT_RATIO = 1.2;\n\nvar MIN_TEXT_ANNOTATION_HEIGHT = 30;\n\n/**\n * @typedef { {\n *   fontFamily: string;\n *   fontSize: number;\n *   fontWeight: string;\n *   lineHeight: number;\n * } } TextRendererStyle\n *\n * @typedef { {\n *   defaultStyle?: Partial<TextRendererStyle>;\n *   externalStyle?: Partial<TextRendererStyle>;\n * } } TextRendererConfig\n *\n * @typedef { import('diagram-js/lib/util/Text').TextLayoutConfig } TextLayoutConfig\n *\n * @typedef { import('diagram-js/lib/util/Types').Rect } Rect\n */\n\n\n/**\n * Renders text and computes text bounding boxes.\n *\n * @param {TextRendererConfig} [config]\n */\nexport default function TextRenderer(config) {\n\n  var defaultStyle = assign({\n    fontFamily: 'Arial, sans-serif',\n    fontSize: DEFAULT_FONT_SIZE,\n    fontWeight: 'normal',\n    lineHeight: LINE_HEIGHT_RATIO\n  }, config && config.defaultStyle || {});\n\n  var fontSize = parseInt(defaultStyle.fontSize, 10) - 1;\n\n  var externalStyle = assign({}, defaultStyle, {\n    fontSize: fontSize\n  }, config && config.externalStyle || {});\n\n  var textUtil = new TextUtil({\n    style: defaultStyle\n  });\n\n  /**\n   * Get the new bounds of an externally rendered,\n   * layouted label.\n   *\n   * @param {Rect} bounds\n   * @param {string} text\n   *\n   * @return {Rect}\n   */\n  this.getExternalLabelBounds = function(bounds, text) {\n\n    var layoutedDimensions = textUtil.getDimensions(text, {\n      box: {\n        width: 90,\n        height: 30\n      },\n      style: externalStyle\n    });\n\n    // resize label shape to fit label text\n    return {\n      x: Math.round(bounds.x + bounds.width / 2 - layoutedDimensions.width / 2),\n      y: Math.round(bounds.y),\n      width: Math.ceil(layoutedDimensions.width),\n      height: Math.ceil(layoutedDimensions.height)\n    };\n\n  };\n\n  /**\n   * Get the new bounds of text annotation.\n   *\n   * @param {Rect} bounds\n   * @param {string} text\n   *\n   * @return {Rect}\n   */\n  this.getTextAnnotationBounds = function(bounds, text) {\n\n    var layoutedDimensions = textUtil.getDimensions(text, {\n      box: bounds,\n      style: defaultStyle,\n      align: 'left-top',\n      padding: 5\n    });\n\n    return {\n      x: bounds.x,\n      y: bounds.y,\n      width: bounds.width,\n      height: Math.max(MIN_TEXT_ANNOTATION_HEIGHT, Math.round(layoutedDimensions.height))\n    };\n  };\n\n  /**\n   * Create a layouted text element.\n   *\n   * @param {string} text\n   * @param {TextLayoutConfig} [options]\n   *\n   * @return {SVGElement} rendered text\n   */\n  this.createText = function(text, options) {\n    return textUtil.createText(text, options || {});\n  };\n\n  /**\n   * Get default text style.\n   */\n  this.getDefaultStyle = function() {\n    return defaultStyle;\n  };\n\n  /**\n   * Get the external text style.\n   */\n  this.getExternalStyle = function() {\n    return externalStyle;\n  };\n\n}\n\nTextRenderer.$inject = [\n  'config.textRenderer'\n];","/**\n * Map containing SVG paths needed by BpmnRenderer\n */\nexport default function PathMap() {\n\n  /**\n   * Contains a map of path elements\n   *\n   * <h1>Path definition</h1>\n   * A parameterized path is defined like this:\n   * <pre>\n   * 'GATEWAY_PARALLEL': {\n   *   d: 'm {mx},{my} {e.x0},0 0,{e.x1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} ' +\n          '-{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z',\n   *   height: 17.5,\n   *   width:  17.5,\n   *   heightElements: [2.5, 7.5],\n   *   widthElements: [2.5, 7.5]\n   * }\n   * </pre>\n   * <p>It's important to specify a correct <b>height and width</b> for the path as the scaling\n   * is based on the ratio between the specified height and width in this object and the\n   * height and width that is set as scale target (Note x,y coordinates will be scaled with\n   * individual ratios).</p>\n   * <p>The '<b>heightElements</b>' and '<b>widthElements</b>' array must contain the values that will be scaled.\n   * The scaling is based on the computed ratios.\n   * Coordinates on the y axis should be in the <b>heightElement</b>'s array, they will be scaled using\n   * the computed ratio coefficient.\n   * In the parameterized path the scaled values can be accessed through the 'e' object in {} brackets.\n   *   <ul>\n   *    <li>The values for the y axis can be accessed in the path string using {e.y0}, {e.y1}, ....</li>\n   *    <li>The values for the x axis can be accessed in the path string using {e.x0}, {e.x1}, ....</li>\n   *   </ul>\n   *   The numbers x0, x1 respectively y0, y1, ... map to the corresponding array index.\n   * </p>\n   */\n  this.pathMap = {\n    'EVENT_MESSAGE': {\n      d: 'm {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}',\n      height: 36,\n      width:  36,\n      heightElements: [ 6, 14 ],\n      widthElements: [ 10.5, 21 ]\n    },\n    'EVENT_SIGNAL': {\n      d: 'M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z',\n      height: 36,\n      width: 36,\n      heightElements: [ 18 ],\n      widthElements: [ 10, 20 ]\n    },\n    'EVENT_ESCALATION': {\n      d: 'M {mx},{my} l {e.x0},{e.y0} l -{e.x0},-{e.y1} l -{e.x0},{e.y1} Z',\n      height: 36,\n      width: 36,\n      heightElements: [ 20, 7 ],\n      widthElements: [ 8 ]\n    },\n    'EVENT_CONDITIONAL': {\n      d: 'M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z ' +\n         'M {e.x2},{e.y3} l {e.x0},0 ' +\n         'M {e.x2},{e.y4} l {e.x0},0 ' +\n         'M {e.x2},{e.y5} l {e.x0},0 ' +\n         'M {e.x2},{e.y6} l {e.x0},0 ' +\n         'M {e.x2},{e.y7} l {e.x0},0 ' +\n         'M {e.x2},{e.y8} l {e.x0},0 ',\n      height: 36,\n      width:  36,\n      heightElements: [ 8.5, 14.5, 18, 11.5, 14.5, 17.5, 20.5, 23.5, 26.5 ],\n      widthElements:  [ 10.5, 14.5, 12.5 ]\n    },\n    'EVENT_LINK': {\n      d: 'm {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z',\n      height: 36,\n      width: 36,\n      heightElements: [ 4.4375, 6.75, 7.8125 ],\n      widthElements: [ 9.84375, 13.5 ]\n    },\n    'EVENT_ERROR': {\n      d: 'm {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z',\n      height: 36,\n      width: 36,\n      heightElements: [ 0.023, 8.737, 8.151, 16.564, 10.591, 8.714 ],\n      widthElements: [ 0.085, 6.672, 6.97, 4.273, 5.337, 6.636 ]\n    },\n    'EVENT_CANCEL_45': {\n      d: 'm {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 ' +\n        '0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z',\n      height: 36,\n      width: 36,\n      heightElements: [ 4.75, 8.5 ],\n      widthElements: [ 4.75, 8.5 ]\n    },\n    'EVENT_COMPENSATION': {\n      d: 'm {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x1},-{e.y2} {e.x2},-{e.y3} 0,{e.y1} -{e.x2},-{e.y3} z',\n      height: 36,\n      width: 36,\n      heightElements: [ 6.5, 13, 0.4, 6.1 ],\n      widthElements: [ 9, 9.3, 8.7 ]\n    },\n    'EVENT_TIMER_WH': {\n      d: 'M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} ',\n      height: 36,\n      width:  36,\n      heightElements: [ 10, 2 ],\n      widthElements: [ 3, 7 ]\n    },\n    'EVENT_TIMER_LINE': {\n      d:  'M {mx},{my} ' +\n          'm {e.x0},{e.y0} l -{e.x1},{e.y1} ',\n      height: 36,\n      width:  36,\n      heightElements: [ 10, 3 ],\n      widthElements: [ 0, 0 ]\n    },\n    'EVENT_MULTIPLE': {\n      d:'m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z',\n      height: 36,\n      width:  36,\n      heightElements: [ 6.28099, 12.56199 ],\n      widthElements: [ 3.1405, 9.42149, 12.56198 ]\n    },\n    'EVENT_PARALLEL_MULTIPLE': {\n      d:'m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} ' +\n        '-{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z',\n      height: 36,\n      width:  36,\n      heightElements: [ 2.56228, 7.68683 ],\n      widthElements: [ 2.56228, 7.68683 ]\n    },\n    'GATEWAY_EXCLUSIVE': {\n      d:'m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} ' +\n                    '{e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} ' +\n                    '{e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z',\n      height: 17.5,\n      width:  17.5,\n      heightElements: [ 8.5, 6.5312, -6.5312, -8.5 ],\n      widthElements:  [ 6.5, -6.5, 3, -3, 5, -5 ]\n    },\n    'GATEWAY_PARALLEL': {\n      d:'m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 ' +\n        '0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z',\n      height: 30,\n      width:  30,\n      heightElements: [ 5, 12.5 ],\n      widthElements: [ 5, 12.5 ]\n    },\n    'GATEWAY_EVENT_BASED': {\n      d:'m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z',\n      height: 11,\n      width:  11,\n      heightElements: [ -6, 6, 12, -12 ],\n      widthElements: [ 9, -3, -12 ]\n    },\n    'GATEWAY_COMPLEX': {\n      d:'m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} ' +\n        '{e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} ' +\n        '{e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} ' +\n        '-{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z',\n      height: 17.125,\n      width:  17.125,\n      heightElements: [ 4.875, 3.4375, 2.125, 3 ],\n      widthElements: [ 3.4375, 2.125, 4.875, 3 ]\n    },\n    'DATA_OBJECT_PATH': {\n      d:'m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0',\n      height: 61,\n      width:  51,\n      heightElements: [ 10, 50, 60 ],\n      widthElements: [ 10, 40, 50, 60 ]\n    },\n    'DATA_OBJECT_COLLECTION_PATH': {\n      d: 'm{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10',\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: []\n    },\n    'DATA_ARROW': {\n      d:'m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z',\n      height: 61,\n      width:  51,\n      heightElements: [],\n      widthElements: []\n    },\n    'DATA_STORE': {\n      d:'m  {mx},{my} ' +\n        'l  0,{e.y2} ' +\n        'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 ' +\n        'l  0,-{e.y2} ' +\n        'c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0' +\n        'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 ' +\n        'm  -{e.x2},{e.y0}' +\n        'c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0' +\n        'm  -{e.x2},{e.y0}' +\n        'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0',\n      height: 61,\n      width:  61,\n      heightElements: [ 7, 10, 45 ],\n      widthElements:  [ 2, 58, 60 ]\n    },\n    'TEXT_ANNOTATION': {\n      d: 'm {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0',\n      height: 30,\n      width: 10,\n      heightElements: [ 30 ],\n      widthElements: [ 10 ]\n    },\n    'MARKER_SUB_PROCESS': {\n      d: 'm{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0',\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_PARALLEL': {\n      d: 'm{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10',\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_SEQUENTIAL': {\n      d: 'm{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0',\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_COMPENSATION': {\n      d: 'm {mx},{my} 7,-5 0,10 z m 7.1,-0.3 6.9,-4.7 0,10 -6.9,-4.7 z',\n      height: 10,\n      width: 21,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_LOOP': {\n      d: 'm {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 ' +\n        '-6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 ' +\n        '0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 ' +\n        'l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902',\n      height: 13.9,\n      width: 13.7,\n      heightElements: [],\n      widthElements: []\n    },\n    'MARKER_ADHOC': {\n      d: 'm {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 ' +\n        '3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 ' +\n        '1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 ' +\n        '-3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 ' +\n        '-2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z',\n      height: 4,\n      width: 15,\n      heightElements: [],\n      widthElements: []\n    },\n    'TASK_TYPE_SEND': {\n      d: 'm {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}',\n      height: 14,\n      width:  21,\n      heightElements: [ 6, 14 ],\n      widthElements: [ 10.5, 21 ]\n    },\n    'TASK_TYPE_SCRIPT': {\n      d: 'm {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 ' +\n        'c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z ' +\n        'm -7,-12 l 5,0 ' +\n        'm -4.5,3 l 4.5,0 ' +\n        'm -3,3 l 5,0' +\n        'm -4,3 l 5,0',\n      height: 15,\n      width:  12.6,\n      heightElements: [ 6, 14 ],\n      widthElements: [ 10.5, 21 ]\n    },\n    'TASK_TYPE_USER_1': {\n      d: 'm {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 ' +\n        '-4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 ' +\n        '0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 ' +\n        'h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 z' +\n        'm -8,6 l 0,5.5 m 11,0 l 0,-5'\n    },\n    'TASK_TYPE_USER_2': {\n      d: 'm {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 ' +\n        '-2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 '\n    },\n    'TASK_TYPE_USER_3': {\n      d: 'm {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 ' +\n        '4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 ' +\n        '-4.20799998,3.36699999 -4.20699998,4.34799999 z'\n    },\n    'TASK_TYPE_MANUAL': {\n      d: 'm {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 ' +\n        '-0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 ' +\n        '0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 ' +\n        '-1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 ' +\n        '0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 ' +\n        '-10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 ' +\n        '2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 ' +\n        '-0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 ' +\n        '-1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 ' +\n        '-0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 ' +\n        '0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 ' +\n        '-5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z'\n    },\n    'TASK_TYPE_INSTANTIATING_SEND': {\n      d: 'm {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6'\n    },\n    'TASK_TYPE_SERVICE': {\n      d: 'm {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 ' +\n        '0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 ' +\n        '-1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 ' +\n        'v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 ' +\n        '-0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 ' +\n        '-1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 ' +\n        'h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 ' +\n        '-0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 ' +\n        'c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 ' +\n        'l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 ' +\n        '0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 ' +\n        'c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z ' +\n        'm 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 ' +\n        '0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 ' +\n        '0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z'\n    },\n    'TASK_TYPE_SERVICE_FILL': {\n      d: 'm {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 ' +\n        '0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 ' +\n        '0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z'\n    },\n    'TASK_TYPE_BUSINESS_RULE_HEADER': {\n      d: 'm {mx},{my} 0,4 20,0 0,-4 z'\n    },\n    'TASK_TYPE_BUSINESS_RULE_MAIN': {\n      d: 'm {mx},{my} 0,12 20,0 0,-12 z' +\n        'm 0,8 l 20,0 ' +\n        'm -13,-4 l 0,8'\n    },\n    'MESSAGE_FLOW_MARKER': {\n      d: 'm {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6'\n    }\n  };\n\n  /**\n   * Return raw path for the given ID.\n   *\n   * @param {string} pathId\n   *\n   * @return {string} raw path\n   */\n  this.getRawPath = function getRawPath(pathId) {\n    return this.pathMap[pathId].d;\n  };\n\n  /**\n   * Scales the path to the given height and width.\n   * <h1>Use case</h1>\n   * <p>Use case is to scale the content of elements (event, gateways) based\n   * on the element bounding box's size.\n   * </p>\n   * <h1>Why not transform</h1>\n   * <p>Scaling a path with transform() will also scale the stroke and IE does not support\n   * the option 'non-scaling-stroke' to prevent this.\n   * Also there are use cases where only some parts of a path should be\n   * scaled.</p>\n   *\n   * @param {string} pathId The ID of the path.\n   * @param {Object} param <p>\n   *   Example param object scales the path to 60% size of the container (data.width, data.height).\n   *   <pre>\n   *   {\n   *     xScaleFactor: 0.6,\n   *     yScaleFactor:0.6,\n   *     containerWidth: data.width,\n   *     containerHeight: data.height,\n   *     position: {\n   *       mx: 0.46,\n   *       my: 0.2,\n   *     }\n   *   }\n   *   </pre>\n   *   <ul>\n   *    <li>targetpathwidth = xScaleFactor * containerWidth</li>\n   *    <li>targetpathheight = yScaleFactor * containerHeight</li>\n   *    <li>Position is used to set the starting coordinate of the path. M is computed:\n    *    <ul>\n    *      <li>position.x * containerWidth</li>\n    *      <li>position.y * containerHeight</li>\n    *    </ul>\n    *    Center of the container <pre> position: {\n   *       mx: 0.5,\n   *       my: 0.5,\n   *     }</pre>\n   *     Upper left corner of the container\n   *     <pre> position: {\n   *       mx: 0.0,\n   *       my: 0.0,\n   *     }</pre>\n   *    </li>\n   *   </ul>\n   * </p>\n   *\n   * @return {string} scaled path\n   */\n  this.getScaledPath = function getScaledPath(pathId, param) {\n    var rawPath = this.pathMap[pathId];\n\n    // positioning\n    // compute the start point of the path\n    var mx, my;\n\n    if (param.abspos) {\n      mx = param.abspos.x;\n      my = param.abspos.y;\n    } else {\n      mx = param.containerWidth * param.position.mx;\n      my = param.containerHeight * param.position.my;\n    }\n\n    var coordinates = {}; // map for the scaled coordinates\n    if (param.position) {\n\n      // path\n      var heightRatio = (param.containerHeight / rawPath.height) * param.yScaleFactor;\n      var widthRatio = (param.containerWidth / rawPath.width) * param.xScaleFactor;\n\n\n      // Apply height ratio\n      for (var heightIndex = 0; heightIndex < rawPath.heightElements.length; heightIndex++) {\n        coordinates['y' + heightIndex] = rawPath.heightElements[heightIndex] * heightRatio;\n      }\n\n      // Apply width ratio\n      for (var widthIndex = 0; widthIndex < rawPath.widthElements.length; widthIndex++) {\n        coordinates['x' + widthIndex] = rawPath.widthElements[widthIndex] * widthRatio;\n      }\n    }\n\n    // Apply value to raw path\n    var path = format(\n      rawPath.d, {\n        mx: mx,\n        my: my,\n        e: coordinates\n      }\n    );\n    return path;\n  };\n}\n\n// helpers //////////////////////\n\n// copied and adjusted from https://github.com/adobe-webplatform/Snap.svg/blob/master/src/svg.js\nvar tokenRegex = /\\{([^{}]+)\\}/g,\n    objNotationRegex = /(?:(?:^|\\.)(.+?)(?=\\[|\\.|$|\\()|\\[('|\")(.+?)\\2\\])(\\(\\))?/g; // matches .xxxxx or [\"xxxxx\"] to run over object properties\n\nfunction replacer(all, key, obj) {\n  var res = obj;\n  key.replace(objNotationRegex, function(all, name, quote, quotedName, isFunc) {\n    name = name || quotedName;\n    if (res) {\n      if (name in res) {\n        res = res[name];\n      }\n      typeof res == 'function' && isFunc && (res = res());\n    }\n  });\n  res = (res == null || res == obj ? all : res) + '';\n\n  return res;\n}\n\nfunction format(str, obj) {\n  return String(str).replace(tokenRegex, function(all, key) {\n    return replacer(all, key, obj);\n  });\n}\n","import BpmnRenderer from './BpmnRenderer';\nimport TextRenderer from './TextRenderer';\n\nimport PathMap from './PathMap';\n\nexport default {\n  __init__: [ 'bpmnRenderer' ],\n  bpmnRenderer: [ 'type', BpmnRenderer ],\n  textRenderer: [ 'type', TextRenderer ],\n  pathMap: [ 'type', PathMap ]\n};\n","import {\n  assign\n} from 'min-dash';\n\nimport { is } from '../util/ModelUtil';\n\nimport {\n  isLabelExternal,\n  getExternalLabelBounds,\n  getLabel\n} from '../util/LabelUtil';\n\nimport {\n  getMid\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  isExpanded\n} from '../util/DiUtil';\n\nimport {\n  elementToString\n} from './Util';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n *\n * @typedef {import('../features/modeling/ElementFactory').default} ElementFactory\n * @typedef {import('../draw/TextRenderer').default} TextRenderer\n *\n * @typedef {import('../model/Types').Element} Element\n * @typedef {import('../model/Types').Label} Label\n * @typedef {import('../model/Types').Shape} Shape\n * @typedef {import('../model/Types').Connection} Connection\n * @typedef {import('../model/Types').Root} Root\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * @param {ModdleElement} semantic\n * @param {ModdleElement} di\n * @param {Object} [attrs=null]\n *\n * @return {Object}\n */\nfunction elementData(semantic, di, attrs) {\n  return assign({\n    id: semantic.id,\n    type: semantic.$type,\n    businessObject: semantic,\n    di: di\n  }, attrs);\n}\n\nfunction getWaypoints(di, source, target) {\n\n  var waypoints = di.waypoint;\n\n  if (!waypoints || waypoints.length < 2) {\n    return [ getMid(source), getMid(target) ];\n  }\n\n  return waypoints.map(function(p) {\n    return { x: p.x, y: p.y };\n  });\n}\n\nfunction notYetDrawn(semantic, refSemantic, property) {\n  return new Error(\n    `element ${ elementToString(refSemantic) } referenced by ${ elementToString(semantic) }#${ property } not yet drawn`\n  );\n}\n\n\n/**\n * An importer that adds bpmn elements to the canvas\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {ElementFactory} elementFactory\n * @param {ElementRegistry} elementRegistry\n * @param {TextRenderer} textRenderer\n */\nexport default function BpmnImporter(\n    eventBus, canvas, elementFactory,\n    elementRegistry, textRenderer) {\n\n  this._eventBus = eventBus;\n  this._canvas = canvas;\n  this._elementFactory = elementFactory;\n  this._elementRegistry = elementRegistry;\n  this._textRenderer = textRenderer;\n}\n\nBpmnImporter.$inject = [\n  'eventBus',\n  'canvas',\n  'elementFactory',\n  'elementRegistry',\n  'textRenderer'\n];\n\n\n/**\n * Add a BPMN element (semantic) to the canvas making it a child of the\n * given parent.\n *\n * @param {ModdleElement} semantic\n * @param {ModdleElement} di\n * @param {Shape} parentElement\n *\n * @return {Shape | Root | Connection}\n */\nBpmnImporter.prototype.add = function(semantic, di, parentElement) {\n  var element,\n      hidden;\n\n  var parentIndex;\n\n  // ROOT ELEMENT\n  // handle the special case that we deal with a\n  // invisible root element (process, subprocess or collaboration)\n  if (is(di, 'bpmndi:BPMNPlane')) {\n\n    var attrs = is(semantic, 'bpmn:SubProcess')\n      ? { id: semantic.id + '_plane' }\n      : {};\n\n    // add a virtual element (not being drawn)\n    element = this._elementFactory.createRoot(elementData(semantic, di, attrs));\n\n    this._canvas.addRootElement(element);\n  }\n\n  // SHAPE\n  else if (is(di, 'bpmndi:BPMNShape')) {\n\n    var collapsed = !isExpanded(semantic, di),\n        isFrame = isFrameElement(semantic);\n\n    hidden = parentElement && (parentElement.hidden || parentElement.collapsed);\n\n    var bounds = di.bounds;\n\n    element = this._elementFactory.createShape(elementData(semantic, di, {\n      collapsed: collapsed,\n      hidden: hidden,\n      x: Math.round(bounds.x),\n      y: Math.round(bounds.y),\n      width: Math.round(bounds.width),\n      height: Math.round(bounds.height),\n      isFrame: isFrame\n    }));\n\n    if (is(semantic, 'bpmn:BoundaryEvent')) {\n      this._attachBoundary(semantic, element);\n    }\n\n    // insert lanes behind other flow nodes (cf. #727)\n    if (is(semantic, 'bpmn:Lane')) {\n      parentIndex = 0;\n    }\n\n    if (is(semantic, 'bpmn:DataStoreReference')) {\n\n      // check whether data store is inside our outside of its semantic parent\n      if (!isPointInsideBBox(parentElement, getMid(bounds))) {\n        parentElement = this._canvas.findRoot(parentElement);\n      }\n    }\n\n    this._canvas.addShape(element, parentElement, parentIndex);\n  }\n\n  // CONNECTION\n  else if (is(di, 'bpmndi:BPMNEdge')) {\n\n    var source = this._getSource(semantic),\n        target = this._getTarget(semantic);\n\n    hidden = parentElement && (parentElement.hidden || parentElement.collapsed);\n\n    element = this._elementFactory.createConnection(elementData(semantic, di, {\n      hidden: hidden,\n      source: source,\n      target: target,\n      waypoints: getWaypoints(di, source, target)\n    }));\n\n    if (is(semantic, 'bpmn:DataAssociation')) {\n\n      // render always on top; this ensures DataAssociations\n      // are rendered correctly across different \"hacks\" people\n      // love to model such as cross participant / sub process\n      // associations\n      parentElement = this._canvas.findRoot(parentElement);\n    }\n\n    this._canvas.addConnection(element, parentElement, parentIndex);\n  } else {\n    throw new Error(\n      `unknown di ${ elementToString(di) } for element ${ elementToString(semantic) }`\n    );\n  }\n\n  // (optional) LABEL\n  if (isLabelExternal(semantic) && getLabel(element)) {\n    this.addLabel(semantic, di, element);\n  }\n\n  this._eventBus.fire('bpmnElement.added', { element: element });\n\n  return element;\n};\n\n\n/**\n * Attach a boundary element to the given host.\n *\n * @param {ModdleElement} boundarySemantic\n * @param {Shape} boundaryElement\n */\nBpmnImporter.prototype._attachBoundary = function(boundarySemantic, boundaryElement) {\n  var hostSemantic = boundarySemantic.attachedToRef;\n\n  if (!hostSemantic) {\n    throw new Error(\n      `missing ${ elementToString(boundarySemantic) }#attachedToRef`\n    );\n  }\n\n  var host = this._elementRegistry.get(hostSemantic.id),\n      attachers = host && host.attachers;\n\n  if (!host) {\n    throw notYetDrawn(boundarySemantic, hostSemantic, 'attachedToRef');\n  }\n\n  // wire element.host <> host.attachers\n  boundaryElement.host = host;\n\n  if (!attachers) {\n    host.attachers = attachers = [];\n  }\n\n  if (attachers.indexOf(boundaryElement) === -1) {\n    attachers.push(boundaryElement);\n  }\n};\n\n\n/**\n * Add a label to a given element.\n *\n * @param {ModdleElement} semantic\n * @param {ModdleElement} di\n * @param {Element} element\n *\n * @return {Label}\n */\nBpmnImporter.prototype.addLabel = function(semantic, di, element) {\n  var bounds,\n      text,\n      label;\n\n  bounds = getExternalLabelBounds(di, element);\n\n  text = getLabel(element);\n\n  if (text) {\n\n    // get corrected bounds from actual layouted text\n    bounds = this._textRenderer.getExternalLabelBounds(bounds, text);\n  }\n\n  label = this._elementFactory.createLabel(elementData(semantic, di, {\n    id: semantic.id + '_label',\n    labelTarget: element,\n    type: 'label',\n    hidden: element.hidden || !getLabel(element),\n    x: Math.round(bounds.x),\n    y: Math.round(bounds.y),\n    width: Math.round(bounds.width),\n    height: Math.round(bounds.height)\n  }));\n\n  return this._canvas.addShape(label, element.parent);\n};\n\n/**\n * Get the source or target of the given connection.\n *\n * @param {ModdleElement} semantic\n * @param {'source' | 'target'} side\n *\n * @return {Element}\n */\nBpmnImporter.prototype._getConnectedElement = function(semantic, side) {\n\n  var element,\n      refSemantic,\n      type = semantic.$type;\n\n  refSemantic = semantic[side + 'Ref'];\n\n  // handle mysterious isMany DataAssociation#sourceRef\n  if (side === 'source' && type === 'bpmn:DataInputAssociation') {\n    refSemantic = refSemantic && refSemantic[0];\n  }\n\n  // fix source / target for DataInputAssociation / DataOutputAssociation\n  if (side === 'source' && type === 'bpmn:DataOutputAssociation' ||\n      side === 'target' && type === 'bpmn:DataInputAssociation') {\n\n    refSemantic = semantic.$parent;\n  }\n\n  element = refSemantic && this._getElement(refSemantic);\n\n  if (element) {\n    return element;\n  }\n\n  if (refSemantic) {\n    throw notYetDrawn(semantic, refSemantic, side + 'Ref');\n  } else {\n    throw new Error(\n      `${ elementToString(semantic) }#${ side } Ref not specified`\n    );\n  }\n};\n\nBpmnImporter.prototype._getSource = function(semantic) {\n  return this._getConnectedElement(semantic, 'source');\n};\n\nBpmnImporter.prototype._getTarget = function(semantic) {\n  return this._getConnectedElement(semantic, 'target');\n};\n\n\nBpmnImporter.prototype._getElement = function(semantic) {\n  return this._elementRegistry.get(semantic.id);\n};\n\n\n// helpers ////////////////////\n\nfunction isPointInsideBBox(bbox, point) {\n  var x = point.x,\n      y = point.y;\n\n  return x >= bbox.x &&\n    x <= bbox.x + bbox.width &&\n    y >= bbox.y &&\n    y <= bbox.y + bbox.height;\n}\n\nfunction isFrameElement(semantic) {\n  return is(semantic, 'bpmn:Group');\n}\n","import translate from 'diagram-js/lib/i18n/translate';\n\nimport BpmnImporter from './BpmnImporter';\n\nexport default {\n  __depends__: [\n    translate\n  ],\n  bpmnImporter: [ 'type', BpmnImporter ]\n};","import DrawModule from '../draw';\nimport ImportModule from '../import';\n\nexport default {\n  __depends__: [\n    DrawModule,\n    ImportModule\n  ]\n};","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from '../../command/CommandInterceptor';\n\n/**\n * @typedef {import('didi').Injector} Injector\n *\n * @typedef {import('../../core/Canvas').default} Canvas\n */\n\n/**\n * A modeling behavior that ensures we set the correct root element\n * as we undo and redo commands.\n *\n * @param {Canvas} canvas\n * @param {Injector} injector\n */\nexport default function RootElementsBehavior(canvas, injector) {\n\n  injector.invoke(CommandInterceptor, this);\n\n  this.executed(function(event) {\n    var context = event.context;\n\n    if (context.rootElement) {\n      canvas.setRootElement(context.rootElement);\n    } else {\n      context.rootElement = canvas.getRootElement();\n    }\n  });\n\n  this.revert(function(event) {\n    var context = event.context;\n\n    if (context.rootElement) {\n      canvas.setRootElement(context.rootElement);\n    }\n  });\n}\n\ninherits(RootElementsBehavior, CommandInterceptor);\n\nRootElementsBehavior.$inject = [ 'canvas', 'injector' ];","import RootElementsBehavior from './RootElementsBehavior';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [ 'rootElementsBehavior' ],\n  rootElementsBehavior: [ 'type', RootElementsBehavior ]\n};\n","import { domify, classes } from 'min-dom';\nimport { find } from 'min-dash';\n\nimport { escapeHTML } from 'diagram-js/lib/util/EscapeUtil';\nimport { getBusinessObject, is } from '../../util/ModelUtil';\nimport {\n  getPlaneIdFromShape\n} from '../../util/DrilldownUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n */\n\nvar OPEN_CLASS = 'bjs-breadcrumbs-shown';\n\n\n/**\n * Adds overlays that allow switching planes on collapsed subprocesses.\n *\n * @param {EventBus} eventBus\n * @param {ElementRegistry} elementRegistry\n * @param {Canvas} canvas\n */\nexport default function DrilldownBreadcrumbs(eventBus, elementRegistry, canvas) {\n  var breadcrumbs = domify('<ul class=\"bjs-breadcrumbs\"></ul>');\n  var container = canvas.getContainer();\n  var containerClasses = classes(container);\n  container.appendChild(breadcrumbs);\n\n  var businessObjectParents = [];\n\n  // update breadcrumbs if name or ID of the primary shape changes\n  eventBus.on('element.changed', function(event) {\n    var shape = event.element,\n        businessObject = getBusinessObject(shape);\n\n    var isPresent = find(businessObjectParents, function(element) {\n      return element === businessObject;\n    });\n\n    if (!isPresent) {\n      return;\n    }\n\n    updateBreadcrumbs();\n  });\n\n  /**\n   * Updates the displayed breadcrumbs. If no element is provided, only the\n   * labels are updated.\n   *\n   * @param {Element} [element]\n   */\n  function updateBreadcrumbs(element) {\n    if (element) {\n      businessObjectParents = getBusinessObjectParentChain(element);\n    }\n\n    var path = businessObjectParents.flatMap(function(parent) {\n      var parentPlane =\n        canvas.findRoot(getPlaneIdFromShape(parent)) ||\n        canvas.findRoot(parent.id);\n\n      // when the root is a collaboration, the process does not have a\n      // corresponding element in the elementRegisty. Instead, we search\n      // for the corresponding participant\n      if (!parentPlane && is(parent, 'bpmn:Process')) {\n        var participant = elementRegistry.find(function(element) {\n          var businessObject = getBusinessObject(element);\n\n          return businessObject && businessObject.get('processRef') === parent;\n        });\n\n        parentPlane = participant && canvas.findRoot(participant.id);\n      }\n\n      if (!parentPlane) {\n        return [];\n      }\n\n      var title = escapeHTML(parent.name || parent.id);\n      var link = domify('<li><span class=\"bjs-crumb\"><a title=\"' + title + '\">' + title + '</a></span></li>');\n\n      link.addEventListener('click', function() {\n        canvas.setRootElement(parentPlane);\n      });\n\n      return link;\n    });\n\n    breadcrumbs.innerHTML = '';\n\n    // show breadcrumbs and expose state to .djs-container\n    var visible = path.length > 1;\n\n    containerClasses.toggle(OPEN_CLASS, visible);\n\n    path.forEach(function(element) {\n      breadcrumbs.appendChild(element);\n    });\n  }\n\n  eventBus.on('root.set', function(event) {\n    updateBreadcrumbs(event.element);\n  });\n\n}\n\nDrilldownBreadcrumbs.$inject = [ 'eventBus', 'elementRegistry', 'canvas' ];\n\n\n// helpers //////////\n\n/**\n * Returns the parents for the element using the business object chain,\n * starting with the root element.\n *\n * @param {Shape} child\n *\n * @return {Shape}\n */\nfunction getBusinessObjectParentChain(child) {\n  var businessObject = getBusinessObject(child);\n\n  var parents = [];\n\n  for (var element = businessObject; element; element = element.$parent) {\n    if (is(element, 'bpmn:SubProcess') || is(element, 'bpmn:Process')) {\n      parents.push(element);\n    }\n  }\n\n  return parents.reverse();\n}","import { is } from '../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * Move collapsed subprocesses into view when drilling down.\n *\n * Zoom and scroll are saved in a session.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function DrilldownCentering(eventBus, canvas) {\n\n  var currentRoot = null;\n  var positionMap = new Map();\n\n  eventBus.on('root.set', function(event) {\n    var newRoot = event.element;\n    var currentViewbox = canvas.viewbox();\n    var storedViewbox = positionMap.get(newRoot);\n\n    positionMap.set(currentRoot, {\n      x: currentViewbox.x,\n      y: currentViewbox.y,\n      zoom: currentViewbox.scale\n    });\n\n    currentRoot = newRoot;\n\n    // Keep viewbox when replacing root elements\n    if (!is(newRoot, 'bpmn:SubProcess') && !storedViewbox) {\n      return;\n    }\n\n    storedViewbox = storedViewbox || { x: 0, y: 0, zoom: 1 };\n\n    var dx = (currentViewbox.x - storedViewbox.x) * currentViewbox.scale,\n        dy = (currentViewbox.y - storedViewbox.y) * currentViewbox.scale;\n\n    if (dx !== 0 || dy !== 0) {\n      canvas.scroll({\n        dx: dx,\n        dy: dy\n      });\n    }\n\n    if (storedViewbox.zoom !== currentViewbox.scale) {\n      canvas.zoom(storedViewbox.zoom, { x: 0, y: 0 });\n    }\n  });\n\n  eventBus.on('diagram.clear', function() {\n    positionMap.clear();\n    currentRoot = null;\n  });\n\n}\n\nDrilldownCentering.$inject = [ 'eventBus', 'canvas' ];\n\n\n/**\n * ES5 Map implementation. Works.\n */\nfunction Map() {\n\n  this._entries = [];\n\n  this.set = function(key, value) {\n\n    var found = false;\n\n    for (var k in this._entries) {\n      if (this._entries[k][0] === key) {\n        this._entries[k][1] = value;\n\n        found = true;\n\n        break;\n      }\n    }\n\n    if (!found) {\n      this._entries.push([ key, value ]);\n    }\n  };\n\n  this.get = function(key) {\n\n    for (var k in this._entries) {\n      if (this._entries[k][0] === key) {\n        return this._entries[k][1];\n      }\n    }\n\n    return null;\n  };\n\n  this.clear = function() {\n    this._entries.length = 0;\n  };\n\n  this.remove = function(key) {\n\n    var idx = -1;\n\n    for (var k in this._entries) {\n      if (this._entries[k][0] === key) {\n        idx = k;\n\n        break;\n      }\n    }\n\n    if (idx !== -1) {\n      this._entries.splice(idx, 1);\n    }\n  };\n}","\nimport { asBounds, asTRBL } from 'diagram-js/lib/layout/LayoutUtil';\nimport { is, isAny } from '../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../model/Types').Moddle} Moddle\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/core/Canvas').CanvasPlane} CanvasPlane\n *\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n */\n\nvar DEFAULT_POSITION = {\n  x: 180,\n  y: 160\n};\n\n/**\n * Hook into `import.render.start` and create new planes for diagrams with\n * collapsed subprocesses and all DI elements on the same plane.\n *\n * @param {EventBus} eventBus\n * @param {Moddle} moddle\n */\nexport default function SubprocessCompatibility(eventBus, moddle) {\n  this._eventBus = eventBus;\n  this._moddle = moddle;\n\n  var self = this;\n\n  eventBus.on('import.render.start', 1500, function(e, context) {\n    self._handleImport(context.definitions);\n  });\n}\n\n/**\n * @param {ModdleElement} definitions\n */\nSubprocessCompatibility.prototype._handleImport = function(definitions) {\n  if (!definitions.diagrams) {\n    return;\n  }\n\n  var self = this;\n  this._definitions = definitions;\n  this._processToDiagramMap = {};\n\n  definitions.diagrams.forEach(function(diagram) {\n    if (!diagram.plane || !diagram.plane.bpmnElement) {\n      return;\n    }\n\n    self._processToDiagramMap[diagram.plane.bpmnElement.id] = diagram;\n  });\n\n  var newDiagrams = definitions.diagrams\n    .filter(diagram => diagram.plane)\n    .flatMap(diagram => self._createNewDiagrams(diagram.plane));\n\n  newDiagrams.forEach(function(diagram) {\n    self._movePlaneElementsToOrigin(diagram.plane);\n  });\n};\n\n\n/**\n * Moves all DI elements from collapsed subprocesses to a new plane.\n *\n * @param {CanvasPlane} plane\n *\n * @return {ModdleElement[]} new diagrams created for the collapsed subprocesses\n */\nSubprocessCompatibility.prototype._createNewDiagrams = function(plane) {\n  var self = this;\n\n  var collapsedElements = [];\n  var elementsToMove = [];\n\n  plane.get('planeElement').forEach(function(diElement) {\n    var businessObject = diElement.bpmnElement;\n\n    if (!businessObject) {\n      return;\n    }\n\n    var parent = businessObject.$parent;\n\n    if (is(businessObject, 'bpmn:SubProcess') && !diElement.isExpanded) {\n      collapsedElements.push(businessObject);\n    }\n\n    if (shouldMoveToPlane(businessObject, plane)) {\n\n      // don't change the array while we iterate over it\n      elementsToMove.push({ diElement: diElement, parent: parent });\n    }\n  });\n\n  var newDiagrams = [];\n\n  // create new planes for all collapsed subprocesses, even when they are empty\n  collapsedElements.forEach(function(element) {\n    if (!self._processToDiagramMap[ element.id ]) {\n      var diagram = self._createDiagram(element);\n\n      self._processToDiagramMap[element.id] = diagram;\n\n      newDiagrams.push(diagram);\n    }\n  });\n\n  elementsToMove.forEach(function(element) {\n    var diElement = element.diElement;\n    var parent = element.parent;\n\n    // parent is expanded, get nearest collapsed parent\n    while (parent && collapsedElements.indexOf(parent) === -1) {\n      parent = parent.$parent;\n    }\n\n    // false positive, all parents are expanded\n    if (!parent) {\n      return;\n    }\n\n    var diagram = self._processToDiagramMap[ parent.id ];\n\n    self._moveToDiPlane(diElement, diagram.plane);\n  });\n\n  return newDiagrams;\n};\n\n/**\n * @param {CanvasPlane} plane\n */\nSubprocessCompatibility.prototype._movePlaneElementsToOrigin = function(plane) {\n  var elements = plane.get('planeElement');\n\n  // get bounding box of all elements\n  var planeBounds = getPlaneBounds(plane);\n\n  var offset = {\n    x: planeBounds.x - DEFAULT_POSITION.x,\n    y: planeBounds.y - DEFAULT_POSITION.y\n  };\n\n  elements.forEach(function(diElement) {\n    if (diElement.waypoint) {\n      diElement.waypoint.forEach(function(waypoint) {\n        waypoint.x = waypoint.x - offset.x;\n        waypoint.y = waypoint.y - offset.y;\n      });\n    } else if (diElement.bounds) {\n      diElement.bounds.x = diElement.bounds.x - offset.x;\n      diElement.bounds.y = diElement.bounds.y - offset.y;\n    }\n  });\n};\n\n/**\n * @param {ModdleElement} diElement\n * @param {CanvasPlane} newPlane\n */\nSubprocessCompatibility.prototype._moveToDiPlane = function(diElement, newPlane) {\n  var containingDiagram = findRootDiagram(diElement);\n\n  // remove DI from old Plane and add it to the new one\n  var parentPlaneElement = containingDiagram.plane.get('planeElement');\n\n  parentPlaneElement.splice(parentPlaneElement.indexOf(diElement), 1);\n\n  newPlane.get('planeElement').push(diElement);\n};\n\n/**\n * @param {ModdleElement} businessObject\n *\n * @return {ModdleElement}\n */\nSubprocessCompatibility.prototype._createDiagram = function(businessObject) {\n  var plane = this._moddle.create('bpmndi:BPMNPlane', {\n    bpmnElement: businessObject\n  });\n\n  var diagram = this._moddle.create('bpmndi:BPMNDiagram', {\n    plane: plane\n  });\n\n  plane.$parent = diagram;\n\n  plane.bpmnElement = businessObject;\n\n  diagram.$parent = this._definitions;\n\n  this._definitions.diagrams.push(diagram);\n\n  return diagram;\n};\n\nSubprocessCompatibility.$inject = [ 'eventBus', 'moddle' ];\n\n\n// helpers //////////\n\nfunction findRootDiagram(element) {\n  if (is(element, 'bpmndi:BPMNDiagram')) {\n    return element;\n  } else {\n    return findRootDiagram(element.$parent);\n  }\n}\n\n/**\n * @param {CanvasPlane} plane\n *\n * @return {Rect}\n */\nfunction getPlaneBounds(plane) {\n  var planeTrbl = {\n    top: Infinity,\n    right: -Infinity,\n    bottom: -Infinity,\n    left: Infinity\n  };\n\n  plane.planeElement.forEach(function(element) {\n    if (!element.bounds) {\n      return;\n    }\n\n    var trbl = asTRBL(element.bounds);\n\n    planeTrbl.top = Math.min(trbl.top, planeTrbl.top);\n    planeTrbl.left = Math.min(trbl.left, planeTrbl.left);\n  });\n\n  return asBounds(planeTrbl);\n}\n\n/**\n * @param {ModdleElement} businessObject\n * @param {CanvasPlane} plane\n *\n * @return {boolean}\n */\nfunction shouldMoveToPlane(businessObject, plane) {\n  var parent = businessObject.$parent;\n\n  // don't move elements that are already on the plane\n  if (!is(parent, 'bpmn:SubProcess') || parent === plane.bpmnElement) {\n    return false;\n  }\n\n  // dataAssociations are children of the subprocess but rendered on process level\n  // cf. https://github.com/bpmn-io/bpmn-js/issues/1619\n  if (isAny(businessObject, [ 'bpmn:DataInputAssociation', 'bpmn:DataOutputAssociation' ])) {\n    return false;\n  }\n\n  return true;\n}\n","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { getBusinessObject, is } from '../../util/ModelUtil';\nimport { classes, domify } from 'min-dom';\nimport { getPlaneIdFromShape } from '../../util/DrilldownUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/features/overlays/Overlays').default} Overlays\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Parent} Parent\n * @typedef {import('../../model/Types').Shape} Shape\n */\n\nvar LOW_PRIORITY = 250;\nvar ARROW_DOWN_SVG = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"M4.81801948,3.50735931 L10.4996894,9.1896894 L10.5,4 L12,4 L12,12 L4,12 L4,10.5 L9.6896894,10.4996894 L3.75735931,4.56801948 C3.46446609,4.27512627 3.46446609,3.80025253 3.75735931,3.50735931 C4.05025253,3.21446609 4.52512627,3.21446609 4.81801948,3.50735931 Z\"/></svg>';\n\nvar EMPTY_MARKER = 'bjs-drilldown-empty';\n\n/**\n * @param {Canvas} canvas\n * @param {EventBus} eventBus\n * @param {ElementRegistry} elementRegistry\n * @param {Overlays} overlays\n * @param {Translate} translate\n */\nexport default function DrilldownOverlayBehavior(\n    canvas, eventBus, elementRegistry, overlays, translate\n) {\n  CommandInterceptor.call(this, eventBus);\n\n  this._canvas = canvas;\n  this._eventBus = eventBus;\n  this._elementRegistry = elementRegistry;\n  this._overlays = overlays;\n  this._translate = translate;\n\n  var self = this;\n\n  this.executed('shape.toggleCollapse', LOW_PRIORITY, function(context) {\n    var shape = context.shape;\n\n    // Add overlay to the collapsed shape\n    if (self._canDrillDown(shape)) {\n      self._addOverlay(shape);\n    } else {\n      self._removeOverlay(shape);\n    }\n  }, true);\n\n\n  this.reverted('shape.toggleCollapse', LOW_PRIORITY, function(context) {\n    var shape = context.shape;\n\n    // Add overlay to the collapsed shape\n    if (self._canDrillDown(shape)) {\n      self._addOverlay(shape);\n    } else {\n      self._removeOverlay(shape);\n    }\n  }, true);\n\n\n  this.executed([ 'shape.create', 'shape.move', 'shape.delete' ], LOW_PRIORITY,\n    function(context) {\n      var oldParent = context.oldParent,\n          newParent = context.newParent || context.parent,\n          shape = context.shape;\n\n      // Add overlay to the collapsed shape\n      if (self._canDrillDown(shape)) {\n        self._addOverlay(shape);\n      }\n\n      self._updateDrilldownOverlay(oldParent);\n      self._updateDrilldownOverlay(newParent);\n      self._updateDrilldownOverlay(shape);\n    }, true);\n\n\n  this.reverted([ 'shape.create', 'shape.move', 'shape.delete' ], LOW_PRIORITY,\n    function(context) {\n      var oldParent = context.oldParent,\n          newParent = context.newParent || context.parent,\n          shape = context.shape;\n\n      // Add overlay to the collapsed shape\n      if (self._canDrillDown(shape)) {\n        self._addOverlay(shape);\n      }\n\n      self._updateDrilldownOverlay(oldParent);\n      self._updateDrilldownOverlay(newParent);\n      self._updateDrilldownOverlay(shape);\n    }, true);\n\n\n  eventBus.on('import.render.complete', function() {\n    elementRegistry.filter(function(e) {\n      return self._canDrillDown(e);\n    }).map(function(el) {\n      self._addOverlay(el);\n    });\n  });\n\n}\n\ninherits(DrilldownOverlayBehavior, CommandInterceptor);\n\n/**\n * @param {Shape} shape\n */\nDrilldownOverlayBehavior.prototype._updateDrilldownOverlay = function(shape) {\n  var canvas = this._canvas;\n\n  if (!shape) {\n    return;\n  }\n\n  var root = canvas.findRoot(shape);\n\n  if (root) {\n    this._updateOverlayVisibility(root);\n  }\n};\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nDrilldownOverlayBehavior.prototype._canDrillDown = function(element) {\n  var canvas = this._canvas;\n\n  return is(element, 'bpmn:SubProcess') && canvas.findRoot(getPlaneIdFromShape(element));\n};\n\n/**\n * Update the visibility of the drilldown overlay. If the plane has no elements,\n * the drilldown will only be shown when the element is selected.\n *\n * @param {Parent} element The collapsed root or shape.\n */\nDrilldownOverlayBehavior.prototype._updateOverlayVisibility = function(element) {\n  var overlays = this._overlays;\n\n  var businessObject = getBusinessObject(element);\n\n  var overlay = overlays.get({ element: businessObject.id, type: 'drilldown' })[0];\n\n  if (!overlay) {\n    return;\n  }\n\n  var hasFlowElements = businessObject\n    && businessObject.get('flowElements')\n    && businessObject.get('flowElements').length;\n\n  classes(overlay.html).toggle(EMPTY_MARKER, !hasFlowElements);\n};\n\n/**\n * Add a drilldown button to the given element assuming the plane has the same\n * ID as the element.\n *\n * @param {Shape} element The collapsed shape.\n */\nDrilldownOverlayBehavior.prototype._addOverlay = function(element) {\n  var canvas = this._canvas,\n      overlays = this._overlays,\n      bo = getBusinessObject(element);\n\n  var existingOverlays = overlays.get({ element: element, type: 'drilldown' });\n\n  if (existingOverlays.length) {\n    this._removeOverlay(element);\n  }\n\n  var button = domify('<button type=\"button\" class=\"bjs-drilldown\">' + ARROW_DOWN_SVG + '</button>'),\n      elementName = bo.get('name') || bo.get('id'),\n      title = this._translate('Open {element}', { element: elementName });\n  button.setAttribute('title', title);\n\n  button.addEventListener('click', function() {\n    canvas.setRootElement(canvas.findRoot(getPlaneIdFromShape(element)));\n  });\n\n  overlays.add(element, 'drilldown', {\n    position: {\n      bottom: -7,\n      right: -8\n    },\n    html: button\n  });\n\n  this._updateOverlayVisibility(element);\n};\n\nDrilldownOverlayBehavior.prototype._removeOverlay = function(element) {\n  var overlays = this._overlays;\n\n  overlays.remove({\n    element: element,\n    type: 'drilldown'\n  });\n};\n\nDrilldownOverlayBehavior.$inject = [\n  'canvas',\n  'eventBus',\n  'elementRegistry',\n  'overlays',\n  'translate'\n];","import OverlaysModule from 'diagram-js/lib/features/overlays';\nimport ChangeSupportModule from 'diagram-js/lib/features/change-support';\nimport RootElementsModule from 'diagram-js/lib/features/root-elements';\n\nimport DrilldownBreadcrumbs from './DrilldownBreadcrumbs';\nimport DrilldownCentering from './DrilldownCentering';\nimport SubprocessCompatibility from './SubprocessCompatibility';\nimport DrilldownOverlayBehavior from './DrilldownOverlayBehavior';\n\nexport default {\n  __depends__: [ OverlaysModule, ChangeSupportModule, RootElementsModule ],\n  __init__: [ 'drilldownBreadcrumbs', 'drilldownOverlayBehavior', 'drilldownCentering', 'subprocessCompatibility' ],\n  drilldownBreadcrumbs: [ 'type', DrilldownBreadcrumbs ],\n  drilldownCentering: [ 'type', DrilldownCentering ],\n  drilldownOverlayBehavior: [ 'type', DrilldownOverlayBehavior ],\n  subprocessCompatibility: [ 'type', SubprocessCompatibility ]\n};","import inherits from 'inherits-browser';\n\nimport CoreModule from './core';\nimport DrilldownModdule from './features/drilldown';\nimport OverlaysModule from 'diagram-js/lib/features/overlays';\nimport SelectionModule from 'diagram-js/lib/features/selection';\nimport TranslateModule from 'diagram-js/lib/i18n/translate';\n\nimport BaseViewer from './BaseViewer';\n\n\n/**\n * @typedef { import('./BaseViewer').BaseViewerOptions } BaseViewerOptions\n */\n\n/**\n * A viewer for BPMN 2.0 diagrams.\n *\n * Have a look at {@link bpmn-js/lib/NavigatedViewer} or {@link bpmn-js/lib/Modeler} for bundles that include\n * additional features.\n *\n *\n * ## Extending the Viewer\n *\n * In order to extend the viewer pass extension modules to bootstrap via the\n * `additionalModules` option. An extension module is an object that exposes\n * named services.\n *\n * The following example depicts the integration of a simple\n * logging component that integrates with interaction events:\n *\n *\n * ```javascript\n *\n * // logging component\n * function InteractionLogger(eventBus) {\n *   eventBus.on('element.hover', function(event) {\n *     console.log()\n *   })\n * }\n *\n * InteractionLogger.$inject = [ 'eventBus' ]; // minification save\n *\n * // extension module\n * var extensionModule = {\n *   __init__: [ 'interactionLogger' ],\n *   interactionLogger: [ 'type', InteractionLogger ]\n * };\n *\n * // extend the viewer\n * var bpmnViewer = new Viewer({ additionalModules: [ extensionModule ] });\n * bpmnViewer.importXML(...);\n * ```\n *\n * @template [ServiceMap=null]\n *\n * @extends BaseViewer<ServiceMap>\n *\n * @param {BaseViewerOptions} [options] The options to configure the viewer.\n */\nexport default function Viewer(options) {\n  BaseViewer.call(this, options);\n}\n\ninherits(Viewer, BaseViewer);\n\n// modules the viewer is composed of\nViewer.prototype._modules = [\n  CoreModule,\n  DrilldownModdule,\n  OverlaysModule,\n  SelectionModule,\n  TranslateModule\n];\n\n// default moddle extensions the viewer is composed of\nViewer.prototype._moddleExtensions = {};","import inherits from 'inherits-browser';\n\nimport Viewer from './Viewer';\n\nimport KeyboardMoveModule from 'diagram-js/lib/navigation/keyboard-move';\nimport MoveCanvasModule from 'diagram-js/lib/navigation/movecanvas';\nimport ZoomScrollModule from 'diagram-js/lib/navigation/zoomscroll';\n\n/**\n * @typedef { import('./BaseViewer').BaseViewerOptions } BaseViewerOptions\n */\n\n/**\n * A viewer with mouse and keyboard navigation features.\n *\n * @template [ServiceMap=null]\n *\n * @extends Viewer<ServiceMap>\n *\n * @param {BaseViewerOptions} [options]\n */\nexport default function NavigatedViewer(options) {\n  Viewer.call(this, options);\n}\n\ninherits(NavigatedViewer, Viewer);\n\n\nNavigatedViewer.prototype._navigationModules = [\n  KeyboardMoveModule,\n  MoveCanvasModule,\n  ZoomScrollModule\n];\n\nNavigatedViewer.prototype._modules = [].concat(\n  Viewer.prototype._modules,\n  NavigatedViewer.prototype._navigationModules\n);","/**\n * To change the icons, modify the SVGs in `./resources`, execute `npx svgo -f resources --datauri enc -o dist`,\n * and then replace respective icons with the optimized data URIs in `./dist`.\n */\nvar icons = {\n  align:  `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 2000 2000\">\n              <line x1=\"200\" y1=\"150\" x2=\"200\" y2=\"1850\" style=\"stroke:currentColor;stroke-width:100;stroke-linecap:round;\"/>\n              <rect x=\"500\" y=\"150\" width=\"1300\" height=\"700\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n              <rect x=\"500\" y=\"1150\" width=\"700\" height=\"700\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n          </svg>`,\n  bottom: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n            <line x1=\"150\" y1=\"1650\" x2=\"1650\" y2=\"1650\" style=\"stroke:currentColor;stroke-width:100;stroke-linecap:round;\"/>\n            <rect x=\"150\" y=\"350\" width=\"600\" height=\"1300\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n            <rect x=\"1050\" y=\"850\" width=\"600\" height=\"800\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n          </svg>`,\n  center: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n            <line x1=\"900\" y1=\"150\" x2=\"900\" y2=\"1650\" style=\"stroke:currentColor;stroke-width:100;stroke-linecap:round;\"/>\n            <rect x=\"250\" y=\"150\" width=\"1300\" height=\"600\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n            <rect x=\"500\" y=\"1050\" width=\"800\" height=\"600\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n          </svg>`,\n  left:   `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n            <line x1=\"100\" y1=\"150\" x2=\"100\" y2=\"1650\" style=\"stroke:currentColor;stroke-width:100;stroke-linecap:round;\"/>\n            <rect x=\"100\" y=\"150\" width=\"1300\" height=\"600\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n            <rect x=\"100\" y=\"1050\" width=\"800\" height=\"600\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n          </svg>`,\n  right:  `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n            <line x1=\"1650\" y1=\"150\" x2=\"1650\" y2=\"1650\" style=\"stroke:currentColor;stroke-width:100;stroke-linecap:round;\"/>\n            <rect x=\"350\" y=\"150\" width=\"1300\" height=\"600\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n            <rect x=\"850\" y=\"1050\" width=\"800\" height=\"600\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n          </svg>`,\n  top:    `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n            <line x1=\"150\" y1=\"150\" x2=\"1650\" y2=\"150\" style=\"stroke:currentColor;stroke-width:100;stroke-linecap:round;\"/>\n            <rect x=\"150\" y=\"150\" width=\"600\" height=\"1300\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n            <rect x=\"1050\" y=\"150\" width=\"600\" height=\"800\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n          </svg>`,\n  middle: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n            <line x1=\"150\" y1=\"900\" x2=\"1650\" y2=\"900\" style=\"stroke:currentColor;stroke-width:100;stroke-linecap:round;\"/>\n            <rect x=\"150\" y=\"250\" width=\"600\" height=\"1300\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n            <rect x=\"1050\" y=\"500\" width=\"600\" height=\"800\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n          </svg>`\n};\n\nexport default icons;\n","import {\n  assign\n} from 'min-dash';\n\nimport ICONS from './AlignElementsIcons';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/features/context-pad/ContextPad').default} ContextPad\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').default} PopupMenu\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('diagram-js/lib/features/context-pad/ContextPad').ContextPadEntries} ContextPadEntries\n * @typedef {import('diagram-js/lib/features/context-pad/ContextPadProvider').default<Element>} ContextPadProvider\n */\n\nvar LOW_PRIORITY = 900;\n\n/**\n * A provider for the `Align elements` context pad entry.\n *\n * @implements {ContextPadProvider}\n *\n * @param {ContextPad} contextPad\n * @param {PopupMenu} popupMenu\n * @param {Translate} translate\n * @param {Canvas} canvas\n */\nexport default function AlignElementsContextPadProvider(contextPad, popupMenu, translate, canvas) {\n\n  contextPad.registerProvider(LOW_PRIORITY, this);\n\n  this._contextPad = contextPad;\n  this._popupMenu = popupMenu;\n  this._translate = translate;\n  this._canvas = canvas;\n}\n\nAlignElementsContextPadProvider.$inject = [\n  'contextPad',\n  'popupMenu',\n  'translate',\n  'canvas'\n];\n\n/**\n * @param {Element[]} elements\n *\n * @return {ContextPadEntries}\n */\nAlignElementsContextPadProvider.prototype.getMultiElementContextPadEntries = function(elements) {\n  var actions = {};\n\n  if (this._isAllowed(elements)) {\n    assign(actions, this._getEntries(elements));\n  }\n\n  return actions;\n};\n\nAlignElementsContextPadProvider.prototype._isAllowed = function(elements) {\n  return !this._popupMenu.isEmpty(elements, 'align-elements');\n};\n\nAlignElementsContextPadProvider.prototype._getEntries = function() {\n  var self = this;\n\n  return {\n    'align-elements': {\n      group: 'align-elements',\n      title: self._translate('Align elements'),\n      html: `<div class=\"entry\">${ICONS['align']}</div>`,\n      action: {\n        click: function(event, target) {\n          var position = self._getMenuPosition(target);\n\n          assign(position, {\n            cursor: {\n              x: event.x,\n              y: event.y\n            }\n          });\n\n          self._popupMenu.open(target, 'align-elements', position);\n        }\n      }\n    }\n  };\n};\n\nAlignElementsContextPadProvider.prototype._getMenuPosition = function(elements) {\n  var Y_OFFSET = 5;\n\n  var pad = this._contextPad.getPad(elements).html;\n\n  var padRect = pad.getBoundingClientRect();\n\n  var pos = {\n    x: padRect.left,\n    y: padRect.bottom + Y_OFFSET\n  };\n\n  return pos;\n};\n","import ICONS from './AlignElementsIcons';\n\nimport {\n  assign,\n  forEach,\n} from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/features/align-elements/AlignElements').default} AlignElements\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').default} PopupMenu\n * @typedef {import('diagram-js/lib/features/rules/Rules').default} Rules\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n *\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').PopupMenuEntries} PopupMenuEntries\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').default} PopupMenuProvider\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').PopupMenuTarget} PopupMenuTarget\n */\n\nvar ALIGNMENT_OPTIONS = [\n  'left',\n  'center',\n  'right',\n  'top',\n  'middle',\n  'bottom'\n];\n\n/**\n * A provider for the `Align elements` popup menu.\n *\n * @implements {PopupMenuProvider}\n *\n * @param {PopupMenu} popupMenu\n * @param {AlignElements} alignElements\n * @param {Translate} translate\n * @param {Rules} rules\n */\nexport default function AlignElementsMenuProvider(popupMenu, alignElements, translate, rules) {\n\n  this._alignElements = alignElements;\n  this._translate = translate;\n  this._popupMenu = popupMenu;\n  this._rules = rules;\n\n  popupMenu.registerProvider('align-elements', this);\n}\n\nAlignElementsMenuProvider.$inject = [\n  'popupMenu',\n  'alignElements',\n  'translate',\n  'rules'\n];\n\n/**\n * @param {PopupMenuTarget} target\n *\n * @return {PopupMenuEntries}\n */\nAlignElementsMenuProvider.prototype.getPopupMenuEntries = function(target) {\n  var entries = {};\n\n  if (this._isAllowed(target)) {\n    assign(entries, this._getEntries(target));\n  }\n\n  return entries;\n};\n\nAlignElementsMenuProvider.prototype._isAllowed = function(target) {\n  return this._rules.allowed('elements.align', { elements: target });\n};\n\n/**\n * @param {PopupMenuTarget} target\n *\n * @return {PopupMenuEntries}\n */\nAlignElementsMenuProvider.prototype._getEntries = function(target) {\n  var alignElements = this._alignElements,\n      translate = this._translate,\n      popupMenu = this._popupMenu;\n\n  var entries = {};\n\n  forEach(ALIGNMENT_OPTIONS, function(alignment) {\n    entries[ 'align-elements-' + alignment ] = {\n      group: 'align',\n      title: translate('Align elements ' + alignment),\n      className: 'bjs-align-elements-menu-entry',\n      imageHtml: ICONS[ alignment ],\n      action: function() {\n        alignElements.trigger(target, alignment);\n        popupMenu.close();\n      }\n    };\n  });\n\n  return entries;\n};\n","import inherits from 'inherits-browser';\n\nimport RuleProvider from 'diagram-js/lib/features/rules/RuleProvider';\nimport { getParents } from 'diagram-js/lib/util/Elements';\n\nimport {\n  filter\n} from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * Rule provider for aligning BPMN elements.\n *\n * @param {EventBus} eventBus\n */\nexport default function BpmnAlignElements(eventBus) {\n  RuleProvider.call(this, eventBus);\n}\n\nBpmnAlignElements.$inject = [ 'eventBus' ];\n\ninherits(BpmnAlignElements, RuleProvider);\n\nBpmnAlignElements.prototype.init = function() {\n  this.addRule('elements.align', function(context) {\n    var elements = context.elements;\n\n    // filter out elements which cannot be aligned\n    var filteredElements = filter(elements, function(element) {\n      return !(element.waypoints || element.host || element.labelTarget);\n    });\n\n    // filter out elements which are children of any of the selected elements\n    filteredElements = getParents(filteredElements);\n\n    if (filteredElements.length < 2) {\n      return false;\n    }\n\n    return filteredElements;\n  });\n};\n","import AlignElementsModule from 'diagram-js/lib/features/align-elements';\nimport ContextPadModule from 'diagram-js/lib/features/context-pad';\nimport PopupMenuModule from 'diagram-js/lib/features/popup-menu';\n\nimport AlignElementsContextPadProvider from './AlignElementsContextPadProvider';\nimport AlignElementsMenuProvider from './AlignElementsMenuProvider';\nimport BpmnAlignElements from './BpmnAlignElements';\n\nexport default {\n  __depends__: [\n    AlignElementsModule,\n    ContextPadModule,\n    PopupMenuModule\n  ],\n  __init__: [\n    'alignElementsContextPadProvider',\n    'alignElementsMenuProvider',\n    'bpmnAlignElements'\n  ],\n  alignElementsContextPadProvider: [ 'type', AlignElementsContextPadProvider ],\n  alignElementsMenuProvider: [ 'type', AlignElementsMenuProvider ],\n  bpmnAlignElements: [ 'type', BpmnAlignElements ]\n};\n","import { isString } from 'min-dash';\n\nexport { is, isAny } from '../../../util/ModelUtil';\n\nimport {\n  is,\n  isAny,\n  getBusinessObject\n} from '../../../util/ModelUtil';\n\nimport { isHorizontal } from '../../../util/DiUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('../../../model/Types').Element} Element\n */\n\n/**\n * Return the parent of the element with any of the given types.\n *\n * @param {Element} element\n * @param {string|string[]} anyType\n *\n * @return {Element|null}\n */\nexport function getParent(element, anyType) {\n\n  if (isString(anyType)) {\n    anyType = [ anyType ];\n  }\n\n  while ((element = element.parent)) {\n    if (isAny(element, anyType)) {\n      return element;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Determines if the local modeling direction is vertical or horizontal.\n *\n * @param {Element} element\n * @param {ElementRegistry} [elementRegistry] - provide to consider parent diagram direction\n *\n * @return {boolean} false for vertical pools, lanes and their children. true otherwise\n */\nexport function isDirectionHorizontal(element, elementRegistry) {\n\n  var parent = getParent(element, 'bpmn:Process');\n  if (parent) {\n    return true;\n  }\n\n  var types = [ 'bpmn:Participant', 'bpmn:Lane' ];\n\n  parent = getParent(element, types);\n  if (parent) {\n    return isHorizontal(parent);\n  } else if (isAny(element, types)) {\n    return isHorizontal(element);\n  }\n\n  var process;\n  for (process = getBusinessObject(element); process; process = process.$parent) {\n    if (is(process, 'bpmn:Process')) {\n      break;\n    }\n  }\n\n  if (!elementRegistry) {\n    return true;\n  }\n\n  // The direction may be specified in another diagram. We ignore that there\n  // could be multiple diagrams with contradicting properties based on the\n  // assumption that such BPMN files are unusual.\n  var pool = elementRegistry.find(function(shape) {\n    var businessObject = getBusinessObject(shape);\n    return businessObject && businessObject.get('processRef') === process;\n  });\n\n  if (!pool) {\n    return true;\n  }\n\n  return isHorizontal(pool);\n}","import { is } from '../../util/ModelUtil';\n\nimport {\n  isAny,\n  isDirectionHorizontal\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  getMid,\n  asTRBL,\n  getOrientation\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  findFreePosition,\n  generateGetNextPosition,\n  getConnectedDistance\n} from 'diagram-js/lib/features/auto-place/AutoPlaceUtil';\n\nimport { isConnection } from 'diagram-js/lib/util/ModelUtil';\n\n/**\n * @typedef {import('../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n * @typedef {import('diagram-js/lib/util/Types').DirectionTRBL} DirectionTRBL\n */\n\n/**\n * Get the position for given new target relative to the source it will be\n * connected to.\n *\n * @param  {Shape} source\n * @param  {Shape} element\n * @param  {ElementRegistry} elementRegistry\n *\n * @return {Point}\n */\nexport function getNewShapePosition(source, element, elementRegistry) {\n\n  var placeHorizontally = isDirectionHorizontal(source, elementRegistry);\n\n  if (is(element, 'bpmn:TextAnnotation')) {\n    return getTextAnnotationPosition(source, element, placeHorizontally);\n  }\n\n  if (isAny(element, [ 'bpmn:DataObjectReference', 'bpmn:DataStoreReference' ])) {\n    return getDataElementPosition(source, element, placeHorizontally);\n  }\n\n  if (is(element, 'bpmn:FlowNode')) {\n    return getFlowNodePosition(source, element, placeHorizontally);\n  }\n}\n\n/**\n * Get the position for given new flow node. Try placing the flow node right/bottom of\n * the source.\n *\n * @param {Shape} source\n * @param {Shape} element\n * @param {boolean} placeHorizontally Whether to place the new element horizontally\n *\n * @return {Point}\n */\nexport function getFlowNodePosition(source, element, placeHorizontally) {\n\n  var sourceTrbl = asTRBL(source);\n  var sourceMid = getMid(source);\n\n  var placement = placeHorizontally ? {\n    directionHint: 'e',\n    minDistance: 80,\n    baseOrientation: 'left',\n    boundaryOrientation: 'top',\n    start: 'top',\n    end: 'bottom'\n  } : {\n    directionHint: 's',\n    minDistance: 90,\n    baseOrientation: 'top',\n    boundaryOrientation: 'left',\n    start: 'left',\n    end: 'right'\n  };\n\n  var connectedDistance = getConnectedDistance(source, {\n    filter: function(connection) {\n      return is(connection, 'bpmn:SequenceFlow');\n    },\n    direction: placement.directionHint\n  });\n\n  var margin = 30,\n      minDistance = placement.minDistance,\n      orientation = placement.baseOrientation;\n\n  if (is(source, 'bpmn:BoundaryEvent')) {\n    orientation = getOrientation(source, source.host, -25);\n\n    if (orientation.indexOf(placement.boundaryOrientation) !== -1) {\n      margin *= -1;\n    }\n  }\n\n  var position = placeHorizontally ? {\n    x: sourceTrbl.right + connectedDistance + element.width / 2,\n    y: sourceMid.y + getDistance(orientation, minDistance, placement)\n  } : {\n    x: sourceMid.x + getDistance(orientation, minDistance, placement),\n    y: sourceTrbl.bottom + connectedDistance + element.height / 2\n  };\n\n  var nextPosition = {\n    margin: margin,\n    minDistance: minDistance\n  };\n\n  var nextPositionDirection = placeHorizontally ? {\n    y: nextPosition\n  } : {\n    x: nextPosition\n  };\n\n  return findFreePosition(source, element, position, generateGetNextPosition(nextPositionDirection));\n}\n\n/**\n * @param {DirectionTRBL} orientation\n * @param {number} minDistance\n * @param {{ start: DirectionTRBL, end: DirectionTRBL }} placement\n *\n * @return {number}\n */\nfunction getDistance(orientation, minDistance, placement) {\n  if (orientation.includes(placement.start)) {\n    return -1 * minDistance;\n  } else if (orientation.includes(placement.end)) {\n    return minDistance;\n  } else {\n    return 0;\n  }\n}\n\n\n/**\n * Get the position for given text annotation. Try placing the text annotation\n * top-right of the source (bottom-right in vertical layouts).\n *\n * @param {Shape} source\n * @param {Shape} element\n * @param {boolean} placeHorizontally Whether to place the new element horizontally\n *\n * @return {Point}\n */\nexport function getTextAnnotationPosition(source, element, placeHorizontally) {\n\n  var sourceTrbl = asTRBL(source);\n\n  var position = placeHorizontally ? {\n    x: sourceTrbl.right + element.width / 2,\n    y: sourceTrbl.top - 50 - element.height / 2\n  } : {\n    x: sourceTrbl.right + 50 + element.width / 2,\n    y: sourceTrbl.bottom + element.height / 2\n  };\n\n  if (isConnection(source)) {\n    position = getMid(source);\n    if (placeHorizontally) {\n      position.x += 100;\n      position.y -= 50;\n    } else {\n      position.x += 100;\n      position.y += 50;\n    }\n  }\n\n  var nextPosition = {\n    margin: placeHorizontally ? -30 : 30,\n    minDistance: 20\n  };\n  var nextPositionDirection = placeHorizontally ? {\n    y: nextPosition\n  } : {\n    x: nextPosition\n  };\n\n  return findFreePosition(source, element, position, generateGetNextPosition(nextPositionDirection));\n}\n\n\n/**\n * Get the position for given new data element. Try placing the data element\n * bottom-right of the source (bottom-left in vertical layouts).\n *\n * @param {Shape} source\n * @param {Shape} element\n * @param {boolean} placeHorizontally Whether to place the new element horizontally\n *\n * @return {Point}\n */\nexport function getDataElementPosition(source, element, placeHorizontally) {\n\n  var sourceTrbl = asTRBL(source);\n\n  var position = placeHorizontally ? {\n    x: sourceTrbl.right - 10 + element.width / 2,\n    y: sourceTrbl.bottom + 40 + element.width / 2\n  } : {\n    x: sourceTrbl.left - 40 - element.width / 2,\n    y: sourceTrbl.bottom - 10 + element.height / 2\n  };\n\n  var nextPosition = {\n    margin: 30,\n    minDistance: 30\n  };\n  var nextPositionDirection = placeHorizontally ? {\n    x: nextPosition\n  } : {\n    y: nextPosition\n  };\n\n  return findFreePosition(source, element, position, generateGetNextPosition(nextPositionDirection));\n}","import { getNewShapePosition } from './BpmnAutoPlaceUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n */\n\n/**\n * BPMN auto-place behavior.\n *\n * @param {EventBus} eventBus\n * @param {ElementRegistry} elementRegistry\n */\nexport default function AutoPlace(eventBus, elementRegistry) {\n  eventBus.on('autoPlace', function(context) {\n    var shape = context.shape,\n        source = context.source;\n\n    return getNewShapePosition(source, shape, elementRegistry);\n  });\n}\n\nAutoPlace.$inject = [ 'eventBus', 'elementRegistry' ];","import AutoPlaceModule from 'diagram-js/lib/features/auto-place';\n\nimport BpmnAutoPlace from './BpmnAutoPlace';\n\nexport default {\n  __depends__: [ AutoPlaceModule ],\n  __init__: [ 'bpmnAutoPlace' ],\n  bpmnAutoPlace: [ 'type', BpmnAutoPlace ]\n};","import inherits from 'inherits-browser';\n\nimport { getBBox as getBoundingBox } from '../../util/Elements';\n\nimport {\n  asTRBL,\n  asBounds\n} from '../../layout/LayoutUtil';\n\nimport {\n  assign,\n  flatten,\n  find,\n  forEach,\n  groupBy,\n  isArray,\n  matchPattern,\n  pick,\n  values\n} from 'min-dash';\n\nimport CommandInterceptor from '../../command/CommandInterceptor';\n\n/**\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n *\n * @typedef {import('../../util/Types').Direction} Direction\n * @typedef {import('../../util/Types').Rect} Rect\n * @typedef {import('../../util/Types').RectTRBL} RectTRBL\n *\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../modeling/Modeling').default} Modeling\n * @typedef {import('../rules/Rules').default} Rules\n */\n\n/**\n * An auto resize component that takes care of expanding a parent element\n * if child elements are created or moved close the parents edge.\n *\n * @param {EventBus} eventBus\n * @param {ElementRegistry} elementRegistry\n * @param {Modeling} modeling\n * @param {Rules} rules\n */\nexport default function AutoResize(eventBus, elementRegistry, modeling, rules) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this._elementRegistry = elementRegistry;\n  this._modeling = modeling;\n  this._rules = rules;\n\n  var self = this;\n\n  this.postExecuted([ 'shape.create' ], function(event) {\n    var context = event.context,\n        hints = context.hints || {},\n        shape = context.shape,\n        parent = context.parent || context.newParent;\n\n    if (hints.autoResize === false) {\n      return;\n    }\n\n    self._expand([ shape ], parent);\n  });\n\n  this.postExecuted([ 'elements.move' ], function(event) {\n    var context = event.context,\n        elements = flatten(values(context.closure.topLevel)),\n        hints = context.hints;\n\n    var autoResize = hints ? hints.autoResize : true;\n\n    if (autoResize === false) {\n      return;\n    }\n\n    var expandings = groupBy(elements, function(element) {\n      return element.parent.id;\n    });\n\n    forEach(expandings, function(elements, parentId) {\n\n      // optionally filter elements to be considered when resizing\n      if (isArray(autoResize)) {\n        elements = elements.filter(function(element) {\n          return find(autoResize, matchPattern({ id: element.id }));\n        });\n      }\n\n      self._expand(elements, parentId);\n    });\n  });\n\n  this.postExecuted([ 'shape.toggleCollapse' ], function(event) {\n    var context = event.context,\n        hints = context.hints,\n        shape = context.shape;\n\n    if (hints && hints.autoResize === false) {\n      return;\n    }\n\n    if (shape.collapsed) {\n      return;\n    }\n\n    self._expand(shape.children || [], shape);\n  });\n\n  this.postExecuted([ 'shape.resize' ], function(event) {\n    var context = event.context,\n        hints = context.hints,\n        shape = context.shape,\n        parent = shape.parent;\n\n    if (hints && hints.autoResize === false) {\n      return;\n    }\n\n    if (parent) {\n      self._expand([ shape ], parent);\n    }\n  });\n\n}\n\nAutoResize.$inject = [\n  'eventBus',\n  'elementRegistry',\n  'modeling',\n  'rules'\n];\n\ninherits(AutoResize, CommandInterceptor);\n\n\n/**\n * Calculate the new bounds of the target shape, given\n * a number of elements have been moved or added into the parent.\n *\n * This method considers the current size, the added elements as well as\n * the provided padding for the new bounds.\n *\n * @param {Shape[]} elements\n * @param {Shape} target\n */\nAutoResize.prototype._getOptimalBounds = function(elements, target) {\n\n  var offset = this.getOffset(target),\n      padding = this.getPadding(target);\n\n  var elementsTrbl = asTRBL(getBoundingBox(elements)),\n      targetTrbl = asTRBL(target);\n\n  var newTrbl = {};\n\n  if (elementsTrbl.top - targetTrbl.top < padding.top) {\n    newTrbl.top = elementsTrbl.top - offset.top;\n  }\n\n  if (elementsTrbl.left - targetTrbl.left < padding.left) {\n    newTrbl.left = elementsTrbl.left - offset.left;\n  }\n\n  if (targetTrbl.right - elementsTrbl.right < padding.right) {\n    newTrbl.right = elementsTrbl.right + offset.right;\n  }\n\n  if (targetTrbl.bottom - elementsTrbl.bottom < padding.bottom) {\n    newTrbl.bottom = elementsTrbl.bottom + offset.bottom;\n  }\n\n  return asBounds(assign({}, targetTrbl, newTrbl));\n};\n\n\n/**\n * Expand the target shape respecting rules, offset and padding\n *\n * @param {Shape[]} elements\n * @param {Shape|string} target The target or its ID.\n */\nAutoResize.prototype._expand = function(elements, target) {\n\n  if (typeof target === 'string') {\n    target = this._elementRegistry.get(target);\n  }\n\n  var allowed = this._rules.allowed('element.autoResize', {\n    elements: elements,\n    target: target\n  });\n\n  if (!allowed) {\n    return;\n  }\n\n  // calculate the new bounds\n  var newBounds = this._getOptimalBounds(elements, target);\n\n  if (!boundsChanged(newBounds, target)) {\n    return;\n  }\n\n  var resizeDirections = getResizeDirections(pick(target, [ 'x', 'y', 'width', 'height' ]), newBounds);\n\n  // resize the parent shape\n  this.resize(target, newBounds, {\n    autoResize: resizeDirections\n  });\n\n  var parent = target.parent;\n\n  // recursively expand parent elements\n  if (parent) {\n    this._expand([ target ], parent);\n  }\n};\n\n\n/**\n * Get the amount to expand the given shape in each direction.\n *\n * @param {Shape} shape\n *\n * @return {RectTRBL}\n */\nAutoResize.prototype.getOffset = function(shape) {\n  return { top: 60, bottom: 60, left: 100, right: 100 };\n};\n\n\n/**\n * Get the activation threshold for each side for which\n * resize triggers.\n *\n * @param {Shape} shape\n *\n * @return {RectTRBL}\n */\nAutoResize.prototype.getPadding = function(shape) {\n  return { top: 2, bottom: 2, left: 15, right: 15 };\n};\n\n\n/**\n * Perform the actual resize operation.\n *\n * @param {Shape} shape\n * @param {Rect} newBounds\n * @param {Object} [hints]\n * @param {string} [hints.autoResize]\n */\nAutoResize.prototype.resize = function(shape, newBounds, hints) {\n  this._modeling.resizeShape(shape, newBounds, null, hints);\n};\n\n\nfunction boundsChanged(newBounds, oldBounds) {\n  return (\n    newBounds.x !== oldBounds.x ||\n    newBounds.y !== oldBounds.y ||\n    newBounds.width !== oldBounds.width ||\n    newBounds.height !== oldBounds.height\n  );\n}\n\n/**\n * Get directions of resize as {n|w|s|e} e.g. \"nw\".\n *\n * @param {Rect} oldBounds\n * @param {Rect} newBounds\n *\n * @return {Direction} Resize directions as {n|w|s|e}.\n */\nfunction getResizeDirections(oldBounds, newBounds) {\n  var directions = '';\n\n  oldBounds = asTRBL(oldBounds);\n  newBounds = asTRBL(newBounds);\n\n  if (oldBounds.top > newBounds.top) {\n    directions = directions.concat('n');\n  }\n\n  if (oldBounds.right < newBounds.right) {\n    directions = directions.concat('w');\n  }\n\n  if (oldBounds.bottom < newBounds.bottom) {\n    directions = directions.concat('s');\n  }\n\n  if (oldBounds.left > newBounds.left) {\n    directions = directions.concat('e');\n  }\n\n  return directions;\n}","import AutoResize from 'diagram-js/lib/features/auto-resize/AutoResize';\n\nimport inherits from 'inherits-browser';\n\nimport { is } from '../../util/ModelUtil';\n\n/**\n * @typedef {import('didi').Injector} Injector\n *\n * @typedef {import('../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n */\n\n/**\n * BPMN-specific resize behavior.\n *\n * @param {Injector} injector\n */\nexport default function BpmnAutoResize(injector) {\n\n  injector.invoke(AutoResize, this);\n}\n\nBpmnAutoResize.$inject = [\n  'injector'\n];\n\ninherits(BpmnAutoResize, AutoResize);\n\n/**\n * Perform BPMN-specific resizing of participants.\n *\n * @param {Shape} target\n * @param {Rect} newBounds\n * @param {Object} [hints]\n * @param {string} [hints.autoResize]\n */\nBpmnAutoResize.prototype.resize = function(target, newBounds, hints) {\n\n  if (is(target, 'bpmn:Participant')) {\n    this._modeling.resizeLane(target, newBounds, null, hints);\n  } else {\n    this._modeling.resizeShape(target, newBounds, null, hints);\n  }\n};","import RuleProvider from '../rules/RuleProvider';\n\nimport inherits from 'inherits-browser';\n\n/**\n * @typedef {import('../../model/Types').Shape} Shape\n *\n * @typedef {import('../../core/EventBus').default} EventBus\n */\n\n/**\n * This is a base rule provider for the element.autoResize rule.\n *\n * @param {EventBus} eventBus\n */\nexport default function AutoResizeProvider(eventBus) {\n\n  RuleProvider.call(this, eventBus);\n\n  var self = this;\n\n  this.addRule('element.autoResize', function(context) {\n    return self.canResize(context.elements, context.target);\n  });\n}\n\nAutoResizeProvider.$inject = [ 'eventBus' ];\n\ninherits(AutoResizeProvider, RuleProvider);\n\n/**\n * Needs to be implemented by sub classes to allow actual auto resize\n *\n * @param {Shape[]} elements\n * @param {Shape} target\n *\n * @return {boolean}\n */\nAutoResizeProvider.prototype.canResize = function(elements, target) {\n  return false;\n};","import { is } from '../../util/ModelUtil';\n\nimport { isLabel } from '../../util/LabelUtil';\n\nimport inherits from 'inherits-browser';\n\nimport { forEach } from 'min-dash';\n\nimport AutoResizeProvider from 'diagram-js/lib/features/auto-resize/AutoResizeProvider';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../modeling/Modeling').default} Modeling\n *\n * @typedef {import('../../model/Types').Shape} Shape\n */\n\n/**\n * BPMN-specific provider for automatic resizung.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function BpmnAutoResizeProvider(eventBus, modeling) {\n  AutoResizeProvider.call(this, eventBus);\n\n  this._modeling = modeling;\n}\n\ninherits(BpmnAutoResizeProvider, AutoResizeProvider);\n\nBpmnAutoResizeProvider.$inject = [\n  'eventBus',\n  'modeling'\n];\n\n\n/**\n * BPMN-specific check whether given elements can be resized.\n *\n * @param {Shape[]} elements\n * @param {Shape} target\n *\n * @return {boolean}\n */\nBpmnAutoResizeProvider.prototype.canResize = function(elements, target) {\n\n  // do not resize plane elements:\n  // root elements, collapsed sub-processes\n  if (is(target.di, 'bpmndi:BPMNPlane')) {\n    return false;\n  }\n\n  if (!is(target, 'bpmn:Participant') && !is(target, 'bpmn:Lane') && !(is(target, 'bpmn:SubProcess'))) {\n    return false;\n  }\n\n  var canResize = true;\n\n  forEach(elements, function(element) {\n\n    if (is(element, 'bpmn:Lane') || isLabel(element)) {\n      canResize = false;\n      return;\n    }\n  });\n\n  return canResize;\n};\n","import BpmnAutoResize from './BpmnAutoResize';\nimport BpmnAutoResizeProvider from './BpmnAutoResizeProvider';\n\n\nexport default {\n  __init__: [\n    'bpmnAutoResize',\n    'bpmnAutoResizeProvider'\n  ],\n  bpmnAutoResize: [ 'type', BpmnAutoResize ],\n  bpmnAutoResizeProvider: [ 'type', BpmnAutoResizeProvider ]\n};\n","import {\n  clear as svgClear,\n  create as svgCreate\n} from 'tiny-svg';\n\nimport { getVisual } from '../../util/GraphicsUtil';\n\nimport { isConnection } from '../../util/ModelUtil';\n\nimport { translate } from '../../util/SvgTransformUtil';\n\n/**\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n * @typedef {import('../../util/Types').Point} Point\n * @typedef {import('../../util/Types').Rect} Rect\n *\n * @typedef { { element: Element, delta: Point } } MovedOption\n * @typedef { { shape: Shape, bounds: Rect } } ResizedOption\n *\n * @typedef { {\n *   created?: Element[],\n *   removed?: Element[],\n *   moved?: MovedOption[],\n *   resized?: ResizedOption[]\n * } } CreateOptions\n */\n\nconst LAYER_NAME = 'complex-preview';\n\n/**\n * Complex preview for shapes and connections.\n */\nexport default class ComplexPreview {\n  constructor(canvas, graphicsFactory, previewSupport) {\n    this._canvas = canvas;\n    this._graphicsFactory = graphicsFactory;\n    this._previewSupport = previewSupport;\n\n    this._markers = [];\n  }\n\n  /**\n   * Create complex preview.\n   *\n   * @param {CreateOptions} options\n   */\n  create(options) {\n\n    // there can only be one complex preview at a time\n    this.cleanUp();\n\n    const {\n      created = [],\n      moved = [],\n      removed = [],\n      resized = []\n    } = options;\n\n    const layer = this._canvas.getLayer(LAYER_NAME);\n\n    // shapes and connections to be created\n    created.filter(element => !isHidden(element)).forEach(element => {\n      let gfx;\n\n      if (isConnection(element)) {\n        gfx = this._graphicsFactory._createContainer('connection', svgCreate('g'));\n\n        this._graphicsFactory.drawConnection(getVisual(gfx), element);\n      } else {\n        gfx = this._graphicsFactory._createContainer('shape', svgCreate('g'));\n\n        this._graphicsFactory.drawShape(getVisual(gfx), element);\n\n        translate(gfx, element.x, element.y);\n      }\n\n      this._previewSupport.addDragger(element, layer, gfx);\n    });\n\n    // elements to be moved\n    moved.forEach(({ element, delta }) => {\n      this._previewSupport.addDragger(element, layer, undefined, 'djs-dragging');\n\n      this._canvas.addMarker(element, 'djs-element-hidden');\n\n      this._markers.push([ element, 'djs-element-hidden' ]);\n\n      const dragger = this._previewSupport.addDragger(element, layer);\n\n      if (isConnection(element)) {\n        translate(dragger, delta.x, delta.y);\n      } else {\n        translate(dragger, element.x + delta.x, element.y + delta.y);\n      }\n    });\n\n    // elements to be removed\n    removed.forEach(element => {\n      this._previewSupport.addDragger(element, layer, undefined, 'djs-dragging');\n\n      this._canvas.addMarker(element, 'djs-element-hidden');\n\n      this._markers.push([ element, 'djs-element-hidden' ]);\n    });\n\n    // elements to be resized\n    resized.forEach(({ shape, bounds }) => {\n      this._canvas.addMarker(shape, 'djs-hidden');\n\n      this._markers.push([ shape, 'djs-hidden' ]);\n\n      this._previewSupport.addDragger(shape, layer, undefined, 'djs-dragging');\n\n      const gfx = this._graphicsFactory._createContainer('shape', svgCreate('g'));\n\n      this._graphicsFactory.drawShape(getVisual(gfx), shape, {\n        width: bounds.width,\n        height: bounds.height\n      });\n\n      translate(gfx, bounds.x, bounds.y);\n\n      this._previewSupport.addDragger(shape, layer, gfx);\n    });\n  }\n\n  cleanUp() {\n    svgClear(this._canvas.getLayer(LAYER_NAME));\n\n    this._markers.forEach(([ element, marker ]) => this._canvas.removeMarker(element, marker));\n\n    this._markers = [];\n  }\n\n  show() {\n    this._canvas.showLayer(LAYER_NAME);\n  }\n\n  hide() {\n    this._canvas.hideLayer(LAYER_NAME);\n  }\n}\n\nComplexPreview.$inject = [\n  'canvas',\n  'graphicsFactory',\n  'previewSupport'\n];\n\nfunction isHidden(element) {\n  return element.hidden;\n}","import PreviewSupportModule from '../preview-support';\n\nimport ComplexPreview from './ComplexPreview';\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __depends__: [ PreviewSupportModule ],\n  __init__: [ 'complexPreview' ],\n  complexPreview: [ 'type', ComplexPreview ]\n};","import inherits from 'inherits-browser';\n\nimport {\n  getOrientation,\n  getMid,\n  asTRBL\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  substract\n} from 'diagram-js/lib/util/Math';\n\nimport {\n  hasExternalLabel\n} from '../../../util/LabelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { isConnection } from 'diagram-js/lib/util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n *\n * @typedef {import('../../../model/Types').Element} Element\n * @typedef {import('../../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').DirectionTRBL} DirectionTRBL\n */\n\nvar ALIGNMENTS = [\n  'top',\n  'bottom',\n  'left',\n  'right'\n];\n\nvar ELEMENT_LABEL_DISTANCE = 10;\n\n/**\n * A behavior that ensures that labels are positioned in a way that they do not\n * overlap with other elements or connections.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function AdaptiveLabelPositioningBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this.postExecuted([\n    'connection.create',\n    'connection.layout',\n    'connection.updateWaypoints'\n  ], function(event) {\n    var context = event.context,\n        connection = context.connection,\n        source = connection.source,\n        target = connection.target,\n        hints = context.hints || {};\n\n    if (hints.createElementsBehavior !== false) {\n      checkLabelAdjustment(source);\n      checkLabelAdjustment(target);\n    }\n  });\n\n\n  this.postExecuted([\n    'label.create'\n  ], function(event) {\n    var context = event.context,\n        shape = context.shape,\n        hints = context.hints || {};\n\n    if (hints.createElementsBehavior !== false) {\n      checkLabelAdjustment(shape.labelTarget);\n    }\n  });\n\n\n  this.postExecuted([\n    'elements.create'\n  ], function(event) {\n    var context = event.context,\n        elements = context.elements,\n        hints = context.hints || {};\n\n    if (hints.createElementsBehavior !== false) {\n      elements.forEach(function(element) {\n        checkLabelAdjustment(element);\n      });\n    }\n  });\n\n  function checkLabelAdjustment(element) {\n\n    // skip non-existing labels\n    if (!hasExternalLabel(element)) {\n      return;\n    }\n\n    if (isConnection(element)) {\n      return;\n    }\n\n    var optimalPosition = getOptimalPosition(element);\n\n    // no optimal position found\n    if (!optimalPosition) {\n      return;\n    }\n\n    adjustLabelPosition(element, optimalPosition);\n  }\n\n  function adjustLabelPosition(element, orientation) {\n\n    var elementMid = getMid(element),\n        label = element.label,\n        labelMid = getMid(label);\n\n    // ignore labels that are being created\n    if (!label.parent) {\n      return;\n    }\n\n    var elementTrbl = asTRBL(element);\n\n    var newLabelMid;\n\n    switch (orientation) {\n    case 'top':\n      newLabelMid = {\n        x: elementMid.x,\n        y: elementTrbl.top - ELEMENT_LABEL_DISTANCE - label.height / 2\n      };\n\n      break;\n\n    case 'left':\n\n      newLabelMid = {\n        x: elementTrbl.left - ELEMENT_LABEL_DISTANCE - label.width / 2,\n        y: elementMid.y\n      };\n\n      break;\n\n    case 'bottom':\n\n      newLabelMid = {\n        x: elementMid.x,\n        y: elementTrbl.bottom + ELEMENT_LABEL_DISTANCE + label.height / 2\n      };\n\n      break;\n\n    case 'right':\n\n      newLabelMid = {\n        x: elementTrbl.right + ELEMENT_LABEL_DISTANCE + label.width / 2,\n        y: elementMid.y\n      };\n\n      break;\n    }\n\n    var delta = substract(newLabelMid, labelMid);\n\n    modeling.moveShape(label, delta);\n  }\n\n}\n\ninherits(AdaptiveLabelPositioningBehavior, CommandInterceptor);\n\nAdaptiveLabelPositioningBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\n/**\n * Return alignments which are taken by a boundary's host element\n *\n * @param {Shape} element\n *\n * @return {DirectionTRBL[]}\n */\nfunction getTakenHostAlignments(element) {\n\n  var hostElement = element.host,\n      elementMid = getMid(element),\n      hostOrientation = getOrientation(elementMid, hostElement);\n\n  var freeAlignments;\n\n  // check whether there is a multi-orientation, e.g. 'top-left'\n  if (hostOrientation.indexOf('-') >= 0) {\n    freeAlignments = hostOrientation.split('-');\n  } else {\n    freeAlignments = [ hostOrientation ];\n  }\n\n  var takenAlignments = ALIGNMENTS.filter(function(alignment) {\n\n    return freeAlignments.indexOf(alignment) === -1;\n  });\n\n  return takenAlignments;\n\n}\n\n/**\n * Return alignments which are taken by related connections\n *\n * @param {Element} element\n *\n * @return {DirectionTRBL[]}\n */\nfunction getTakenConnectionAlignments(element) {\n\n  var elementMid = getMid(element);\n\n  var takenAlignments = [].concat(\n    element.incoming.map(function(c) {\n      return c.waypoints[c.waypoints.length - 2 ];\n    }),\n    element.outgoing.map(function(c) {\n      return c.waypoints[1];\n    })\n  ).map(function(point) {\n    return getApproximateOrientation(elementMid, point);\n  });\n\n  return takenAlignments;\n}\n\n/**\n * Return the optimal label position around an element\n * or `undefined`, if none was found.\n *\n * @param  {Element} element\n *\n * @return {DirectionTRBL|undefined}\n */\nfunction getOptimalPosition(element) {\n\n  var labelMid = getMid(element.label);\n\n  var elementMid = getMid(element);\n\n  var labelOrientation = getApproximateOrientation(elementMid, labelMid);\n\n  if (!isAligned(labelOrientation)) {\n    return;\n  }\n\n  var takenAlignments = getTakenConnectionAlignments(element);\n\n  if (element.host) {\n    var takenHostAlignments = getTakenHostAlignments(element);\n\n    takenAlignments = takenAlignments.concat(takenHostAlignments);\n  }\n\n  var freeAlignments = ALIGNMENTS.filter(function(alignment) {\n\n    return takenAlignments.indexOf(alignment) === -1;\n  });\n\n  // NOTHING TO DO; label already aligned a.O.K.\n  if (freeAlignments.indexOf(labelOrientation) !== -1) {\n    return;\n  }\n\n  return freeAlignments[0];\n}\n\nfunction getApproximateOrientation(p0, p1) {\n  return getOrientation(p1, p0, 5);\n}\n\nfunction isAligned(orientation) {\n  return ALIGNMENTS.indexOf(orientation) !== -1;\n}\n","import inherits from 'inherits-browser';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\nexport default function AppendBehavior(eventBus) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  // assign correct shape position unless already set\n\n  this.preExecute('shape.append', function(context) {\n\n    var source = context.source,\n        shape = context.shape;\n\n    if (!context.position) {\n\n      if (is(shape, 'bpmn:TextAnnotation')) {\n        context.position = {\n          x: source.x + source.width / 2 + 75,\n          y: source.y - 50 - shape.height / 2\n        };\n      } else {\n        context.position = {\n          x: source.x + source.width + 80 + shape.width / 2,\n          y: source.y + source.height / 2\n        };\n      }\n    }\n  }, true);\n}\n\ninherits(AppendBehavior, CommandInterceptor);\n\nAppendBehavior.$inject = [\n  'eventBus'\n];","import inherits from 'inherits-browser';\r\n\r\nimport { is } from '../../../util/ModelUtil';\r\n\r\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\r\n\r\nimport {\r\n  filter,\r\n  forEach\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('didi').Injector} Injector\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * @param {Injector} injector\r\n * @param {Modeling} modeling\r\n */\r\nexport default function AssociationBehavior(injector, modeling) {\r\n  injector.invoke(CommandInterceptor, this);\r\n\r\n  this.postExecute('shape.move', function(context) {\r\n    var newParent = context.newParent,\r\n        shape = context.shape;\r\n\r\n    var associations = filter(shape.incoming.concat(shape.outgoing), function(connection) {\r\n      return is(connection, 'bpmn:Association');\r\n    });\r\n\r\n    forEach(associations, function(association) {\r\n      modeling.moveConnection(association, { x: 0, y: 0 }, newParent);\r\n    });\r\n  }, true);\r\n}\r\n\r\ninherits(AssociationBehavior, CommandInterceptor);\r\n\r\nAssociationBehavior.$inject = [\r\n  'injector',\r\n  'modeling'\r\n];","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { getBusinessObject } from '../../../util/ModelUtil';\n\nimport { isAny } from '../util/ModelingUtil';\n\nimport { isLabel } from '../../../util/LabelUtil';\n\n/**\n * @typedef {import('../../replace/BpmnReplace').default} BpmnReplace\n * @typedef {import('didi').Injector} Injector\n */\n\nvar LOW_PRIORITY = 500;\n\n\n/**\n * Replace intermediate event with boundary event when creating or moving results in attached event.\n *\n * @param {BpmnReplace} bpmnReplace\n * @param {Injector} injector\n */\nexport default function AttachEventBehavior(bpmnReplace, injector) {\n  injector.invoke(CommandInterceptor, this);\n\n  this._bpmnReplace = bpmnReplace;\n\n  var self = this;\n\n  this.postExecuted('elements.create', LOW_PRIORITY, function(context) {\n    var elements = context.elements;\n\n    elements = elements.filter(function(shape) {\n      var host = shape.host;\n\n      return shouldReplace(shape, host);\n    });\n\n    if (elements.length !== 1) {\n      return;\n    }\n\n    elements.map(function(element) {\n      return elements.indexOf(element);\n    }).forEach(function(index) {\n      var host = elements[ index ];\n\n      context.elements[ index ] = self._replaceShape(elements[ index ], host);\n    });\n  }, true);\n\n\n  this.preExecute('elements.move', LOW_PRIORITY, function(context) {\n    var shapes = context.shapes,\n        host = context.newHost;\n\n    if (shapes.length !== 1) {\n      return;\n    }\n\n    var shape = shapes[0];\n\n    if (shouldReplace(shape, host)) {\n      context.shapes = [ self._replaceShape(shape, host) ];\n    }\n  }, true);\n}\n\nAttachEventBehavior.$inject = [\n  'bpmnReplace',\n  'injector'\n];\n\ninherits(AttachEventBehavior, CommandInterceptor);\n\nAttachEventBehavior.prototype._replaceShape = function(shape, host) {\n  var eventDefinition = getEventDefinition(shape);\n\n  var boundaryEvent = {\n    type: 'bpmn:BoundaryEvent',\n    host: host\n  };\n\n  if (eventDefinition) {\n    boundaryEvent.eventDefinitionType = eventDefinition.$type;\n  }\n\n  return this._bpmnReplace.replaceElement(shape, boundaryEvent, { layoutConnection: false });\n};\n\n\n// helpers //////////\n\nfunction getEventDefinition(element) {\n  var businessObject = getBusinessObject(element),\n      eventDefinitions = businessObject.eventDefinitions;\n\n  return eventDefinitions && eventDefinitions[0];\n}\n\nfunction shouldReplace(shape, host) {\n  return !isLabel(shape) &&\n    isAny(shape, [ 'bpmn:IntermediateThrowEvent', 'bpmn:IntermediateCatchEvent' ]) && !!host;\n}\n","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport {\n  filter,\n  forEach\n} from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * BPMN specific boundary event behavior.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function BoundaryEventBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  function getBoundaryEvents(element) {\n    return filter(element.attachers, function(attacher) {\n      return is(attacher, 'bpmn:BoundaryEvent');\n    });\n  }\n\n  // remove after connecting to event-based gateway\n  this.postExecute('connection.create', function(event) {\n    var source = event.context.source,\n        target = event.context.target,\n        boundaryEvents = getBoundaryEvents(target);\n\n    if (\n      is(source, 'bpmn:EventBasedGateway') &&\n      is(target, 'bpmn:ReceiveTask') &&\n      boundaryEvents.length > 0\n    ) {\n      modeling.removeElements(boundaryEvents);\n    }\n\n  });\n\n  // remove after replacing connected gateway with event-based gateway\n  this.postExecute('connection.reconnect', function(event) {\n    var oldSource = event.context.oldSource,\n        newSource = event.context.newSource;\n\n    if (is(oldSource, 'bpmn:Gateway') &&\n        is(newSource, 'bpmn:EventBasedGateway')) {\n      forEach(newSource.outgoing, function(connection) {\n        var target = connection.target,\n            attachedboundaryEvents = getBoundaryEvents(target);\n\n        if (is(target, 'bpmn:ReceiveTask') &&\n            attachedboundaryEvents.length > 0) {\n          modeling.removeElements(attachedboundaryEvents);\n        }\n      });\n    }\n  });\n\n}\n\nBoundaryEventBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n\ninherits(BoundaryEventBehavior, CommandInterceptor);","import inherits from 'inherits-browser';\n\nimport { getBusinessObject, is } from '../../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { hasEventDefinition, isEventSubProcess } from '../../../util/DiUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../lib/features/modeling/Modeling').default} Modeling\n */\n\n/**\n * Behavior ensuring that only a single compensation activity is connected to a\n * compensation boundary event when connecting, reconnecting or replacing shapes.\n *\n * @param {import('diagram-js/lib/core/EventBus').default} eventBus\n * @param {import('../Modeling').default} modeling\n * @param {import('../../rules/BpmnRules').default} bpmnRules\n */\nexport default function CompensateBoundaryEventBehavior(eventBus, modeling, bpmnRules) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this.preExecute('shape.replace', handleReplacement, true);\n  this.postExecuted('shape.replace', handleReplacementPostExecuted, true);\n  this.preExecute('connection.create', handleNewConnection, true);\n  this.postExecuted('connection.delete', handleConnectionRemoval, true);\n  this.postExecuted('connection.reconnect', handleReconnection, true);\n  this.postExecuted('element.updateProperties', handlePropertiesUpdate, true);\n\n  /**\n   * Given a connection from boundary event is removed, remove the `isForCompensation` property.\n   */\n  function handleConnectionRemoval(context) {\n    const source = context.source,\n          target = context.target;\n\n    if (isCompensationBoundaryEvent(source) && isForCompensation(target)) {\n      removeIsForCompensationProperty(target);\n    }\n  }\n\n  /**\n   * Add `isForCompensation` property and make sure only a single compensation activity is connected.\n   */\n  function handleNewConnection(context) {\n    const connection = context.connection,\n          source = context.source,\n          target = context.target;\n\n    if (isCompensationBoundaryEvent(source) && isForCompensationAllowed(target)) {\n      addIsForCompensationProperty(target);\n      removeExistingAssociations(source, [ connection ]);\n    }\n  }\n\n  function handleReconnection(context) {\n    const newTarget = context.newTarget,\n          oldSource = context.oldSource,\n          oldTarget = context.oldTarget;\n\n    // target changes\n    if (oldTarget !== newTarget) {\n      const source = oldSource;\n\n      // oldTarget perspective\n      if (isForCompensation(oldTarget)) {\n        removeIsForCompensationProperty(oldTarget);\n      }\n\n      // newTarget perspective\n      if (isCompensationBoundaryEvent(source) && isForCompensationAllowed(newTarget)) {\n        addIsForCompensationProperty(newTarget);\n      }\n    }\n  }\n\n  function handlePropertiesUpdate(context) {\n    const { element } = context;\n\n    if (isForCompensation(element)) {\n      removeDisallowedConnections(element);\n      removeAttachments(element);\n    } else if (isForCompensationAllowed(element)) {\n      removeIncomingCompensationAssociations(element);\n    }\n  }\n\n  /**\n   * When replacing a boundary event, make sure the compensation activity is connected,\n   * and remove the potential candidates for connection replacement to have a single compensation activity.\n   */\n  function handleReplacement(context) {\n    const {\n      newData,\n      oldShape\n    } = context;\n\n    // from compensate boundary event\n    if (isCompensationBoundaryEvent(context.oldShape) &&\n      newData.eventDefinitionType !== 'bpmn:CompensateEventDefinition' ||\n      newData.type !== 'bpmn:BoundaryEvent'\n    ) {\n      const targetConnection = oldShape.outgoing.find(\n        ({ target }) => isForCompensation(target)\n      );\n\n      if (targetConnection && targetConnection.target) {\n        context._connectionTarget = targetConnection.target;\n      }\n    }\n\n    // to compensate boundary event\n    else if (\n      !isCompensationBoundaryEvent(context.oldShape) &&\n      newData.eventDefinitionType === 'bpmn:CompensateEventDefinition' &&\n      newData.type === 'bpmn:BoundaryEvent'\n    ) {\n      const targetConnection = oldShape.outgoing.find(\n        ({ target }) => isForCompensationAllowed(target)\n      );\n\n      if (targetConnection && targetConnection.target) {\n        context._connectionTarget = targetConnection.target;\n      }\n\n      removeOutgoingSequenceFlows(oldShape);\n    }\n  }\n\n  function handleReplacementPostExecuted(context) {\n    const { _connectionTarget: target, newShape } = context;\n\n    if (target) {\n      modeling.connect(newShape, target);\n    }\n  }\n\n  function addIsForCompensationProperty(target) {\n    modeling.updateProperties(target, { isForCompensation: true });\n  }\n\n  function removeIsForCompensationProperty(target) {\n    modeling.updateProperties(target, { isForCompensation: undefined });\n  }\n\n  function removeDisallowedConnections(element) {\n\n    for (const connection of element.incoming) {\n      if (!bpmnRules.canConnect(connection.source, element)) {\n        modeling.removeConnection(connection);\n      }\n    }\n\n    for (const connection of element.outgoing) {\n      if (!bpmnRules.canConnect(element, connection.target)) {\n        modeling.removeConnection(connection);\n      }\n    }\n  }\n\n  function removeExistingAssociations(boundaryEvent, ignoredAssociations) {\n    const associations = boundaryEvent.outgoing.filter(connection => is(connection, 'bpmn:Association'));\n    const associationsToRemove = associations.filter(association => {\n      return isForCompensation(association.target) && !ignoredAssociations.includes(association);\n    });\n\n    // remove existing associations\n    associationsToRemove.forEach(association => modeling.removeConnection(association));\n  }\n\n  function removeAttachments(element) {\n    const attachments = element.attachers.slice();\n\n    if (!attachments.length) {\n      return;\n    }\n\n    modeling.removeElements(attachments);\n  }\n\n  function removeIncomingCompensationAssociations(element) {\n    const compensationAssociations = element.incoming.filter(\n      connection => isCompensationBoundaryEvent(connection.source)\n    );\n\n    modeling.removeElements(compensationAssociations);\n  }\n\n  function removeOutgoingSequenceFlows(element) {\n    const sequenceFlows = element.outgoing.filter(\n      connection => is(connection, 'bpmn:SequenceFlow')\n    );\n\n    modeling.removeElements(sequenceFlows);\n  }\n}\n\ninherits(CompensateBoundaryEventBehavior, CommandInterceptor);\n\nCompensateBoundaryEventBehavior.$inject = [\n  'eventBus',\n  'modeling',\n  'bpmnRules'\n];\n\n// helpers //////////\n\nfunction isForCompensation(element) {\n  const bo = getBusinessObject(element);\n  return bo && bo.get('isForCompensation');\n}\n\nfunction isCompensationBoundaryEvent(element) {\n  return element && is(element, 'bpmn:BoundaryEvent') &&\n    hasEventDefinition(element, 'bpmn:CompensateEventDefinition');\n}\n\nfunction isForCompensationAllowed(element) {\n  return element && is(element, 'bpmn:Activity') && !isEventSubProcess(element);\n}\n","import inherits from 'inherits-browser';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { getParent } from '../util/ModelingUtil';\n\n/**\n * @typedef {import('didi').Injector} Injector\n */\n\n/**\n * @param {Injector} injector\n */\nexport default function CreateBehavior(injector) {\n  injector.invoke(CommandInterceptor, this);\n\n  this.preExecute('shape.create', 1500, function(event) {\n    var context = event.context,\n        parent = context.parent,\n        shape = context.shape;\n\n    if (is(parent, 'bpmn:Lane') && !is(shape, 'bpmn:Lane')) {\n      context.parent = getParent(parent, 'bpmn:Participant');\n    }\n  });\n\n}\n\n\nCreateBehavior.$inject = [ 'injector' ];\n\ninherits(CreateBehavior, CommandInterceptor);","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../BpmnFactory').default} BpmnFactory\n */\n\n/**\n * BPMN specific create data object behavior.\n *\n * @param {EventBus} eventBus\n * @param {BpmnFactory} bpmnFactory\n */\nexport default function CreateDataObjectBehavior(eventBus, bpmnFactory) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this.preExecute('shape.create', function(event) {\n\n    var context = event.context,\n        shape = context.shape;\n\n    if (is(shape, 'bpmn:DataObjectReference') && shape.type !== 'label') {\n\n      // create a DataObject every time a DataObjectReference is created\n      var dataObject = bpmnFactory.create('bpmn:DataObject');\n\n      // Copy the isCollection property if needed.\n      dataObject.isCollection = shape.businessObject.dataObjectRef?.isCollection || false;\n\n      // set the reference to the DataObject\n      shape.businessObject.dataObjectRef = dataObject;\n    }\n  });\n\n}\n\nCreateDataObjectBehavior.$inject = [\n  'eventBus',\n  'bpmnFactory'\n];\n\ninherits(CreateDataObjectBehavior, CommandInterceptor);","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { getBusinessObject, is } from '../../../util/ModelUtil';\n\nimport { isLabel } from '../../../util/LabelUtil';\n\nimport { getBBox } from 'diagram-js/lib/util/Elements';\n\nimport {\n  assign,\n  find\n} from 'min-dash';\n\nimport { asTRBL } from 'diagram-js/lib/layout/LayoutUtil';\n\nimport { isConnection } from 'diagram-js/lib/util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\nvar HORIZONTAL_PARTICIPANT_PADDING = 20,\n    VERTICAL_PARTICIPANT_PADDING = 20;\n\nexport var PARTICIPANT_BORDER_WIDTH = 30;\n\nvar HIGH_PRIORITY = 2000;\n\n\n/**\n * BPMN-specific behavior for creating participants.\n *\n * @param {Canvas} canvas\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function CreateParticipantBehavior(canvas, eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  // fit participant\n  eventBus.on([\n    'create.start',\n    'shape.move.start'\n  ], HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        shape = context.shape,\n        rootElement = canvas.getRootElement();\n\n    if (!is(shape, 'bpmn:Participant') ||\n      !is(rootElement, 'bpmn:Process') ||\n      !rootElement.children.length) {\n      return;\n    }\n\n    // ignore connections, groups and labels\n    var children = rootElement.children.filter(function(element) {\n      return !is(element, 'bpmn:Group') &&\n        !isLabel(element) &&\n        !isConnection(element);\n    });\n\n    // ensure for available children to calculate bounds\n    if (!children.length) {\n      return;\n    }\n\n    var childrenBBox = getBBox(children);\n\n    var participantBounds = getParticipantBounds(shape, childrenBBox);\n\n    // assign width and height\n    assign(shape, participantBounds);\n\n    // assign create constraints\n    context.createConstraints = getParticipantCreateConstraints(shape, childrenBBox);\n  });\n\n  // force hovering process when creating first participant\n  eventBus.on('create.start', HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        shape = context.shape,\n        rootElement = canvas.getRootElement(),\n        rootElementGfx = canvas.getGraphics(rootElement);\n\n    function ensureHoveringProcess(event) {\n      event.element = rootElement;\n      event.gfx = rootElementGfx;\n    }\n\n    if (is(shape, 'bpmn:Participant') && is(rootElement, 'bpmn:Process')) {\n      eventBus.on('element.hover', HIGH_PRIORITY, ensureHoveringProcess);\n\n      eventBus.once('create.cleanup', function() {\n        eventBus.off('element.hover', ensureHoveringProcess);\n      });\n    }\n  });\n\n  // turn process into collaboration when creating first participant\n  function getOrCreateCollaboration() {\n    var rootElement = canvas.getRootElement();\n\n    if (is(rootElement, 'bpmn:Collaboration')) {\n      return rootElement;\n    }\n\n    return modeling.makeCollaboration();\n  }\n\n  // when creating mutliple elements through `elements.create` parent must be set to collaboration\n  // and passed to `shape.create` as hint\n  this.preExecute('elements.create', HIGH_PRIORITY, function(context) {\n    var elements = context.elements,\n        parent = context.parent,\n        participant = findParticipant(elements),\n        hints;\n\n    if (participant && is(parent, 'bpmn:Process')) {\n      context.parent = getOrCreateCollaboration();\n\n      hints = context.hints = context.hints || {};\n\n      hints.participant = participant;\n      hints.process = parent;\n      hints.processRef = getBusinessObject(participant).get('processRef');\n    }\n  }, true);\n\n  // when creating single shape through `shape.create` parent must be set to collaboration\n  // unless it was already set through `elements.create`\n  this.preExecute('shape.create', function(context) {\n    var parent = context.parent,\n        shape = context.shape;\n\n    if (is(shape, 'bpmn:Participant') && is(parent, 'bpmn:Process')) {\n      context.parent = getOrCreateCollaboration();\n\n      context.process = parent;\n      context.processRef = getBusinessObject(shape).get('processRef');\n    }\n  }, true);\n\n  // #execute necessary because #preExecute not called on CommandStack#redo\n  this.execute('shape.create', function(context) {\n    var hints = context.hints || {},\n        process = context.process || hints.process,\n        shape = context.shape,\n        participant = hints.participant;\n\n    // both shape.create and elements.create must be handled\n    if (process && (!participant || shape === participant)) {\n\n      // monkey-patch process ref\n      getBusinessObject(shape).set('processRef', getBusinessObject(process));\n    }\n  }, true);\n\n  this.revert('shape.create', function(context) {\n    var hints = context.hints || {},\n        process = context.process || hints.process,\n        processRef = context.processRef || hints.processRef,\n        shape = context.shape,\n        participant = hints.participant;\n\n    // both shape.create and elements.create must be handled\n    if (process && (!participant || shape === participant)) {\n\n      // monkey-patch process ref\n      getBusinessObject(shape).set('processRef', processRef);\n    }\n  }, true);\n\n  this.postExecute('shape.create', function(context) {\n    var hints = context.hints || {},\n        process = context.process || context.hints.process,\n        shape = context.shape,\n        participant = hints.participant;\n\n    if (process) {\n      var children = process.children.slice();\n\n      // both shape.create and elements.create must be handled\n      if (!participant) {\n        modeling.moveElements(children, { x: 0, y: 0 }, shape);\n      } else if (shape === participant) {\n        modeling.moveElements(children, { x: 0, y: 0 }, participant);\n      }\n    }\n  }, true);\n}\n\nCreateParticipantBehavior.$inject = [\n  'canvas',\n  'eventBus',\n  'modeling'\n];\n\ninherits(CreateParticipantBehavior, CommandInterceptor);\n\n// helpers //////////\n\nfunction getParticipantBounds(shape, childrenBBox) {\n  childrenBBox = {\n    width: childrenBBox.width + HORIZONTAL_PARTICIPANT_PADDING * 2 + PARTICIPANT_BORDER_WIDTH,\n    height: childrenBBox.height + VERTICAL_PARTICIPANT_PADDING * 2\n  };\n\n  var width = Math.max(shape.width, childrenBBox.width),\n      height = Math.max(shape.height, childrenBBox.height);\n\n  return {\n    x: -width / 2,\n    y: -height / 2,\n    width: width,\n    height: height\n  };\n}\n\nfunction getParticipantCreateConstraints(shape, childrenBBox) {\n  childrenBBox = asTRBL(childrenBBox);\n\n  return {\n    bottom: childrenBBox.top + shape.height / 2 - VERTICAL_PARTICIPANT_PADDING,\n    left: childrenBBox.right - shape.width / 2 + HORIZONTAL_PARTICIPANT_PADDING,\n    top: childrenBBox.bottom - shape.height / 2 + VERTICAL_PARTICIPANT_PADDING,\n    right: childrenBBox.left + shape.width / 2 - HORIZONTAL_PARTICIPANT_PADDING - PARTICIPANT_BORDER_WIDTH\n  };\n}\n\nfunction findParticipant(elements) {\n  return find(elements, function(element) {\n    return is(element, 'bpmn:Participant');\n  });\n}","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  add as collectionAdd,\n  remove as collectionRemove\n} from 'diagram-js/lib/util/Collections';\n\nimport {\n  find\n} from 'min-dash';\n\nimport {\n  is\n} from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../BpmnFactory').default} BpmnFactory\n */\n\nvar TARGET_REF_PLACEHOLDER_NAME = '__targetRef_placeholder';\n\n\n/**\n * This behavior makes sure we always set a fake\n * DataInputAssociation#targetRef as demanded by the BPMN 2.0\n * XSD schema.\n *\n * The reference is set to a bpmn:Property{ name: '__targetRef_placeholder' }\n * which is created on the fly and cleaned up afterwards if not needed\n * anymore.\n *\n * @param {EventBus} eventBus\n * @param {BpmnFactory} bpmnFactory\n */\nexport default function DataInputAssociationBehavior(eventBus, bpmnFactory) {\n\n  CommandInterceptor.call(this, eventBus);\n\n\n  this.executed([\n    'connection.create',\n    'connection.delete',\n    'connection.move',\n    'connection.reconnect'\n  ], ifDataInputAssociation(fixTargetRef));\n\n  this.reverted([\n    'connection.create',\n    'connection.delete',\n    'connection.move',\n    'connection.reconnect'\n  ], ifDataInputAssociation(fixTargetRef));\n\n\n  function usesTargetRef(element, targetRef, removedConnection) {\n\n    var inputAssociations = element.get('dataInputAssociations');\n\n    return find(inputAssociations, function(association) {\n      return association !== removedConnection &&\n             association.targetRef === targetRef;\n    });\n  }\n\n  function getTargetRef(element, create) {\n\n    var properties = element.get('properties');\n\n    var targetRefProp = find(properties, function(p) {\n      return p.name === TARGET_REF_PLACEHOLDER_NAME;\n    });\n\n    if (!targetRefProp && create) {\n      targetRefProp = bpmnFactory.create('bpmn:Property', {\n        name: TARGET_REF_PLACEHOLDER_NAME\n      });\n\n      collectionAdd(properties, targetRefProp);\n    }\n\n    return targetRefProp;\n  }\n\n  function cleanupTargetRef(element, connection) {\n\n    var targetRefProp = getTargetRef(element);\n\n    if (!targetRefProp) {\n      return;\n    }\n\n    if (!usesTargetRef(element, targetRefProp, connection)) {\n      collectionRemove(element.get('properties'), targetRefProp);\n    }\n  }\n\n  /**\n   * Make sure targetRef is set to a valid property or\n   * `null` if the connection is detached.\n   *\n   * @param {Event} event\n   */\n  function fixTargetRef(event) {\n\n    var context = event.context,\n        connection = context.connection,\n        connectionBo = connection.businessObject,\n        target = connection.target,\n        targetBo = target && target.businessObject,\n        newTarget = context.newTarget,\n        newTargetBo = newTarget && newTarget.businessObject,\n        oldTarget = context.oldTarget || context.target,\n        oldTargetBo = oldTarget && oldTarget.businessObject;\n\n    var dataAssociation = connection.businessObject,\n        targetRefProp;\n\n    if (oldTargetBo && oldTargetBo !== targetBo) {\n      cleanupTargetRef(oldTargetBo, connectionBo);\n    }\n\n    if (newTargetBo && newTargetBo !== targetBo) {\n      cleanupTargetRef(newTargetBo, connectionBo);\n    }\n\n    if (targetBo) {\n      targetRefProp = getTargetRef(targetBo, true);\n      dataAssociation.targetRef = targetRefProp;\n    } else {\n      dataAssociation.targetRef = null;\n    }\n  }\n}\n\nDataInputAssociationBehavior.$inject = [\n  'eventBus',\n  'bpmnFactory'\n];\n\ninherits(DataInputAssociationBehavior, CommandInterceptor);\n\n\n/**\n * Only call the given function when the event\n * changes a bpmn:DataInputAssociation.\n *\n * @param {Function} fn\n * @return {Function}\n */\nfunction ifDataInputAssociation(fn) {\n\n  return function(event) {\n    var context = event.context,\n        connection = context.connection;\n\n    if (is(connection, 'bpmn:DataInputAssociation')) {\n      return fn(event);\n    }\n  };\n}","/**\r\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\r\n *\r\n * @typedef {import('../BpmnUpdater').default} BpmnUpdater\r\n */\r\n\r\n/**\r\n * @implements {CommandHandler}\r\n *\r\n * @param {BpmnUpdater} bpmnUpdater\r\n */\r\nexport default function UpdateSemanticParentHandler(bpmnUpdater) {\r\n  this._bpmnUpdater = bpmnUpdater;\r\n}\r\n\r\nUpdateSemanticParentHandler.$inject = [ 'bpmnUpdater' ];\r\n\r\n\r\nUpdateSemanticParentHandler.prototype.execute = function(context) {\r\n  var dataStoreBo = context.dataStoreBo,\r\n      dataStoreDi = context.dataStoreDi,\r\n      newSemanticParent = context.newSemanticParent,\r\n      newDiParent = context.newDiParent;\r\n\r\n  context.oldSemanticParent = dataStoreBo.$parent;\r\n  context.oldDiParent = dataStoreDi.$parent;\r\n\r\n  // update semantic parent\r\n  this._bpmnUpdater.updateSemanticParent(dataStoreBo, newSemanticParent);\r\n\r\n  // update DI parent\r\n  this._bpmnUpdater.updateDiParent(dataStoreDi, newDiParent);\r\n\r\n  return [];\r\n};\r\n\r\nUpdateSemanticParentHandler.prototype.revert = function(context) {\r\n  var dataStoreBo = context.dataStoreBo,\r\n      dataStoreDi = context.dataStoreDi,\r\n      oldSemanticParent = context.oldSemanticParent,\r\n      oldDiParent = context.oldDiParent;\r\n\r\n  // update semantic parent\r\n  this._bpmnUpdater.updateSemanticParent(dataStoreBo, oldSemanticParent);\r\n\r\n  // update DI parent\r\n  this._bpmnUpdater.updateDiParent(dataStoreDi, oldDiParent);\r\n\r\n  return [];\r\n};\r\n\r\n","import inherits from 'inherits-browser';\r\n\r\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\r\n\r\nimport {\r\n  getBusinessObject,\r\n  getDi,\r\n  is\r\n} from '../../../util/ModelUtil';\r\n\r\nimport { isAny } from '../util/ModelingUtil';\r\n\r\nimport UpdateSemanticParentHandler from '../cmd/UpdateSemanticParentHandler';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\r\n * @typedef {import('diagram-js/lib/command/CommandStack').default} CommandStack\r\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n */\r\n\r\n/**\r\n * BPMN specific data store behavior.\r\n *\r\n * @param {Canvas} canvas\r\n * @param {CommandStack} commandStack\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function DataStoreBehavior(\r\n    canvas, commandStack, elementRegistry,\r\n    eventBus) {\r\n\r\n  CommandInterceptor.call(this, eventBus);\r\n\r\n  commandStack.registerHandler('dataStore.updateContainment', UpdateSemanticParentHandler);\r\n\r\n  function getFirstParticipantWithProcessRef() {\r\n    return elementRegistry.filter(function(element) {\r\n      return is(element, 'bpmn:Participant') && getBusinessObject(element).processRef;\r\n    })[0];\r\n  }\r\n\r\n  function getDataStores(element) {\r\n    return element.children.filter(function(child) {\r\n      return is(child, 'bpmn:DataStoreReference') && !child.labelTarget;\r\n    });\r\n  }\r\n\r\n  function updateDataStoreParent(dataStore, newDataStoreParent) {\r\n    var dataStoreBo = dataStore.businessObject || dataStore;\r\n\r\n    newDataStoreParent = newDataStoreParent || getFirstParticipantWithProcessRef();\r\n\r\n    if (newDataStoreParent) {\r\n      var newDataStoreParentBo = newDataStoreParent.businessObject || newDataStoreParent;\r\n\r\n      commandStack.execute('dataStore.updateContainment', {\r\n        dataStoreBo: dataStoreBo,\r\n        dataStoreDi: getDi(dataStore),\r\n        newSemanticParent: newDataStoreParentBo.processRef || newDataStoreParentBo,\r\n        newDiParent: getDi(newDataStoreParent)\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  // disable auto-resize for data stores\r\n  this.preExecute('shape.create', function(event) {\r\n\r\n    var context = event.context,\r\n        shape = context.shape;\r\n\r\n    if (is(shape, 'bpmn:DataStoreReference') &&\r\n        shape.type !== 'label') {\r\n\r\n      if (!context.hints) {\r\n        context.hints = {};\r\n      }\r\n\r\n      // prevent auto resizing\r\n      context.hints.autoResize = false;\r\n    }\r\n  });\r\n\r\n\r\n  // disable auto-resize for data stores\r\n  this.preExecute('elements.move', function(event) {\r\n    var context = event.context,\r\n        shapes = context.shapes;\r\n\r\n    var dataStoreReferences = shapes.filter(function(shape) {\r\n      return is(shape, 'bpmn:DataStoreReference');\r\n    });\r\n\r\n    if (dataStoreReferences.length) {\r\n      if (!context.hints) {\r\n        context.hints = {};\r\n      }\r\n\r\n      // prevent auto resizing for data store references\r\n      context.hints.autoResize = shapes.filter(function(shape) {\r\n        return !is(shape, 'bpmn:DataStoreReference');\r\n      });\r\n    }\r\n  });\r\n\r\n\r\n  // update parent on data store created\r\n  this.postExecute('shape.create', function(event) {\r\n    var context = event.context,\r\n        shape = context.shape,\r\n        parent = shape.parent;\r\n\r\n\r\n    if (is(shape, 'bpmn:DataStoreReference') &&\r\n        shape.type !== 'label' &&\r\n        is(parent, 'bpmn:Collaboration')) {\r\n\r\n      updateDataStoreParent(shape);\r\n    }\r\n  });\r\n\r\n\r\n  // update parent on data store moved\r\n  this.postExecute('shape.move', function(event) {\r\n    var context = event.context,\r\n        shape = context.shape,\r\n        oldParent = context.oldParent,\r\n        parent = shape.parent;\r\n\r\n    if (is(oldParent, 'bpmn:Collaboration')) {\r\n\r\n      // do nothing if not necessary\r\n      return;\r\n    }\r\n\r\n    if (is(shape, 'bpmn:DataStoreReference') &&\r\n        shape.type !== 'label' &&\r\n        is(parent, 'bpmn:Collaboration')) {\r\n\r\n      var participant = is(oldParent, 'bpmn:Participant') ?\r\n        oldParent :\r\n        getAncestor(oldParent, 'bpmn:Participant');\r\n\r\n      updateDataStoreParent(shape, participant);\r\n    }\r\n  });\r\n\r\n\r\n  // update data store parents on participant or subprocess deleted\r\n  this.postExecute('shape.delete', function(event) {\r\n    var context = event.context,\r\n        shape = context.shape,\r\n        rootElement = canvas.getRootElement();\r\n\r\n    if (isAny(shape, [ 'bpmn:Participant', 'bpmn:SubProcess' ])\r\n        && is(rootElement, 'bpmn:Collaboration')) {\r\n      getDataStores(rootElement)\r\n        .filter(function(dataStore) {\r\n          return isDescendant(dataStore, shape);\r\n        })\r\n        .forEach(function(dataStore) {\r\n          updateDataStoreParent(dataStore);\r\n        });\r\n    }\r\n  });\r\n\r\n  // update data store parents on collaboration -> process\r\n  this.postExecute('canvas.updateRoot', function(event) {\r\n    var context = event.context,\r\n        oldRoot = context.oldRoot,\r\n        newRoot = context.newRoot;\r\n\r\n    var dataStores = getDataStores(oldRoot);\r\n\r\n    dataStores.forEach(function(dataStore) {\r\n\r\n      if (is(newRoot, 'bpmn:Process')) {\r\n        updateDataStoreParent(dataStore, newRoot);\r\n      }\r\n\r\n    });\r\n  });\r\n}\r\n\r\nDataStoreBehavior.$inject = [\r\n  'canvas',\r\n  'commandStack',\r\n  'elementRegistry',\r\n  'eventBus',\r\n];\r\n\r\ninherits(DataStoreBehavior, CommandInterceptor);\r\n\r\n\r\n// helpers //////////\r\n\r\nfunction isDescendant(descendant, ancestor) {\r\n  var descendantBo = descendant.businessObject || descendant,\r\n      ancestorBo = ancestor.businessObject || ancestor;\r\n\r\n  while (descendantBo.$parent) {\r\n    if (descendantBo.$parent === ancestorBo.processRef || ancestorBo) {\r\n      return true;\r\n    }\r\n\r\n    descendantBo = descendantBo.$parent;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction getAncestor(element, type) {\r\n\r\n  while (element.parent) {\r\n    if (is(element.parent, type)) {\r\n      return element.parent;\r\n    }\r\n\r\n    element = element.parent;\r\n  }\r\n}","import { is } from '../../../util/ModelUtil';\n\nimport {\n  getParent\n} from './ModelingUtil';\n\nimport {\n  isHorizontal\n} from '../../../util/DiUtil';\n\nimport {\n  asTRBL\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  substractTRBL,\n  resizeTRBL\n} from 'diagram-js/lib/features/resize/ResizeUtil';\n\n/**\n * @typedef {import('../../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n */\n\nvar abs = Math.abs;\n\n\nfunction getTRBLResize(oldBounds, newBounds) {\n  return substractTRBL(asTRBL(newBounds), asTRBL(oldBounds));\n}\n\n\nvar LANE_PARENTS = [\n  'bpmn:Participant',\n  'bpmn:Process',\n  'bpmn:SubProcess'\n];\n\nexport var LANE_INDENTATION = 30;\n\n\n/**\n * Return all lanes that are children of the given shape.\n *\n * @param  {Shape} shape\n * @param  {Shape[]} [collectedShapes]\n *\n * @return {Shape[]}\n */\nexport function collectLanes(shape, collectedShapes) {\n\n  collectedShapes = collectedShapes || [];\n\n  shape.children.filter(function(s) {\n    if (is(s, 'bpmn:Lane')) {\n      collectLanes(s, collectedShapes);\n\n      collectedShapes.push(s);\n    }\n  });\n\n  return collectedShapes;\n}\n\n\n/**\n * Return all lanes that are direct children of the given shape.\n *\n * @param {Shape} shape\n *\n * @return {Shape[]}\n */\nexport function getChildLanes(shape) {\n  return shape.children.filter(function(c) {\n    return is(c, 'bpmn:Lane');\n  });\n}\n\n\n/**\n * Return the parent shape of the given lane.\n *\n * @param {Shape} shape\n *\n * @return {Shape}\n */\nexport function getLanesRoot(shape) {\n  return getParent(shape, LANE_PARENTS) || shape;\n}\n\n\n/**\n * Compute the required resize operations for lanes\n * adjacent to the given shape, assuming it will be\n * resized to the given new bounds.\n *\n * @param {Shape} shape\n * @param {Rect} newBounds\n *\n * @return { {\n *   shape: Shape;\n *   newBounds: Rect;\n * }[] }\n */\nexport function computeLanesResize(shape, newBounds) {\n\n  var rootElement = getLanesRoot(shape);\n\n  var initialShapes = is(rootElement, 'bpmn:Process') ? [] : [ rootElement ];\n\n  var allLanes = collectLanes(rootElement, initialShapes),\n      shapeTrbl = asTRBL(shape),\n      shapeNewTrbl = asTRBL(newBounds),\n      trblResize = getTRBLResize(shape, newBounds),\n      resizeNeeded = [];\n\n  var isHorizontalLane = isHorizontal(shape);\n\n  allLanes.forEach(function(other) {\n\n    if (other === shape) {\n      return;\n    }\n\n    var topResize = isHorizontalLane ? 0 : trblResize.top,\n        rightResize = isHorizontalLane ? trblResize.right : 0,\n        bottomResize = isHorizontalLane ? 0 : trblResize.bottom,\n        leftResize = isHorizontalLane ? trblResize.left : 0;\n\n    var otherTrbl = asTRBL(other);\n\n    if (trblResize.top) {\n      if (abs(otherTrbl.bottom - shapeTrbl.top) < 10) {\n        bottomResize = shapeNewTrbl.top - otherTrbl.bottom;\n      }\n\n      if (abs(otherTrbl.top - shapeTrbl.top) < 5) {\n        topResize = shapeNewTrbl.top - otherTrbl.top;\n      }\n    }\n\n    if (trblResize.left) {\n      if (abs(otherTrbl.right - shapeTrbl.left) < 10) {\n        rightResize = shapeNewTrbl.left - otherTrbl.right;\n      }\n\n      if (abs(otherTrbl.left - shapeTrbl.left) < 5) {\n        leftResize = shapeNewTrbl.left - otherTrbl.left;\n      }\n    }\n\n    if (trblResize.bottom) {\n      if (abs(otherTrbl.top - shapeTrbl.bottom) < 10) {\n        topResize = shapeNewTrbl.bottom - otherTrbl.top;\n      }\n\n      if (abs(otherTrbl.bottom - shapeTrbl.bottom) < 5) {\n        bottomResize = shapeNewTrbl.bottom - otherTrbl.bottom;\n      }\n    }\n\n    if (trblResize.right) {\n      if (abs(otherTrbl.left - shapeTrbl.right) < 10) {\n        leftResize = shapeNewTrbl.right - otherTrbl.left;\n      }\n\n      if (abs(otherTrbl.right - shapeTrbl.right) < 5) {\n        rightResize = shapeNewTrbl.right - otherTrbl.right;\n      }\n    }\n\n    if (topResize || rightResize || bottomResize || leftResize) {\n\n      resizeNeeded.push({\n        shape: other,\n        newBounds: resizeTRBL(other, {\n          top: topResize,\n          right: rightResize,\n          bottom: bottomResize,\n          left: leftResize\n        })\n      });\n    }\n\n  });\n\n  return resizeNeeded;\n}","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport {\n  getChildLanes\n} from '../util/LaneUtil';\n\nimport {\n  isHorizontal\n} from '../../../util/DiUtil';\n\nimport {\n  eachElement\n} from 'diagram-js/lib/util/Elements';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../space-tool/BpmnSpaceTool').default} SpaceTool\n */\n\nvar LOW_PRIORITY = 500;\n\n\n/**\n * BPMN specific delete lane behavior.\n *\n * @param {EventBus} eventBus\n * @param {SpaceTool} spaceTool\n */\nexport default function DeleteLaneBehavior(eventBus, spaceTool) {\n\n  CommandInterceptor.call(this, eventBus);\n\n\n  function compensateLaneDelete(shape, oldParent) {\n    var isHorizontalLane = isHorizontal(shape);\n\n    var siblings = getChildLanes(oldParent);\n\n    var topAffected = [];\n    var bottomAffected = [];\n    var leftAffected = [];\n    var rightAffected = [];\n\n    eachElement(siblings, function(element) {\n\n      if (isHorizontalLane) {\n        if (element.y > shape.y) {\n          bottomAffected.push(element);\n        } else {\n          topAffected.push(element);\n        }\n      } else {\n        if (element.x > shape.x) {\n          rightAffected.push(element);\n        } else {\n          leftAffected.push(element);\n        }\n      }\n\n      return element.children;\n    });\n\n    if (!siblings.length) {\n      return;\n    }\n\n    var offset;\n\n    if (isHorizontalLane) {\n      if (bottomAffected.length && topAffected.length) {\n        offset = shape.height / 2;\n      } else {\n        offset = shape.height;\n      }\n    } else {\n      if (rightAffected.length && leftAffected.length) {\n        offset = shape.width / 2;\n      } else {\n        offset = shape.width;\n      }\n    }\n\n    var topAdjustments,\n        bottomAdjustments,\n        leftAdjustments,\n        rightAdjustments;\n\n    if (topAffected.length) {\n      topAdjustments = spaceTool.calculateAdjustments(\n        topAffected, 'y', offset, shape.y - 10);\n\n      spaceTool.makeSpace(\n        topAdjustments.movingShapes,\n        topAdjustments.resizingShapes,\n        { x: 0, y: offset }, 's');\n    }\n\n    if (bottomAffected.length) {\n      bottomAdjustments = spaceTool.calculateAdjustments(\n        bottomAffected, 'y', -offset, shape.y + shape.height + 10);\n\n      spaceTool.makeSpace(\n        bottomAdjustments.movingShapes,\n        bottomAdjustments.resizingShapes,\n        { x: 0, y: -offset }, 'n');\n    }\n\n    if (leftAffected.length) {\n      leftAdjustments = spaceTool.calculateAdjustments(\n        leftAffected, 'x', offset, shape.x - 10);\n\n      spaceTool.makeSpace(\n        leftAdjustments.movingShapes,\n        leftAdjustments.resizingShapes,\n        { x: offset, y: 0 }, 'e');\n    }\n\n    if (rightAffected.length) {\n      rightAdjustments = spaceTool.calculateAdjustments(\n        rightAffected, 'x', -offset, shape.x + shape.width + 10);\n\n      spaceTool.makeSpace(\n        rightAdjustments.movingShapes,\n        rightAdjustments.resizingShapes,\n        { x: -offset, y: 0 }, 'w');\n    }\n  }\n\n\n  /**\n   * Adjust sizes of other lanes after lane deletion\n   */\n  this.postExecuted('shape.delete', LOW_PRIORITY, function(event) {\n\n    var context = event.context,\n        hints = context.hints,\n        shape = context.shape,\n        oldParent = context.oldParent;\n\n    // only compensate lane deletes\n    if (!is(shape, 'bpmn:Lane')) {\n      return;\n    }\n\n    // compensate root deletes only\n    if (hints && hints.nested) {\n      return;\n    }\n\n    compensateLaneDelete(shape, oldParent);\n  });\n}\n\nDeleteLaneBehavior.$inject = [\n  'eventBus',\n  'spaceTool'\n];\n\ninherits(DeleteLaneBehavior, CommandInterceptor);","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getBusinessObject,\n  is\n} from '../../../util/ModelUtil';\n\nimport { isLabel } from '../../../util/LabelUtil';\n\n/**\n * @typedef {import('../../replace/BpmnReplace').default} BpmnReplace\n * @typedef {import('didi').Injector} Injector\n */\n\nvar LOW_PRIORITY = 500;\n\n\n/**\n * Replace boundary event with intermediate event when creating or moving results in detached event.\n *\n * @param {BpmnReplace} bpmnReplace\n * @param {Injector} injector\n */\nexport default function DetachEventBehavior(bpmnReplace, injector) {\n  injector.invoke(CommandInterceptor, this);\n\n  this._bpmnReplace = bpmnReplace;\n\n  var self = this;\n\n  this.postExecuted('elements.create', LOW_PRIORITY, function(context) {\n    var elements = context.elements;\n\n    elements.filter(function(shape) {\n      var host = shape.host;\n\n      return shouldReplace(shape, host);\n    }).map(function(shape) {\n      return elements.indexOf(shape);\n    }).forEach(function(index) {\n      context.elements[ index ] = self._replaceShape(elements[ index ]);\n    });\n  }, true);\n\n  this.preExecute('elements.move', LOW_PRIORITY, function(context) {\n    var shapes = context.shapes,\n        newHost = context.newHost;\n\n    shapes.forEach(function(shape, index) {\n      var host = shape.host;\n\n      if (shouldReplace(shape, includes(shapes, host) ? host : newHost)) {\n        shapes[ index ] = self._replaceShape(shape);\n      }\n    });\n  }, true);\n}\n\nDetachEventBehavior.$inject = [\n  'bpmnReplace',\n  'injector'\n];\n\ninherits(DetachEventBehavior, CommandInterceptor);\n\nDetachEventBehavior.prototype._replaceShape = function(shape) {\n  var eventDefinition = getEventDefinition(shape),\n      intermediateEvent;\n\n  if (eventDefinition) {\n    intermediateEvent = {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: eventDefinition.$type\n    };\n  } else {\n    intermediateEvent = {\n      type: 'bpmn:IntermediateThrowEvent'\n    };\n  }\n\n  return this._bpmnReplace.replaceElement(shape, intermediateEvent, { layoutConnection: false });\n};\n\n\n// helpers //////////\n\nfunction getEventDefinition(element) {\n  var businessObject = getBusinessObject(element),\n      eventDefinitions = businessObject.eventDefinitions;\n\n  return eventDefinitions && eventDefinitions[0];\n}\n\nfunction shouldReplace(shape, host) {\n  return !isLabel(shape) && is(shape, 'bpmn:BoundaryEvent') && !host;\n}\n\nfunction includes(array, item) {\n  return array.indexOf(item) !== -1;\n}","import inherits from 'inherits-browser';\n\nimport {\n  assign,\n  filter,\n  find,\n  isNumber\n} from 'min-dash';\n\nimport { getMid } from 'diagram-js/lib/layout/LayoutUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getApproxIntersection\n} from 'diagram-js/lib/util/LineIntersection';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../rules/BpmnRules').default} BpmnRules\n * @typedef {import('../../modeling/Modeling').default} Modeling\n */\n\n/**\n * @param {EventBus} eventBus\n * @param {BpmnRules} bpmnRules\n * @param {Modeling} modeling\n */\nexport default function DropOnFlowBehavior(eventBus, bpmnRules, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Reconnect start / end of a connection after\n   * dropping an element on a flow.\n   */\n\n  function insertShape(shape, targetFlow, positionOrBounds) {\n    var waypoints = targetFlow.waypoints,\n        waypointsBefore,\n        waypointsAfter,\n        dockingPoint,\n        source,\n        target,\n        incomingConnection,\n        outgoingConnection,\n        oldOutgoing = shape.outgoing.slice(),\n        oldIncoming = shape.incoming.slice();\n\n    var mid;\n\n    if (isNumber(positionOrBounds.width)) {\n      mid = getMid(positionOrBounds);\n    } else {\n      mid = positionOrBounds;\n    }\n\n    var intersection = getApproxIntersection(waypoints, mid);\n\n    if (intersection) {\n      waypointsBefore = waypoints.slice(0, intersection.index);\n      waypointsAfter = waypoints.slice(intersection.index + (intersection.bendpoint ? 1 : 0));\n\n      // due to inaccuracy intersection might have been found\n      if (!waypointsBefore.length || !waypointsAfter.length) {\n        return;\n      }\n\n      dockingPoint = intersection.bendpoint ? waypoints[intersection.index] : mid;\n\n      // if last waypointBefore is inside shape's bounds, ignore docking point\n      if (waypointsBefore.length === 1 || !isPointInsideBBox(shape, waypointsBefore[waypointsBefore.length - 1])) {\n        waypointsBefore.push(copy(dockingPoint));\n      }\n\n      // if first waypointAfter is inside shape's bounds, ignore docking point\n      if (waypointsAfter.length === 1 || !isPointInsideBBox(shape, waypointsAfter[0])) {\n        waypointsAfter.unshift(copy(dockingPoint));\n      }\n    }\n\n    source = targetFlow.source;\n    target = targetFlow.target;\n\n    if (bpmnRules.canConnect(source, shape, targetFlow)) {\n\n      // reconnect source -> inserted shape\n      modeling.reconnectEnd(targetFlow, shape, waypointsBefore || mid);\n\n      incomingConnection = targetFlow;\n    }\n\n    if (bpmnRules.canConnect(shape, target, targetFlow)) {\n\n      if (!incomingConnection) {\n\n        // reconnect inserted shape -> end\n        modeling.reconnectStart(targetFlow, shape, waypointsAfter || mid);\n\n        outgoingConnection = targetFlow;\n      } else {\n        outgoingConnection = modeling.connect(\n          shape, target, { type: targetFlow.type, waypoints: waypointsAfter }\n        );\n      }\n    }\n\n    var duplicateConnections = [].concat(\n\n      incomingConnection && filter(oldIncoming, function(connection) {\n        return connection.source === incomingConnection.source;\n      }) || [],\n\n      outgoingConnection && filter(oldOutgoing, function(connection) {\n        return connection.target === outgoingConnection.target;\n      }) || []\n    );\n\n    if (duplicateConnections.length) {\n      modeling.removeElements(duplicateConnections);\n    }\n  }\n\n  this.preExecute('elements.move', function(context) {\n\n    var newParent = context.newParent,\n        shapes = context.shapes,\n        delta = context.delta,\n        shape = shapes[0];\n\n    if (!shape || !newParent) {\n      return;\n    }\n\n    // if the new parent is a connection,\n    // change it to the new parent's parent\n    if (newParent && newParent.waypoints) {\n      context.newParent = newParent = newParent.parent;\n    }\n\n    var shapeMid = getMid(shape);\n    var newShapeMid = {\n      x: shapeMid.x + delta.x,\n      y: shapeMid.y + delta.y\n    };\n\n    // find a connection which intersects with the\n    // element's mid point\n    var connection = find(newParent.children, function(element) {\n      var canInsert = bpmnRules.canInsert(shapes, element);\n\n      return canInsert && getApproxIntersection(element.waypoints, newShapeMid);\n    });\n\n    if (connection) {\n      context.targetFlow = connection;\n      context.position = newShapeMid;\n    }\n\n  }, true);\n\n  this.postExecuted('elements.move', function(context) {\n\n    var shapes = context.shapes,\n        targetFlow = context.targetFlow,\n        position = context.position;\n\n    if (targetFlow) {\n      insertShape(shapes[0], targetFlow, position);\n    }\n\n  }, true);\n\n  this.preExecute('shape.create', function(context) {\n\n    var parent = context.parent,\n        shape = context.shape;\n\n    if (bpmnRules.canInsert(shape, parent)) {\n      context.targetFlow = parent;\n      context.parent = parent.parent;\n    }\n  }, true);\n\n  this.postExecuted('shape.create', function(context) {\n\n    var shape = context.shape,\n        targetFlow = context.targetFlow,\n        positionOrBounds = context.position;\n\n    if (targetFlow) {\n      insertShape(shape, targetFlow, positionOrBounds);\n    }\n  }, true);\n}\n\ninherits(DropOnFlowBehavior, CommandInterceptor);\n\nDropOnFlowBehavior.$inject = [\n  'eventBus',\n  'bpmnRules',\n  'modeling'\n];\n\n\n// helpers /////////////////////\n\nfunction isPointInsideBBox(bbox, point) {\n  var x = point.x,\n      y = point.y;\n\n  return x >= bbox.x &&\n    x <= bbox.x + bbox.width &&\n    y >= bbox.y &&\n    y <= bbox.y + bbox.height;\n}\n\nfunction copy(obj) {\n  return assign({}, obj);\n}\n\n","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function EventBasedGatewayBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Remove incoming sequence flows of event-based target when creating\n   * sequence flow.\n   *\n   * 1. If source is event-based gateway remove all incoming sequence flows\n   * 2. If source is not event-based gateway remove all incoming sequence flows\n   * whose source is event-based gateway\n   */\n  this.preExecuted('connection.create', function(event) {\n    var context = event.context,\n        connection = context.connection,\n        source = context.source,\n        target = context.target,\n        hints = context.hints;\n\n    if (hints && hints.createElementsBehavior === false) {\n      return;\n    }\n\n    if (!isSequenceFlow(connection)) {\n      return;\n    }\n\n    var sequenceFlows = [];\n\n    if (is(source, 'bpmn:EventBasedGateway')) {\n      sequenceFlows = target.incoming\n        .filter(flow =>\n          flow !== connection &&\n          isSequenceFlow(flow)\n        );\n    } else {\n      sequenceFlows = target.incoming\n        .filter(flow =>\n          flow !== connection &&\n          isSequenceFlow(flow) &&\n          is(flow.source, 'bpmn:EventBasedGateway')\n        );\n    }\n\n    sequenceFlows.forEach(function(sequenceFlow) {\n      modeling.removeConnection(sequenceFlow);\n    });\n  });\n\n  /**\n   * Remove incoming sequence flows of event-based targets when replacing source\n   * with event-based gateway.\n   */\n  this.preExecuted('shape.replace', function(event) {\n    var context = event.context,\n        newShape = context.newShape;\n\n    if (!is(newShape, 'bpmn:EventBasedGateway')) {\n      return;\n    }\n\n    var targets = newShape.outgoing.filter(isSequenceFlow)\n      .reduce(function(targets, sequenceFlow) {\n        if (!targets.includes(sequenceFlow.target)) {\n          return targets.concat(sequenceFlow.target);\n        }\n\n        return targets;\n      }, []);\n\n    targets.forEach(function(target) {\n      target.incoming.filter(isSequenceFlow).forEach(function(sequenceFlow) {\n        const sequenceFlowsFromNewShape = target.incoming.filter(isSequenceFlow).filter(function(sequenceFlow) {\n          return sequenceFlow.source === newShape;\n        });\n\n        if (sequenceFlow.source !== newShape || sequenceFlowsFromNewShape.length > 1) {\n          modeling.removeConnection(sequenceFlow);\n        }\n      });\n    });\n  });\n}\n\nEventBasedGatewayBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n\ninherits(EventBasedGatewayBehavior, CommandInterceptor);\n\n// helpers //////////\n\nfunction isSequenceFlow(connection) {\n  return is(connection, 'bpmn:SequenceFlow');\n}","import { getLanesRoot } from '../util/LaneUtil';\r\n\r\nimport { is, isAny } from '../../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\r\n */\r\n\r\nvar HIGH_PRIORITY = 1500;\r\nvar HIGHEST_PRIORITY = 2000;\r\n\r\n\r\n/**\r\n * Correct hover targets in certain situations to improve diagram interaction.\r\n *\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n */\r\nexport default function FixHoverBehavior(elementRegistry, eventBus, canvas) {\r\n\r\n  eventBus.on([\r\n    'create.hover',\r\n    'create.move',\r\n    'create.out',\r\n    'create.end',\r\n    'shape.move.hover',\r\n    'shape.move.move',\r\n    'shape.move.out',\r\n    'shape.move.end'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        shape = context.shape || event.shape,\r\n        hover = event.hover;\r\n\r\n    // ensure elements are not dropped onto a bpmn:Lane but onto\r\n    // the underlying bpmn:Participant\r\n    if (is(hover, 'bpmn:Lane') && !isAny(shape, [ 'bpmn:Lane', 'bpmn:Participant' ])) {\r\n      event.hover = getLanesRoot(hover);\r\n      event.hoverGfx = elementRegistry.getGraphics(event.hover);\r\n    }\r\n\r\n    var rootElement = canvas.getRootElement();\r\n\r\n    // ensure bpmn:Group and label elements are dropped\r\n    // always onto the root\r\n    if (hover !== rootElement && (shape.labelTarget || isAny(shape, [ 'bpmn:Group', 'bpmn:TextAnnotation' ]))) {\r\n      event.hover = rootElement;\r\n      event.hoverGfx = elementRegistry.getGraphics(event.hover);\r\n    }\r\n  });\r\n\r\n  eventBus.on([\r\n    'connect.hover',\r\n    'connect.out',\r\n    'connect.end',\r\n    'connect.cleanup',\r\n    'global-connect.hover',\r\n    'global-connect.out',\r\n    'global-connect.end',\r\n    'global-connect.cleanup'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var hover = event.hover;\r\n\r\n    // ensure connections start/end on bpmn:Participant,\r\n    // not the underlying bpmn:Lane\r\n    if (is(hover, 'bpmn:Lane')) {\r\n      event.hover = getLanesRoot(hover) || hover;\r\n      event.hoverGfx = elementRegistry.getGraphics(event.hover);\r\n    }\r\n  });\r\n\r\n\r\n  eventBus.on([\r\n    'bendpoint.move.hover'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        hover = event.hover,\r\n        type = context.type;\r\n\r\n    // ensure reconnect start/end on bpmn:Participant,\r\n    // not the underlying bpmn:Lane\r\n    if (is(hover, 'bpmn:Lane') && /reconnect/.test(type)) {\r\n      event.hover = getLanesRoot(hover) || hover;\r\n      event.hoverGfx = elementRegistry.getGraphics(event.hover);\r\n    }\r\n  });\r\n\r\n\r\n  eventBus.on([\r\n    'connect.start'\r\n  ], HIGH_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        start = context.start;\r\n\r\n    // ensure connect start on bpmn:Participant,\r\n    // not the underlying bpmn:Lane\r\n    if (is(start, 'bpmn:Lane')) {\r\n      context.start = getLanesRoot(start) || start;\r\n    }\r\n  });\r\n\r\n\r\n  // allow movement of participants from lanes\r\n  eventBus.on('shape.move.start', HIGHEST_PRIORITY, function(event) {\r\n    var shape = event.shape;\r\n\r\n    if (is(shape, 'bpmn:Lane')) {\r\n      event.shape = getLanesRoot(shape) || shape;\r\n    }\r\n  });\r\n\r\n  // ensure lanes aren't resized without their parent participant when using\r\n  // space tool\r\n  eventBus.on('spaceTool.move', HIGHEST_PRIORITY, function(event) {\r\n    var hover = event.hover;\r\n\r\n    if (hover && is(hover, 'bpmn:Lane')) {\r\n      event.hover = getLanesRoot(hover);\r\n    }\r\n  });\r\n\r\n}\r\n\r\nFixHoverBehavior.$inject = [\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'canvas'\r\n];","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getBusinessObject,\n  is\n} from '../../../util/ModelUtil';\n\nimport {\n  createCategory,\n  createCategoryValue,\n  linkCategoryValue,\n  unlinkCategory,\n  unlinkCategoryValue\n} from './util/CategoryUtil';\n\n/**\n * @typedef {import('../BpmnFactory').default} BpmnFactory\n * @typedef {import('../../../Modeler').default} Modeler\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('didi').Injector} Injector\n * @typedef {import('../../copy-paste/ModdleCopy').default} ModdleCopy\n *\n * @typedef {import('../../../model/Types').Element} Element\n * @typedef {import('../../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').DirectionTRBL} DirectionTRBL\n */\n\nvar LOWER_PRIORITY = 770;\n\n\n/**\n * BPMN specific group behavior.\n *\n * @param {BpmnFactory} bpmnFactory\n * @param {Modeler} bpmnjs\n * @param {ElementRegistry} elementRegistry\n * @param {EventBus} eventBus\n * @param {Injector} injector\n * @param {ModdleCopy} moddleCopy\n */\nexport default function GroupBehavior(\n    bpmnFactory,\n    bpmnjs,\n    elementRegistry,\n    eventBus,\n    injector,\n    moddleCopy\n) {\n  injector.invoke(CommandInterceptor, this);\n\n  /**\n   * Returns all group element in the current registry.\n   *\n   * @return {Shape[]}\n   */\n  function getGroupElements() {\n    return elementRegistry.filter(function(e) {\n      return is(e, 'bpmn:Group');\n    });\n  }\n\n  /**\n   * Returns true if given category is referenced in one of the given elements.\n   *\n   * @param {Element[]} elements\n   * @param {ModdleElement} category\n   *\n   * @return {boolean}\n   */\n  function isReferencedCategory(elements, category) {\n    return elements.some(function(element) {\n      var businessObject = getBusinessObject(element);\n\n      var _category = businessObject.categoryValueRef && businessObject.categoryValueRef.$parent;\n\n      return _category === category;\n    });\n  }\n\n  /**\n   * Returns true if given categoryValue is referenced in one of the given elements.\n   *\n   * @param {Element[]} elements\n   * @param {ModdleElement} categoryValue\n   *\n   * @return {boolean}\n   */\n  function isReferencedCategoryValue(elements, categoryValue) {\n    return elements.some(function(element) {\n      var businessObject = getBusinessObject(element);\n\n      return businessObject.categoryValueRef === categoryValue;\n    });\n  }\n\n  /**\n   * Remove category value unless it is still referenced.\n   *\n   * @param {ModdleElement} categoryValue\n   * @param {ModdleElement} category\n   * @param {ModdleElement} businessObject\n   */\n  function removeCategoryValue(categoryValue, category, businessObject) {\n\n    var groups = getGroupElements().filter(function(element) {\n      return element.businessObject !== businessObject;\n    });\n\n    if (category && !isReferencedCategory(groups, category)) {\n      unlinkCategory(category);\n    }\n\n    if (categoryValue && !isReferencedCategoryValue(groups, categoryValue)) {\n      unlinkCategoryValue(categoryValue);\n    }\n  }\n\n  /**\n   * Add category value.\n   *\n   * @param {ModdleElement} categoryValue\n   * @param {ModdleElement} category\n   *\n   * @return {ModdleElement}\n   */\n  function addCategoryValue(categoryValue, category) {\n    return linkCategoryValue(categoryValue, category, bpmnjs.getDefinitions());\n  }\n\n  function setCategoryValue(element, context) {\n    var businessObject = getBusinessObject(element),\n        categoryValue = businessObject.categoryValueRef;\n\n    if (!categoryValue) {\n      categoryValue =\n      businessObject.categoryValueRef =\n      context.categoryValue = (\n        context.categoryValue || createCategoryValue(bpmnFactory)\n      );\n    }\n\n    var category = categoryValue.$parent;\n\n    if (!category) {\n      category =\n      categoryValue.$parent =\n      context.category = (\n        context.category || createCategory(bpmnFactory)\n      );\n    }\n\n    addCategoryValue(categoryValue, category, bpmnjs.getDefinitions());\n  }\n\n  function unsetCategoryValue(element, context) {\n    var category = context.category,\n        categoryValue = context.categoryValue,\n        businessObject = getBusinessObject(element);\n\n    if (categoryValue) {\n      businessObject.categoryValueRef = null;\n\n      removeCategoryValue(categoryValue, category, businessObject);\n    } else {\n      removeCategoryValue(null, businessObject.categoryValueRef.$parent, businessObject);\n    }\n  }\n\n\n  // ensure category + value exist before label editing\n\n  this.execute('label.create', function(event) {\n    var context = event.context,\n        labelTarget = context.labelTarget;\n\n    if (!is(labelTarget, 'bpmn:Group')) {\n      return;\n    }\n\n    setCategoryValue(labelTarget, context);\n  });\n\n  this.revert('label.create', function(event) {\n    var context = event.context,\n        labelTarget = context.labelTarget;\n\n    if (!is(labelTarget, 'bpmn:Group')) {\n      return;\n    }\n\n    unsetCategoryValue(labelTarget, context);\n  });\n\n\n  // remove referenced category + value when group was deleted\n\n  this.execute('shape.delete', function(event) {\n\n    var context = event.context,\n        shape = context.shape,\n        businessObject = getBusinessObject(shape);\n\n    if (!is(shape, 'bpmn:Group') || shape.labelTarget) {\n      return;\n    }\n\n    var categoryValue = context.categoryValue = businessObject.categoryValueRef,\n        category;\n\n    if (categoryValue) {\n      category = context.category = categoryValue.$parent;\n\n      removeCategoryValue(categoryValue, category, businessObject);\n\n      businessObject.categoryValueRef = null;\n    }\n  });\n\n  this.reverted('shape.delete', function(event) {\n\n    var context = event.context,\n        shape = context.shape;\n\n    if (!is(shape, 'bpmn:Group') || shape.labelTarget) {\n      return;\n    }\n\n    var category = context.category,\n        categoryValue = context.categoryValue,\n        businessObject = getBusinessObject(shape);\n\n    if (categoryValue) {\n      businessObject.categoryValueRef = categoryValue;\n\n      addCategoryValue(categoryValue, category);\n    }\n  });\n\n\n  // create new category + value when group was created\n\n  this.execute('shape.create', function(event) {\n    var context = event.context,\n        shape = context.shape;\n\n    if (!is(shape, 'bpmn:Group') || shape.labelTarget) {\n      return;\n    }\n\n    if (getBusinessObject(shape).categoryValueRef) {\n      setCategoryValue(shape, context);\n    }\n  });\n\n  this.reverted('shape.create', function(event) {\n\n    var context = event.context,\n        shape = context.shape;\n\n    if (!is(shape, 'bpmn:Group') || shape.labelTarget) {\n      return;\n    }\n\n    if (getBusinessObject(shape).categoryValueRef) {\n      unsetCategoryValue(shape, context);\n    }\n  });\n\n\n  // copy + paste categoryValueRef with group\n\n  function copy(bo, clone) {\n    var targetBo = bpmnFactory.create(bo.$type);\n\n    return moddleCopy.copyElement(bo, targetBo, null, clone);\n  }\n\n  eventBus.on('copyPaste.copyElement', LOWER_PRIORITY, function(context) {\n    var descriptor = context.descriptor,\n        element = context.element;\n\n    if (!is(element, 'bpmn:Group') || element.labelTarget) {\n      return;\n    }\n\n    var groupBo = getBusinessObject(element);\n\n    if (groupBo.categoryValueRef) {\n\n      var categoryValue = groupBo.categoryValueRef;\n\n      descriptor.categoryValue = copy(categoryValue, true);\n\n      if (categoryValue.$parent) {\n        descriptor.category = copy(categoryValue.$parent, true);\n      }\n    }\n  });\n\n  eventBus.on('copyPaste.pasteElement', LOWER_PRIORITY, function(context) {\n    var descriptor = context.descriptor,\n        businessObject = descriptor.businessObject,\n        categoryValue = descriptor.categoryValue,\n        category = descriptor.category;\n\n    if (categoryValue) {\n      categoryValue = businessObject.categoryValueRef = copy(categoryValue);\n    }\n\n    if (category) {\n      categoryValue.$parent = copy(category);\n    }\n\n    delete descriptor.category;\n    delete descriptor.categoryValue;\n  });\n\n}\n\nGroupBehavior.$inject = [\n  'bpmnFactory',\n  'bpmnjs',\n  'elementRegistry',\n  'eventBus',\n  'injector',\n  'moddleCopy'\n];\n\ninherits(GroupBehavior, CommandInterceptor);","import {\n  add as collectionAdd,\n  remove as collectionRemove\n} from 'diagram-js/lib/util/Collections';\n\n/**\n * @typedef {import('../../BpmnFactory').default} BpmnFactory\n *\n * @typedef {import('../../../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * Creates a new bpmn:CategoryValue inside a new bpmn:Category\n *\n * @param {BpmnFactory} bpmnFactory\n *\n * @return {ModdleElement}\n */\nexport function createCategory(bpmnFactory) {\n  return bpmnFactory.create('bpmn:Category');\n}\n\n/**\n * Creates a new bpmn:CategoryValue inside a new bpmn:Category\n *\n * @param {BpmnFactory} bpmnFactory\n *\n * @return {ModdleElement}\n */\nexport function createCategoryValue(bpmnFactory) {\n  return bpmnFactory.create('bpmn:CategoryValue');\n}\n\n/**\n * Adds category value to definitions\n *\n * @param {ModdleElement} categoryValue\n * @param {ModdleElement} category\n * @param {ModdleElement} definitions\n *\n * @return {ModdleElement}\n */\nexport function linkCategoryValue(categoryValue, category, definitions) {\n  collectionAdd(category.get('categoryValue'), categoryValue);\n  categoryValue.$parent = category;\n\n  collectionAdd(definitions.get('rootElements'), category);\n  category.$parent = definitions;\n\n  return categoryValue;\n}\n\n/**\n * Unlink category value from parent\n *\n * @param {ModdleElement} categoryValue\n *\n * @return {ModdleElement}\n */\nexport function unlinkCategoryValue(categoryValue) {\n  var category = categoryValue.$parent;\n\n  if (category) {\n    collectionRemove(category.get('categoryValue'), categoryValue);\n    categoryValue.$parent = null;\n  }\n\n  return categoryValue;\n}\n\n/**\n * Unlink category from parent\n *\n * @param {ModdleElement} category\n *\n * @return {ModdleElement}\n */\nexport function unlinkCategory(category) {\n  var definitions = category.$parent;\n\n  if (definitions) {\n    collectionRemove(definitions.get('rootElements'), category);\n    category.$parent = null;\n  }\n\n  return category;\n}","/**\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n */\n\n/**\n * Returns the intersection between two line segments a and b.\n *\n * @param {Point} l1s\n * @param {Point} l1e\n * @param {Point} l2s\n * @param {Point} l2e\n *\n * @return {Point}\n */\nexport default function lineIntersect(l1s, l1e, l2s, l2e) {\n\n  // if the lines intersect, the result contains the x and y of the\n  // intersection (treating the lines as infinite) and booleans for\n  // whether line segment 1 or line segment 2 contain the point\n  var denominator, a, b, c, numerator;\n\n  denominator = ((l2e.y - l2s.y) * (l1e.x - l1s.x)) - ((l2e.x - l2s.x) * (l1e.y - l1s.y));\n\n  if (denominator == 0) {\n    return null;\n  }\n\n  a = l1s.y - l2s.y;\n  b = l1s.x - l2s.x;\n  numerator = ((l2e.x - l2s.x) * a) - ((l2e.y - l2s.y) * b);\n\n  c = numerator / denominator;\n\n  // if we cast these lines infinitely in\n  // both directions, they intersect here\n  return {\n    x: Math.round(l1s.x + (c * (l1e.x - l1s.x))),\n    y: Math.round(l1s.y + (c * (l1e.y - l1s.y)))\n  };\n}","import {\n  getMid\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport lineIntersect from './util/LineIntersect';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * Fix broken dockings after DI imports.\n *\n * @param {EventBus} eventBus\n */\nexport default function ImportDockingFix(eventBus) {\n\n  function adjustDocking(startPoint, nextPoint, elementMid) {\n\n    var elementTop = {\n      x: elementMid.x,\n      y: elementMid.y - 50\n    };\n\n    var elementLeft = {\n      x: elementMid.x - 50,\n      y: elementMid.y\n    };\n\n    var verticalIntersect = lineIntersect(startPoint, nextPoint, elementMid, elementTop),\n        horizontalIntersect = lineIntersect(startPoint, nextPoint, elementMid, elementLeft);\n\n    // original is horizontal or vertical center cross intersection\n    var centerIntersect;\n\n    if (verticalIntersect && horizontalIntersect) {\n      if (getDistance(verticalIntersect, elementMid) > getDistance(horizontalIntersect, elementMid)) {\n        centerIntersect = horizontalIntersect;\n      } else {\n        centerIntersect = verticalIntersect;\n      }\n    } else {\n      centerIntersect = verticalIntersect || horizontalIntersect;\n    }\n\n    startPoint.original = centerIntersect;\n  }\n\n  function fixDockings(connection) {\n    var waypoints = connection.waypoints;\n\n    adjustDocking(\n      waypoints[0],\n      waypoints[1],\n      getMid(connection.source)\n    );\n\n    adjustDocking(\n      waypoints[waypoints.length - 1],\n      waypoints[waypoints.length - 2],\n      getMid(connection.target)\n    );\n  }\n\n  eventBus.on('bpmnElement.added', function(e) {\n\n    var element = e.element;\n\n    if (element.waypoints) {\n      fixDockings(element);\n    }\n  });\n}\n\nImportDockingFix.$inject = [\n  'eventBus'\n];\n\n\n// helpers //////////////////////\n\nfunction getDistance(p1, p2) {\n  return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));\n}","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getBusinessObject,\n  getDi\n} from '../../../util/ModelUtil';\n\nimport {\n  isAny\n} from '../util/ModelingUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * A component that makes sure that each created or updated\n * Pool and Lane is assigned an isHorizontal property set to true.\n *\n * @param {EventBus} eventBus\n */\nexport default function IsHorizontalFix(eventBus) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  var elementTypesToUpdate = [\n    'bpmn:Participant',\n    'bpmn:Lane'\n  ];\n\n  this.executed([ 'shape.move', 'shape.create', 'shape.resize' ], function(event) {\n    var shape = event.context.shape,\n        bo = getBusinessObject(shape),\n        di = getDi(shape);\n\n    if (isAny(bo, elementTypesToUpdate)) {\n      var isHorizontal = di.get('isHorizontal');\n\n      if (isHorizontal === undefined) {\n        isHorizontal = true;\n      }\n\n      // set attribute directly to avoid modeling#updateProperty side effects\n      di.set('isHorizontal', isHorizontal);\n    }\n  });\n\n}\n\nIsHorizontalFix.$inject = [ 'eventBus' ];\n\ninherits(IsHorizontalFix, CommandInterceptor);\n","/**\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n *\n * @typedef { {\n*   type: 'bendpoint' | 'segment';\n*   position: Point;\n*   segmentIndex: number;\n*   bendpointIndex?: number;\n*   relativeLocation?: number;\n* } } Attachment\n*/\n\nvar sqrt = Math.sqrt,\n    min = Math.min,\n    max = Math.max,\n    abs = Math.abs;\n\n/**\n * Calculate the square (power to two) of a number.\n *\n * @param {number} n\n *\n * @return {number}\n */\nfunction sq(n) {\n  return Math.pow(n, 2);\n}\n\n/**\n * Get distance between two points.\n *\n * @param {Point} p1\n * @param {Point} p2\n *\n * @return {number}\n */\nfunction getDistance(p1, p2) {\n  return sqrt(sq(p1.x - p2.x) + sq(p1.y - p2.y));\n}\n\n/**\n * Return the attachment of the given point on the specified line.\n *\n * The attachment is either a bendpoint (attached to the given point)\n * or segment (attached to a location on a line segment) attachment:\n *\n * ```javascript\n * var pointAttachment = {\n *   type: 'bendpoint',\n *   bendpointIndex: 3,\n *   position: { x: 10, y: 10 } // the attach point on the line\n * };\n *\n * var segmentAttachment = {\n *   type: 'segment',\n *   segmentIndex: 2,\n *   relativeLocation: 0.31, // attach point location between 0 (at start) and 1 (at end)\n *   position: { x: 10, y: 10 } // the attach point on the line\n * };\n * ```\n *\n * @param {Point} point\n * @param {Point[]} line\n *\n * @return {Attachment}\n */\nexport function getAttachment(point, line) {\n\n  var idx = 0,\n      segmentStart,\n      segmentEnd,\n      segmentStartDistance,\n      segmentEndDistance,\n      attachmentPosition,\n      minDistance,\n      intersections,\n      attachment,\n      attachmentDistance,\n      closestAttachmentDistance,\n      closestAttachment;\n\n  for (idx = 0; idx < line.length - 1; idx++) {\n\n    segmentStart = line[idx];\n    segmentEnd = line[idx + 1];\n\n    if (pointsEqual(segmentStart, segmentEnd)) {\n      intersections = [ segmentStart ];\n    } else {\n      segmentStartDistance = getDistance(point, segmentStart);\n      segmentEndDistance = getDistance(point, segmentEnd);\n\n      minDistance = min(segmentStartDistance, segmentEndDistance);\n\n      intersections = getCircleSegmentIntersections(segmentStart, segmentEnd, point, minDistance);\n    }\n\n    if (intersections.length < 1) {\n      throw new Error('expected between [1, 2] circle -> line intersections');\n    }\n\n    // one intersection -> bendpoint attachment\n    if (intersections.length === 1) {\n      attachment = {\n        type: 'bendpoint',\n        position: intersections[0],\n        segmentIndex: idx,\n        bendpointIndex: pointsEqual(segmentStart, intersections[0]) ? idx : idx + 1\n      };\n    }\n\n    // two intersections -> segment attachment\n    if (intersections.length === 2) {\n\n      attachmentPosition = mid(intersections[0], intersections[1]);\n\n      attachment = {\n        type: 'segment',\n        position: attachmentPosition,\n        segmentIndex: idx,\n        relativeLocation: getDistance(segmentStart, attachmentPosition) / getDistance(segmentStart, segmentEnd)\n      };\n    }\n\n    attachmentDistance = getDistance(attachment.position, point);\n\n    if (!closestAttachment || closestAttachmentDistance > attachmentDistance) {\n      closestAttachment = attachment;\n      closestAttachmentDistance = attachmentDistance;\n    }\n  }\n\n  return closestAttachment;\n}\n\n/**\n * Get the intersection between a circle and a line segment.\n *\n * @param {Point} s1 segment start\n * @param {Point} s2 segment end\n * @param {Point} cc circle center\n * @param {number} cr circle radius\n *\n * @return {Point[]} intersections\n */\nfunction getCircleSegmentIntersections(s1, s2, cc, cr) {\n\n  var baX = s2.x - s1.x;\n  var baY = s2.y - s1.y;\n  var caX = cc.x - s1.x;\n  var caY = cc.y - s1.y;\n\n  var a = baX * baX + baY * baY;\n  var bBy2 = baX * caX + baY * caY;\n  var c = caX * caX + caY * caY - cr * cr;\n\n  var pBy2 = bBy2 / a;\n  var q = c / a;\n\n  var disc = pBy2 * pBy2 - q;\n\n  // check against negative value to work around\n  // negative, very close to zero results (-4e-15)\n  // being produced in some environments\n  if (disc < 0 && disc > -0.000001) {\n    disc = 0;\n  }\n\n  if (disc < 0) {\n    return [];\n  }\n\n  // if disc == 0 ... dealt with later\n  var tmpSqrt = sqrt(disc);\n  var abScalingFactor1 = -pBy2 + tmpSqrt;\n  var abScalingFactor2 = -pBy2 - tmpSqrt;\n\n  var i1 = {\n    x: s1.x - baX * abScalingFactor1,\n    y: s1.y - baY * abScalingFactor1\n  };\n\n  if (disc === 0) { // abScalingFactor1 == abScalingFactor2\n    return [ i1 ];\n  }\n\n  var i2 = {\n    x: s1.x - baX * abScalingFactor2,\n    y: s1.y - baY * abScalingFactor2\n  };\n\n  // return only points on line segment\n  return [ i1, i2 ].filter(function(p) {\n    return isPointInSegment(p, s1, s2);\n  });\n}\n\n\nfunction isPointInSegment(p, segmentStart, segmentEnd) {\n  return (\n    fenced(p.x, segmentStart.x, segmentEnd.x) &&\n    fenced(p.y, segmentStart.y, segmentEnd.y)\n  );\n}\n\nfunction fenced(n, rangeStart, rangeEnd) {\n\n  // use matching threshold to work around\n  // precision errors in intersection computation\n\n  return (\n    n >= min(rangeStart, rangeEnd) - EQUAL_THRESHOLD &&\n    n <= max(rangeStart, rangeEnd) + EQUAL_THRESHOLD\n  );\n}\n\n/**\n * Calculate the mid between two points.\n *\n * @param {Point} p1\n * @param {Point} p2\n *\n * @return {Point}\n */\nfunction mid(p1, p2) {\n\n  return {\n    x: (p1.x + p2.x) / 2,\n    y: (p1.y + p2.y) / 2\n  };\n}\n\nvar EQUAL_THRESHOLD = 0.1;\n\nfunction pointsEqual(p1, p2) {\n\n  return (\n    abs(p1.x - p2.x) <= EQUAL_THRESHOLD &&\n    abs(p1.y - p2.y) <= EQUAL_THRESHOLD\n  );\n}\n","import {\n  getDistancePointPoint,\n  rotateVector,\n  getAngle\n} from './GeometricUtil';\n\nimport {\n  getAttachment\n} from './LineAttachmentUtil';\n\nimport {\n  roundPoint\n} from 'diagram-js/lib/layout/LayoutUtil';\n\n/**\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n *\n * @typedef {import('./LineAttachmentUtil').Attachment} Attachment\n *\n * @typedef { {\n *   point: Point;\n *   delta: Point;\n * } } AnchorPointAdjustment\n *\n * @typedef { {\n *   segmentMove?: {\n*     segmentStartIndex: number;\n*     newSegmentStartIndex: number;\n*   };\n*   bendpointMove?: {\n*     insert: boolean;\n*     bendpointIndex: number;\n*   };\n*   connectionStart: boolean;\n*   connectionEnd: boolean;\n* } } FindNewLineStartIndexHints\n */\n\n/**\n * @param {Point[]} oldWaypoints\n * @param {Point[]} newWaypoints\n * @param {Attachment} attachment\n * @param {FindNewLineStartIndexHints} hints\n *\n * @return {number}\n */\nexport function findNewLineStartIndex(oldWaypoints, newWaypoints, attachment, hints) {\n\n  var index = attachment.segmentIndex;\n\n  var offset = newWaypoints.length - oldWaypoints.length;\n\n  // segmentMove happened\n  if (hints.segmentMove) {\n\n    var oldSegmentStartIndex = hints.segmentMove.segmentStartIndex,\n        newSegmentStartIndex = hints.segmentMove.newSegmentStartIndex;\n\n    // if point was on moved segment return new segment index\n    if (index === oldSegmentStartIndex) {\n      return newSegmentStartIndex;\n    }\n\n    // point is after new segment index\n    if (index >= newSegmentStartIndex) {\n      return (index + offset < newSegmentStartIndex) ? newSegmentStartIndex : index + offset;\n    }\n\n    // if point is before new segment index\n    return index;\n  }\n\n  // bendpointMove happened\n  if (hints.bendpointMove) {\n\n    var insert = hints.bendpointMove.insert,\n        bendpointIndex = hints.bendpointMove.bendpointIndex,\n        newIndex;\n\n    // waypoints length didnt change\n    if (offset === 0) {\n      return index;\n    }\n\n    // point behind new/removed bendpoint\n    if (index >= bendpointIndex) {\n      newIndex = insert ? index + 1 : index - 1;\n    }\n\n    // point before new/removed bendpoint\n    if (index < bendpointIndex) {\n\n      newIndex = index;\n\n      // decide point should take right or left segment\n      if (insert && attachment.type !== 'bendpoint' && bendpointIndex - 1 === index) {\n\n        var rel = relativePositionMidWaypoint(newWaypoints, bendpointIndex);\n\n        if (rel < attachment.relativeLocation) {\n          newIndex++;\n        }\n      }\n    }\n\n    return newIndex;\n  }\n\n  // start/end changed\n  if (offset === 0) {\n    return index;\n  }\n\n  if (hints.connectionStart && index === 0) {\n    return 0;\n  }\n\n  if (hints.connectionEnd && index === oldWaypoints.length - 2) {\n    return newWaypoints.length - 2;\n  }\n\n  // if nothing fits, take the middle segment\n  return Math.floor((newWaypoints.length - 2) / 2);\n}\n\n\n/**\n * Calculate the required adjustment (move delta) for the given point\n * after the connection waypoints got updated.\n *\n * @param {Point} position\n * @param {Point[]} newWaypoints\n * @param {Point[]} oldWaypoints\n * @param {FindNewLineStartIndexHints} hints\n *\n * @return {AnchorPointAdjustment} result\n */\nexport function getAnchorPointAdjustment(position, newWaypoints, oldWaypoints, hints) {\n\n  var dx = 0,\n      dy = 0;\n\n  var oldPosition = {\n    point: position,\n    delta: { x: 0, y: 0 }\n  };\n\n  // get closest attachment\n  var attachment = getAttachment(position, oldWaypoints),\n      oldLabelLineIndex = attachment.segmentIndex,\n      newLabelLineIndex = findNewLineStartIndex(oldWaypoints, newWaypoints, attachment, hints);\n\n\n  // should never happen\n  // TODO(@janstuemmel): throw an error here when connectionSegmentMove is refactored\n  if (newLabelLineIndex < 0 ||\n      newLabelLineIndex > newWaypoints.length - 2 ||\n      newLabelLineIndex === null) {\n    return oldPosition;\n  }\n\n  var oldLabelLine = getLine(oldWaypoints, oldLabelLineIndex),\n      newLabelLine = getLine(newWaypoints, newLabelLineIndex),\n      oldFoot = attachment.position;\n\n  var relativeFootPosition = getRelativeFootPosition(oldLabelLine, oldFoot),\n      angleDelta = getAngleDelta(oldLabelLine, newLabelLine);\n\n  // special rule if label on bendpoint\n  if (attachment.type === 'bendpoint') {\n\n    var offset = newWaypoints.length - oldWaypoints.length,\n        oldBendpointIndex = attachment.bendpointIndex,\n        oldBendpoint = oldWaypoints[oldBendpointIndex];\n\n    // bendpoint position hasn't changed, return same position\n    if (newWaypoints.indexOf(oldBendpoint) !== -1) {\n      return oldPosition;\n    }\n\n    // new bendpoint and old bendpoint have same index, then just return the offset\n    if (offset === 0) {\n      var newBendpoint = newWaypoints[oldBendpointIndex];\n\n      dx = newBendpoint.x - attachment.position.x,\n      dy = newBendpoint.y - attachment.position.y;\n\n      return {\n        delta: {\n          x: dx,\n          y: dy\n        },\n        point: {\n          x: position.x + dx,\n          y: position.y + dy\n        }\n      };\n    }\n\n    // if bendpoints get removed\n    if (offset < 0 && oldBendpointIndex !== 0 && oldBendpointIndex < oldWaypoints.length - 1) {\n      relativeFootPosition = relativePositionMidWaypoint(oldWaypoints, oldBendpointIndex);\n    }\n  }\n\n  var newFoot = {\n    x: (newLabelLine[1].x - newLabelLine[0].x) * relativeFootPosition + newLabelLine[0].x,\n    y: (newLabelLine[1].y - newLabelLine[0].y) * relativeFootPosition + newLabelLine[0].y\n  };\n\n  // the rotated vector to label\n  var newLabelVector = rotateVector({\n    x: position.x - oldFoot.x,\n    y: position.y - oldFoot.y\n  }, angleDelta);\n\n  // the new relative position\n  dx = newFoot.x + newLabelVector.x - position.x;\n  dy = newFoot.y + newLabelVector.y - position.y;\n\n  return {\n    point: roundPoint(newFoot),\n    delta: roundPoint({\n      x: dx,\n      y: dy\n    })\n  };\n}\n\n\n// HELPERS //////////////////////\n\nfunction relativePositionMidWaypoint(waypoints, idx) {\n\n  var distanceSegment1 = getDistancePointPoint(waypoints[idx - 1], waypoints[idx]),\n      distanceSegment2 = getDistancePointPoint(waypoints[idx], waypoints[idx + 1]);\n\n  var relativePosition = distanceSegment1 / (distanceSegment1 + distanceSegment2);\n\n  return relativePosition;\n}\n\nfunction getAngleDelta(l1, l2) {\n  var a1 = getAngle(l1),\n      a2 = getAngle(l2);\n  return a2 - a1;\n}\n\nfunction getLine(waypoints, idx) {\n  return [ waypoints[idx], waypoints[idx + 1] ];\n}\n\nfunction getRelativeFootPosition(line, foot) {\n\n  var length = getDistancePointPoint(line[0], line[1]),\n      lengthToFoot = getDistancePointPoint(line[0], foot);\n\n  return length === 0 ? 0 : lengthToFoot / length;\n}\n","import {\n  assign\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nimport {\n  is,\n  getBusinessObject\n} from '../../../util/ModelUtil';\n\nimport {\n  isLabelExternal,\n  getLabel,\n  hasExternalLabel,\n  isLabel\n} from '../../../util/LabelUtil';\n\nimport {\n  getLabelAdjustment\n} from './util/LabelLayoutUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getNewAttachPoint\n} from 'diagram-js/lib/util/AttachUtil';\n\nimport {\n  getMid,\n  roundPoint\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  delta\n} from 'diagram-js/lib/util/PositionUtil';\n\nimport {\n  sortBy\n} from 'min-dash';\n\nimport {\n  getDistancePointLine,\n  perpendicularFoot\n} from './util/GeometricUtil';\n\nvar NAME_PROPERTY = 'name';\nvar TEXT_PROPERTY = 'text';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('../BpmnFactory').default} BpmnFactory\n * @typedef {import('../../../draw/TextRenderer').default} TextRenderer\n *\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n *\n * @typedef {Point[]} Line\n */\n\n/**\n * A component that makes sure that external labels are added\n * together with respective elements and properly updated (DI wise)\n * during move.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {BpmnFactory} bpmnFactory\n * @param {TextRenderer} textRenderer\n */\nexport default function LabelBehavior(\n    eventBus, modeling, bpmnFactory,\n    textRenderer) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  // update label if name property was updated\n  this.postExecute('element.updateProperties', onPropertyUpdate);\n  this.postExecute('element.updateModdleProperties', e => {\n    const elementBo = getBusinessObject(e.context.element);\n\n    if (elementBo === e.context.moddleElement) {\n      onPropertyUpdate(e);\n    }\n  });\n\n  function onPropertyUpdate(e) {\n    var context = e.context,\n        element = context.element,\n        properties = context.properties;\n\n    if (NAME_PROPERTY in properties) {\n      modeling.updateLabel(element, properties[NAME_PROPERTY]);\n    }\n\n    if (TEXT_PROPERTY in properties\n        && is(element, 'bpmn:TextAnnotation')) {\n\n      var newBounds = textRenderer.getTextAnnotationBounds(\n        {\n          x: element.x,\n          y: element.y,\n          width: element.width,\n          height: element.height\n        },\n        properties[TEXT_PROPERTY] || ''\n      );\n\n      modeling.updateLabel(element, properties.text, newBounds);\n    }\n  }\n\n  // create label shape after shape/connection was created\n  this.postExecute([ 'shape.create', 'connection.create' ], function(e) {\n    var context = e.context,\n        hints = context.hints || {};\n\n    if (hints.createElementsBehavior === false) {\n      return;\n    }\n\n    var element = context.shape || context.connection;\n\n    if (isLabel(element) || !isLabelExternal(element)) {\n      return;\n    }\n\n    // only create label if attribute available\n    if (!getLabel(element)) {\n      return;\n    }\n\n    modeling.updateLabel(element, getLabel(element));\n  });\n\n  // update label after label shape was deleted\n  this.postExecute('shape.delete', function(event) {\n    var context = event.context,\n        labelTarget = context.labelTarget,\n        hints = context.hints || {};\n\n    // check if label\n    if (labelTarget && hints.unsetLabel !== false) {\n      modeling.updateLabel(labelTarget, null, null, { removeShape: false });\n    }\n  });\n\n  function getVisibleLabelAdjustment(event) {\n\n    var context = event.context,\n        connection = context.connection,\n        label = connection.label,\n        hints = assign({}, context.hints),\n        newWaypoints = context.newWaypoints || connection.waypoints,\n        oldWaypoints = context.oldWaypoints;\n\n\n    if (typeof hints.startChanged === 'undefined') {\n      hints.startChanged = !!hints.connectionStart;\n    }\n\n    if (typeof hints.endChanged === 'undefined') {\n      hints.endChanged = !!hints.connectionEnd;\n    }\n\n    return getLabelAdjustment(label, newWaypoints, oldWaypoints, hints);\n  }\n\n  this.postExecute([\n    'connection.layout',\n    'connection.updateWaypoints'\n  ], function(event) {\n    var context = event.context,\n        hints = context.hints || {};\n\n    if (hints.labelBehavior === false) {\n      return;\n    }\n\n    var connection = context.connection,\n        label = connection.label,\n        labelAdjustment;\n\n    // handle missing label as well as the case\n    // that the label parent does not exist (yet),\n    // because it is being pasted / created via multi element create\n    //\n    // Cf. https://github.com/bpmn-io/bpmn-js/pull/1227\n    if (!label || !label.parent) {\n      return;\n    }\n\n    labelAdjustment = getVisibleLabelAdjustment(event);\n\n    modeling.moveShape(label, labelAdjustment);\n  });\n\n\n  // keep label position on shape replace\n  this.postExecute([ 'shape.replace' ], function(event) {\n    var context = event.context,\n        newShape = context.newShape,\n        oldShape = context.oldShape;\n\n    var businessObject = getBusinessObject(newShape);\n\n    if (businessObject\n      && isLabelExternal(businessObject)\n      && oldShape.label\n      && newShape.label) {\n      newShape.label.x = oldShape.label.x;\n      newShape.label.y = oldShape.label.y;\n    }\n  });\n\n\n  // move external label after resizing\n  this.postExecute('shape.resize', function(event) {\n\n    var context = event.context,\n        shape = context.shape,\n        newBounds = context.newBounds,\n        oldBounds = context.oldBounds;\n\n    if (hasExternalLabel(shape)) {\n\n      var label = shape.label,\n          labelMid = getMid(label),\n          edges = asEdges(oldBounds);\n\n      // get nearest border point to label as reference point\n      var referencePoint = getReferencePoint(labelMid, edges);\n\n      var delta = getReferencePointDelta(referencePoint, oldBounds, newBounds);\n\n      modeling.moveShape(label, delta);\n\n    }\n\n  });\n\n}\n\ninherits(LabelBehavior, CommandInterceptor);\n\nLabelBehavior.$inject = [\n  'eventBus',\n  'modeling',\n  'bpmnFactory',\n  'textRenderer'\n];\n\n// helpers //////////////////////\n\n/**\n * Calculates a reference point delta relative to a new position\n * of a certain element's bounds\n *\n * @param {Point} referencePoint\n * @param {Rect} oldBounds\n * @param {Rect} newBounds\n *\n * @return {Point}\n */\nexport function getReferencePointDelta(referencePoint, oldBounds, newBounds) {\n\n  var newReferencePoint = getNewAttachPoint(referencePoint, oldBounds, newBounds);\n\n  return roundPoint(delta(newReferencePoint, referencePoint));\n}\n\n/**\n * Generates the nearest point (reference point) for a given point\n * onto given set of lines\n *\n * @param {Point} point\n * @param {Line[]} lines\n *\n * @return {Point}\n */\nexport function getReferencePoint(point, lines) {\n\n  if (!lines.length) {\n    return;\n  }\n\n  var nearestLine = getNearestLine(point, lines);\n\n  return perpendicularFoot(point, nearestLine);\n}\n\n/**\n * Convert the given bounds to a lines array containing all edges\n *\n * @param {Rect|Point} bounds\n *\n * @return {Line[]}\n */\nexport function asEdges(bounds) {\n  return [\n    [ // top\n      {\n        x: bounds.x,\n        y: bounds.y\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y\n      }\n    ],\n    [ // right\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y + (bounds.height || 0)\n      }\n    ],\n    [ // bottom\n      {\n        x: bounds.x,\n        y: bounds.y + (bounds.height || 0)\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y + (bounds.height || 0)\n      }\n    ],\n    [ // left\n      {\n        x: bounds.x,\n        y: bounds.y\n      },\n      {\n        x: bounds.x,\n        y: bounds.y + (bounds.height || 0)\n      }\n    ]\n  ];\n}\n\n/**\n * Returns the nearest line for a given point by distance\n * @param {Point} point\n * @param {Line[]} lines\n *\n * @return {Line}\n */\nfunction getNearestLine(point, lines) {\n\n  var distances = lines.map(function(l) {\n    return {\n      line: l,\n      distance: getDistancePointLine(point, l)\n    };\n  });\n\n  var sorted = sortBy(distances, 'distance');\n\n  return sorted[0].line;\n}\n","import { findNewLineStartIndex, getAnchorPointAdjustment } from './LayoutUtil';\n\nimport { getMid } from 'diagram-js/lib/layout/LayoutUtil';\n\n/**\n * @typedef {import('./LineAttachmentUtil').Attachment} Attachment\n *\n * @typedef {import('./LayoutUtil').FindNewLineStartIndexHints} FindNewLineStartIndexHints\n *\n * @typedef {import('../../../../model/Types').Label} Label\n *\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n */\n\n/**\n * @param {Point[]} oldWaypoints\n * @param {Point[]} newWaypoints\n * @param {Attachment} attachment\n * @param {FindNewLineStartIndexHints} hints\n *\n * @return {number}\n */\nexport function findNewLabelLineStartIndex(oldWaypoints, newWaypoints, attachment, hints) {\n  return findNewLineStartIndex(oldWaypoints, newWaypoints, attachment, hints);\n}\n\n/**\n * Calculate the required adjustment (move delta) for the given label\n * after the connection waypoints got updated.\n *\n * @param {Label} label\n * @param {Point[]} newWaypoints\n * @param {Point[]} oldWaypoints\n * @param {FindNewLineStartIndexHints} hints\n *\n * @return {Point}\n */\nexport function getLabelAdjustment(label, newWaypoints, oldWaypoints, hints) {\n  var labelPosition = getMid(label);\n\n  return getAnchorPointAdjustment(labelPosition, newWaypoints, oldWaypoints, hints).delta;\n}","import {\n  assign\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { getConnectionAdjustment as getConnectionAnchorPoint } from './util/ConnectionLayoutUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * A component that makes sure that Associations connected to Connections\n * are updated together with the Connection.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function LayoutConnectionBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  function getnewAnchorPoint(event, point) {\n\n    var context = event.context,\n        connection = context.connection,\n        hints = assign({}, context.hints),\n        newWaypoints = context.newWaypoints || connection.waypoints,\n        oldWaypoints = context.oldWaypoints;\n\n\n    if (typeof hints.startChanged === 'undefined') {\n      hints.startChanged = !!hints.connectionStart;\n    }\n\n    if (typeof hints.endChanged === 'undefined') {\n      hints.endChanged = !!hints.connectionEnd;\n    }\n\n    return getConnectionAnchorPoint(point, newWaypoints, oldWaypoints, hints);\n  }\n\n  this.postExecute([\n    'connection.layout',\n    'connection.updateWaypoints'\n  ], function(event) {\n    var context = event.context;\n\n    var connection = context.connection,\n        outgoing = connection.outgoing,\n        incoming = connection.incoming;\n\n    incoming.forEach(function(connection) {\n      var endPoint = connection.waypoints[connection.waypoints.length - 1];\n      var newEndpoint = getnewAnchorPoint(event, endPoint);\n\n      var newWaypoints = [].concat(connection.waypoints.slice(0, -1), [ newEndpoint ]);\n\n      modeling.updateWaypoints(connection, newWaypoints);\n    });\n\n    outgoing.forEach(function(connection) {\n      var startpoint = connection.waypoints[0];\n      var newStartpoint = getnewAnchorPoint(event, startpoint);\n\n      var newWaypoints = [].concat([ newStartpoint ], connection.waypoints.slice(1));\n\n      modeling.updateWaypoints(connection, newWaypoints);\n    });\n\n  });\n\n\n  this.postExecute([\n    'connection.move'\n  ], function(event) {\n    var context = event.context;\n\n    var connection = context.connection,\n        outgoing = connection.outgoing,\n        incoming = connection.incoming,\n        delta = context.delta;\n\n    incoming.forEach(function(connection) {\n      var endPoint = connection.waypoints[connection.waypoints.length - 1];\n      var newEndpoint = {\n        x: endPoint.x + delta.x,\n        y: endPoint.y + delta.y\n      };\n\n      var newWaypoints = [].concat(connection.waypoints.slice(0, -1), [ newEndpoint ]);\n\n      modeling.updateWaypoints(connection, newWaypoints);\n    });\n\n    outgoing.forEach(function(connection) {\n      var startpoint = connection.waypoints[0];\n      var newStartpoint = {\n        x: startpoint.x + delta.x,\n        y: startpoint.y + delta.y\n      };\n\n      var newWaypoints = [].concat([ newStartpoint ], connection.waypoints.slice(1));\n\n      modeling.updateWaypoints(connection, newWaypoints);\n    });\n\n  });\n\n}\n\ninherits(LayoutConnectionBehavior, CommandInterceptor);\n\nLayoutConnectionBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n","import { getAnchorPointAdjustment } from './LayoutUtil';\n\n/**\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n *\n * @typedef {import('./LayoutUtil').FindNewLineStartIndexHints} FindNewLineStartIndexHints\n */\n\n/**\n * Calculate the new point after the connection waypoints got updated.\n *\n * @param {Point} position\n * @param {Point[]} newWaypoints\n * @param {Point[]} oldWaypoints\n * @param {FindNewLineStartIndexHints} hints\n *\n * @return {Point}\n */\nexport function getConnectionAdjustment(position, newWaypoints, oldWaypoints, hints) {\n  return getAnchorPointAdjustment(position, newWaypoints, oldWaypoints, hints).point;\n}\n\n","import inherits from 'inherits-browser';\r\n\r\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\r\n\r\nimport { is } from '../../../util/ModelUtil';\r\n\r\nimport { isExpanded } from '../../../util/DiUtil';\r\n\r\nimport { selfAndAllChildren } from 'diagram-js/lib/util/Elements';\r\n\r\nimport {\r\n  getResizedSourceAnchor,\r\n  getResizedTargetAnchor\r\n} from 'diagram-js/lib/features/modeling/cmd/helper/AnchorsHelper';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * BPMN-specific message flow behavior.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Modeling} modeling\r\n */\r\nexport default function MessageFlowBehavior(eventBus, modeling) {\r\n\r\n  CommandInterceptor.call(this, eventBus);\r\n\r\n  this.postExecute('shape.replace', function(context) {\r\n    var oldShape = context.oldShape,\r\n        newShape = context.newShape;\r\n\r\n    if (!isParticipantCollapse(oldShape, newShape)) {\r\n      return;\r\n    }\r\n\r\n    var messageFlows = getMessageFlows(oldShape);\r\n\r\n    messageFlows.incoming.forEach(function(incoming) {\r\n      var anchor = getResizedTargetAnchor(incoming, newShape, oldShape);\r\n\r\n      modeling.reconnectEnd(incoming, newShape, anchor);\r\n    });\r\n\r\n    messageFlows.outgoing.forEach(function(outgoing) {\r\n      var anchor = getResizedSourceAnchor(outgoing, newShape, oldShape);\r\n\r\n      modeling.reconnectStart(outgoing, newShape, anchor);\r\n    });\r\n  }, true);\r\n\r\n}\r\n\r\nMessageFlowBehavior.$inject = [ 'eventBus', 'modeling' ];\r\n\r\ninherits(MessageFlowBehavior, CommandInterceptor);\r\n\r\n// helpers //////////\r\n\r\nfunction isParticipantCollapse(oldShape, newShape) {\r\n  return is(oldShape, 'bpmn:Participant')\r\n    && isExpanded(oldShape)\r\n    && is(newShape, 'bpmn:Participant')\r\n    && !isExpanded(newShape);\r\n}\r\n\r\nfunction getMessageFlows(parent) {\r\n  var elements = selfAndAllChildren([ parent ], false);\r\n\r\n  var incoming = [],\r\n      outgoing = [];\r\n\r\n  elements.forEach(function(element) {\r\n    if (element === parent) {\r\n      return;\r\n    }\r\n\r\n    element.incoming.forEach(function(connection) {\r\n      if (is(connection, 'bpmn:MessageFlow')) {\r\n        incoming.push(connection);\r\n      }\r\n    });\r\n\r\n    element.outgoing.forEach(function(connection) {\r\n      if (is(connection, 'bpmn:MessageFlow')) {\r\n        outgoing.push(connection);\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  return {\r\n    incoming: incoming,\r\n    outgoing: outgoing\r\n  };\r\n}","import { isEventSubProcess } from '../../../../util/DiUtil';\nimport { getBusinessObject, is } from '../../../../util/ModelUtil';\n\nexport const NON_INTERRUPTING_EVENT_TYPES = [\n  'bpmn:MessageEventDefinition',\n  'bpmn:TimerEventDefinition',\n  'bpmn:EscalationEventDefinition',\n  'bpmn:ConditionalEventDefinition',\n  'bpmn:SignalEventDefinition'\n];\n\nexport function canBeNonInterrupting(shape) {\n\n  const businessObject = getBusinessObject(shape);\n\n  if (\n    !is(businessObject, 'bpmn:BoundaryEvent') &&\n    !(is(businessObject, 'bpmn:StartEvent') && isEventSubProcess(businessObject.$parent))\n  ) {\n    return false;\n  }\n\n  const eventDefinitions = businessObject.get('eventDefinitions');\n  if (!eventDefinitions || !eventDefinitions.length) {\n    return false;\n  }\n\n  return NON_INTERRUPTING_EVENT_TYPES.some(event => is(eventDefinitions[0], event));\n}\n\nexport function getInterruptingProperty(shape) {\n  return is(shape, 'bpmn:BoundaryEvent') ? 'cancelActivity' : 'isInterrupting';\n}","import CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport inherits from 'inherits-browser';\n\nimport { canBeNonInterrupting, getInterruptingProperty } from './util/NonInterruptingUtil';\nimport { getBusinessObject } from '../../../util/ModelUtil';\n\nexport default function NonInterruptingBehavior(injector, modeling) {\n  injector.invoke(CommandInterceptor, this);\n\n  this.postExecuted('shape.replace', function(event) {\n    const oldShape = event.context.oldShape;\n    const newShape = event.context.newShape;\n    const hints = event.context.hints;\n\n    if (!canBeNonInterrupting(newShape)) {\n      return;\n    }\n\n    const property = getInterruptingProperty(newShape);\n    const isExplicitChange = hints.targetElement && hints.targetElement[property] !== undefined;\n\n    if (isExplicitChange) {\n      return;\n    }\n\n    const isOldInterrupting = getBusinessObject(oldShape).get(property);\n    const isNewInterruptingDefault = getBusinessObject(newShape).get(property);\n\n    if (isOldInterrupting === isNewInterruptingDefault) {\n      return;\n    }\n\n    modeling.updateProperties(newShape, {\n      [property]: isOldInterrupting\n    });\n  });\n}\n\nNonInterruptingBehavior.$inject = [ 'injector', 'modeling' ];\n\ninherits(NonInterruptingBehavior, CommandInterceptor);\n","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { getDi } from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * BPMN specific behavior ensuring that bpmndi:Label's dc:Bounds are removed\n * when shape is resized.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function RemoveEmbeddedLabelBoundsBehavior(eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  this.preExecute('shape.resize', function(context) {\n    var shape = context.shape;\n\n    var di = getDi(shape),\n        label = di && di.get('label'),\n        bounds = label && label.get('bounds');\n\n    if (bounds) {\n      modeling.updateModdleProperties(shape, label, {\n        bounds: undefined\n      });\n    }\n  }, true);\n}\n\ninherits(RemoveEmbeddedLabelBoundsBehavior, CommandInterceptor);\n\nRemoveEmbeddedLabelBoundsBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];","import inherits from 'inherits-browser';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport lineIntersect from './util/LineIntersect';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../rules/BpmnRules').default} BpmnRules\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * @param {EventBus} eventBus\n * @param {BpmnRules} bpmnRules\n * @param {Modeling} modeling\n */\nexport default function RemoveElementBehavior(eventBus, bpmnRules, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Combine sequence flows when deleting an element\n   * if there is one incoming and one outgoing\n   * sequence flow\n   */\n  this.preExecute('shape.delete', function(e) {\n\n    var shape = e.context.shape;\n\n    // only handle [a] -> [shape] -> [b] patterns\n    if (shape.incoming.length !== 1 || shape.outgoing.length !== 1) {\n      return;\n    }\n\n    var inConnection = shape.incoming[0],\n        outConnection = shape.outgoing[0];\n\n    // only handle sequence flows\n    if (!is(inConnection, 'bpmn:SequenceFlow') || !is(outConnection, 'bpmn:SequenceFlow')) {\n      return;\n    }\n\n    if (bpmnRules.canConnect(inConnection.source, outConnection.target, inConnection)) {\n\n      // compute new, combined waypoints\n      var newWaypoints = getNewWaypoints(inConnection.waypoints, outConnection.waypoints);\n\n      modeling.reconnectEnd(inConnection, outConnection.target, newWaypoints);\n    }\n  });\n\n}\n\ninherits(RemoveElementBehavior, CommandInterceptor);\n\nRemoveElementBehavior.$inject = [\n  'eventBus',\n  'bpmnRules',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\nfunction getDocking(point) {\n  return point.original || point;\n}\n\n\nfunction getNewWaypoints(inWaypoints, outWaypoints) {\n\n  var intersection = lineIntersect(\n    getDocking(inWaypoints[inWaypoints.length - 2]),\n    getDocking(inWaypoints[inWaypoints.length - 1]),\n    getDocking(outWaypoints[1]),\n    getDocking(outWaypoints[0]));\n\n  if (intersection) {\n    return [].concat(\n      inWaypoints.slice(0, inWaypoints.length - 1),\n      [ intersection ],\n      outWaypoints.slice(1));\n  } else {\n    return [\n      getDocking(inWaypoints[0]),\n      getDocking(outWaypoints[outWaypoints.length - 1])\n    ];\n  }\n}","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * BPMN specific remove behavior.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function RemoveParticipantBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n\n  /**\n   * morph collaboration diagram into process diagram\n   * after the last participant has been removed\n   */\n\n  this.preExecute('shape.delete', function(context) {\n\n    var shape = context.shape,\n        parent = shape.parent;\n\n    // activate the behavior if the shape to be removed\n    // is a participant\n    if (is(shape, 'bpmn:Participant')) {\n      context.collaborationRoot = parent;\n    }\n  }, true);\n\n  this.postExecute('shape.delete', function(context) {\n\n    var collaborationRoot = context.collaborationRoot;\n\n    if (collaborationRoot && !collaborationRoot.businessObject.participants.length) {\n\n      // replace empty collaboration with process diagram\n      var process = modeling.makeProcess();\n\n      // move all root elements from collaboration to process\n      var children = collaborationRoot.children.slice();\n\n      modeling.moveElements(children, { x: 0, y: 0 }, process);\n    }\n  }, true);\n\n}\n\nRemoveParticipantBehavior.$inject = [ 'eventBus', 'modeling' ];\n\ninherits(RemoveParticipantBehavior, CommandInterceptor);","import {\n  forEach,\n  find,\n  matchPattern\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('../../rules/BpmnRules').default} BpmnRules\n * @typedef {import('didi').Injector} Injector\n */\n\n/**\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {BpmnRules} bpmnRules\n * @param {Injector} injector\n */\nexport default function ReplaceConnectionBehavior(eventBus, modeling, bpmnRules, injector) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  var dragging = injector.get('dragging', false);\n\n  function fixConnection(connection) {\n\n    var source = connection.source,\n        target = connection.target,\n        parent = connection.parent;\n\n    // do not do anything if connection\n    // is already deleted (may happen due to other\n    // behaviors plugged-in before)\n    if (!parent) {\n      return;\n    }\n\n    var replacementType,\n        remove;\n\n    /**\n     * Check if incoming or outgoing connections\n     * can stay or could be substituted with an\n     * appropriate replacement.\n     *\n     * This holds true for SequenceFlow <> MessageFlow.\n     */\n\n    if (is(connection, 'bpmn:SequenceFlow')) {\n      if (!bpmnRules.canConnectSequenceFlow(source, target)) {\n        remove = true;\n      }\n\n      if (bpmnRules.canConnectMessageFlow(source, target)) {\n        replacementType = 'bpmn:MessageFlow';\n      }\n    }\n\n    // transform message flows into sequence flows, if possible\n\n    if (is(connection, 'bpmn:MessageFlow')) {\n\n      if (!bpmnRules.canConnectMessageFlow(source, target)) {\n        remove = true;\n      }\n\n      if (bpmnRules.canConnectSequenceFlow(source, target)) {\n        replacementType = 'bpmn:SequenceFlow';\n      }\n    }\n\n    // remove invalid connection,\n    // unless it has been removed already\n    if (remove) {\n      modeling.removeConnection(connection);\n    }\n\n    // replace SequenceFlow <> MessageFlow\n\n    if (replacementType) {\n      modeling.connect(source, target, {\n        type: replacementType,\n        waypoints: connection.waypoints.slice()\n      });\n    }\n  }\n\n  function replaceReconnectedConnection(event) {\n\n    var context = event.context,\n        connection = context.connection,\n        source = context.newSource || connection.source,\n        target = context.newTarget || connection.target,\n        allowed,\n        replacement;\n\n    allowed = bpmnRules.canConnect(source, target);\n\n    if (!allowed || allowed.type === connection.type) {\n      return;\n    }\n\n    replacement = modeling.connect(source, target, {\n      type: allowed.type,\n      associationDirection: allowed.associationDirection,\n      waypoints: connection.waypoints.slice()\n    });\n\n    // remove old connection unless it's already removed\n    if (connection.parent) {\n      modeling.removeConnection(connection);\n    }\n\n    // replace connection in context to reconnect end/start\n    context.connection = replacement;\n\n    if (dragging) {\n      cleanDraggingSelection(connection, replacement);\n    }\n  }\n\n  // monkey-patch selection saved in dragging in order to re-select it when operation is finished\n  function cleanDraggingSelection(oldConnection, newConnection) {\n    var context = dragging.context(),\n        previousSelection = context && context.payload.previousSelection,\n        index;\n\n    // do nothing if not dragging or no selection was present\n    if (!previousSelection || !previousSelection.length) {\n      return;\n    }\n\n    index = previousSelection.indexOf(oldConnection);\n\n    if (index === -1) {\n      return;\n    }\n\n    previousSelection.splice(index, 1, newConnection);\n  }\n\n  // lifecycle hooks\n\n  this.postExecuted('elements.move', function(context) {\n\n    var closure = context.closure,\n        allConnections = closure.allConnections;\n\n    forEach(allConnections, fixConnection);\n  }, true);\n\n  this.preExecute('connection.reconnect', replaceReconnectedConnection);\n\n  this.postExecuted('element.updateProperties', function(event) {\n    var context = event.context,\n        properties = context.properties,\n        element = context.element,\n        businessObject = element.businessObject,\n        connection;\n\n    // remove condition on change to default\n    if (properties.default) {\n      connection = find(\n        element.outgoing,\n        matchPattern({ id: element.businessObject.default.id })\n      );\n\n      if (connection) {\n        modeling.updateProperties(connection, { conditionExpression: undefined });\n      }\n    }\n\n    // remove default from source on change to conditional\n    if (properties.conditionExpression && businessObject.sourceRef.default === businessObject) {\n      modeling.updateProperties(element.source, { default: undefined });\n    }\n  });\n}\n\ninherits(ReplaceConnectionBehavior, CommandInterceptor);\n\nReplaceConnectionBehavior.$inject = [\n  'eventBus',\n  'modeling',\n  'bpmnRules',\n  'injector'\n];\n","import inherits from 'inherits-browser';\n\nimport { forEach, reduce } from 'min-dash';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { isEventSubProcess } from '../../../util/DiUtil';\n\n/**\n * @typedef {import('../../replace/BpmnReplace').default} BpmnReplace\n * @typedef {import('../../rules/BpmnRules').default} BpmnRules\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('didi').Injector} Injector\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('diagram-js/lib/features/selection/Selection').default} Selection\n */\n\n/**\n * BPMN-specific replace behavior.\n *\n * @param {BpmnReplace} bpmnReplace\n * @param {BpmnRules} bpmnRules\n * @param {ElementRegistry} elementRegistry\n * @param {Injector} injector\n * @param {Modeling} modeling\n * @param {Selection} selection\n */\nexport default function ReplaceElementBehaviour(\n    bpmnReplace,\n    bpmnRules,\n    elementRegistry,\n    injector,\n    modeling,\n    selection\n) {\n  injector.invoke(CommandInterceptor, this);\n\n  this._bpmnReplace = bpmnReplace;\n  this._elementRegistry = elementRegistry;\n  this._selection = selection;\n\n  // replace elements on create, e.g. during copy-paste\n  this.postExecuted([ 'elements.create' ], 500, function(event) {\n    var context = event.context,\n        target = context.parent,\n        elements = context.elements;\n\n    var elementReplacements = reduce(elements, function(replacements, element) {\n      var canReplace = bpmnRules.canReplace([ element ], element.host || element.parent || target);\n\n      return canReplace ? replacements.concat(canReplace.replacements) : replacements;\n    }, []);\n\n    if (elementReplacements.length) {\n      this._replaceElements(elements, elementReplacements);\n    }\n  }, this);\n\n  // replace elements on move\n  this.postExecuted([ 'elements.move' ], 500, function(event) {\n    var context = event.context,\n        target = context.newParent,\n        newHost = context.newHost,\n        elements = [];\n\n    forEach(context.closure.topLevel, function(topLevelElements) {\n      if (isEventSubProcess(topLevelElements)) {\n        elements = elements.concat(topLevelElements.children);\n      } else {\n        elements = elements.concat(topLevelElements);\n      }\n    });\n\n    // set target to host if attaching\n    if (elements.length === 1 && newHost) {\n      target = newHost;\n    }\n\n    var canReplace = bpmnRules.canReplace(elements, target);\n\n    if (canReplace) {\n      this._replaceElements(elements, canReplace.replacements, newHost);\n    }\n  }, this);\n\n  // update attachments on host replace\n  this.postExecute([ 'shape.replace' ], 1500, function(e) {\n    var context = e.context,\n        oldShape = context.oldShape,\n        newShape = context.newShape,\n        attachers = oldShape.attachers,\n        canReplace;\n\n    if (attachers && attachers.length) {\n      canReplace = bpmnRules.canReplace(attachers, newShape);\n\n      this._replaceElements(attachers, canReplace.replacements);\n    }\n\n  }, this);\n\n  // keep ID on shape replace\n  this.postExecuted([ 'shape.replace' ], 1500, function(e) {\n    var context = e.context,\n        oldShape = context.oldShape,\n        newShape = context.newShape;\n\n    modeling.unclaimId(oldShape.businessObject.id, oldShape.businessObject);\n    modeling.updateProperties(newShape, { id: oldShape.id });\n  });\n}\n\ninherits(ReplaceElementBehaviour, CommandInterceptor);\n\nReplaceElementBehaviour.prototype._replaceElements = function(elements, newElements) {\n  var elementRegistry = this._elementRegistry,\n      bpmnReplace = this._bpmnReplace,\n      selection = this._selection;\n\n  forEach(newElements, function(replacement) {\n    var newElement = {\n      type: replacement.newElementType\n    };\n\n    var oldElement = elementRegistry.get(replacement.oldElementId);\n\n    var idx = elements.indexOf(oldElement);\n\n    elements[idx] = bpmnReplace.replaceElement(oldElement, newElement, { select: false });\n  });\n\n  if (newElements) {\n    selection.select(elements);\n  }\n};\n\nReplaceElementBehaviour.$inject = [\n  'bpmnReplace',\n  'bpmnRules',\n  'elementRegistry',\n  'injector',\n  'modeling',\n  'selection'\n];\n","import { is } from '../../../util/ModelUtil';\n\nimport {\n  isExpanded,\n  isHorizontal\n} from '../../../util/DiUtil';\n\nimport {\n  asTRBL\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  collectLanes,\n  getLanesRoot\n} from '../util/LaneUtil';\n\nvar HIGH_PRIORITY = 1500;\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n *\n * @typedef {import('../../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').Dimensions} Dimensions\n * @typedef {import('diagram-js/lib/util/Types').Direction} Direction\n * @typedef {import('diagram-js/lib/util/Types').RectTRBL} RectTRBL\n */\n\n/**\n * @type {Dimensions}\n */\nexport var GROUP_MIN_DIMENSIONS = { width: 140, height: 120 };\n\n/**\n * @type {Dimensions}\n */\nexport var LANE_MIN_DIMENSIONS = { width: 300, height: 60 };\n\n/**\n * @type {Dimensions}\n */\nexport var VERTICAL_LANE_MIN_DIMENSIONS = { width: 60, height: 300 };\n\n/**\n * @type {Dimensions}\n */\nexport var PARTICIPANT_MIN_DIMENSIONS = { width: 300, height: 150 };\n\n/**\n * @type {Dimensions}\n */\nexport var VERTICAL_PARTICIPANT_MIN_DIMENSIONS = { width: 150, height: 300 };\n\n/**\n * @type {Dimensions}\n */\nexport var SUB_PROCESS_MIN_DIMENSIONS = { width: 140, height: 120 };\n\n/**\n * @type {Dimensions}\n */\nexport var TEXT_ANNOTATION_MIN_DIMENSIONS = { width: 50, height: 30 };\n\n/**\n * Set minimum bounds/resize constraints on resize.\n *\n * @param {EventBus} eventBus\n */\nexport default function ResizeBehavior(eventBus) {\n  eventBus.on('resize.start', HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        shape = context.shape,\n        direction = context.direction,\n        balanced = context.balanced;\n\n    if (is(shape, 'bpmn:Lane') || is(shape, 'bpmn:Participant')) {\n      context.resizeConstraints = getParticipantResizeConstraints(shape, direction, balanced);\n    }\n\n    if (is(shape, 'bpmn:SubProcess') && isExpanded(shape)) {\n      context.minDimensions = SUB_PROCESS_MIN_DIMENSIONS;\n    }\n\n    if (is(shape, 'bpmn:TextAnnotation')) {\n      context.minDimensions = TEXT_ANNOTATION_MIN_DIMENSIONS;\n    }\n  });\n}\n\nResizeBehavior.$inject = [ 'eventBus' ];\n\n\nvar abs = Math.abs,\n    min = Math.min,\n    max = Math.max;\n\n\nfunction addToTrbl(trbl, attr, value, choice) {\n  var current = trbl[attr];\n\n  // make sure to set the value if it does not exist\n  // or apply the correct value by comparing against\n  // choice(value, currentValue)\n  trbl[attr] = current === undefined ? value : choice(value, current);\n}\n\nfunction addMin(trbl, attr, value) {\n  return addToTrbl(trbl, attr, value, min);\n}\n\nfunction addMax(trbl, attr, value) {\n  return addToTrbl(trbl, attr, value, max);\n}\n\nvar LANE_PADDING = { top: 20, left: 50, right: 20, bottom: 20 },\n    VERTICAL_LANE_PADDING = { top: 50, left: 20, right: 20, bottom: 20 };\n\n/**\n * @param {Shape} laneShape\n * @param {Direction} resizeDirection\n * @param {boolean} [balanced=false]\n *\n * @return { {\n *   min: RectTRBL;\n *   max: RectTRBL;\n * } }\n */\nexport function getParticipantResizeConstraints(laneShape, resizeDirection, balanced) {\n  var lanesRoot = getLanesRoot(laneShape);\n\n  var isFirst = true,\n      isLast = true;\n\n  var allLanes = collectLanes(lanesRoot, [ lanesRoot ]);\n\n  var laneTrbl = asTRBL(laneShape);\n\n  var maxTrbl = {},\n      minTrbl = {};\n\n  var isHorizontalLane = isHorizontal(laneShape);\n\n  var minDimensions = isHorizontalLane ? LANE_MIN_DIMENSIONS : VERTICAL_LANE_MIN_DIMENSIONS;\n\n  if (/n/.test(resizeDirection)) {\n    minTrbl.top = laneTrbl.bottom - minDimensions.height;\n  } else if (/e/.test(resizeDirection)) {\n    minTrbl.right = laneTrbl.left + minDimensions.width;\n  } else if (/s/.test(resizeDirection)) {\n    minTrbl.bottom = laneTrbl.top + minDimensions.height;\n  } else if (/w/.test(resizeDirection)) {\n    minTrbl.left = laneTrbl.right - minDimensions.width;\n  }\n\n  // min/max size based on related lanes\n  allLanes.forEach(function(other) {\n\n    var otherTrbl = asTRBL(other);\n\n    // lane flags\n    if (isHorizontalLane) {\n      if (otherTrbl.top < (laneTrbl.top - 10)) {\n        isFirst = false;\n      }\n      if (otherTrbl.bottom > (laneTrbl.bottom + 10)) {\n        isLast = false;\n      }\n    }\n    else {\n      if (otherTrbl.left < (laneTrbl.left - 10)) {\n        isFirst = false;\n      }\n      if (otherTrbl.right > (laneTrbl.right + 10)) {\n        isLast = false;\n      }\n    }\n\n    if (/n/.test(resizeDirection)) {\n\n      // max top size (based on next element)\n      if (balanced && abs(laneTrbl.top - otherTrbl.bottom) < 10) {\n        addMax(maxTrbl, 'top', otherTrbl.top + minDimensions.height);\n      }\n\n      // min top size (based on self or nested element)\n      if (abs(laneTrbl.top - otherTrbl.top) < 5) {\n        addMin(minTrbl, 'top', otherTrbl.bottom - minDimensions.height);\n      }\n    }\n\n    if (/e/.test(resizeDirection)) {\n\n      // max right size (based on previous element)\n      if (balanced && abs(laneTrbl.right - otherTrbl.left) < 10) {\n        addMin(maxTrbl, 'right', otherTrbl.right - minDimensions.width);\n      }\n\n      // min right size (based on self or nested element)\n      if (abs(laneTrbl.right - otherTrbl.right) < 5) {\n        addMax(minTrbl, 'right', otherTrbl.left + minDimensions.width);\n      }\n    }\n\n    if (/s/.test(resizeDirection)) {\n\n      // max bottom size (based on previous element)\n      if (balanced && abs(laneTrbl.bottom - otherTrbl.top) < 10) {\n        addMin(maxTrbl, 'bottom', otherTrbl.bottom - minDimensions.height);\n      }\n\n      // min bottom size (based on self or nested element)\n      if (abs(laneTrbl.bottom - otherTrbl.bottom) < 5) {\n        addMax(minTrbl, 'bottom', otherTrbl.top + minDimensions.height);\n      }\n    }\n\n    if (/w/.test(resizeDirection)) {\n\n      // max left size (based on next element)\n      if (balanced && abs(laneTrbl.left - otherTrbl.right) < 10) {\n        addMax(maxTrbl, 'left', otherTrbl.left + minDimensions.width);\n      }\n\n      // min left size (based on self or nested element)\n      if (abs(laneTrbl.left - otherTrbl.left) < 5) {\n        addMin(minTrbl, 'left', otherTrbl.right - minDimensions.width);\n      }\n    }\n  });\n\n  // max top/bottom/left/right size based on flow nodes\n  var flowElements = lanesRoot.children.filter(function(s) {\n    return !s.hidden && !s.waypoints && (is(s, 'bpmn:FlowElement') || is(s, 'bpmn:Artifact'));\n  });\n\n  var padding = isHorizontalLane ? LANE_PADDING : VERTICAL_LANE_PADDING;\n\n  flowElements.forEach(function(flowElement) {\n\n    var flowElementTrbl = asTRBL(flowElement);\n\n    // vertical lane will resize from top with respect to flow element irrespective of first or last lane\n    if (/n/.test(resizeDirection) && (!isHorizontalLane || isFirst)) {\n      addMin(minTrbl, 'top', flowElementTrbl.top - padding.top);\n    }\n\n    // horizonal lane will resize from right with respect to flow element irrespective of first or last lane\n    if (/e/.test(resizeDirection) && (isHorizontalLane || isLast)) {\n      addMax(minTrbl, 'right', flowElementTrbl.right + padding.right);\n    }\n\n    // vertical lane will resize from bottom with respect to flow element irrespective of first or last lane\n    if (/s/.test(resizeDirection) && (!isHorizontalLane || isLast)) {\n      addMax(minTrbl, 'bottom', flowElementTrbl.bottom + padding.bottom);\n    }\n\n    // horizonal lane will resize from left with respect to flow element irrespective of first or last lane\n    if (/w/.test(resizeDirection) && (isHorizontalLane || isFirst)) {\n      addMin(minTrbl, 'left', flowElementTrbl.left - padding.left);\n    }\n  });\n  return {\n    min: minTrbl,\n    max: maxTrbl\n  };\n}","import { is } from '../../../util/ModelUtil';\n\nimport {\n  roundBounds\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  hasPrimaryModifier\n} from 'diagram-js/lib/util/Mouse';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\nvar SLIGHTLY_HIGHER_PRIORITY = 1001;\n\n\n/**\n * Invoke {@link Modeling#resizeLane} instead of {@link Modeling#resizeShape}\n * when resizing a lane or participant shape.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function ResizeLaneBehavior(eventBus, modeling) {\n\n  eventBus.on('resize.start', SLIGHTLY_HIGHER_PRIORITY + 500, function(event) {\n    var context = event.context,\n        shape = context.shape;\n\n    if (is(shape, 'bpmn:Lane') || is(shape, 'bpmn:Participant')) {\n\n      // should we resize the opposite lane(s) in\n      // order to compensate for the resize operation?\n      context.balanced = !hasPrimaryModifier(event);\n    }\n  });\n\n  /**\n   * Intercept resize end and call resize lane function instead.\n   */\n  eventBus.on('resize.end', SLIGHTLY_HIGHER_PRIORITY, function(event) {\n    var context = event.context,\n        shape = context.shape,\n        canExecute = context.canExecute,\n        newBounds = context.newBounds;\n\n    if (is(shape, 'bpmn:Lane') || is(shape, 'bpmn:Participant')) {\n\n      if (canExecute) {\n\n        // ensure we have actual pixel values for new bounds\n        // (important when zoom level was > 1 during move)\n        newBounds = roundBounds(newBounds);\n\n        // perform the actual resize\n        modeling.resizeLane(shape, newBounds, context.balanced);\n      }\n\n      // stop propagation\n      return false;\n    }\n  });\n}\n\nResizeLaneBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n","import inherits from 'inherits-browser';\r\n\r\nimport {\r\n  find,\r\n  isArray,\r\n  matchPattern,\r\n  some\r\n} from 'min-dash';\r\n\r\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\r\n\r\nimport {\r\n  add as collectionAdd,\r\n  remove as collectionRemove\r\n} from 'diagram-js/lib/util/Collections';\r\n\r\nimport {\r\n  getBusinessObject,\r\n  is\r\n} from '../../../util/ModelUtil';\r\n\r\nimport { isAny } from '../util/ModelingUtil';\r\n\r\nimport { hasEventDefinition } from '../../../util/DiUtil';\r\n\r\n/**\r\n * @typedef {import('../../../Modeler').default} Modeler\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('didi').Injector} Injector\r\n * @typedef {import('../../copy-paste/ModdleCopy').default} ModdleCopy\r\n * @typedef {import('../BpmnFactory').default} BpmnFactory\r\n *\r\n * @typedef {import('../../../model/Types').Element} Element\r\n * @typedef {import('../../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('diagram-js/lib/util/Types').DirectionTRBL} DirectionTRBL\r\n */\r\n\r\nvar LOW_PRIORITY = 500;\r\n\r\n\r\n/**\r\n * Add referenced root elements (error, escalation, message, signal) if they don't exist.\r\n * Copy referenced root elements on copy & paste.\r\n *\r\n * @param {Modeler} bpmnjs\r\n * @param {EventBus} eventBus\r\n * @param {Injector} injector\r\n * @param {ModdleCopy} moddleCopy\r\n * @param {BpmnFactory} bpmnFactory\r\n */\r\nexport default function RootElementReferenceBehavior(\r\n    bpmnjs, eventBus, injector, moddleCopy, bpmnFactory\r\n) {\r\n  injector.invoke(CommandInterceptor, this);\r\n\r\n  function canHaveRootElementReference(element) {\r\n    return isAny(element, [ 'bpmn:ReceiveTask', 'bpmn:SendTask' ]) ||\r\n      hasAnyEventDefinition(element, [\r\n        'bpmn:ErrorEventDefinition',\r\n        'bpmn:EscalationEventDefinition',\r\n        'bpmn:MessageEventDefinition',\r\n        'bpmn:SignalEventDefinition'\r\n      ]);\r\n  }\r\n\r\n  function hasRootElement(rootElement) {\r\n    var definitions = bpmnjs.getDefinitions(),\r\n        rootElements = definitions.get('rootElements');\r\n\r\n    return !!find(rootElements, matchPattern({ id: rootElement.id }));\r\n  }\r\n\r\n  function getRootElementReferencePropertyName(eventDefinition) {\r\n    if (is(eventDefinition, 'bpmn:ErrorEventDefinition')) {\r\n      return 'errorRef';\r\n    } else if (is(eventDefinition, 'bpmn:EscalationEventDefinition')) {\r\n      return 'escalationRef';\r\n    } else if (is(eventDefinition, 'bpmn:MessageEventDefinition')) {\r\n      return 'messageRef';\r\n    } else if (is(eventDefinition, 'bpmn:SignalEventDefinition')) {\r\n      return 'signalRef';\r\n    }\r\n  }\r\n\r\n  function getRootElement(businessObject) {\r\n    if (isAny(businessObject, [ 'bpmn:ReceiveTask', 'bpmn:SendTask' ])) {\r\n      return businessObject.get('messageRef');\r\n    }\r\n\r\n    var eventDefinitions = businessObject.get('eventDefinitions'),\r\n        eventDefinition = eventDefinitions[ 0 ];\r\n\r\n    return eventDefinition.get(getRootElementReferencePropertyName(eventDefinition));\r\n  }\r\n\r\n  function setRootElement(businessObject, rootElement) {\r\n    if (isAny(businessObject, [ 'bpmn:ReceiveTask', 'bpmn:SendTask' ])) {\r\n      return businessObject.set('messageRef', rootElement);\r\n    }\r\n\r\n    var eventDefinitions = businessObject.get('eventDefinitions'),\r\n        eventDefinition = eventDefinitions[ 0 ];\r\n\r\n    return eventDefinition.set(getRootElementReferencePropertyName(eventDefinition), rootElement);\r\n  }\r\n\r\n  // create shape\r\n  this.executed([\r\n    'shape.create',\r\n    'element.updateProperties',\r\n    'element.updateModdleProperties'\r\n  ], function(context) {\r\n    var shape = context.shape || context.element;\r\n\r\n    if (!canHaveRootElementReference(shape)) {\r\n      return;\r\n    }\r\n\r\n    var businessObject = getBusinessObject(shape),\r\n        rootElement = getRootElement(businessObject),\r\n        rootElements;\r\n\r\n    if (rootElement && !hasRootElement(rootElement)) {\r\n      rootElements = bpmnjs.getDefinitions().get('rootElements');\r\n\r\n      // add root element\r\n      collectionAdd(rootElements, rootElement);\r\n\r\n      context.addedRootElement = rootElement;\r\n    }\r\n  }, true);\r\n\r\n  this.reverted([\r\n    'shape.create',\r\n    'element.updateProperties',\r\n    'element.updateModdleProperties'\r\n  ], function(context) {\r\n    var addedRootElement = context.addedRootElement;\r\n\r\n    if (!addedRootElement) {\r\n      return;\r\n    }\r\n\r\n    var rootElements = bpmnjs.getDefinitions().get('rootElements');\r\n\r\n    // remove root element\r\n    collectionRemove(rootElements, addedRootElement);\r\n  }, true);\r\n\r\n  eventBus.on('copyPaste.copyElement', function(context) {\r\n    var descriptor = context.descriptor,\r\n        element = context.element;\r\n\r\n    if (element.labelTarget || !canHaveRootElementReference(element)) {\r\n      return;\r\n    }\r\n\r\n    var businessObject = getBusinessObject(element),\r\n        rootElement = getRootElement(businessObject);\r\n\r\n    if (rootElement) {\r\n\r\n      // TODO(nikku): clone on copy\r\n      descriptor.referencedRootElement = rootElement;\r\n    }\r\n  });\r\n\r\n  eventBus.on('copyPaste.pasteElement', LOW_PRIORITY, function(context) {\r\n    var descriptor = context.descriptor,\r\n        businessObject = descriptor.businessObject,\r\n        referencedRootElement = descriptor.referencedRootElement;\r\n\r\n    if (!referencedRootElement) {\r\n      return;\r\n    }\r\n\r\n    if (!hasRootElement(referencedRootElement)) {\r\n      referencedRootElement = moddleCopy.copyElement(\r\n        referencedRootElement,\r\n        bpmnFactory.create(referencedRootElement.$type)\r\n      );\r\n    }\r\n\r\n    setRootElement(businessObject, referencedRootElement);\r\n\r\n    delete descriptor.referencedRootElement;\r\n  });\r\n}\r\n\r\nRootElementReferenceBehavior.$inject = [\r\n  'bpmnjs',\r\n  'eventBus',\r\n  'injector',\r\n  'moddleCopy',\r\n  'bpmnFactory'\r\n];\r\n\r\ninherits(RootElementReferenceBehavior, CommandInterceptor);\r\n\r\n// helpers //////////\r\n\r\nfunction hasAnyEventDefinition(element, types) {\r\n  if (!isArray(types)) {\r\n    types = [ types ];\r\n  }\r\n\r\n  return some(types, function(type) {\r\n    return hasEventDefinition(element, type);\r\n  });\r\n}","import { forEach } from 'min-dash';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport {\n  isExpanded,\n  isHorizontal\n} from '../../../util/DiUtil';\n\nimport {\n  GROUP_MIN_DIMENSIONS,\n  LANE_MIN_DIMENSIONS,\n  VERTICAL_LANE_MIN_DIMENSIONS,\n  PARTICIPANT_MIN_DIMENSIONS,\n  VERTICAL_PARTICIPANT_MIN_DIMENSIONS,\n  SUB_PROCESS_MIN_DIMENSIONS,\n  TEXT_ANNOTATION_MIN_DIMENSIONS\n} from './ResizeBehavior';\n\nimport { getChildLanes } from '../util/LaneUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n *\n * @typedef {import('../../../model/Types').Shape} Shape\n */\n\nvar max = Math.max;\n\n/**\n * @param {EventBus} eventBus\n */\nexport default function SpaceToolBehavior(eventBus) {\n  eventBus.on('spaceTool.getMinDimensions', function(context) {\n    var shapes = context.shapes,\n        axis = context.axis,\n        start = context.start,\n        minDimensions = {};\n\n    forEach(shapes, function(shape) {\n      var id = shape.id;\n\n      if (is(shape, 'bpmn:Participant')) {\n        minDimensions[ id ] = getParticipantMinDimensions(shape, axis, start);\n      }\n\n      if (is(shape, 'bpmn:Lane')) {\n        minDimensions[ id ] = isHorizontal(shape) ? LANE_MIN_DIMENSIONS : VERTICAL_LANE_MIN_DIMENSIONS;\n      }\n\n      if (is(shape, 'bpmn:SubProcess') && isExpanded(shape)) {\n        minDimensions[ id ] = SUB_PROCESS_MIN_DIMENSIONS;\n      }\n\n      if (is(shape, 'bpmn:TextAnnotation')) {\n        minDimensions[ id ] = TEXT_ANNOTATION_MIN_DIMENSIONS;\n      }\n\n      if (is(shape, 'bpmn:Group')) {\n        minDimensions[ id ] = GROUP_MIN_DIMENSIONS;\n      }\n    });\n\n    return minDimensions;\n  });\n}\n\nSpaceToolBehavior.$inject = [ 'eventBus' ];\n\n\n// helpers //////////\nfunction isHorizontalAxis(axis) {\n  return axis === 'x';\n}\n\n/**\n * Get minimum dimensions for participant taking lanes into account.\n *\n * @param {Shape} participant\n * @param {Axis} axis\n * @param {number} start\n *\n * @return {number}\n */\nfunction getParticipantMinDimensions(participant, axis, start) {\n  var isHorizontalLane = isHorizontal(participant);\n\n  if (!hasChildLanes(participant)) {\n    return isHorizontalLane ? PARTICIPANT_MIN_DIMENSIONS : VERTICAL_PARTICIPANT_MIN_DIMENSIONS;\n  }\n\n  var isHorizontalResize = isHorizontalAxis(axis);\n  var minDimensions = {};\n\n  if (isHorizontalResize) {\n    if (isHorizontalLane) {\n      minDimensions = PARTICIPANT_MIN_DIMENSIONS;\n    } else {\n      minDimensions = {\n        width: getParticipantMinWidth(participant, start, isHorizontalResize),\n        height: VERTICAL_PARTICIPANT_MIN_DIMENSIONS.height\n      };\n    }\n\n  } else {\n    if (isHorizontalLane) {\n      minDimensions = {\n        width: PARTICIPANT_MIN_DIMENSIONS.width,\n        height: getParticipantMinHeight(participant, start, isHorizontalResize)\n      };\n    } else {\n      minDimensions = VERTICAL_PARTICIPANT_MIN_DIMENSIONS;\n    }\n  }\n\n  return minDimensions;\n}\n\n/**\n * Get minimum height for participant taking lanes into account.\n *\n * @param {Shape} participant\n * @param {number} start\n * @param {boolean} isHorizontalResize\n *\n * @return {number}\n */\nfunction getParticipantMinHeight(participant, start, isHorizontalResize) {\n  var lanesMinHeight;\n  lanesMinHeight = getLanesMinHeight(participant, start, isHorizontalResize);\n  return max(PARTICIPANT_MIN_DIMENSIONS.height, lanesMinHeight);\n}\n\n/**\n * Get minimum width for participant taking lanes into account.\n *\n * @param {Shape} participant\n * @param {number} start\n * @param {boolean} isHorizontalResize\n *\n * @return {number}\n */\nfunction getParticipantMinWidth(participant, start, isHorizontalResize) {\n  var lanesMinWidth;\n  lanesMinWidth = getLanesMinWidth(participant, start, isHorizontalResize);\n  return max(VERTICAL_PARTICIPANT_MIN_DIMENSIONS.width, lanesMinWidth);\n}\n\nfunction hasChildLanes(element) {\n  return !!getChildLanes(element).length;\n}\n\nfunction getLanesMinHeight(participant, resizeStart, isHorizontalResize) {\n  var lanes = getChildLanes(participant),\n      resizedLane;\n\n  // find the nested lane which is currently resized\n  resizedLane = findResizedLane(lanes, resizeStart, isHorizontalResize);\n\n  // resized lane cannot shrink below the minimum height\n  // but remaining lanes' dimensions are kept intact\n  return participant.height - resizedLane.height + LANE_MIN_DIMENSIONS.height;\n}\n\nfunction getLanesMinWidth(participant, resizeStart, isHorizontalResize) {\n  var lanes = getChildLanes(participant),\n      resizedLane;\n\n  // find the nested lane which is currently resized\n  resizedLane = findResizedLane(lanes, resizeStart, isHorizontalResize);\n\n  // resized lane cannot shrink below the minimum width\n  // but remaining lanes' dimensions are kept intact\n  return participant.width - resizedLane.width + VERTICAL_LANE_MIN_DIMENSIONS.width;\n}\n\n/**\n * Find nested lane which is currently resized.\n *\n * @param {Shape[]} lanes\n * @param {number} resizeStart\n * @param {boolean} isHorizontalResize\n *\n * @return {Shape}\n */\nfunction findResizedLane(lanes, resizeStart, isHorizontalResize) {\n  var i, lane, childLanes;\n\n  for (i = 0; i < lanes.length; i++) {\n    lane = lanes[i];\n\n    // resizing current lane or a lane nested\n    if (!isHorizontalResize && resizeStart >= lane.y && resizeStart <= lane.y + lane.height ||\n        isHorizontalResize && resizeStart >= lane.x && resizeStart <= lane.x + lane.width) {\n\n      childLanes = getChildLanes(lane);\n\n      // a nested lane is resized\n      if (childLanes.length) {\n        return findResizedLane(childLanes, resizeStart, isHorizontalResize);\n      }\n\n      // current lane is the resized one\n      return lane;\n    }\n  }\n}\n","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { find } from 'min-dash';\n\nimport { isExpanded } from '../../../util/DiUtil';\n\nimport { getBusinessObject, getDi, is } from '../../../util/ModelUtil';\n\nimport { getMid } from 'diagram-js/lib/layout/LayoutUtil';\n\nimport { getBBox } from 'diagram-js/lib/util/Elements';\n\nimport {\n  getPlaneIdFromShape,\n  getShapeIdFromPlane,\n  isPlane,\n  toPlaneId\n} from '../../../util/DrilldownUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('../ElementFactory').default} ElementFactory\n * @typedef {import('../BpmnFactory').default} BpmnFactory\n * @typedef {import('../../../Modeler').default} Modeler\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n *\n * @typedef {import('../../../model/Types').Element} Element\n * @typedef {import('../../../model/Types').Root} Root\n * @typedef {import('../../../model/Types').ModdleElement} ModdleElement\n */\n\nvar LOW_PRIORITY = 400;\nvar HIGH_PRIORITY = 600;\n\nvar DEFAULT_POSITION = {\n  x: 180,\n  y: 160\n};\n\n\n/**\n * Creates bpmndi:BPMNPlane elements and canvas planes when collapsed subprocesses are created.\n *\n * @param {Canvas} canvas\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {ElementFactory} elementFactory\n * @param {BpmnFactory} bpmnFactory\n * @param {Modeler} bpmnjs\n * @param {ElementRegistry} elementRegistry\n */\nexport default function SubProcessPlaneBehavior(\n    canvas, eventBus, modeling,\n    elementFactory, bpmnFactory, bpmnjs, elementRegistry) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this._canvas = canvas;\n  this._eventBus = eventBus;\n  this._modeling = modeling;\n  this._elementFactory = elementFactory;\n  this._bpmnFactory = bpmnFactory;\n  this._bpmnjs = bpmnjs;\n  this._elementRegistry = elementRegistry;\n\n  var self = this;\n\n  function isCollapsedSubProcess(element) {\n    return is(element, 'bpmn:SubProcess') && !isExpanded(element);\n  }\n\n  function createRoot(context) {\n    var shape = context.shape,\n        rootElement = context.newRootElement;\n\n    var businessObject = getBusinessObject(shape);\n\n    rootElement = self._addDiagram(rootElement || businessObject);\n\n    context.newRootElement = canvas.addRootElement(rootElement);\n  }\n\n  function removeRoot(context) {\n    var shape = context.shape;\n\n    var businessObject = getBusinessObject(shape);\n    self._removeDiagram(businessObject);\n\n    var rootElement = context.newRootElement = elementRegistry.get(getPlaneIdFromShape(businessObject));\n\n    canvas.removeRootElement(rootElement);\n  }\n\n  // add plane elements for newly created sub-processes\n  // this ensures we can actually drill down into the element\n  this.executed('shape.create', function(context) {\n    var shape = context.shape;\n    if (!isCollapsedSubProcess(shape)) {\n      return;\n    }\n\n    createRoot(context);\n  }, true);\n\n\n  this.postExecuted('shape.create', function(context) {\n    var shape = context.shape,\n        rootElement = context.newRootElement;\n\n    if (!rootElement || !shape.children) {\n      return;\n    }\n\n    self._showRecursively(shape.children);\n\n    self._moveChildrenToShape(shape, rootElement);\n  }, true);\n\n\n  this.reverted('shape.create', function(context) {\n    var shape = context.shape;\n    if (!isCollapsedSubProcess(shape)) {\n      return;\n    }\n\n    removeRoot(context);\n  }, true);\n\n\n  this.preExecuted('shape.delete', function(context) {\n    var shape = context.shape;\n    if (!isCollapsedSubProcess(shape)) {\n      return;\n    }\n\n    var attachedRoot = elementRegistry.get(getPlaneIdFromShape(shape));\n\n    if (!attachedRoot) {\n      return;\n    }\n\n    modeling.removeElements(attachedRoot.children.slice());\n  }, true);\n\n\n  this.executed('shape.delete', function(context) {\n    var shape = context.shape;\n    if (!isCollapsedSubProcess(shape)) {\n      return;\n    }\n    removeRoot(context);\n  }, true);\n\n\n  this.reverted('shape.delete', function(context) {\n    var shape = context.shape;\n    if (!isCollapsedSubProcess(shape)) {\n      return;\n    }\n\n    createRoot(context);\n  }, true);\n\n\n  this.preExecuted('shape.replace', function(context) {\n    var oldShape = context.oldShape;\n    var newShape = context.newShape;\n\n    if (!isCollapsedSubProcess(oldShape) || !isCollapsedSubProcess(newShape)) {\n      return;\n    }\n\n    // old plane could have content,\n    // we remove it so it is not recursively deleted from 'shape.delete'\n    context.oldRoot = canvas.removeRootElement(getPlaneIdFromShape(oldShape));\n  }, true);\n\n\n  this.postExecuted('shape.replace', function(context) {\n    var newShape = context.newShape,\n        source = context.oldRoot,\n        target = canvas.findRoot(getPlaneIdFromShape(newShape));\n\n    if (!source || !target) {\n      return;\n    }\n    var elements = source.children;\n\n    modeling.moveElements(elements, { x: 0, y: 0 }, target);\n  }, true);\n\n\n  // rename primary elements when the secondary element changes\n  // this ensures rootElement.id = element.id + '_plane'\n  this.executed('element.updateProperties', function(context) {\n    var shape = context.element;\n\n    if (!is(shape, 'bpmn:SubProcess')) {\n      return;\n    }\n\n    var properties = context.properties;\n    var oldProperties = context.oldProperties;\n\n    var oldId = oldProperties.id,\n        newId = properties.id;\n\n    if (oldId === newId) {\n      return;\n    }\n\n    if (isPlane(shape)) {\n      elementRegistry.updateId(shape, toPlaneId(newId));\n      elementRegistry.updateId(oldId, newId);\n\n      return;\n    }\n\n    var planeElement = elementRegistry.get(toPlaneId(oldId));\n\n    if (!planeElement) {\n      return;\n    }\n\n    elementRegistry.updateId(toPlaneId(oldId), toPlaneId(newId));\n  }, true);\n\n\n  this.reverted('element.updateProperties', function(context) {\n    var shape = context.element;\n\n    if (!is(shape, 'bpmn:SubProcess')) {\n      return;\n    }\n\n    var properties = context.properties;\n    var oldProperties = context.oldProperties;\n\n    var oldId = oldProperties.id,\n        newId = properties.id;\n\n    if (oldId === newId) {\n      return;\n    }\n\n    if (isPlane(shape)) {\n      elementRegistry.updateId(shape, toPlaneId(oldId));\n      elementRegistry.updateId(newId, oldId);\n\n      return;\n    }\n\n    var planeElement = elementRegistry.get(toPlaneId(newId));\n\n    if (!planeElement) {\n      return;\n    }\n\n    elementRegistry.updateId(planeElement, toPlaneId(oldId));\n  }, true);\n\n  // re-throw element.changed to re-render primary shape if associated plane has\n  // changed (e.g. bpmn:name property has changed)\n  eventBus.on('element.changed', function(context) {\n    var element = context.element;\n\n    if (!isPlane(element)) {\n      return;\n    }\n\n    var plane = element;\n\n    var primaryShape = elementRegistry.get(getShapeIdFromPlane(plane));\n\n    // do not re-throw if no associated primary shape (e.g. bpmn:Process)\n    if (!primaryShape || primaryShape === plane) {\n      return;\n    }\n\n    eventBus.fire('element.changed', { element: primaryShape });\n  });\n\n\n  // create/remove plane for the subprocess\n  this.executed('shape.toggleCollapse', LOW_PRIORITY, function(context) {\n    var shape = context.shape;\n\n    if (!is(shape, 'bpmn:SubProcess')) {\n      return;\n    }\n\n    if (!isExpanded(shape)) {\n      createRoot(context);\n      self._showRecursively(shape.children);\n    } else {\n      removeRoot(context);\n    }\n\n  }, true);\n\n\n  // create/remove plane for the subprocess\n  this.reverted('shape.toggleCollapse', LOW_PRIORITY, function(context) {\n    var shape = context.shape;\n\n    if (!is(shape, 'bpmn:SubProcess')) {\n      return;\n    }\n\n    if (!isExpanded(shape)) {\n      createRoot(context);\n      self._showRecursively(shape.children);\n    } else {\n      removeRoot(context);\n    }\n\n  }, true);\n\n  // move elements between planes\n  this.postExecuted('shape.toggleCollapse', HIGH_PRIORITY, function(context) {\n    var shape = context.shape;\n\n    if (!is(shape, 'bpmn:SubProcess')) {\n      return;\n    }\n\n    var rootElement = context.newRootElement;\n\n    if (!rootElement) {\n      return;\n    }\n\n    if (!isExpanded(shape)) {\n\n      // collapsed\n      self._moveChildrenToShape(shape, rootElement);\n\n    } else {\n      self._moveChildrenToShape(rootElement, shape);\n    }\n  }, true);\n\n\n  // copy-paste ///////////\n\n  // add elements in plane to tree\n  eventBus.on('copyPaste.createTree', function(context) {\n    var element = context.element,\n        children = context.children;\n\n    if (!isCollapsedSubProcess(element)) {\n      return;\n    }\n\n    var id = getPlaneIdFromShape(element);\n    var parent = elementRegistry.get(id);\n\n    if (parent) {\n\n      // do not copy invisible root element\n      children.push.apply(children, parent.children);\n    }\n  });\n\n  // set plane children as direct children of collapsed shape\n  eventBus.on('copyPaste.copyElement', function(context) {\n    var descriptor = context.descriptor,\n        element = context.element,\n        elements = context.elements;\n\n    var parent = element.parent;\n\n    var isPlane = is(getDi(parent), 'bpmndi:BPMNPlane');\n    if (!isPlane) {\n      return;\n    }\n\n    var parentId = getShapeIdFromPlane(parent);\n\n    var referencedShape = find(elements, function(element) {\n      return element.id === parentId;\n    });\n\n    if (!referencedShape) {\n      return;\n    }\n\n    descriptor.parent = referencedShape.id;\n  });\n\n  // hide children during pasting\n  eventBus.on('copyPaste.pasteElement', function(context) {\n    var descriptor = context.descriptor;\n\n    if (!descriptor.parent) {\n      return;\n    }\n\n    if (isCollapsedSubProcess(descriptor.parent) || descriptor.parent.hidden) {\n      descriptor.hidden = true;\n    }\n  });\n\n}\n\ninherits(SubProcessPlaneBehavior, CommandInterceptor);\n\n/**\n * Moves the child elements from source to target.\n *\n * If the target is a plane, the children are moved to the top left corner.\n * Otherwise, the center of the target is used.\n *\n * @param {Root} source\n * @param {Root} target\n */\nSubProcessPlaneBehavior.prototype._moveChildrenToShape = function(source, target) {\n  var modeling = this._modeling;\n\n  var children = source.children;\n  var offset;\n\n  if (!children) {\n    return;\n  }\n\n  // add external labels that weren't children of sub process\n  children = children.concat(children.reduce(function(labels, child) {\n    if (child.label && child.label.parent !== source) {\n      return labels.concat(child.label);\n    }\n\n    return labels;\n  }, []));\n\n  // only change plane if there are no visible children, but don't move them\n  var visibleChildren = children.filter(function(child) {\n    return !child.hidden;\n  });\n\n  if (!visibleChildren.length) {\n    modeling.moveElements(children, { x: 0, y: 0 }, target, { autoResize: false });\n    return;\n  }\n\n  var childrenBounds = getBBox(visibleChildren);\n\n  // target is a plane\n  if (!target.x) {\n    offset = {\n      x: DEFAULT_POSITION.x - childrenBounds.x,\n      y: DEFAULT_POSITION.y - childrenBounds.y\n    };\n  }\n\n  // source is a plane\n  else {\n\n    // move relative to the center of the shape\n    var targetMid = getMid(target);\n    var childrenMid = getMid(childrenBounds);\n\n    offset = {\n      x: targetMid.x - childrenMid.x,\n      y: targetMid.y - childrenMid.y\n    };\n  }\n\n  modeling.moveElements(children, offset, target, { autoResize: false });\n};\n\n/**\n * Sets `hidden` property on all children of the given shape.\n *\n * @param {Element[]} elements\n * @param {boolean} [hidden=false]\n *\n * @return {Element[]}\n */\nSubProcessPlaneBehavior.prototype._showRecursively = function(elements, hidden) {\n  var self = this;\n\n  var result = [];\n  elements.forEach(function(element) {\n    element.hidden = !!hidden;\n\n    result = result.concat(element);\n\n    if (element.children) {\n      result = result.concat(\n        self._showRecursively(element.children, element.collapsed || hidden)\n      );\n    }\n  });\n\n  return result;\n};\n\n/**\n * Adds a given root element to the BPMNDI diagrams.\n *\n * @param {Root|ModdleElement} planeElement\n *\n * @return {Root}\n */\nSubProcessPlaneBehavior.prototype._addDiagram = function(planeElement) {\n  var bpmnjs = this._bpmnjs;\n  var diagrams = bpmnjs.getDefinitions().diagrams;\n\n  if (!planeElement.businessObject) {\n    planeElement = this._createNewDiagram(planeElement);\n  }\n\n  diagrams.push(planeElement.di.$parent);\n\n  return planeElement;\n};\n\n\n/**\n * Creates a new plane element for the given sub process.\n *\n * @param {ModdleElement} bpmnElement\n *\n * @return {Root}\n */\nSubProcessPlaneBehavior.prototype._createNewDiagram = function(bpmnElement) {\n  var bpmnFactory = this._bpmnFactory,\n      elementFactory = this._elementFactory;\n\n  var diPlane = bpmnFactory.create('bpmndi:BPMNPlane', {\n    bpmnElement: bpmnElement\n  });\n\n  var diDiagram = bpmnFactory.create('bpmndi:BPMNDiagram', {\n    plane: diPlane\n  });\n\n  diPlane.$parent = diDiagram;\n\n  // add a virtual element (not being drawn),\n  // a copy cat of our BpmnImporter code\n  var planeElement = elementFactory.createRoot({\n    id: getPlaneIdFromShape(bpmnElement),\n    type: bpmnElement.$type,\n    di: diPlane,\n    businessObject: bpmnElement,\n    collapsed: true\n  });\n\n  return planeElement;\n};\n\n/**\n * Removes the diagram for a given root element.\n *\n * @param {Root} rootElement\n *\n * @return {ModdleElement}\n */\nSubProcessPlaneBehavior.prototype._removeDiagram = function(rootElement) {\n  var bpmnjs = this._bpmnjs;\n\n  var diagrams = bpmnjs.getDefinitions().diagrams;\n\n  var removedDiagram = find(diagrams, function(diagram) {\n    return diagram.plane.bpmnElement.id === rootElement.id;\n  });\n\n  diagrams.splice(diagrams.indexOf(removedDiagram), 1);\n\n  return removedDiagram;\n};\n\n\nSubProcessPlaneBehavior.$inject = [\n  'canvas',\n  'eventBus',\n  'modeling',\n  'elementFactory',\n  'bpmnFactory',\n  'bpmnjs',\n  'elementRegistry'\n];\n","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport { isExpanded } from '../../../util/DiUtil.js';\n\n/**\n * @typedef {import('didi').Injector} Injector\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * Add start event replacing element with expanded sub process.\n *\n * @param {Injector} injector\n * @param {Modeling} modeling\n */\nexport default function SubProcessStartEventBehavior(injector, modeling) {\n  injector.invoke(CommandInterceptor, this);\n\n  this.postExecuted('shape.replace', function(event) {\n    var oldShape = event.context.oldShape,\n        newShape = event.context.newShape;\n\n    if (\n      !is(newShape, 'bpmn:SubProcess') ||\n      is(newShape,'bpmn:AdHocSubProcess') ||\n      ! (is(oldShape, 'bpmn:Task') || is(oldShape, 'bpmn:CallActivity')) ||\n      !isExpanded(newShape)\n    ) {\n      return;\n    }\n\n    var position = getStartEventPosition(newShape);\n\n    modeling.createShape({ type: 'bpmn:StartEvent' }, position, newShape);\n  });\n}\n\nSubProcessStartEventBehavior.$inject = [\n  'injector',\n  'modeling'\n];\n\ninherits(SubProcessStartEventBehavior, CommandInterceptor);\n\n// helpers //////////\n\nfunction getStartEventPosition(shape) {\n  return {\n    x: shape.x + shape.width / 6,\n    y: shape.y + shape.height / 2\n  };\n}\n","import inherits from 'inherits-browser';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\nexport default function TextAnnotationBehavior(eventBus) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  // On Append, TextAnnotations will be created on the Root.\n  // The default for connections will create the connection in the parent of\n  // the source element, so we overwrite the parent here.\n  this.preExecute('connection.create', function(context) {\n    const { target } = context;\n\n    if (!is(target, 'bpmn:TextAnnotation')) {\n      return;\n    }\n\n    context.parent = target.parent;\n  }, true);\n\n  this.preExecute([ 'shape.create', 'shape.resize', 'elements.move' ], function(context) {\n    const shapes = context.shapes || [ context.shape ];\n\n    if (shapes.length === 1 && is(shapes[0], 'bpmn:TextAnnotation')) {\n      context.hints = context.hints || {};\n\n      context.hints.autoResize = false;\n    }\n  }, true);\n}\n\ninherits(TextAnnotationBehavior, CommandInterceptor);\n\nTextAnnotationBehavior.$inject = [\n  'eventBus'\n];","\nimport inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  forEach\n} from 'min-dash';\n\nimport { getMid } from 'diagram-js/lib/layout/LayoutUtil';\nimport { selfAndAllChildren } from 'diagram-js/lib/util/Elements';\n\nimport { isExpanded } from '../../../util/DiUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n *\n * @typedef {import('../../../model/Types').Element} Element\n * @typedef {import('../../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').DirectionTRBL} DirectionTRBL\n */\n\n/**\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function ToggleCollapseConnectionBehaviour(\n    eventBus, modeling\n) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this.postExecuted('shape.toggleCollapse', 1500, function(context) {\n\n    // var shape = context.shape;\n    var shape = context.shape;\n\n    // only change connections when collapsing\n    if (isExpanded(shape)) {\n      return;\n    }\n\n    var allChildren = selfAndAllChildren(shape);\n\n    allChildren.forEach(function(child) {\n\n      // Ensure that the connection array is not modified during iteration\n      var incomingConnections = child.incoming.slice(),\n          outgoingConnections = child.outgoing.slice();\n\n      forEach(incomingConnections, function(c) {\n        handleConnection(c, true);\n      });\n\n      forEach(outgoingConnections, function(c) {\n        handleConnection(c, false);\n      });\n    });\n\n\n    function handleConnection(c, incoming) {\n      if (allChildren.indexOf(c.source) !== -1 && allChildren.indexOf(c.target) !== -1) {\n        return;\n      }\n\n      if (incoming) {\n        modeling.reconnectEnd(c, shape, getMid(shape));\n      } else {\n        modeling.reconnectStart(c, shape, getMid(shape));\n      }\n\n    }\n\n  }, true);\n\n}\n\ninherits(ToggleCollapseConnectionBehaviour, CommandInterceptor);\n\nToggleCollapseConnectionBehaviour.$inject = [\n  'eventBus',\n  'modeling',\n];\n\n\n","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getDi,\n  is\n} from '../../../util/ModelUtil';\n\nimport {\n  computeChildrenBBox\n} from 'diagram-js/lib/features/resize/ResizeUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../ElementFactory').default} ElementFactory\n * @typedef {import('../Modeling').default} Modeling\n */\n\nvar LOW_PRIORITY = 500;\n\n/**\n * @param {EventBus} eventBus\n * @param {ElementFactory} elementFactory\n * @param {Modeling} modeling\n */\nexport default function ToggleElementCollapseBehaviour(\n    eventBus, elementFactory, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n\n  function hideEmptyLabels(children) {\n    if (children.length) {\n      children.forEach(function(child) {\n        if (child.type === 'label' && !child.businessObject.name) {\n          child.hidden = true;\n        }\n      });\n    }\n  }\n\n  function expandedBounds(shape, defaultSize) {\n    var children = shape.children,\n        newBounds = defaultSize,\n        visibleElements,\n        visibleBBox;\n\n    visibleElements = filterVisible(children).concat([ shape ]);\n\n    visibleBBox = computeChildrenBBox(visibleElements);\n\n    if (visibleBBox) {\n\n      // center to visibleBBox with max(defaultSize, childrenBounds)\n      newBounds.width = Math.max(visibleBBox.width, newBounds.width);\n      newBounds.height = Math.max(visibleBBox.height, newBounds.height);\n\n      newBounds.x = visibleBBox.x + (visibleBBox.width - newBounds.width) / 2;\n      newBounds.y = visibleBBox.y + (visibleBBox.height - newBounds.height) / 2;\n    } else {\n\n      // center to collapsed shape with defaultSize\n      newBounds.x = shape.x + (shape.width - newBounds.width) / 2;\n      newBounds.y = shape.y + (shape.height - newBounds.height) / 2;\n    }\n\n    return newBounds;\n  }\n\n  function collapsedBounds(shape, defaultSize) {\n\n    return {\n      x: shape.x + (shape.width - defaultSize.width) / 2,\n      y: shape.y + (shape.height - defaultSize.height) / 2,\n      width: defaultSize.width,\n      height: defaultSize.height\n    };\n  }\n\n  this.executed([ 'shape.toggleCollapse' ], LOW_PRIORITY, function(e) {\n\n    var context = e.context,\n        shape = context.shape;\n\n    if (!is(shape, 'bpmn:SubProcess')) {\n      return;\n    }\n\n    if (!shape.collapsed) {\n\n      // all children got made visible through djs, hide empty labels\n      hideEmptyLabels(shape.children);\n\n      // remove collapsed marker\n      getDi(shape).isExpanded = true;\n    } else {\n\n      // place collapsed marker\n      getDi(shape).isExpanded = false;\n    }\n  });\n\n  this.reverted([ 'shape.toggleCollapse' ], LOW_PRIORITY, function(e) {\n\n    var context = e.context;\n    var shape = context.shape;\n\n\n    // revert removing/placing collapsed marker\n    if (!shape.collapsed) {\n      getDi(shape).isExpanded = true;\n\n    } else {\n      getDi(shape).isExpanded = false;\n    }\n  });\n\n  this.postExecuted([ 'shape.toggleCollapse' ], LOW_PRIORITY, function(e) {\n    var shape = e.context.shape,\n        defaultSize = elementFactory.getDefaultSize(shape),\n        newBounds;\n\n    if (shape.collapsed) {\n\n      // resize to default size of collapsed shapes\n      newBounds = collapsedBounds(shape, defaultSize);\n    } else {\n\n      // resize to bounds of max(visible children, defaultSize)\n      newBounds = expandedBounds(shape, defaultSize);\n    }\n\n    modeling.resizeShape(shape, newBounds, null, {\n      autoResize: shape.collapsed ? false : 'nwse'\n    });\n  });\n\n}\n\n\ninherits(ToggleElementCollapseBehaviour, CommandInterceptor);\n\nToggleElementCollapseBehaviour.$inject = [\n  'eventBus',\n  'elementFactory',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\nfunction filterVisible(elements) {\n  return elements.filter(function(e) {\n    return !e.hidden;\n  });\n}","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\nimport { isExpanded } from '../../../util/DiUtil';\nimport { isLabel } from '../../../util/LabelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('didi').Injector} Injector\n * @typedef {import('../Modeling').default} Modeling\n *\n * @typedef {import('../../../model/Types').Moddle} Moddle\n */\n\n/**\n * Unclaims model IDs on element deletion.\n *\n * @param {Canvas} canvas\n * @param {Injector} injector\n * @param {Moddle} moddle\n * @param {Modeling} modeling\n */\nexport default function UnclaimIdBehavior(canvas, injector, moddle, modeling) {\n  injector.invoke(CommandInterceptor, this);\n\n  this.preExecute('shape.delete', function(event) {\n    var context = event.context,\n        shape = context.shape,\n        shapeBo = shape.businessObject;\n\n    if (isLabel(shape)) {\n      return;\n    }\n\n    if (is(shape, 'bpmn:Participant') && isExpanded(shape)) {\n      moddle.ids.unclaim(shapeBo.processRef.id);\n    }\n\n    modeling.unclaimId(shapeBo.id, shapeBo);\n  });\n\n\n  this.preExecute('connection.delete', function(event) {\n    var context = event.context,\n        connection = context.connection,\n        connectionBo = connection.businessObject;\n\n    modeling.unclaimId(connectionBo.id, connectionBo);\n  });\n\n  this.preExecute('canvas.updateRoot', function() {\n    var rootElement = canvas.getRootElement(),\n        rootElementBo = rootElement.businessObject;\n\n    if (is(rootElement, 'bpmn:Collaboration')) {\n      moddle.ids.unclaim(rootElementBo.id);\n    }\n  });\n}\n\ninherits(UnclaimIdBehavior, CommandInterceptor);\n\nUnclaimIdBehavior.$inject = [ 'canvas', 'injector', 'moddle', 'modeling' ];","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getBusinessObject,\n  is\n} from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * A behavior that unsets the Default property of sequence flow source on\n * element delete, if the removed element is the Gateway or Task's default flow.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function DeleteSequenceFlowBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n\n  this.preExecute('connection.delete', function(event) {\n    var context = event.context,\n        connection = context.connection,\n        source = connection.source;\n\n    if (isDefaultFlow(connection, source)) {\n      modeling.updateProperties(source, {\n        'default': null\n      });\n    }\n  });\n}\n\ninherits(DeleteSequenceFlowBehavior, CommandInterceptor);\n\nDeleteSequenceFlowBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\nfunction isDefaultFlow(connection, source) {\n\n  if (!is(connection, 'bpmn:SequenceFlow')) {\n    return false;\n  }\n\n  var sourceBo = getBusinessObject(source),\n      sequenceFlow = getBusinessObject(connection);\n\n  return sourceBo.get('default') === sequenceFlow;\n}","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  is\n} from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../Modeling').default} Modeling\n */\n\nvar LOW_PRIORITY = 500,\n    HIGH_PRIORITY = 5000;\n\n\n/**\n * BPMN specific delete lane behavior.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function UpdateFlowNodeRefsBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Update Lane#flowNodeRefs and FlowNode#lanes with every flow node\n   * move/resize and lane move/resize. Groups elements to recompute containments\n   * as efficient as possible.\n   */\n\n  // the update context\n  var context;\n\n\n  function initContext() {\n    context = context || new UpdateContext();\n    context.enter();\n\n    return context;\n  }\n\n  function getContext() {\n    if (!context) {\n      throw new Error('out of bounds release');\n    }\n\n    return context;\n  }\n\n  function releaseContext() {\n\n    if (!context) {\n      throw new Error('out of bounds release');\n    }\n\n    var triggerUpdate = context.leave();\n\n    if (triggerUpdate) {\n      modeling.updateLaneRefs(context.flowNodes, context.lanes);\n\n      context = null;\n    }\n\n    return triggerUpdate;\n  }\n\n\n  var laneRefUpdateEvents = [\n    'spaceTool',\n    'lane.add',\n    'lane.resize',\n    'lane.split',\n    'elements.create',\n    'elements.delete',\n    'elements.move',\n    'shape.create',\n    'shape.delete',\n    'shape.move',\n    'shape.resize'\n  ];\n\n\n  // listen to a lot of stuff to group lane updates\n\n  this.preExecute(laneRefUpdateEvents, HIGH_PRIORITY, function(event) {\n    initContext();\n  });\n\n  this.postExecuted(laneRefUpdateEvents, LOW_PRIORITY, function(event) {\n    releaseContext();\n  });\n\n\n  // Mark flow nodes + lanes that need an update\n\n  this.preExecute([\n    'shape.create',\n    'shape.move',\n    'shape.delete',\n    'shape.resize'\n  ], function(event) {\n\n    var context = event.context,\n        shape = context.shape;\n\n    var updateContext = getContext();\n\n    // no need to update labels\n    if (shape.labelTarget) {\n      return;\n    }\n\n    if (is(shape, 'bpmn:Lane')) {\n      updateContext.addLane(shape);\n    }\n\n    if (is(shape, 'bpmn:FlowNode')) {\n      updateContext.addFlowNode(shape);\n    }\n  });\n}\n\nUpdateFlowNodeRefsBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n\ninherits(UpdateFlowNodeRefsBehavior, CommandInterceptor);\n\n\nfunction UpdateContext() {\n\n  this.flowNodes = [];\n  this.lanes = [];\n\n  this.counter = 0;\n\n  this.addLane = function(lane) {\n    this.lanes.push(lane);\n  };\n\n  this.addFlowNode = function(flowNode) {\n    this.flowNodes.push(flowNode);\n  };\n\n  this.enter = function() {\n    this.counter++;\n  };\n\n  this.leave = function() {\n    this.counter--;\n\n    return !this.counter;\n  };\n}","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { getBusinessObject, is } from '../../../util/ModelUtil';\n\nimport { hasEventDefinition } from '../../../util/DiUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../rules/BpmnRules').default} BpmnRules\n * @typedef {import('../Modeling').default} Modeling\n */\n\n\n/**\n * A behavior that sets the property of Compensation Activity after paste operation\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function SetCompensationActivityAfterPasteBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this.postExecuted('elements.create', function(event) {\n    const context = event.context,\n          elements = context.elements;\n\n    // check if compensation activity is connected to compensation boundary event\n    for (const element of elements) {\n      if (isForCompensation(element) && !isConnectedToCompensationBoundaryEvent(element)) {\n        modeling.updateProperties(element, { isForCompensation: undefined });\n      }\n    }\n  });\n}\n\ninherits(SetCompensationActivityAfterPasteBehavior, CommandInterceptor);\n\nSetCompensationActivityAfterPasteBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\nfunction isForCompensation(element) {\n  const bo = getBusinessObject(element);\n  return bo && bo.isForCompensation;\n}\n\nfunction isCompensationBoundaryEvent(element) {\n  return element && is(element, 'bpmn:BoundaryEvent') &&\n      hasEventDefinition(element, 'bpmn:CompensateEventDefinition');\n}\n\nfunction isConnectedToCompensationBoundaryEvent(element) {\n  const compensationAssociations = element.incoming.filter(\n    connection => isCompensationBoundaryEvent(connection.source)\n  );\n  if (compensationAssociations.length > 0) {\n    return true;\n  }\n  return false;\n}","import AdaptiveLabelPositioningBehavior from './AdaptiveLabelPositioningBehavior';\nimport AppendBehavior from './AppendBehavior';\nimport AssociationBehavior from './AssociationBehavior';\nimport AttachEventBehavior from './AttachEventBehavior';\nimport BoundaryEventBehavior from './BoundaryEventBehavior';\nimport CompensateBoundaryEventBehavior from './CompensateBoundaryEventBehavior';\nimport CreateBehavior from './CreateBehavior';\nimport CreateDataObjectBehavior from './CreateDataObjectBehavior';\nimport CreateParticipantBehavior from './CreateParticipantBehavior';\nimport DataInputAssociationBehavior from './DataInputAssociationBehavior';\nimport DataStoreBehavior from './DataStoreBehavior';\nimport DeleteLaneBehavior from './DeleteLaneBehavior';\nimport DetachEventBehavior from './DetachEventBehavior';\nimport DropOnFlowBehavior from './DropOnFlowBehavior';\nimport EventBasedGatewayBehavior from './EventBasedGatewayBehavior';\nimport FixHoverBehavior from './FixHoverBehavior';\nimport GroupBehavior from './GroupBehavior';\nimport ImportDockingFix from './ImportDockingFix';\nimport IsHorizontalFix from './IsHorizontalFix';\nimport LabelBehavior from './LabelBehavior';\nimport LayoutConnectionBehavior from './LayoutConnectionBehavior';\nimport MessageFlowBehavior from './MessageFlowBehavior';\nimport NonInterruptingBehavior from './NonInterruptingBehavior';\nimport RemoveEmbeddedLabelBoundsBehavior from './RemoveEmbeddedLabelBoundsBehavior';\nimport RemoveElementBehavior from './RemoveElementBehavior';\nimport RemoveParticipantBehavior from './RemoveParticipantBehavior';\nimport ReplaceConnectionBehavior from './ReplaceConnectionBehavior';\nimport ReplaceElementBehaviour from './ReplaceElementBehaviour';\nimport ResizeBehavior from './ResizeBehavior';\nimport ResizeLaneBehavior from './ResizeLaneBehavior';\nimport RootElementReferenceBehavior from './RootElementReferenceBehavior';\nimport SpaceToolBehavior from './SpaceToolBehavior';\nimport SubProcessPlaneBehavior from './SubProcessPlaneBehavior';\nimport SubProcessStartEventBehavior from './SubProcessStartEventBehavior';\nimport TextAnnotationBehavior from './TextAnnotationBehavior';\nimport ToggleCollapseConnectionBehaviour from './ToggleCollapseConnectionBehaviour';\nimport ToggleElementCollapseBehaviour from './ToggleElementCollapseBehaviour';\nimport UnclaimIdBehavior from './UnclaimIdBehavior';\nimport UnsetDefaultFlowBehavior from './UnsetDefaultFlowBehavior';\nimport UpdateFlowNodeRefsBehavior from './UpdateFlowNodeRefsBehavior';\nimport SetCompensationActivityAfterPasteBehavior from './SetCompensationActivityAfterPasteBehavior';\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [\n    'adaptiveLabelPositioningBehavior',\n    'appendBehavior',\n    'associationBehavior',\n    'attachEventBehavior',\n    'boundaryEventBehavior',\n    'compensateBoundaryEventBehaviour',\n    'createBehavior',\n    'createDataObjectBehavior',\n    'createParticipantBehavior',\n    'dataInputAssociationBehavior',\n    'dataStoreBehavior',\n    'deleteLaneBehavior',\n    'detachEventBehavior',\n    'dropOnFlowBehavior',\n    'eventBasedGatewayBehavior',\n    'fixHoverBehavior',\n    'groupBehavior',\n    'importDockingFix',\n    'isHorizontalFix',\n    'labelBehavior',\n    'layoutConnectionBehavior',\n    'messageFlowBehavior',\n    'nonInterruptingBehavior',\n    'removeElementBehavior',\n    'removeEmbeddedLabelBoundsBehavior',\n    'removeParticipantBehavior',\n    'replaceConnectionBehavior',\n    'replaceElementBehaviour',\n    'resizeBehavior',\n    'resizeLaneBehavior',\n    'rootElementReferenceBehavior',\n    'spaceToolBehavior',\n    'subProcessPlaneBehavior',\n    'subProcessStartEventBehavior',\n    'textAnnotationBehavior',\n    'toggleCollapseConnectionBehaviour',\n    'toggleElementCollapseBehaviour',\n    'unclaimIdBehavior',\n    'updateFlowNodeRefsBehavior',\n    'unsetDefaultFlowBehavior',\n    'setCompensationActivityAfterPasteBehavior'\n  ],\n  adaptiveLabelPositioningBehavior: [ 'type', AdaptiveLabelPositioningBehavior ],\n  appendBehavior: [ 'type', AppendBehavior ],\n  associationBehavior: [ 'type', AssociationBehavior ],\n  attachEventBehavior: [ 'type', AttachEventBehavior ],\n  boundaryEventBehavior: [ 'type', BoundaryEventBehavior ],\n  compensateBoundaryEventBehaviour: [ 'type', CompensateBoundaryEventBehavior ],\n  createBehavior: [ 'type', CreateBehavior ],\n  createDataObjectBehavior: [ 'type', CreateDataObjectBehavior ],\n  createParticipantBehavior: [ 'type', CreateParticipantBehavior ],\n  dataInputAssociationBehavior: [ 'type', DataInputAssociationBehavior ],\n  dataStoreBehavior: [ 'type', DataStoreBehavior ],\n  deleteLaneBehavior: [ 'type', DeleteLaneBehavior ],\n  detachEventBehavior: [ 'type', DetachEventBehavior ],\n  dropOnFlowBehavior: [ 'type', DropOnFlowBehavior ],\n  eventBasedGatewayBehavior: [ 'type', EventBasedGatewayBehavior ],\n  fixHoverBehavior: [ 'type', FixHoverBehavior ],\n  groupBehavior: [ 'type', GroupBehavior ],\n  importDockingFix: [ 'type', ImportDockingFix ],\n  isHorizontalFix: [ 'type', IsHorizontalFix ],\n  labelBehavior: [ 'type', LabelBehavior ],\n  layoutConnectionBehavior: [ 'type', LayoutConnectionBehavior ],\n  messageFlowBehavior: [ 'type', MessageFlowBehavior ],\n  nonInterruptingBehavior: [ 'type', NonInterruptingBehavior ],\n  removeElementBehavior: [ 'type', RemoveElementBehavior ],\n  removeEmbeddedLabelBoundsBehavior: [ 'type', RemoveEmbeddedLabelBoundsBehavior ],\n  removeParticipantBehavior: [ 'type', RemoveParticipantBehavior ],\n  replaceConnectionBehavior: [ 'type', ReplaceConnectionBehavior ],\n  replaceElementBehaviour: [ 'type', ReplaceElementBehaviour ],\n  resizeBehavior: [ 'type', ResizeBehavior ],\n  resizeLaneBehavior: [ 'type', ResizeLaneBehavior ],\n  rootElementReferenceBehavior: [ 'type', RootElementReferenceBehavior ],\n  spaceToolBehavior: [ 'type', SpaceToolBehavior ],\n  subProcessPlaneBehavior: [ 'type', SubProcessPlaneBehavior ],\n  subProcessStartEventBehavior: [ 'type', SubProcessStartEventBehavior ],\n  textAnnotationBehavior: [ 'type', TextAnnotationBehavior ],\n  toggleCollapseConnectionBehaviour: [ 'type', ToggleCollapseConnectionBehaviour ],\n  toggleElementCollapseBehaviour : [ 'type', ToggleElementCollapseBehaviour ],\n  unclaimIdBehavior: [ 'type', UnclaimIdBehavior ],\n  unsetDefaultFlowBehavior: [ 'type', UnsetDefaultFlowBehavior ],\n  updateFlowNodeRefsBehavior: [ 'type', UpdateFlowNodeRefsBehavior ],\n  setCompensationActivityAfterPasteBehavior: [ 'type', SetCompensationActivityAfterPasteBehavior ]\n};\n","import { getOrientation } from 'diagram-js/lib/layout/LayoutUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/util/Types').DirectionTRBL} DirectionTRBL\r\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\r\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\r\n */\r\n\r\n/**\r\n * @param {Point} position\r\n * @param {Rect} targetBounds\r\n *\r\n * @return {DirectionTRBL|null}\r\n */\r\nexport function getBoundaryAttachment(position, targetBounds) {\r\n\r\n  var orientation = getOrientation(position, targetBounds, -15);\r\n\r\n  if (orientation !== 'intersect') {\r\n    return orientation;\r\n  } else {\r\n    return null;\r\n  }\r\n}","import {\n  every,\n  find,\n  forEach,\n  some\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nimport {\n  is,\n  getBusinessObject\n} from '../../util/ModelUtil';\n\nimport {\n  getParent,\n  isAny\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  isLabel\n} from '../../util/LabelUtil';\n\nimport {\n  isExpanded,\n  isEventSubProcess,\n  isInterrupting,\n  hasErrorEventDefinition,\n  hasEscalationEventDefinition,\n  hasCompensateEventDefinition\n} from '../../util/DiUtil';\n\nimport RuleProvider from 'diagram-js/lib/features/rules/RuleProvider';\n\nimport {\n  getBoundaryAttachment as isBoundaryAttachment\n} from '../snapping/BpmnSnappingUtil';\n\nimport { isConnection } from 'diagram-js/lib/util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n *\n * @typedef {import('../../model/Types').Connection} Connection\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n *\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n *\n * @typedef { {\n *   associationDirection?: 'None' | 'One' | 'Both';\n *   type: string;\n * } | boolean | null } CanConnectResult\n *\n * @typedef { {\n *   id: string;\n *   type: string;\n * } | boolean } CanReplaceResult\n */\n\n/**\n * BPMN-specific modeling rules.\n *\n * @param {EventBus} eventBus\n */\nexport default function BpmnRules(eventBus) {\n  RuleProvider.call(this, eventBus);\n}\n\ninherits(BpmnRules, RuleProvider);\n\nBpmnRules.$inject = [ 'eventBus' ];\n\nBpmnRules.prototype.init = function() {\n\n  this.addRule('connection.start', function(context) {\n    var source = context.source;\n\n    return canStartConnection(source);\n  });\n\n  this.addRule('connection.create', function(context) {\n    var source = context.source,\n        target = context.target,\n        hints = context.hints || {},\n        targetParent = hints.targetParent,\n        targetAttach = hints.targetAttach;\n\n    // don't allow incoming connections on\n    // newly created boundary events\n    // to boundary events\n    if (targetAttach) {\n      return false;\n    }\n\n    // temporarily set target parent for scoping\n    // checks to work\n    if (targetParent) {\n      target.parent = targetParent;\n    }\n\n    try {\n      return canConnect(source, target);\n    } finally {\n\n      // unset temporary target parent\n      if (targetParent) {\n        target.parent = null;\n      }\n    }\n  });\n\n  this.addRule('connection.reconnect', function(context) {\n\n    var connection = context.connection,\n        source = context.source,\n        target = context.target;\n\n    return canConnect(source, target, connection);\n  });\n\n  this.addRule('connection.updateWaypoints', function(context) {\n    return {\n      type: context.connection.type\n    };\n  });\n\n  this.addRule('shape.resize', function(context) {\n\n    var shape = context.shape,\n        newBounds = context.newBounds;\n\n    return canResize(shape, newBounds);\n  });\n\n  this.addRule('elements.create', function(context) {\n    var elements = context.elements,\n        position = context.position,\n        target = context.target;\n\n    if (isConnection(target) && !canInsert(elements, target, position)) {\n      return false;\n    }\n\n    return every(elements, function(element) {\n      if (isConnection(element)) {\n        return canConnect(element.source, element.target, element);\n      }\n\n      if (element.host) {\n        return canAttach(element, element.host, null, position);\n      }\n\n      return canCreate(element, target, null, position);\n    });\n  });\n\n  this.addRule('elements.move', function(context) {\n\n    var target = context.target,\n        shapes = context.shapes,\n        position = context.position,\n        hints = context.hints;\n\n    // prevent keyboard movement of boundary events without host\n    if (hints?.keyboardMove) {\n      const hasAttachedEventWithoutHost = shapes.some(function(shape) {\n        return isBoundaryEvent(shape) && !shapes.includes(shape.host);\n      });\n\n      if (hasAttachedEventWithoutHost) {\n        return false;\n      }\n    }\n\n    return canAttach(shapes, target, null, position) ||\n           canReplace(shapes, target, position) ||\n           canMove(shapes, target, position) ||\n           canInsert(shapes, target, position);\n  });\n\n  this.addRule('shape.create', function(context) {\n    return canCreate(\n      context.shape,\n      context.target,\n      context.source,\n      context.position\n    );\n  });\n\n  this.addRule('shape.attach', function(context) {\n\n    return canAttach(\n      context.shape,\n      context.target,\n      null,\n      context.position\n    );\n  });\n\n  this.addRule('element.copy', function(context) {\n    var element = context.element,\n        elements = context.elements;\n\n    return canCopy(elements, element);\n  });\n};\n\nBpmnRules.prototype.canConnectMessageFlow = canConnectMessageFlow;\n\nBpmnRules.prototype.canConnectSequenceFlow = canConnectSequenceFlow;\n\nBpmnRules.prototype.canConnectDataAssociation = canConnectDataAssociation;\n\nBpmnRules.prototype.canConnectAssociation = canConnectAssociation;\n\nBpmnRules.prototype.canConnectCompensationAssociation = canConnectCompensationAssociation;\n\nBpmnRules.prototype.canMove = canMove;\n\nBpmnRules.prototype.canAttach = canAttach;\n\nBpmnRules.prototype.canReplace = canReplace;\n\nBpmnRules.prototype.canDrop = canDrop;\n\nBpmnRules.prototype.canInsert = canInsert;\n\nBpmnRules.prototype.canCreate = canCreate;\n\nBpmnRules.prototype.canConnect = canConnect;\n\nBpmnRules.prototype.canResize = canResize;\n\nBpmnRules.prototype.canCopy = canCopy;\n\n/**\n * Utility functions for rule checking\n */\n\n/**\n * Checks if given element can be used for starting connection.\n *\n * @param  {Element} source\n *\n * @return {boolean}\n */\nfunction canStartConnection(element) {\n  if (nonExistingOrLabel(element)) {\n    return null;\n  }\n\n  return isAny(element, [\n    'bpmn:FlowNode',\n    'bpmn:InteractionNode',\n    'bpmn:DataObjectReference',\n    'bpmn:DataStoreReference',\n    'bpmn:Group',\n    'bpmn:TextAnnotation'\n  ]);\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction nonExistingOrLabel(element) {\n  return !element || isLabel(element);\n}\n\nfunction isSame(a, b) {\n  return a === b;\n}\n\n/**\n * @param {Element} element\n *\n * @return {ModdleElement}\n */\nfunction getOrganizationalParent(element) {\n\n  do {\n    if (is(element, 'bpmn:Process')) {\n      return getBusinessObject(element);\n    }\n\n    if (is(element, 'bpmn:Participant')) {\n      return (\n        getBusinessObject(element).processRef ||\n        getBusinessObject(element)\n      );\n    }\n  } while ((element = element.parent));\n\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isTextAnnotation(element) {\n  return is(element, 'bpmn:TextAnnotation');\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isGroup(element) {\n  return is(element, 'bpmn:Group') && !element.labelTarget;\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isCompensationBoundary(element) {\n  return is(element, 'bpmn:BoundaryEvent') &&\n         hasEventDefinition(element, 'bpmn:CompensateEventDefinition');\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isForCompensation(element) {\n  return getBusinessObject(element).isForCompensation;\n}\n\n/**\n * @param {Element} a\n * @param {Element} b\n *\n * @return {boolean}\n */\nfunction isSameOrganization(a, b) {\n  var parentA = getOrganizationalParent(a),\n      parentB = getOrganizationalParent(b);\n\n  return parentA === parentB;\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isMessageFlowSource(element) {\n  return (\n    is(element, 'bpmn:InteractionNode') &&\n    !is(element, 'bpmn:BoundaryEvent') && (\n      !is(element, 'bpmn:Event') || (\n        is(element, 'bpmn:ThrowEvent') &&\n        hasEventDefinitionOrNone(element, 'bpmn:MessageEventDefinition')\n      )\n    )\n  );\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isMessageFlowTarget(element) {\n  return (\n    is(element, 'bpmn:InteractionNode') &&\n    !isForCompensation(element) && (\n      !is(element, 'bpmn:Event') || (\n        is(element, 'bpmn:CatchEvent') &&\n        hasEventDefinitionOrNone(element, 'bpmn:MessageEventDefinition')\n      )\n    ) && !(\n      is(element, 'bpmn:BoundaryEvent') &&\n      !hasEventDefinition(element, 'bpmn:MessageEventDefinition')\n    )\n  );\n}\n\n/**\n * @param {Element} element\n *\n * @return {ModdleElement}\n */\nfunction getScopeParent(element) {\n\n  var parent = element;\n\n  while ((parent = parent.parent)) {\n\n    if (is(parent, 'bpmn:FlowElementsContainer')) {\n      return getBusinessObject(parent);\n    }\n\n    if (is(parent, 'bpmn:Participant')) {\n      return getBusinessObject(parent).processRef;\n    }\n  }\n\n  return null;\n}\n\n/**\n * @param {Element} a\n * @param {Element} b\n *\n * @return {boolean}\n */\nfunction isSameScope(a, b) {\n  var scopeParentA = getScopeParent(a),\n      scopeParentB = getScopeParent(b);\n\n  return scopeParentA === scopeParentB;\n}\n\n/**\n * @param {Element} element\n * @param {string} eventDefinition\n *\n * @return {boolean}\n */\nfunction hasEventDefinition(element, eventDefinition) {\n  var businessObject = getBusinessObject(element);\n\n  return !!find(businessObject.eventDefinitions || [], function(definition) {\n    return is(definition, eventDefinition);\n  });\n}\n\n/**\n * @param {Element} element\n * @param {string} eventDefinition\n *\n * @return {boolean}\n */\nfunction hasEventDefinitionOrNone(element, eventDefinition) {\n  var businessObject = getBusinessObject(element);\n\n  return (businessObject.eventDefinitions || []).every(function(definition) {\n    return is(definition, eventDefinition);\n  });\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isSequenceFlowSource(element) {\n  return (\n    is(element, 'bpmn:FlowNode') &&\n    !is(element, 'bpmn:EndEvent') &&\n    !isEventSubProcess(element) &&\n    !(is(element, 'bpmn:IntermediateThrowEvent') &&\n      hasEventDefinition(element, 'bpmn:LinkEventDefinition')\n    ) &&\n    !isCompensationBoundary(element) &&\n    !isForCompensation(element)\n  );\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isSequenceFlowTarget(element) {\n  return (\n    is(element, 'bpmn:FlowNode') &&\n    !is(element, 'bpmn:StartEvent') &&\n    !is(element, 'bpmn:BoundaryEvent') &&\n    !isEventSubProcess(element) &&\n    !(is(element, 'bpmn:IntermediateCatchEvent') &&\n      hasEventDefinition(element, 'bpmn:LinkEventDefinition')\n    ) &&\n    !isForCompensation(element)\n  );\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isEventBasedTarget(element) {\n  return (\n    is(element, 'bpmn:ReceiveTask') || (\n      is(element, 'bpmn:IntermediateCatchEvent') && (\n        hasEventDefinition(element, 'bpmn:MessageEventDefinition') ||\n        hasEventDefinition(element, 'bpmn:TimerEventDefinition') ||\n        hasEventDefinition(element, 'bpmn:ConditionalEventDefinition') ||\n        hasEventDefinition(element, 'bpmn:SignalEventDefinition')\n      )\n    )\n  );\n}\n\n/**\n * @param {Element} element\n *\n * @return {Shape[]}\n */\nfunction getParents(element) {\n\n  var parents = [];\n\n  while (element) {\n    element = element.parent;\n\n    if (element) {\n      parents.push(element);\n    }\n  }\n\n  return parents;\n}\n\n/**\n * @param {Shape} possibleParent\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isParent(possibleParent, element) {\n  var allParents = getParents(element);\n\n  return allParents.indexOf(possibleParent) !== -1;\n}\n\n/**\n * @param {Element} source\n * @param {Element} target\n * @param {Connection} connection\n *\n * @return {CanConnectResult}\n */\nfunction canConnect(source, target, connection) {\n\n  if (nonExistingOrLabel(source) || nonExistingOrLabel(target)) {\n    return null;\n  }\n\n  if (!is(connection, 'bpmn:DataAssociation')) {\n\n    if (canConnectMessageFlow(source, target)) {\n      return { type: 'bpmn:MessageFlow' };\n    }\n\n    if (canConnectSequenceFlow(source, target)) {\n      return { type: 'bpmn:SequenceFlow' };\n    }\n  }\n\n  var connectDataAssociation = canConnectDataAssociation(source, target);\n\n  if (connectDataAssociation) {\n    return connectDataAssociation;\n  }\n\n  if (canConnectCompensationAssociation(source, target)) {\n    return {\n      type: 'bpmn:Association',\n      associationDirection: 'One'\n    };\n  }\n\n  if (canConnectAssociation(source, target)) {\n    return {\n      type: 'bpmn:Association',\n      associationDirection: 'None'\n    };\n  }\n\n  return false;\n}\n\n/**\n * Can an element be dropped into the target element.\n *\n * @param {Element} element\n * @param {Shape} target\n *\n * @return {boolean}\n */\nfunction canDrop(element, target) {\n\n  // can move labels and groups everywhere\n  if (isLabel(element) || isGroup(element)) {\n    return true;\n  }\n\n\n  // disallow to create elements on collapsed pools\n  if (is(target, 'bpmn:Participant') && !isExpanded(target)) {\n    return false;\n  }\n\n  // allow to create new participants on\n  // existing collaboration and process diagrams\n  if (is(element, 'bpmn:Participant')) {\n    return is(target, 'bpmn:Process') || is(target, 'bpmn:Collaboration');\n  }\n\n  // allow moving DataInput / DataOutput within its original container only\n  if (isAny(element, [ 'bpmn:DataInput', 'bpmn:DataOutput' ])) {\n\n    if (element.parent) {\n      return target === element.parent;\n    }\n  }\n\n  // allow creating lanes on participants and other lanes only\n  if (is(element, 'bpmn:Lane')) {\n    return is(target, 'bpmn:Participant') || is(target, 'bpmn:Lane');\n  }\n\n  // disallow dropping boundary events which cannot replace with intermediate event\n  if (is(element, 'bpmn:BoundaryEvent') && !isDroppableBoundaryEvent(element)) {\n    return false;\n  }\n\n  // drop flow elements onto flow element containers\n  // and participants\n  if (is(element, 'bpmn:FlowElement') && !is(element, 'bpmn:DataStoreReference')) {\n    if (is(target, 'bpmn:FlowElementsContainer')) {\n      return isExpanded(target);\n    }\n\n    return isAny(target, [ 'bpmn:Participant', 'bpmn:Lane' ]);\n  }\n\n  // disallow dropping data store reference if there is no process to append to\n  if (is(element, 'bpmn:DataStoreReference') && is(target, 'bpmn:Collaboration')) {\n    return some(getBusinessObject(target).get('participants'), function(participant) {\n      return !!participant.get('processRef');\n    });\n  }\n\n  // account for the fact that data associations are always\n  // rendered and moved to top (Process or Collaboration level)\n  //\n  // artifacts may be placed wherever, too\n  if (isAny(element, [ 'bpmn:Artifact', 'bpmn:DataAssociation', 'bpmn:DataStoreReference' ])) {\n    return isAny(target, [\n      'bpmn:Collaboration',\n      'bpmn:Lane',\n      'bpmn:Participant',\n      'bpmn:Process',\n      'bpmn:SubProcess' ]);\n  }\n\n  if (is(element, 'bpmn:MessageFlow')) {\n    return is(target, 'bpmn:Collaboration')\n      || element.source.parent == target\n      || element.target.parent == target;\n  }\n\n  return false;\n}\n\n/**\n * @param {Shape} event\n *\n * @return {boolean}\n */\nfunction isDroppableBoundaryEvent(event) {\n  return getBusinessObject(event).cancelActivity && (\n    hasNoEventDefinition(event) || hasCommonBoundaryIntermediateEventDefinition(event)\n  );\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isBoundaryEvent(element) {\n  return !isLabel(element) && is(element, 'bpmn:BoundaryEvent');\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isLane(element) {\n  return is(element, 'bpmn:Lane');\n}\n\n/**\n * `bpmn:IntermediateThrowEvents` are treated as boundary events during create.\n *\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isBoundaryCandidate(element) {\n  if (isBoundaryEvent(element)) {\n    return true;\n  }\n\n  if (is(element, 'bpmn:IntermediateThrowEvent') && hasNoEventDefinition(element)) {\n    return true;\n  }\n\n  return (\n    is(element, 'bpmn:IntermediateCatchEvent') &&\n    hasCommonBoundaryIntermediateEventDefinition(element)\n  );\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction hasNoEventDefinition(element) {\n  var businessObject = getBusinessObject(element);\n\n  return businessObject && !(businessObject.eventDefinitions && businessObject.eventDefinitions.length);\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction hasCommonBoundaryIntermediateEventDefinition(element) {\n  return hasOneOfEventDefinitions(element, [\n    'bpmn:MessageEventDefinition',\n    'bpmn:TimerEventDefinition',\n    'bpmn:SignalEventDefinition',\n    'bpmn:ConditionalEventDefinition'\n  ]);\n}\n\n/**\n * @param {Element} element\n * @param {string[]} eventDefinitions\n *\n * @return {boolean}\n */\nfunction hasOneOfEventDefinitions(element, eventDefinitions) {\n  return eventDefinitions.some(function(definition) {\n    return hasEventDefinition(element, definition);\n  });\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isReceiveTaskAfterEventBasedGateway(element) {\n  return (\n    is(element, 'bpmn:ReceiveTask') &&\n    find(element.incoming, function(incoming) {\n      return is(incoming.source, 'bpmn:EventBasedGateway');\n    })\n  );\n}\n\n/**\n * TODO(philippfromme): remove `source` parameter\n *\n * @param {Element[]} elements\n * @param {Shape} target\n * @param {Element} source\n * @param {Point} [position]\n *\n * @return {boolean | 'attach'}\n */\nfunction canAttach(elements, target, source, position) {\n\n  if (!Array.isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  // only (re-)attach one element at a time\n  if (elements.length !== 1) {\n    return false;\n  }\n\n  var element = elements[0];\n\n  // do not attach labels\n  if (isLabel(element)) {\n    return false;\n  }\n\n  // only handle boundary events\n  if (!isBoundaryCandidate(element)) {\n    return false;\n  }\n\n  // disallow drop on event sub processes\n  if (isEventSubProcess(target)) {\n    return false;\n  }\n\n  // only allow drop on non compensation activities\n  if (!is(target, 'bpmn:Activity') || isForCompensation(target)) {\n    return false;\n  }\n\n  // only attach to subprocess border\n  if (position && !isBoundaryAttachment(position, target)) {\n    return false;\n  }\n\n  // do not attach on receive tasks after event based gateways\n  if (isReceiveTaskAfterEventBasedGateway(target)) {\n    return false;\n  }\n\n  return 'attach';\n}\n\n/**\n * Check whether the given elements can be replaced. Return all elements which\n * can be replaced.\n *\n * @example\n *\n * ```javascript\n * [{\n *   id: 'IntermediateEvent_1',\n *   type: 'bpmn:StartEvent'\n * },\n * {\n *   id: 'Task_1',\n *   type: 'bpmn:ServiceTask'\n * }]\n * ```\n *\n * @param  {Element[]} elements\n * @param  {Shape} [target]\n * @param  {Point} [position]\n *\n * @return {CanReplaceResult}\n */\nfunction canReplace(elements, target, position) {\n\n  if (!target) {\n    return false;\n  }\n\n  var canExecute = {\n    replacements: []\n  };\n\n  forEach(elements, function(element) {\n\n    if (!isEventSubProcess(target)) {\n\n      if (is(element, 'bpmn:StartEvent') &&\n          element.type !== 'label' &&\n          canDrop(element, target)) {\n\n        // replace a non-interrupting start event by a blank interrupting start event\n        // when the target is not an event sub process\n        if (!isInterrupting(element)) {\n          canExecute.replacements.push({\n            oldElementId: element.id,\n            newElementType: 'bpmn:StartEvent'\n          });\n        }\n\n        // replace an error/escalation/compensate start event by a blank interrupting start event\n        // when the target is not an event sub process\n        if (hasErrorEventDefinition(element) ||\n            hasEscalationEventDefinition(element) ||\n            hasCompensateEventDefinition(element)) {\n          canExecute.replacements.push({\n            oldElementId: element.id,\n            newElementType: 'bpmn:StartEvent'\n          });\n        }\n\n        // replace a typed start event by a blank interrupting start event\n        // when the target is a sub process but not an event sub process\n        if (hasOneOfEventDefinitions(element,\n          [\n            'bpmn:MessageEventDefinition',\n            'bpmn:TimerEventDefinition',\n            'bpmn:SignalEventDefinition',\n            'bpmn:ConditionalEventDefinition'\n          ]) &&\n            is(target, 'bpmn:SubProcess')) {\n          canExecute.replacements.push({\n            oldElementId: element.id,\n            newElementType: 'bpmn:StartEvent'\n          });\n        }\n      }\n    }\n\n    if (!is(target, 'bpmn:Transaction')) {\n      if (hasEventDefinition(element, 'bpmn:CancelEventDefinition') &&\n          element.type !== 'label') {\n\n        if (is(element, 'bpmn:EndEvent') && canDrop(element, target)) {\n          canExecute.replacements.push({\n            oldElementId: element.id,\n            newElementType: 'bpmn:EndEvent'\n          });\n        }\n\n        if (is(element, 'bpmn:BoundaryEvent') && canAttach(element, target, null, position)) {\n          canExecute.replacements.push({\n            oldElementId: element.id,\n            newElementType: 'bpmn:BoundaryEvent'\n          });\n        }\n      }\n    }\n  });\n\n  return canExecute.replacements.length ? canExecute : false;\n}\n\n/**\n * @param {Element[]} elements\n * @param {Shape} target\n *\n * @return {boolean}\n */\nfunction canMove(elements, target) {\n\n  // do not move selection containing lanes\n  if (some(elements, isLane)) {\n    return false;\n  }\n\n  // allow default move check to start move operation\n  if (!target) {\n    return true;\n  }\n\n  return elements.every(function(element) {\n    return canDrop(element, target);\n  });\n}\n\n/**\n * @param {Shape} shape\n * @param {Shape} target\n * @param {Element} source\n * @param {Point} position\n *\n * @return {boolean}\n */\nfunction canCreate(shape, target, source, position) {\n\n  if (!target) {\n    return false;\n  }\n\n  if (isLabel(shape) || isGroup(shape)) {\n    return true;\n  }\n\n  if (isSame(source, target)) {\n    return false;\n  }\n\n  // ensure we do not drop the element\n  // into source\n  if (source && isParent(source, target)) {\n    return false;\n  }\n\n  return canDrop(shape, target, position) || canInsert(shape, target, position);\n}\n\n/**\n * @param {Shape} shape\n * @param {Rect} newBounds\n *\n * @return {boolean}\n */\nfunction canResize(shape, newBounds) {\n  if (is(shape, 'bpmn:SubProcess')) {\n    return (\n      isExpanded(shape) && (\n        !newBounds || (newBounds.width >= 100 && newBounds.height >= 80)\n      )\n    );\n  }\n\n  if (is(shape, 'bpmn:Lane')) {\n    return true;\n  }\n\n  if (is(shape, 'bpmn:Participant')) {\n    return true;\n  }\n\n  if (isTextAnnotation(shape)) {\n    return true;\n  }\n\n  if (isGroup(shape)) {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Check whether one of of the elements to be connected is a text annotation.\n *\n * @param {Element} source\n * @param {Element} target\n *\n * @return {boolean}\n */\nfunction isOneTextAnnotation(source, target) {\n\n  var sourceTextAnnotation = isTextAnnotation(source),\n      targetTextAnnotation = isTextAnnotation(target);\n\n  return (\n    (sourceTextAnnotation || targetTextAnnotation) &&\n    (sourceTextAnnotation !== targetTextAnnotation)\n  );\n}\n\n/**\n * @param {Element} source\n * @param {Element} target\n *\n * @return {CanConnectResult}\n */\nfunction canConnectAssociation(source, target) {\n\n  // don't connect parent <-> child\n  if (isParent(target, source) || isParent(source, target)) {\n    return false;\n  }\n\n  // allow connection of associations between <!TextAnnotation> and <TextAnnotation>\n  if (isOneTextAnnotation(source, target)) {\n    return true;\n  }\n\n  // can connect associations where we can connect\n  // data associations, too (!)\n  return !!canConnectDataAssociation(source, target);\n}\n\n/**\n * @param {Element} source\n * @param {Element} target\n *\n * @return {boolean}\n */\nfunction canConnectCompensationAssociation(source, target) {\n  return (\n    isSameScope(source, target) &&\n    isCompensationBoundary(source) &&\n    is(target, 'bpmn:Activity') &&\n    !isHostOfElement(target, source) &&\n    !isEventSubProcess(target)\n  );\n}\n\n/**\n * @param {Element} source\n * @param {Element} target\n *\n * @return {boolean}\n */\nfunction canConnectMessageFlow(source, target) {\n\n  // during connect user might move mouse out of canvas\n  // https://github.com/bpmn-io/bpmn-js/issues/1033\n  if (getRootElement(source) && !getRootElement(target)) {\n    return false;\n  }\n\n  return (\n    isMessageFlowSource(source) &&\n    isMessageFlowTarget(target) &&\n    !isSameOrganization(source, target)\n  );\n}\n\n/**\n * @param {Element} source\n * @param {Element} target\n *\n * @return {boolean}\n */\nfunction canConnectSequenceFlow(source, target) {\n  return isSequenceFlowSource(source) &&\n         isSequenceFlowTarget(target) &&\n         isSameScope(source, target) &&\n         !(is(source, 'bpmn:EventBasedGateway') && !isEventBasedTarget(target));\n}\n\n/**\n * @param {Element} source\n * @param {Element} target\n *\n * @return {CanConnectResult}\n */\nfunction canConnectDataAssociation(source, target) {\n\n  if (isAny(source, [ 'bpmn:DataObjectReference', 'bpmn:DataStoreReference' ]) &&\n      isAny(target, [ 'bpmn:Activity', 'bpmn:ThrowEvent' ])) {\n    return { type: 'bpmn:DataInputAssociation' };\n  }\n\n  if (isAny(target, [ 'bpmn:DataObjectReference', 'bpmn:DataStoreReference' ]) &&\n      isAny(source, [ 'bpmn:Activity', 'bpmn:CatchEvent' ])) {\n    return { type: 'bpmn:DataOutputAssociation' };\n  }\n\n  return false;\n}\n\n/**\n * @param {Shape} shape\n * @param {Connection} connection\n * @param {Point} position\n *\n * @return {boolean}\n */\nfunction canInsert(shape, connection, position) {\n  if (!connection) {\n    return false;\n  }\n\n  if (Array.isArray(shape)) {\n    if (shape.length !== 1) {\n      return false;\n    }\n\n    shape = shape[ 0 ];\n  }\n\n  if (connection.source === shape ||\n      connection.target === shape) {\n    return false;\n  }\n\n  // return true if shape can be inserted into connection parent\n  return (\n    isAny(connection, [ 'bpmn:SequenceFlow', 'bpmn:MessageFlow' ]) &&\n    !isLabel(connection) &&\n    is(shape, 'bpmn:FlowNode') &&\n    !is(shape, 'bpmn:BoundaryEvent') &&\n    canDrop(shape, connection.parent, position));\n}\n\n/**\n * @param {Element[]} elements\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction includes(elements, element) {\n  return (elements && element) && elements.indexOf(element) !== -1;\n}\n\n/**\n * @param {Element[]} elements\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction canCopy(elements, element) {\n  if (isLabel(element)) {\n    return true;\n  }\n\n  if (is(element, 'bpmn:Lane') && !includes(elements, element.parent)) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * @param {Element} element\n *\n * @return {Element|null}\n */\nfunction getRootElement(element) {\n  return getParent(element, 'bpmn:Process') || getParent(element, 'bpmn:Collaboration');\n}\n\nfunction isHostOfElement(potentialHost, element) {\n  return potentialHost.attachers.includes(element);\n}\n","import RulesModule from 'diagram-js/lib/features/rules';\n\nimport BpmnRules from './BpmnRules';\n\nexport default {\n  __depends__: [\n    RulesModule\n  ],\n  __init__: [ 'bpmnRules' ],\n  bpmnRules: [ 'type', BpmnRules ]\n};\n","import { getDi } from '../../util/ModelUtil';\n\nimport {\n  filter,\n  forEach,\n  map\n} from 'min-dash';\n\nimport { selfAndAllChildren } from 'diagram-js/lib/util/Elements';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n */\n\nvar HIGH_PRIORITY = 2000;\n\n/**\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function BpmnDiOrdering(eventBus, canvas) {\n\n  eventBus.on('saveXML.start', HIGH_PRIORITY, orderDi);\n\n  function orderDi() {\n    var rootElements = canvas.getRootElements();\n\n    forEach(rootElements, function(root) {\n      var rootDi = getDi(root),\n          elements,\n          diElements;\n\n      elements = selfAndAllChildren([ root ], false);\n\n      // only bpmndi:Shape and bpmndi:Edge can be direct children of bpmndi:Plane\n      elements = filter(elements, function(element) {\n        return element !== root && !element.labelTarget;\n      });\n\n      diElements = map(elements, getDi);\n\n      rootDi.set('planeElement', diElements);\n    });\n  }\n}\n\nBpmnDiOrdering.$inject = [ 'eventBus', 'canvas' ];\n","import BpmnDiOrdering from '../di-ordering/BpmnDiOrdering';\n\nexport default {\n  __init__: [\n    'bpmnDiOrdering'\n  ],\n  bpmnDiOrdering: [ 'type', BpmnDiOrdering ]\n};","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from '../../command/CommandInterceptor';\n\n/**\n * @typedef {import('../../core/Types').ElementLike} Element\n * @typedef {import('../../core/Types').ShapeLike} Shape\n *\n * @typedef {import('../../core/EventBus').default} EventBus\n */\n\n/**\n * An abstract provider that allows modelers to implement a custom\n * ordering of diagram elements on the canvas.\n *\n * It makes sure that the order is always preserved during element\n * creation and move operations.\n *\n * In order to use this behavior, inherit from it and override\n * the method {@link OrderingProvider#getOrdering}.\n *\n * @example\n *\n * ```javascript\n * function CustomOrderingProvider(eventBus) {\n *   OrderingProvider.call(this, eventBus);\n *\n *   this.getOrdering = function(element, newParent) {\n *     // always insert elements at the front\n *     // when moving\n *     return {\n *       index: 0,\n *       parent: newParent\n *     };\n *   };\n * }\n * ```\n *\n * @param {EventBus} eventBus\n */\nexport default function OrderingProvider(eventBus) {\n\n  CommandInterceptor.call(this, eventBus);\n\n\n  var self = this;\n\n  this.preExecute([ 'shape.create', 'connection.create' ], function(event) {\n\n    var context = event.context,\n        element = context.shape || context.connection,\n        parent = context.parent;\n\n    var ordering = self.getOrdering(element, parent);\n\n    if (ordering) {\n\n      if (ordering.parent !== undefined) {\n        context.parent = ordering.parent;\n      }\n\n      context.parentIndex = ordering.index;\n    }\n  });\n\n  this.preExecute([ 'shape.move', 'connection.move' ], function(event) {\n\n    var context = event.context,\n        element = context.shape || context.connection,\n        parent = context.newParent || element.parent;\n\n    var ordering = self.getOrdering(element, parent);\n\n    if (ordering) {\n\n      if (ordering.parent !== undefined) {\n        context.newParent = ordering.parent;\n      }\n\n      context.newParentIndex = ordering.index;\n    }\n  });\n}\n\n/**\n * Return a custom ordering of the element, both in terms\n * of parent element and index in the new parent.\n *\n * Implementors of this method must return an object with\n * `parent` _and_ `index` in it.\n *\n * @param {Element} element\n * @param {Shape} newParent\n *\n * @return {Object} ordering descriptor\n */\nOrderingProvider.prototype.getOrdering = function(element, newParent) {\n  return null;\n};\n\ninherits(OrderingProvider, CommandInterceptor);","import inherits from 'inherits-browser';\n\nimport OrderingProvider from 'diagram-js/lib/features/ordering/OrderingProvider';\n\nimport {\n  is,\n  isAny\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  findIndex,\n  find\n} from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * A BPMN-specific ordering provider.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function BpmnOrderingProvider(eventBus, canvas) {\n\n  OrderingProvider.call(this, eventBus);\n\n  var orders = [\n    { type: 'bpmn:SubProcess', order: { level: 6 } },\n\n    // handle SequenceFlow(s) like message flows and render them always on top\n    {\n      type: 'bpmn:SequenceFlow',\n      order: {\n        level: 9,\n        containers: [\n          'bpmn:Participant',\n          'bpmn:FlowElementsContainer'\n        ]\n      }\n    },\n\n    // handle DataAssociation(s) like message flows and render them always on top\n    {\n      type: 'bpmn:DataAssociation',\n      order: {\n        level: 9,\n        containers: [\n          'bpmn:Collaboration',\n          'bpmn:FlowElementsContainer'\n        ]\n      }\n    },\n    {\n      type: 'bpmn:TextAnnotation',\n      order: {\n        level: 9\n      }\n    },\n    {\n      type: 'bpmn:MessageFlow', order: {\n        level: 9,\n        containers: [ 'bpmn:Collaboration' ]\n      }\n    },\n    {\n      type: 'bpmn:Association',\n      order: {\n        level: 6,\n        containers: [\n          'bpmn:Participant',\n          'bpmn:FlowElementsContainer',\n          'bpmn:Collaboration'\n        ]\n      }\n    },\n    { type: 'bpmn:BoundaryEvent', order: { level: 8 } },\n    {\n      type: 'bpmn:Group',\n      order: {\n        level: 10,\n        containers: [\n          'bpmn:Collaboration',\n          'bpmn:FlowElementsContainer'\n        ]\n      }\n    },\n    { type: 'bpmn:FlowElement', order: { level: 5 } },\n    { type: 'bpmn:Participant', order: { level: -2 } },\n    { type: 'bpmn:Lane', order: { level: -1 } }\n  ];\n\n  function computeOrder(element) {\n    if (element.labelTarget) {\n      return { level: 10 };\n    }\n\n    var entry = find(orders, function(o) {\n      return isAny(element, [ o.type ]);\n    });\n\n    return entry && entry.order || { level: 1 };\n  }\n\n  function getOrder(element) {\n\n    var order = element.order;\n\n    if (!order) {\n      element.order = order = computeOrder(element);\n    }\n\n    if (!order) {\n      throw new Error(`no order for <${ element.id }>`);\n    }\n\n    return order;\n  }\n\n  function findActualParent(element, newParent, containers) {\n\n    var actualParent = newParent;\n\n    while (actualParent) {\n\n      if (isAny(actualParent, containers)) {\n        break;\n      }\n\n      actualParent = actualParent.parent;\n    }\n\n    if (!actualParent) {\n      throw new Error(`no parent for <${ element.id }> in <${ newParent && newParent.id }>`);\n    }\n\n    return actualParent;\n  }\n\n  this.getOrdering = function(element, newParent) {\n\n    // render labels and text annotations always on top\n    if (element.labelTarget || is(element, 'bpmn:TextAnnotation')) {\n      return {\n        parent: canvas.findRoot(newParent) || canvas.getRootElement(),\n        index: -1\n      };\n    }\n\n    var elementOrder = getOrder(element);\n\n    if (elementOrder.containers) {\n      newParent = findActualParent(element, newParent, elementOrder.containers);\n    }\n\n    var currentIndex = newParent.children.indexOf(element);\n\n    var insertIndex = findIndex(newParent.children, function(child) {\n\n      // do not compare with labels, they are created\n      // in the wrong order (right after elements) during import and\n      // mess up the positioning.\n      if (!element.labelTarget && child.labelTarget) {\n        return false;\n      }\n\n      return elementOrder.level < getOrder(child).level;\n    });\n\n\n    // if the element is already in the child list at\n    // a smaller index, we need to adjust the insert index.\n    // this takes into account that the element is being removed\n    // before being re-inserted\n    if (insertIndex !== -1) {\n      if (currentIndex !== -1 && currentIndex < insertIndex) {\n        insertIndex -= 1;\n      }\n    }\n\n    return {\n      index: insertIndex,\n      parent: newParent\n    };\n  };\n}\n\nBpmnOrderingProvider.$inject = [ 'eventBus', 'canvas' ];\n\ninherits(BpmnOrderingProvider, OrderingProvider);","import BpmnOrderingProvider from './BpmnOrderingProvider';\n\nexport default {\n  __init__: [ 'bpmnOrderingProvider' ],\n  bpmnOrderingProvider: [ 'type', BpmnOrderingProvider ]\n};","import {\n  assign,\n  find,\n  forEach,\n  isArray,\n  isNumber,\n  map,\n  matchPattern,\n  omit,\n  sortBy\n} from 'min-dash';\n\nimport {\n  getBBox,\n  getParents\n} from '../../util/Elements';\n\nimport { eachElement } from '../../util/Elements';\n\nimport {\n  isConnection,\n  isLabel\n} from '../../util/ModelUtil';\n\n/**\n * @typedef {import('../../core/Types').ElementLike} Element\n * @typedef {import('../../core/Types').ShapeLike} Shape\n *\n * @typedef {import('../../util/Types').Point} Point\n *\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../clipboard/Clipboard').default} Clipboard\n * @typedef {import('../create/Create').default} Create\n * @typedef {import('../../core/ElementFactory').default} ElementFactory\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../modeling/Modeling').default} Modeling\n * @typedef {import('../mouse/Mouse').default} Mouse\n * @typedef {import('../rules/Rules').default} Rules\n */\n\n/**\n * @typedef { (event: { elements: Element[] }) => Element[]|boolean } CopyPasteCanCopyElementsListener\n */\n\n/**\n * @typedef { (event: { descriptor: any, element: Element, elements: Element[] }) => void } CopyPasteCopyElementListener\n */\n\n/**\n * @typedef { (event: { element: Element, children: Element[] }) => void } CopyPasteCreateTreeListener\n */\n\n/**\n * @typedef { (event: { elements: any, tree: any }) => void } CopyPasteElementsCopiedListener\n */\n\n/**\n * @typedef { (event: { cache: any, descriptor: any }) => void } CopyPastePasteElementListener\n */\n\n/**\n * @typedef { (event: { hints: any }) => void } CopyPastePasteElementsListener\n */\n\n/**\n * @typedef { any } Tree\n */\n\n/**\n * @typedef { {\n *   element: Shape,\n *   point: Point\n * } } DirectPasteContext\n *\n * @typedef { {\n *   hints?: Object,\n *   tree?: Tree\n * } } BasePasteContext\n *\n * @typedef { {\n *   hints?: Object\n * } } BaseDuplicateContext\n *\n * @typedef { BasePasteContext & (DirectPasteContext | {}) } PasteContext\n *\n * @typedef { BaseDuplicateContext & (DirectPasteContext | {}) } DuplicateContext\n */\n\n\nvar HIGH_PRIORITY = 2000;\n\n/**\n * Copy and paste elements.\n *\n * @param {Canvas} canvas\n * @param {Create} create\n * @param {Clipboard} clipboard\n * @param {ElementFactory} elementFactory\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {Mouse} mouse\n * @param {Rules} rules\n */\nexport default function CopyPaste(\n    canvas,\n    create,\n    clipboard,\n    elementFactory,\n    eventBus,\n    modeling,\n    mouse,\n    rules\n) {\n\n  this._canvas = canvas;\n  this._create = create;\n  this._elementFactory = elementFactory;\n  this._eventBus = eventBus;\n  this._modeling = modeling;\n  this._mouse = mouse;\n  this._rules = rules;\n\n  eventBus.on('copyPaste.copyElement', function(context) {\n    var descriptor = context.descriptor,\n        element = context.element,\n        elements = context.elements;\n\n    // default priority (priority = 1)\n    descriptor.priority = 1;\n\n    descriptor.id = element.id;\n\n    var parentCopied = find(elements, function(e) {\n      return e === element.parent;\n    });\n\n    // do NOT reference parent if parent wasn't copied\n    if (parentCopied) {\n      descriptor.parent = element.parent.id;\n    }\n\n    // attachers (priority = 2)\n    if (isAttacher(element)) {\n      descriptor.priority = 2;\n\n      descriptor.host = element.host.id;\n    }\n\n    // connections (priority = 3)\n    if (isConnection(element)) {\n      descriptor.priority = 3;\n\n      descriptor.source = element.source.id;\n      descriptor.target = element.target.id;\n\n      descriptor.waypoints = copyWaypoints(element);\n    }\n\n    // labels (priority = 4)\n    if (isLabel(element)) {\n      descriptor.priority = 4;\n\n      descriptor.labelTarget = element.labelTarget.id;\n    }\n\n    forEach([ 'x', 'y', 'width', 'height' ], function(property) {\n      if (isNumber(element[ property ])) {\n        descriptor[ property ] = element[ property ];\n      }\n    });\n\n    descriptor.hidden = element.hidden;\n    descriptor.collapsed = element.collapsed;\n\n  });\n\n  eventBus.on('copyPaste.elementsCopied', HIGH_PRIORITY, function(context) {\n\n    if (context.hints?.clip !== false) {\n\n      // we set an empty tree, selection of elements\n      // to copy was empty.\n      clipboard.set(context.tree);\n    }\n  });\n\n  eventBus.on('copyPaste.pasteElements', HIGH_PRIORITY, function(context) {\n    if (!context.tree) {\n      context.tree = clipboard.get();\n    }\n  });\n\n  eventBus.on('copyPaste.pasteElements', function(context) {\n    var hints = context.hints;\n\n    assign(hints, {\n      createElementsBehavior: false\n    });\n  });\n}\n\nCopyPaste.$inject = [\n  'canvas',\n  'create',\n  'clipboard',\n  'elementFactory',\n  'eventBus',\n  'modeling',\n  'mouse',\n  'rules'\n];\n\n\n/**\n * Copy elements. Will put elements into a {@link Clipboard} unless\n * specified otherwise.\n *\n * @param {Element[]} elements\n * @param {{ clip: boolean }} [hints]\n *\n * @return { Tree }\n */\nCopyPaste.prototype.copy = function(elements, hints = {}) {\n  var allowed,\n      tree;\n\n  if (!isArray(elements)) {\n    elements = elements ? [ elements ] : [];\n  }\n\n  allowed = this._eventBus.fire('copyPaste.canCopyElements', {\n    elements: elements\n  });\n\n  if (allowed === false) {\n    tree = {};\n  } else {\n    tree = this.createTree(isArray(allowed) ? allowed : elements);\n  }\n\n  this._eventBus.fire('copyPaste.elementsCopied', {\n    elements: elements,\n    tree: tree,\n    hints: hints\n  });\n\n  return tree;\n};\n\n/**\n * Paste elements.\n *\n * @param {PasteContext} [context]\n */\nCopyPaste.prototype.paste = function(context = {}) {\n\n  var pasteEvent = this._eventBus.createEvent({\n    type: 'copyPaste.pasteElements',\n    hints: { },\n    ...context\n  });\n\n  var canPaste = this._eventBus.fire(pasteEvent);\n\n  if (canPaste === false) {\n    return;\n  }\n\n  var tree = pasteEvent.tree;\n\n  if (!tree) {\n    return;\n  }\n\n  var hints = pasteEvent.hints;\n\n  var elements = this._createElements(tree);\n\n  // paste directly\n  if (pasteEvent.element && pasteEvent.point) {\n    return this._paste(elements, pasteEvent.element, pasteEvent.point, hints);\n  }\n\n  this._create.start(this._mouse.getLastMoveEvent(), elements, {\n    hints: hints\n  });\n};\n\n/**\n * Duplicate the given elements into the specified paste context.\n *\n * @param {Element[]} elements\n * @param {DuplicateContext} pasteContext\n *\n * @return {Element[]|undefined} the pasted elements, if direct paste happened.\n */\nCopyPaste.prototype.duplicate = function(elements, pasteContext = {}) {\n\n  var tree = this.copy(elements, { clip: false });\n\n  return this.paste({\n    ...pasteContext,\n    tree\n  });\n};\n\n/**\n * Cut elements.\n *\n * @param {Element[]} elements\n *\n * @return { Tree }\n */\nCopyPaste.prototype.cut = function(elements) {\n  var tree = this.copy(elements);\n\n  // only remove elements that were actually copied\n  var copiedElementIds = this._getElementIdsFromTree(tree);\n  var elementsToCut = elements.filter(function(element) {\n    return copiedElementIds[element.id];\n  });\n\n  if (elementsToCut.length > 0) {\n    this._modeling.removeElements(elementsToCut);\n  }\n\n  return tree;\n};\n\n\n/**\n * Get element IDs from tree.\n *\n * @param {Tree} tree\n *\n * @return {Object<string, boolean>}\n */\nCopyPaste.prototype._getElementIdsFromTree = function(tree) {\n  var elementIds = {};\n\n  forEach(tree, function(branch) {\n    forEach(branch, function(descriptor) {\n      if (descriptor.id) {\n        elementIds[descriptor.id] = true;\n      }\n    });\n  });\n\n  return elementIds;\n};\n\n\n\n/**\n * Paste elements directly.\n *\n * @param {Element[]} elements\n * @param {Shape} target\n * @param {Point} position\n * @param {Object} [hints]\n */\nCopyPaste.prototype._paste = function(elements, target, position, hints) {\n\n  // make sure each element has x and y\n  forEach(elements, function(element) {\n    if (!isNumber(element.x)) {\n      element.x = 0;\n    }\n\n    if (!isNumber(element.y)) {\n      element.y = 0;\n    }\n  });\n\n  var bbox = getBBox(elements);\n\n  // center elements around cursor\n  forEach(elements, function(element) {\n    if (isConnection(element)) {\n      element.waypoints = map(element.waypoints, function(waypoint) {\n        return {\n          x: waypoint.x - bbox.x - bbox.width / 2,\n          y: waypoint.y - bbox.y - bbox.height / 2\n        };\n      });\n    }\n\n    assign(element, {\n      x: element.x - bbox.x - bbox.width / 2,\n      y: element.y - bbox.y - bbox.height / 2\n    });\n  });\n\n  return this._modeling.createElements(elements, position, target, assign({}, hints));\n};\n\n/**\n * Create elements from tree.\n *\n * @param {Tree} tree\n *\n * @return {Element[]} elements\n */\nCopyPaste.prototype._createElements = function(tree) {\n  var self = this;\n\n  var eventBus = this._eventBus;\n\n  var cache = {};\n\n  var elements = [];\n\n  forEach(tree, function(branch, depth) {\n\n    depth = parseInt(depth, 10);\n\n    // sort by priority\n    branch = sortBy(branch, 'priority');\n\n    forEach(branch, function(descriptor) {\n\n      // remove priority\n      var attrs = assign({}, omit(descriptor, [ 'priority' ]));\n\n      if (cache[ descriptor.parent ]) {\n        attrs.parent = cache[ descriptor.parent ];\n      } else {\n        delete attrs.parent;\n      }\n\n      eventBus.fire('copyPaste.pasteElement', {\n        cache: cache,\n        descriptor: attrs\n      });\n\n      var element;\n\n      if (isConnection(attrs)) {\n        attrs.source = cache[ descriptor.source ];\n        attrs.target = cache[ descriptor.target ];\n\n        element = cache[ descriptor.id ] = self.createConnection(attrs);\n\n        elements.push(element);\n\n        return;\n      }\n\n      if (isLabel(attrs)) {\n        attrs.labelTarget = cache[ attrs.labelTarget ];\n\n        element = cache[ descriptor.id ] = self.createLabel(attrs);\n\n        elements.push(element);\n\n        return;\n      }\n\n      if (attrs.host) {\n        attrs.host = cache[ attrs.host ];\n      }\n\n      element = cache[ descriptor.id ] = self.createShape(attrs);\n\n      elements.push(element);\n    });\n\n  });\n\n  return elements;\n};\n\nCopyPaste.prototype.createConnection = function(attrs) {\n  var connection = this._elementFactory.createConnection(omit(attrs, [ 'id' ]));\n\n  return connection;\n};\n\nCopyPaste.prototype.createLabel = function(attrs) {\n  var label = this._elementFactory.createLabel(omit(attrs, [ 'id' ]));\n\n  return label;\n};\n\nCopyPaste.prototype.createShape = function(attrs) {\n  var shape = this._elementFactory.createShape(omit(attrs, [ 'id' ]));\n\n  return shape;\n};\n\n/**\n * Check wether element has relations to other elements e.g. attachers, labels and connections.\n *\n * @param {Object} element\n * @param {Element[]} elements\n *\n * @return {boolean}\n */\nCopyPaste.prototype.hasRelations = function(element, elements) {\n  var labelTarget,\n      source,\n      target;\n\n  if (isConnection(element)) {\n    source = find(elements, matchPattern({ id: element.source.id }));\n    target = find(elements, matchPattern({ id: element.target.id }));\n\n    if (!source || !target) {\n      return false;\n    }\n  }\n\n  if (isLabel(element)) {\n    labelTarget = find(elements, matchPattern({ id: element.labelTarget.id }));\n\n    if (!labelTarget) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\n/**\n * Create a tree-like structure from elements.\n *\n * @example\n *\n * ```javascript\n * tree: {\n *  0: [\n *    { id: 'Shape_1', priority: 1, ... },\n *    { id: 'Shape_2', priority: 1, ... },\n *    { id: 'Connection_1', source: 'Shape_1', target: 'Shape_2', priority: 3, ... },\n *    ...\n *  ],\n *  1: [\n *    { id: 'Shape_3', parent: 'Shape1', priority: 1, ... },\n *    ...\n *  ]\n * };\n * ```\n *\n * @param {Element[]} elements\n *\n * @return {Object}\n */\nCopyPaste.prototype.createTree = function(elements) {\n  var rules = this._rules,\n      self = this;\n\n  var tree = {},\n      elementsData = [];\n\n  var parents = getParents(elements);\n\n  function canCopy(element, elements) {\n    return rules.allowed('element.copy', {\n      element: element,\n      elements: elements\n    });\n  }\n\n  function addElementData(element, depth) {\n\n    // (1) check wether element has already been added\n    var foundElementData = find(elementsData, function(elementsData) {\n      return element === elementsData.element;\n    });\n\n    // (2) add element if not already added\n    if (!foundElementData) {\n      elementsData.push({\n        element: element,\n        depth: depth\n      });\n\n      return;\n    }\n\n    // (3) update depth\n    if (foundElementData.depth < depth) {\n      elementsData = removeElementData(foundElementData, elementsData);\n\n      elementsData.push({\n        element: foundElementData.element,\n        depth: depth\n      });\n    }\n  }\n\n  function removeElementData(elementData, elementsData) {\n    var index = elementsData.indexOf(elementData);\n\n    if (index !== -1) {\n      elementsData.splice(index, 1);\n    }\n\n    return elementsData;\n  }\n\n  // (1) add elements\n  eachElement(parents, function(element, _index, depth) {\n\n    // do NOT add external labels directly\n    if (isLabel(element)) {\n      return;\n    }\n\n    // always copy external labels\n    forEach(element.labels, function(label) {\n      addElementData(label, depth);\n    });\n\n    function addRelatedElements(elements) {\n      elements && elements.length && forEach(elements, function(element) {\n\n        // add external labels\n        forEach(element.labels, function(label) {\n          addElementData(label, depth);\n        });\n\n        addElementData(element, depth);\n      });\n    }\n\n    forEach([ element.attachers, element.incoming, element.outgoing ], addRelatedElements);\n\n    addElementData(element, depth);\n\n    var children = [];\n\n    if (element.children) {\n      children = element.children.slice();\n    }\n\n    // allow others to add children to tree\n    self._eventBus.fire('copyPaste.createTree', {\n      element: element,\n      children: children\n    });\n\n    return children;\n  });\n\n  elements = map(elementsData, function(elementData) {\n    return elementData.element;\n  });\n\n  // (2) copy elements\n  elementsData = map(elementsData, function(elementData) {\n    elementData.descriptor = {};\n\n    self._eventBus.fire('copyPaste.copyElement', {\n      descriptor: elementData.descriptor,\n      element: elementData.element,\n      elements: elements\n    });\n\n    return elementData;\n  });\n\n  // (3) sort elements by priority\n  elementsData = sortBy(elementsData, function(elementData) {\n    return elementData.descriptor.priority;\n  });\n\n  elements = map(elementsData, function(elementData) {\n    return elementData.element;\n  });\n\n  // (4) create tree\n  forEach(elementsData, function(elementData) {\n    var depth = elementData.depth;\n\n    if (!self.hasRelations(elementData.element, elements)) {\n      removeElement(elementData.element, elements);\n\n      return;\n    }\n\n    if (!canCopy(elementData.element, elements)) {\n      removeElement(elementData.element, elements);\n\n      return;\n    }\n\n    if (!tree[depth]) {\n      tree[depth] = [];\n    }\n\n    tree[depth].push(elementData.descriptor);\n  });\n\n  return tree;\n};\n\n// helpers //////////\n\nfunction isAttacher(element) {\n  return !!element.host;\n}\n\nfunction copyWaypoints(element) {\n  return map(element.waypoints, function(waypoint) {\n\n    waypoint = copyWaypoint(waypoint);\n\n    if (waypoint.original) {\n      waypoint.original = copyWaypoint(waypoint.original);\n    }\n\n    return waypoint;\n  });\n}\n\nfunction copyWaypoint(waypoint) {\n  return assign({}, waypoint);\n}\n\nfunction removeElement(element, elements) {\n  var index = elements.indexOf(element);\n\n  if (index === -1) {\n    return elements;\n  }\n\n  return elements.splice(index, 1);\n}","import ClipboardModule from '../clipboard';\nimport CreateModule from '../create';\nimport MouseModule from '../mouse';\nimport RulesModule from '../rules';\n\nimport CopyPaste from './CopyPaste';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __depends__: [\n    ClipboardModule,\n    CreateModule,\n    MouseModule,\n    RulesModule\n  ],\n  __init__: [ 'copyPaste' ],\n  copyPaste: [ 'type', CopyPaste ]\n};\n","import {\n  getBusinessObject,\n  getDi,\n  is\n} from '../../util/ModelUtil';\n\nimport {\n  forEach,\n  isArray,\n  isUndefined,\n  omit,\n  reduce\n} from 'min-dash';\n\nimport { isLabel } from '../../util/LabelUtil';\n\n/**\n * @typedef {import('../modeling/BpmnFactory').default} BpmnFactory\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('./ModdleCopy').default} ModdleCopy\n */\n\nfunction copyProperties(source, target, properties) {\n  if (!isArray(properties)) {\n    properties = [ properties ];\n  }\n\n  forEach(properties, function(property) {\n    if (!isUndefined(source[property])) {\n      target[property] = source[property];\n    }\n  });\n}\n\nvar LOW_PRIORITY = 750;\n\n/**\n * BPMN-specific copy & paste.\n *\n * @param {BpmnFactory} bpmnFactory\n * @param {EventBus} eventBus\n * @param {ModdleCopy} moddleCopy\n */\nexport default function BpmnCopyPaste(bpmnFactory, eventBus, moddleCopy) {\n\n  function copy(bo, clone) {\n    var targetBo = bpmnFactory.create(bo.$type);\n\n    return moddleCopy.copyElement(bo, targetBo, null, clone);\n  }\n\n  eventBus.on('copyPaste.copyElement', LOW_PRIORITY, function(context) {\n    var descriptor = context.descriptor,\n        element = context.element,\n        businessObject = getBusinessObject(element);\n\n    // do not copy business object + di for labels;\n    // will be pulled from the referenced label target\n    if (isLabel(element)) {\n      return descriptor;\n    }\n\n    var businessObjectCopy = descriptor.businessObject = copy(businessObject, true);\n    var diCopy = descriptor.di = copy(getDi(element), true);\n    diCopy.bpmnElement = businessObjectCopy;\n\n    copyProperties(businessObjectCopy, descriptor, 'name');\n    copyProperties(diCopy, descriptor, 'isExpanded');\n\n    // default sequence flow\n    if (businessObject.default) {\n      descriptor.default = businessObject.default.id;\n    }\n  });\n\n  var referencesKey = '-bpmn-js-refs';\n\n  function getReferences(cache) {\n    return (cache[referencesKey] = cache[referencesKey] || {});\n  }\n\n  function setReferences(cache, references) {\n    cache[referencesKey] = references;\n  }\n\n  function resolveReferences(descriptor, cache, references) {\n    var businessObject = getBusinessObject(descriptor);\n\n    // default sequence flows\n    if (descriptor.default) {\n\n      // relationship cannot be resolved immediately\n      references[ descriptor.default ] = {\n        element: businessObject,\n        property: 'default'\n      };\n    }\n\n    // boundary events\n    if (descriptor.host) {\n\n      // relationship can be resolved immediately\n      getBusinessObject(descriptor).attachedToRef = getBusinessObject(cache[ descriptor.host ]);\n    }\n\n    return omit(references, reduce(references, function(array, reference, key) {\n      var element = reference.element,\n          property = reference.property;\n\n      if (key === descriptor.id) {\n        element.set(property, businessObject);\n\n        array.push(descriptor.id);\n      }\n\n      return array;\n    }, []));\n  }\n\n  eventBus.on('copyPaste.pasteElement', function(context) {\n    var cache = context.cache,\n        descriptor = context.descriptor,\n        businessObject = descriptor.businessObject,\n        di = descriptor.di;\n\n    // wire existing di + businessObject for external label\n    if (isLabel(descriptor)) {\n      descriptor.businessObject = getBusinessObject(cache[ descriptor.labelTarget ]);\n      descriptor.di = getDi(cache[ descriptor.labelTarget ]);\n\n      return;\n    }\n\n    businessObject = descriptor.businessObject = copy(businessObject);\n\n    di = descriptor.di = copy(di);\n    di.bpmnElement = businessObject;\n\n    copyProperties(descriptor, businessObject, [\n      'isExpanded',\n      'name'\n    ]);\n\n    descriptor.type = businessObject.$type;\n  });\n\n  // copy + paste processRef with participant\n\n  eventBus.on('copyPaste.copyElement', LOW_PRIORITY, function(context) {\n    var descriptor = context.descriptor,\n        element = context.element;\n\n    if (!is(element, 'bpmn:Participant')) {\n      return;\n    }\n\n    var participantBo = getBusinessObject(element);\n\n    if (participantBo.processRef) {\n      descriptor.processRef = copy(participantBo.processRef, true);\n    }\n  });\n\n  eventBus.on('copyPaste.pasteElement', function(context) {\n    var descriptor = context.descriptor,\n        processRef = descriptor.processRef;\n\n    if (processRef) {\n      descriptor.processRef = copy(processRef);\n    }\n  });\n\n  // resolve references\n\n  eventBus.on('copyPaste.pasteElement', LOW_PRIORITY, function(context) {\n    var cache = context.cache,\n        descriptor = context.descriptor;\n\n    // resolve references e.g. default sequence flow\n    setReferences(\n      cache,\n      resolveReferences(descriptor, cache, getReferences(cache))\n    );\n  });\n\n}\n\n\nBpmnCopyPaste.$inject = [\n  'bpmnFactory',\n  'eventBus',\n  'moddleCopy'\n];","import {\n  find,\n  forEach,\n  has,\n  isArray,\n  isDefined,\n  isObject,\n  matchPattern,\n  reduce,\n  sortBy\n} from 'min-dash';\n\nimport { is } from '../../util/ModelUtil';\n\nconst DISALLOWED_PROPERTIES = [\n  'artifacts',\n  'dataInputAssociations',\n  'dataOutputAssociations',\n  'default',\n  'flowElements',\n  'lanes',\n  'incoming',\n  'outgoing',\n  'categoryValue'\n];\n\nconst ALLOWED_REFERENCES = [\n  'errorRef',\n  'escalationRef',\n  'messageRef',\n  'signalRef',\n  'dataObjectRef'\n];\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../modeling/BpmnFactory').default} BpmnFactory\n * @typedef {import('../../model/Types').Moddle} Moddle\n *\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * Utility for copying model properties from source element to target element.\n *\n * @param {EventBus} eventBus\n * @param {BpmnFactory} bpmnFactory\n * @param {Moddle} moddle\n */\nexport default function ModdleCopy(eventBus, bpmnFactory, moddle) {\n  this._bpmnFactory = bpmnFactory;\n  this._eventBus = eventBus;\n  this._moddle = moddle;\n\n  // copy extension elements last\n  eventBus.on('moddleCopy.canCopyProperties', (context) => {\n    const { propertyNames } = context;\n\n    if (!propertyNames || !propertyNames.length) {\n      return;\n    }\n\n    return sortBy(propertyNames, (propertyName) => {\n      return propertyName === 'extensionElements';\n    });\n  });\n\n  // default check whether property can be copied\n  eventBus.on('moddleCopy.canCopyProperty', (context) => {\n    const {\n      parent,\n      property,\n      propertyName\n    } = context;\n\n    const parentDescriptor = isObject(parent) && parent.$descriptor;\n\n    if (propertyName && ALLOWED_REFERENCES.includes(propertyName)) {\n\n      // allow copying reference\n      return property;\n    }\n\n    if (propertyName && DISALLOWED_PROPERTIES.includes(propertyName)) {\n\n      // disallow copying property\n      return false;\n    }\n\n    if (propertyName &&\n      parentDescriptor &&\n      !find(parentDescriptor.properties, matchPattern({ name: propertyName }))) {\n\n      // disallow copying property\n      return false;\n    }\n  });\n\n  // do NOT allow to copy empty extension elements\n  eventBus.on('moddleCopy.canSetCopiedProperty', (context) => {\n    const { property } = context;\n\n    if (is(property, 'bpmn:ExtensionElements') && (!property.values || !property.values.length)) {\n\n      // disallow setting copied property\n      return false;\n    }\n  });\n}\n\nModdleCopy.$inject = [\n  'eventBus',\n  'bpmnFactory',\n  'moddle'\n];\n\n/**\n * Copy model properties of source element to target element.\n *\n * @param {ModdleElement} sourceElement\n * @param {ModdleElement} targetElement\n * @param {string[]} [propertyNames]\n * @param {boolean} [clone=false]\n *\n * @return {ModdleElement}\n */\nModdleCopy.prototype.copyElement = function(sourceElement, targetElement, propertyNames, clone = false) {\n  if (propertyNames && !isArray(propertyNames)) {\n    propertyNames = [ propertyNames ];\n  }\n\n  propertyNames = propertyNames || getPropertyNames(sourceElement.$descriptor);\n\n  const canCopyProperties = this._eventBus.fire('moddleCopy.canCopyProperties', {\n    propertyNames: propertyNames,\n    sourceElement: sourceElement,\n    targetElement: targetElement,\n    clone: clone\n  });\n\n  if (canCopyProperties === false) {\n    return targetElement;\n  }\n\n  if (isArray(canCopyProperties)) {\n    propertyNames = canCopyProperties;\n  }\n\n  // copy properties\n  forEach(propertyNames, (propertyName) => {\n    let sourceProperty;\n\n    if (has(sourceElement, propertyName)) {\n      sourceProperty = sourceElement.get(propertyName);\n    }\n\n    const copiedProperty = this.copyProperty(sourceProperty, targetElement, propertyName, clone);\n\n    if (!isDefined(copiedProperty)) {\n      return;\n    }\n\n    const canSetProperty = this._eventBus.fire('moddleCopy.canSetCopiedProperty', {\n      parent: targetElement,\n      property: copiedProperty,\n      propertyName: propertyName\n    });\n\n    if (canSetProperty === false) {\n      return;\n    }\n\n    // TODO(nikku): unclaim old IDs if ID property is copied over\n    // this._moddle.getPropertyDescriptor(parent, propertyName)\n    targetElement.set(propertyName, copiedProperty);\n  });\n\n  return targetElement;\n};\n\n/**\n * Copy model property.\n *\n * @param {any} property\n * @param {ModdleElement} parent\n * @param {string} propertyName\n * @param {boolean} [clone=false]\n *\n * @return {any}\n */\nModdleCopy.prototype.copyProperty = function(property, parent, propertyName, clone = false) {\n\n  // allow others to copy property\n  let copiedProperty = this._eventBus.fire('moddleCopy.canCopyProperty', {\n    parent: parent,\n    property: property,\n    propertyName: propertyName,\n    clone: clone\n  });\n\n  // return if copying is NOT allowed\n  if (copiedProperty === false) {\n    return;\n  }\n\n  if (copiedProperty) {\n    if (isObject(copiedProperty) && copiedProperty.$type && !copiedProperty.$parent) {\n      copiedProperty.$parent = parent;\n    }\n\n    return copiedProperty;\n  }\n\n  const propertyDescriptor = this._moddle.getPropertyDescriptor(parent, propertyName);\n\n  // do NOT copy references\n  if (propertyDescriptor.isReference) {\n    return;\n  }\n\n  // copy id\n  if (propertyDescriptor.isId) {\n    return property && this._copyId(property, parent, clone);\n  }\n\n  // copy arrays\n  if (isArray(property)) {\n    return reduce(property, (childProperties, childProperty) => {\n\n      // recursion\n      const copiedProperty = this.copyProperty(childProperty, parent, propertyName, clone);\n\n      // copying might NOT be allowed\n      if (copiedProperty) {\n        return childProperties.concat(copiedProperty);\n      }\n\n      return childProperties;\n    }, []);\n  }\n\n  // copy model elements\n  if (isObject(property) && property.$type) {\n    if (this._moddle.getElementDescriptor(property).isGeneric) {\n      return;\n    }\n\n    copiedProperty = this._bpmnFactory.create(property.$type);\n\n    copiedProperty.$parent = parent;\n\n    // recursion\n    copiedProperty = this.copyElement(property, copiedProperty, null, clone);\n\n    return copiedProperty;\n  }\n\n  // copy primitive properties\n  return property;\n};\n\nModdleCopy.prototype._copyId = function(id, element, clone = false) {\n  if (clone) {\n    return id;\n  }\n\n  // disallow if already taken\n  if (this._moddle.ids.assigned(id)) {\n    return;\n  } else {\n\n    this._moddle.ids.claim(id, element);\n    return id;\n  }\n};\n\n// helpers //////////\n\nexport function getPropertyNames(descriptor, keepDefaultProperties) {\n  return reduce(descriptor.properties, (properties, property) => {\n\n    if (keepDefaultProperties && property.default) {\n      return properties;\n    }\n\n    return properties.concat(property.name);\n  }, []);\n}","import CopyPasteModule from 'diagram-js/lib/features/copy-paste';\n\nimport BpmnCopyPaste from './BpmnCopyPaste';\nimport ModdleCopy from './ModdleCopy';\n\nexport default {\n  __depends__: [\n    CopyPasteModule\n  ],\n  __init__: [ 'bpmnCopyPaste', 'moddleCopy' ],\n  bpmnCopyPaste: [ 'type', BpmnCopyPaste ],\n  moddleCopy: [ 'type', ModdleCopy ]\n};\n","import {\n  pick,\n  assign,\n  filter,\n  forEach,\n  isArray,\n  isUndefined,\n  has\n} from 'min-dash';\n\nimport {\n  is,\n  getDi,\n  getBusinessObject\n} from '../../util/ModelUtil';\n\nimport {\n  isAny\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  isExpanded,\n  isEventSubProcess,\n  isHorizontal\n} from '../../util/DiUtil';\n\nimport { getPropertyNames } from '../copy-paste/ModdleCopy';\n\n/**\n * @typedef {import('../modeling/BpmnFactory').default} BpmnFactory\n * @typedef {import('../modeling/ElementFactory').default} ElementFactory\n * @typedef {import('../copy-paste/ModdleCopy').default} ModdleCopy\n * @typedef {import('../modeling/Modeling').default} Modeling\n * @typedef {import('diagram-js/lib/features/replace/Replace').default} Replace\n * @typedef {import('diagram-js/lib/features/rules/Rules').default} Rules\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n *\n * @typedef { {\n *   type: string;\n *   cancelActivity: boolean;\n *   instantiate: boolean;\n *   eventGatewayType: string;\n *   triggeredByEvent: boolean;\n *   isInterrupting: boolean;\n *   collapsed: boolean;\n *   isExpanded: boolean;\n *   eventDefinitionType: string;\n *   eventDefinitionAttrs: Object;\n *   host: Shape;\n * } } TargetElement\n *\n * @typedef { {\n *   moveChildren: boolean;\n * } & Record<string, any> } Hints\n */\n\nfunction copyProperties(source, target, properties) {\n  if (!isArray(properties)) {\n    properties = [ properties ];\n  }\n\n  forEach(properties, function(property) {\n    if (!isUndefined(source[property])) {\n      target[property] = source[property];\n    }\n  });\n}\n\n\nvar CUSTOM_PROPERTIES = [\n  'cancelActivity',\n  'instantiate',\n  'eventGatewayType',\n  'triggeredByEvent',\n  'isInterrupting'\n];\n\n/**\n * Check if element should be collapsed or expanded.\n */\nfunction shouldToggleCollapsed(element, targetElement) {\n\n  var oldCollapsed = (\n    element && has(element, 'collapsed') ? element.collapsed : !isExpanded(element)\n  );\n\n  var targetCollapsed;\n\n  if (targetElement && (has(targetElement, 'collapsed') || has(targetElement, 'isExpanded'))) {\n\n    // property is explicitly set so use it\n    targetCollapsed = (\n      has(targetElement, 'collapsed') ? targetElement.collapsed : !targetElement.isExpanded\n    );\n  } else {\n\n    // keep old state\n    targetCollapsed = oldCollapsed;\n  }\n\n  if (oldCollapsed !== targetCollapsed) {\n    return true;\n  }\n\n  return false;\n}\n\n\n/**\n * BPMN-specific replace.\n *\n * @param {BpmnFactory} bpmnFactory\n * @param {ElementFactory} elementFactory\n * @param {ModdleCopy} moddleCopy\n * @param {Modeling} modeling\n * @param {Replace} replace\n * @param {Rules} rules\n */\nexport default function BpmnReplace(\n    bpmnFactory,\n    elementFactory,\n    moddleCopy,\n    modeling,\n    replace,\n    rules\n) {\n\n  /**\n   * Prepares a new business object for the replacement element\n   * and triggers the replace operation.\n   *\n   * @param  {Element} element\n   * @param  {TargetElement} targetElement\n   * @param  {Hints} [hints]\n   *\n   * @return {Element}\n   */\n  function replaceElement(element, targetElement, hints) {\n\n    hints = hints || {};\n\n    var type = targetElement.type,\n        oldBusinessObject = element.businessObject;\n\n    if (isSubProcess(oldBusinessObject) && (type === 'bpmn:SubProcess' || type === 'bpmn:AdHocSubProcess')) {\n      if (shouldToggleCollapsed(element, targetElement)) {\n\n        // expanding or collapsing process\n        modeling.toggleCollapse(element);\n\n        return element;\n      }\n    }\n\n    var newBusinessObject = bpmnFactory.create(type);\n\n    var newElement = {\n      type: type,\n      businessObject: newBusinessObject,\n    };\n\n    newElement.di = {};\n\n    if (type === 'bpmn:ExclusiveGateway') {\n      newElement.di.isMarkerVisible = true;\n    }\n\n    // colors will be set to DI\n    copyProperties(element.di, newElement.di, [\n      'fill',\n      'stroke',\n      'background-color',\n      'border-color',\n      'color'\n    ]);\n\n    var elementProps = getPropertyNames(oldBusinessObject.$descriptor),\n        newElementProps = getPropertyNames(newBusinessObject.$descriptor, true),\n        copyProps = intersection(elementProps, newElementProps);\n\n    // initialize special properties defined in target definition\n    assign(newBusinessObject, pick(targetElement, CUSTOM_PROPERTIES));\n\n    var properties = filter(copyProps, function(propertyName) {\n\n      // copying event definitions, unless we replace\n      if (propertyName === 'eventDefinitions') {\n        return hasEventDefinition(element, targetElement.eventDefinitionType);\n      }\n\n      // retain loop characteristics if the target element\n      // is not an event sub process\n      if (propertyName === 'loopCharacteristics') {\n        return !isEventSubProcess(newBusinessObject);\n      }\n\n      // so the applied properties from 'target' don't get lost\n      if (has(newBusinessObject, propertyName)) {\n        return false;\n      }\n\n      if (propertyName === 'processRef' && targetElement.isExpanded === false) {\n        return false;\n      }\n\n      if (propertyName === 'triggeredByEvent') {\n        return false;\n      }\n\n      if (propertyName === 'isForCompensation') {\n        return !isEventSubProcess(newBusinessObject);\n      }\n\n      return true;\n    });\n\n    newBusinessObject = moddleCopy.copyElement(\n      oldBusinessObject,\n      newBusinessObject,\n      properties\n    );\n\n    // initialize custom BPMN extensions\n    if (targetElement.eventDefinitionType) {\n\n      // only initialize with new eventDefinition\n      // if we did not set an event definition yet,\n      // i.e. because we copied it\n      if (!hasEventDefinition(newBusinessObject, targetElement.eventDefinitionType)) {\n        newElement.eventDefinitionType = targetElement.eventDefinitionType;\n        newElement.eventDefinitionAttrs = targetElement.eventDefinitionAttrs;\n      }\n    }\n\n    if (is(oldBusinessObject, 'bpmn:Activity')) {\n\n      if (isSubProcess(oldBusinessObject)) {\n\n        // no toggeling, so keep old state\n        newElement.isExpanded = isExpanded(element);\n      }\n\n      // else if property is explicitly set, use it\n      else if (targetElement && has(targetElement, 'isExpanded')) {\n        newElement.isExpanded = targetElement.isExpanded;\n\n        // assign default size of new expanded element\n        var defaultSize = elementFactory.getDefaultSize(newBusinessObject, {\n          isExpanded: newElement.isExpanded\n        });\n\n        newElement.width = defaultSize.width;\n        newElement.height = defaultSize.height;\n\n        // keep element centered\n        newElement.x = element.x - (newElement.width - element.width) / 2;\n        newElement.y = element.y - (newElement.height - element.height) / 2;\n      }\n\n      // TODO: need also to respect min/max Size\n      // copy size, from an expanded subprocess to an expanded alternative subprocess\n      // except bpmn:Task, because Task is always expanded\n      if ((isExpanded(element) && !is(oldBusinessObject, 'bpmn:Task')) && newElement.isExpanded) {\n        newElement.width = element.width;\n        newElement.height = element.height;\n      }\n    }\n\n    // remove children if not expanding sub process\n    if (isSubProcess(oldBusinessObject) && !isSubProcess(newBusinessObject)) {\n      hints.moveChildren = false;\n    }\n\n    // transform collapsed/expanded pools\n    if (is(oldBusinessObject, 'bpmn:Participant')) {\n\n      // create expanded pool\n      if (targetElement.isExpanded === true) {\n        newBusinessObject.processRef = bpmnFactory.create('bpmn:Process');\n      } else {\n\n        // remove children when transforming to collapsed pool\n        hints.moveChildren = false;\n      }\n\n      // apply same directionality\n      var isHorizontalPool = isHorizontal(element);\n      if (!getDi(element).isHorizontal) {\n        getDi(newElement).isHorizontal = isHorizontalPool;\n      }\n\n      // keep the existing size of the pool's direction to\n      // prevent dangling message flows\n      newElement.width = isHorizontalPool ? element.width : elementFactory.getDefaultSize(newElement).width;\n      newElement.height = isHorizontalPool ? elementFactory.getDefaultSize(newElement).height : element.height;\n    }\n\n    if (!rules.allowed('shape.resize', { shape: newBusinessObject })) {\n      newElement.height = elementFactory.getDefaultSize(newElement).height;\n      newElement.width = elementFactory.getDefaultSize(newElement).width;\n    }\n\n    newBusinessObject.name = oldBusinessObject.name;\n\n    // retain default flow's reference between inclusive <-> exclusive gateways and activities\n    if (\n      isAny(oldBusinessObject, [\n        'bpmn:ExclusiveGateway',\n        'bpmn:InclusiveGateway',\n        'bpmn:Activity'\n      ]) &&\n      isAny(newBusinessObject, [\n        'bpmn:ExclusiveGateway',\n        'bpmn:InclusiveGateway',\n        'bpmn:Activity'\n      ])\n    ) {\n      newBusinessObject.default = oldBusinessObject.default;\n    }\n\n    if (\n      targetElement.host &&\n      !is(oldBusinessObject, 'bpmn:BoundaryEvent') &&\n      is(newBusinessObject, 'bpmn:BoundaryEvent')\n    ) {\n      newElement.host = targetElement.host;\n    }\n\n    // The DataStoreReference element is 14px wider than the DataObjectReference element\n    // This ensures that they stay centered on the x axis when replaced\n    if (\n      newElement.type === 'bpmn:DataStoreReference' ||\n      newElement.type === 'bpmn:DataObjectReference'\n    ) {\n      newElement.x = element.x + (element.width - newElement.width) / 2;\n    }\n\n    return replace.replaceElement(element, newElement, { ...hints, targetElement });\n  }\n\n  this.replaceElement = replaceElement;\n}\n\nBpmnReplace.$inject = [\n  'bpmnFactory',\n  'elementFactory',\n  'moddleCopy',\n  'modeling',\n  'replace',\n  'rules'\n];\n\n/**\n * @param {ModdleElement} businessObject\n *\n * @return {boolean}\n */\nfunction isSubProcess(businessObject) {\n  return is(businessObject, 'bpmn:SubProcess');\n}\n\n/**\n * @param {Element|ModdleElement} element\n * @param {string} type\n *\n * @return {boolean}\n */\nfunction hasEventDefinition(element, type) {\n  var businessObject = getBusinessObject(element);\n\n  return type && businessObject.get('eventDefinitions').some(function(definition) {\n    return is(definition, type);\n  });\n}\n\n/**\n * Compute intersection between two arrays.\n *\n * @param {Array} a\n * @param {Array} b\n *\n * @return {Array}\n */\nfunction intersection(a, b) {\n  return a.filter(function(item) {\n    return b.includes(item);\n  });\n}\n","import CopyPasteModule from '../copy-paste';\nimport ReplaceModule from 'diagram-js/lib/features/replace';\nimport SelectionModule from 'diagram-js/lib/features/selection';\n\nimport BpmnReplace from './BpmnReplace';\n\nexport default {\n  __depends__: [\n    CopyPasteModule,\n    ReplaceModule,\n    SelectionModule\n  ],\n  bpmnReplace: [ 'type', BpmnReplace ]\n};\n","import {\n  assign,\n  filter,\n  forEach,\n  isNumber\n} from 'min-dash';\n\nimport {\n  asTRBL,\n  getMid\n} from '../../layout/LayoutUtil';\n\nimport { getBBox } from '../../util/Elements';\n\nimport { getDirection } from './SpaceUtil';\n\nimport {\n  hasPrimaryModifier,\n  hasSecondaryModifier\n} from '../../util/Mouse';\n\nimport { set as setCursor } from '../../util/Cursor';\n\nimport { selfAndAllChildren } from '../../util/Elements';\n\nimport {\n  isConnection,\n  isLabel\n} from '../../util/ModelUtil';\n\n/**\n * @typedef {import('../../core/Types').ShapeLike} Shape\n *\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../dragging/Dragging').default} Dragging\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../modeling/Modeling').default} Modeling\n * @typedef {import('../mouse/Mouse').default} Mouse\n * @typedef {import('../rules/Rules').default} Rules\n * @typedef {import('../tool-manager/ToolManager').default} ToolManager\n *\n * @typedef {import('../../util/Types').Axis} Axis\n * @typedef {import('../../util/Types').Direction} Direction\n * @typedef {import('../../util/Types').Point} Point\n */\n\nvar abs = Math.abs,\n    round = Math.round;\n\nvar AXIS_TO_DIMENSION = {\n  x: 'width',\n  y: 'height'\n};\n\nvar CURSOR_CROSSHAIR = 'crosshair';\n\nvar DIRECTION_TO_TRBL = {\n  n: 'top',\n  w: 'left',\n  s: 'bottom',\n  e: 'right'\n};\n\nvar HIGH_PRIORITY = 1500;\n\nvar DIRECTION_TO_OPPOSITE = {\n  n: 's',\n  w: 'e',\n  s: 'n',\n  e: 'w'\n};\n\nvar PADDING = 20;\n\n\n/**\n * Add or remove space by moving and resizing elements.\n *\n * @param {Canvas} canvas\n * @param {Dragging} dragging\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {Rules} rules\n * @param {ToolManager} toolManager\n * @param {Mouse} mouse\n */\nexport default function SpaceTool(\n    canvas, dragging, eventBus,\n    modeling, rules, toolManager,\n    mouse) {\n\n  this._canvas = canvas;\n  this._dragging = dragging;\n  this._eventBus = eventBus;\n  this._modeling = modeling;\n  this._rules = rules;\n  this._toolManager = toolManager;\n  this._mouse = mouse;\n\n  var self = this;\n\n  toolManager.registerTool('space', {\n    tool: 'spaceTool.selection',\n    dragging: 'spaceTool'\n  });\n\n  eventBus.on('spaceTool.selection.end', function(event) {\n    eventBus.once('spaceTool.selection.ended', function() {\n      self.activateMakeSpace(event.originalEvent);\n    });\n  });\n\n  eventBus.on('spaceTool.move', HIGH_PRIORITY , function(event) {\n    var context = event.context,\n        initialized = context.initialized;\n\n    if (!initialized) {\n      initialized = context.initialized = self.init(event, context);\n    }\n\n    if (initialized) {\n      ensureConstraints(event);\n    }\n  });\n\n  eventBus.on('spaceTool.end', function(event) {\n    var context = event.context,\n        axis = context.axis,\n        direction = context.direction,\n        movingShapes = context.movingShapes,\n        resizingShapes = context.resizingShapes,\n        start = context.start;\n\n    if (!context.initialized) {\n      return;\n    }\n\n    ensureConstraints(event);\n\n    var delta = {\n      x: 0,\n      y: 0\n    };\n\n    delta[ axis ] = round(event[ 'd' + axis ]);\n\n    self.makeSpace(movingShapes, resizingShapes, delta, direction, start);\n\n    eventBus.once('spaceTool.ended', function(event) {\n\n      // activate space tool selection after make space\n      self.activateSelection(event.originalEvent, true, true);\n    });\n  });\n}\n\nSpaceTool.$inject = [\n  'canvas',\n  'dragging',\n  'eventBus',\n  'modeling',\n  'rules',\n  'toolManager',\n  'mouse'\n];\n\n/**\n * Activate space tool selection.\n *\n * @param {MouseEvent|TouchEvent} event\n * @param {boolean} autoActivate\n * @param {boolean} reactivate\n */\nSpaceTool.prototype.activateSelection = function(event, autoActivate, reactivate) {\n  this._dragging.init(event, 'spaceTool.selection', {\n    autoActivate: autoActivate,\n    cursor: CURSOR_CROSSHAIR,\n    data: {\n      context: {\n        reactivate: reactivate\n      }\n    },\n    trapClick: false\n  });\n};\n\n/**\n * Activate space tool make space.\n *\n * @param {MouseEvent|TouchEvent} event\n */\nSpaceTool.prototype.activateMakeSpace = function(event) {\n  this._dragging.init(event, 'spaceTool', {\n    autoActivate: true,\n    cursor: CURSOR_CROSSHAIR,\n    data: {\n      context: {}\n    }\n  });\n};\n\n/**\n * Make space.\n *\n * @param {Array<Shape>} movingShapes\n * @param {Array<Shape>} resizingShapes\n * @param {Point} delta\n * @param {Direction} direction\n * @param {number} start\n */\nSpaceTool.prototype.makeSpace = function(movingShapes, resizingShapes, delta, direction, start) {\n  return this._modeling.createSpace(movingShapes, resizingShapes, delta, direction, start);\n};\n\n/**\n * Initialize make space and return true if that was successful.\n *\n * @param {MouseEvent|TouchEvent} event\n * @param {Object} context\n *\n * @return {boolean}\n */\nSpaceTool.prototype.init = function(event, context) {\n  var axis = abs(event.dx) > abs(event.dy) ? 'x' : 'y',\n      delta = event[ 'd' + axis ],\n      start = event[ axis ] - delta;\n\n  if (abs(delta) < 5) {\n    return false;\n  }\n\n  // invert delta to remove space when moving left\n  if (delta < 0) {\n    delta *= -1;\n  }\n\n  // invert delta to add/remove space when removing/adding space if modifier key is pressed\n  if (hasPrimaryModifier(event)) {\n    delta *= -1;\n  }\n\n  var direction = getDirection(axis, delta);\n\n  var root = this._canvas.getRootElement();\n\n  if (!hasSecondaryModifier(event) && event.hover) {\n    root = event.hover;\n  }\n\n  var children = [\n    ...selfAndAllChildren(root, true),\n    ...(root.attachers || [])\n  ];\n\n  var elements = this.calculateAdjustments(children, axis, delta, start);\n\n  var minDimensions = this._eventBus.fire('spaceTool.getMinDimensions', {\n    axis: axis,\n    direction: direction,\n    shapes: elements.resizingShapes,\n    start: start\n  });\n\n  var spaceToolConstraints = getSpaceToolConstraints(elements, axis, direction, start, minDimensions);\n\n  assign(\n    context,\n    elements,\n    {\n      axis: axis,\n      direction: direction,\n      spaceToolConstraints: spaceToolConstraints,\n      start: start\n    }\n  );\n\n  setCursor('resize-' + (axis === 'x' ? 'ew' : 'ns'));\n\n  return true;\n};\n\n/**\n * Get elements to be moved and resized.\n *\n * @param {Array<Shape>} elements\n * @param {Axis} axis\n * @param {Point} delta\n * @param {number} start\n *\n * @return {Object}\n */\nSpaceTool.prototype.calculateAdjustments = function(elements, axis, delta, start) {\n  var rules = this._rules;\n\n  var movingShapes = [],\n      resizingShapes = [];\n\n  var attachers = [],\n      connections = [];\n\n  function moveShape(shape) {\n    if (!movingShapes.includes(shape)) {\n      movingShapes.push(shape);\n    }\n\n    var label = shape.label;\n\n    // move external label if its label target is moving\n    if (label && !movingShapes.includes(label)) {\n      movingShapes.push(label);\n    }\n  }\n\n  function resizeShape(shape) {\n    if (!resizingShapes.includes(shape)) {\n      resizingShapes.push(shape);\n    }\n  }\n\n  forEach(elements, function(element) {\n    if (!element.parent || isLabel(element)) {\n      return;\n    }\n\n    // handle connections separately\n    if (isConnection(element)) {\n      connections.push(element);\n\n      return;\n    }\n\n    var shapeStart = element[ axis ],\n        shapeEnd = shapeStart + element[ AXIS_TO_DIMENSION[ axis ] ];\n\n    // handle attachers separately\n    if (isAttacher(element)\n      && ((delta > 0 && getMid(element)[ axis ] > start)\n        || (delta < 0 && getMid(element)[ axis ] < start))) {\n      attachers.push(element);\n\n      return;\n    }\n\n    // move shape if its start is after space tool\n    if ((delta > 0 && shapeStart > start)\n      || (delta < 0 && shapeEnd < start)) {\n      moveShape(element);\n\n      return;\n    }\n\n    // resize shape if it's resizable and its start is before and its end is after space tool\n    if (shapeStart < start\n      && shapeEnd > start\n      && rules.allowed('shape.resize', { shape: element })\n    ) {\n      resizeShape(element);\n\n      return;\n    }\n  });\n\n  // move attacher if its host is moving\n  forEach(movingShapes, function(shape) {\n    var attachers = shape.attachers;\n\n    if (attachers) {\n      forEach(attachers, function(attacher) {\n        moveShape(attacher);\n      });\n    }\n  });\n\n  var allShapes = movingShapes.concat(resizingShapes);\n\n  // move attacher if its mid is after space tool and its host is moving or resizing\n  forEach(attachers, function(attacher) {\n    var host = attacher.host;\n\n    if (includes(allShapes, host)) {\n      moveShape(attacher);\n    }\n  });\n\n  allShapes = movingShapes.concat(resizingShapes);\n\n  // move external label if its label target's (connection) source and target are moving\n  forEach(connections, function(connection) {\n    var source = connection.source,\n        target = connection.target,\n        label = connection.label;\n\n    if (includes(allShapes, source)\n      && includes(allShapes, target)\n      && label) {\n      moveShape(label);\n    }\n  });\n\n  return {\n    movingShapes: movingShapes,\n    resizingShapes: resizingShapes\n  };\n};\n\nSpaceTool.prototype.toggle = function() {\n\n  if (this.isActive()) {\n    return this._dragging.cancel();\n  }\n\n  var mouseEvent = this._mouse.getLastMoveEvent();\n\n  this.activateSelection(mouseEvent, !!mouseEvent);\n};\n\nSpaceTool.prototype.isActive = function() {\n  var context = this._dragging.context();\n\n  if (context) {\n    return /^spaceTool/.test(context.prefix);\n  }\n\n  return false;\n};\n\n// helpers //////////\n\nfunction addPadding(trbl) {\n  return {\n    top: trbl.top - PADDING,\n    right: trbl.right + PADDING,\n    bottom: trbl.bottom + PADDING,\n    left: trbl.left - PADDING\n  };\n}\n\nfunction ensureConstraints(event) {\n  var context = event.context,\n      spaceToolConstraints = context.spaceToolConstraints;\n\n  if (!spaceToolConstraints) {\n    return;\n  }\n\n  var x, y;\n\n  if (isNumber(spaceToolConstraints.left)) {\n    x = Math.max(event.x, spaceToolConstraints.left);\n\n    event.dx = event.dx + x - event.x;\n    event.x = x;\n  }\n\n  if (isNumber(spaceToolConstraints.right)) {\n    x = Math.min(event.x, spaceToolConstraints.right);\n\n    event.dx = event.dx + x - event.x;\n    event.x = x;\n  }\n\n  if (isNumber(spaceToolConstraints.top)) {\n    y = Math.max(event.y, spaceToolConstraints.top);\n\n    event.dy = event.dy + y - event.y;\n    event.y = y;\n  }\n\n  if (isNumber(spaceToolConstraints.bottom)) {\n    y = Math.min(event.y, spaceToolConstraints.bottom);\n\n    event.dy = event.dy + y - event.y;\n    event.y = y;\n  }\n}\n\nfunction getSpaceToolConstraints(elements, axis, direction, start, minDimensions) {\n  var movingShapes = elements.movingShapes,\n      resizingShapes = elements.resizingShapes;\n\n  if (!resizingShapes.length) {\n    return;\n  }\n\n  var spaceToolConstraints = {},\n      min,\n      max;\n\n  forEach(resizingShapes, function(resizingShape) {\n    var attachers = resizingShape.attachers,\n        children = resizingShape.children;\n\n    var resizingShapeBBox = asTRBL(resizingShape);\n\n    // find children that are not moving or resizing\n    var nonMovingResizingChildren = filter(children, function(child) {\n      return !isConnection(child) &&\n        !isLabel(child) &&\n        !includes(movingShapes, child) &&\n        !includes(resizingShapes, child);\n    });\n\n    // find children that are moving\n    var movingChildren = filter(children, function(child) {\n      return !isConnection(child) && !isLabel(child) && includes(movingShapes, child);\n    });\n\n    var minOrMax,\n        nonMovingResizingChildrenBBox,\n        movingChildrenBBox,\n        movingAttachers = [],\n        nonMovingAttachers = [],\n        movingAttachersBBox,\n        movingAttachersConstraint,\n        nonMovingAttachersBBox,\n        nonMovingAttachersConstraint;\n\n    if (nonMovingResizingChildren.length) {\n      nonMovingResizingChildrenBBox = addPadding(asTRBL(getBBox(nonMovingResizingChildren)));\n\n      minOrMax = start -\n        resizingShapeBBox[ DIRECTION_TO_TRBL[ direction ] ] +\n        nonMovingResizingChildrenBBox[ DIRECTION_TO_TRBL[ direction ] ];\n\n      if (direction === 'n') {\n        spaceToolConstraints.bottom = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\n      } else if (direction === 'w') {\n        spaceToolConstraints.right = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\n      } else if (direction === 's') {\n        spaceToolConstraints.top = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\n      } else if (direction === 'e') {\n        spaceToolConstraints.left = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\n      }\n    }\n\n    if (movingChildren.length) {\n      movingChildrenBBox = addPadding(asTRBL(getBBox(movingChildren)));\n\n      minOrMax = start -\n        movingChildrenBBox[ DIRECTION_TO_TRBL[ DIRECTION_TO_OPPOSITE[ direction ] ] ] +\n        resizingShapeBBox[ DIRECTION_TO_TRBL[ DIRECTION_TO_OPPOSITE[ direction ] ] ];\n\n      if (direction === 'n') {\n        spaceToolConstraints.bottom = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\n      } else if (direction === 'w') {\n        spaceToolConstraints.right = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\n      } else if (direction === 's') {\n        spaceToolConstraints.top = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\n      } else if (direction === 'e') {\n        spaceToolConstraints.left = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\n      }\n    }\n\n    if (attachers && attachers.length) {\n      attachers.forEach(function(attacher) {\n        if (includes(movingShapes, attacher)) {\n          movingAttachers.push(attacher);\n        } else {\n          nonMovingAttachers.push(attacher);\n        }\n      });\n\n      if (movingAttachers.length) {\n        movingAttachersBBox = asTRBL(getBBox(movingAttachers.map(getMid)));\n\n        movingAttachersConstraint = resizingShapeBBox[ DIRECTION_TO_TRBL[ DIRECTION_TO_OPPOSITE[ direction ] ] ]\n              - (movingAttachersBBox[ DIRECTION_TO_TRBL[ DIRECTION_TO_OPPOSITE[ direction ] ] ] - start);\n      }\n\n      if (nonMovingAttachers.length) {\n        nonMovingAttachersBBox = asTRBL(getBBox(nonMovingAttachers.map(getMid)));\n\n        nonMovingAttachersConstraint = nonMovingAttachersBBox[ DIRECTION_TO_TRBL[ direction ] ]\n              - (resizingShapeBBox[ DIRECTION_TO_TRBL[ direction ] ] - start);\n      }\n\n      if (direction === 'n') {\n        minOrMax = Math.min(movingAttachersConstraint || Infinity, nonMovingAttachersConstraint || Infinity);\n\n        spaceToolConstraints.bottom = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\n      } else if (direction === 'w') {\n        minOrMax = Math.min(movingAttachersConstraint || Infinity, nonMovingAttachersConstraint || Infinity);\n\n        spaceToolConstraints.right = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\n      } else if (direction === 's') {\n        minOrMax = Math.max(movingAttachersConstraint || -Infinity, nonMovingAttachersConstraint || -Infinity);\n\n        spaceToolConstraints.top = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\n      } else if (direction === 'e') {\n        minOrMax = Math.max(movingAttachersConstraint || -Infinity, nonMovingAttachersConstraint || -Infinity);\n\n        spaceToolConstraints.left = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\n      }\n    }\n\n    var resizingShapeMinDimensions = minDimensions && minDimensions[ resizingShape.id ];\n\n    if (resizingShapeMinDimensions) {\n\n      if (direction === 'n') {\n        minOrMax = start +\n          resizingShape[ AXIS_TO_DIMENSION [ axis ] ] -\n          resizingShapeMinDimensions[ AXIS_TO_DIMENSION[ axis ] ];\n\n        spaceToolConstraints.bottom = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\n      } else if (direction === 'w') {\n        minOrMax = start +\n          resizingShape[ AXIS_TO_DIMENSION [ axis ] ] -\n          resizingShapeMinDimensions[ AXIS_TO_DIMENSION[ axis ] ];\n\n        spaceToolConstraints.right = max = isNumber(max) ? Math.min(max, minOrMax) : minOrMax;\n      } else if (direction === 's') {\n        minOrMax = start -\n          resizingShape[ AXIS_TO_DIMENSION [ axis ] ] +\n          resizingShapeMinDimensions[ AXIS_TO_DIMENSION[ axis ] ];\n\n        spaceToolConstraints.top = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\n      } else if (direction === 'e') {\n        minOrMax = start -\n          resizingShape[ AXIS_TO_DIMENSION [ axis ] ] +\n          resizingShapeMinDimensions[ AXIS_TO_DIMENSION[ axis ] ];\n\n        spaceToolConstraints.left = min = isNumber(min) ? Math.max(min, minOrMax) : minOrMax;\n      }\n    }\n  });\n\n  return spaceToolConstraints;\n}\n\nfunction includes(array, item) {\n  return array.indexOf(item) !== -1;\n}\n\nfunction isAttacher(element) {\n  return !!element.host;\n}","import {\n  forEach\n} from 'min-dash';\n\nvar MARKER_DRAGGING = 'djs-dragging',\n    MARKER_RESIZING = 'djs-resizing';\n\nvar LOW_PRIORITY = 250;\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  classes as svgClasses,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  translate\n} from '../../util/SvgTransformUtil';\n\nimport { isConnection } from '../../util/ModelUtil';\n\n/**\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../../draw/Styles').default} Styles\n */\n\nvar max = Math.max;\n\n\n/**\n * Provides previews for selecting/moving/resizing shapes when creating/removing space.\n *\n * @param {EventBus} eventBus\n * @param {ElementRegistry} elementRegistry\n * @param {Canvas} canvas\n * @param {Styles} styles\n */\nexport default function SpaceToolPreview(\n    eventBus, elementRegistry, canvas,\n    styles, previewSupport) {\n\n  function addPreviewGfx(collection, dragGroup) {\n    forEach(collection, function(element) {\n      previewSupport.addDragger(element, dragGroup);\n\n      canvas.addMarker(element, MARKER_DRAGGING);\n    });\n  }\n\n  // add crosshair\n  eventBus.on('spaceTool.selection.start', function(event) {\n    var space = canvas.getLayer('space'),\n        context = event.context;\n\n    var orientation = {\n      x: 'M 0,-10000 L 0,10000',\n      y: 'M -10000,0 L 10000,0'\n    };\n\n    var crosshairGroup = svgCreate('g');\n    svgAttr(crosshairGroup, styles.cls('djs-crosshair-group', [ 'no-events' ]));\n\n    svgAppend(space, crosshairGroup);\n\n    // horizontal path\n    var pathX = svgCreate('path');\n    svgAttr(pathX, 'd', orientation.x);\n    svgClasses(pathX).add('djs-crosshair');\n\n    svgAppend(crosshairGroup, pathX);\n\n    // vertical path\n    var pathY = svgCreate('path');\n    svgAttr(pathY, 'd', orientation.y);\n    svgClasses(pathY).add('djs-crosshair');\n\n    svgAppend(crosshairGroup, pathY);\n\n    context.crosshairGroup = crosshairGroup;\n  });\n\n  // update crosshair\n  eventBus.on('spaceTool.selection.move', function(event) {\n    var crosshairGroup = event.context.crosshairGroup;\n\n    translate(crosshairGroup, event.x, event.y);\n  });\n\n  // remove crosshair\n  eventBus.on('spaceTool.selection.cleanup', function(event) {\n    var context = event.context,\n        crosshairGroup = context.crosshairGroup;\n\n    if (crosshairGroup) {\n      svgRemove(crosshairGroup);\n    }\n  });\n\n  // add and update move/resize previews\n  eventBus.on('spaceTool.move', LOW_PRIORITY, function(event) {\n\n    var context = event.context,\n        line = context.line,\n        axis = context.axis,\n        movingShapes = context.movingShapes,\n        resizingShapes = context.resizingShapes;\n\n    if (!context.initialized) {\n      return;\n    }\n\n    if (!context.dragGroup) {\n      var spaceLayer = canvas.getLayer('space');\n\n      line = svgCreate('path');\n      svgAttr(line, 'd', 'M0,0 L0,0');\n      svgClasses(line).add('djs-crosshair');\n\n      svgAppend(spaceLayer, line);\n\n      context.line = line;\n\n      var dragGroup = svgCreate('g');\n      svgAttr(dragGroup, styles.cls('djs-drag-group', [ 'no-events' ]));\n\n      svgAppend(canvas.getActiveLayer(), dragGroup);\n\n      // shapes\n      addPreviewGfx(movingShapes, dragGroup);\n\n      // connections\n      var movingConnections = context.movingConnections = elementRegistry.filter(function(element) {\n        var sourceIsMoving = false;\n\n        forEach(movingShapes, function(shape) {\n          forEach(shape.outgoing, function(connection) {\n            if (element === connection) {\n              sourceIsMoving = true;\n            }\n          });\n        });\n\n        var targetIsMoving = false;\n\n        forEach(movingShapes, function(shape) {\n          forEach(shape.incoming, function(connection) {\n            if (element === connection) {\n              targetIsMoving = true;\n            }\n          });\n        });\n\n        var sourceIsResizing = false;\n\n        forEach(resizingShapes, function(shape) {\n          forEach(shape.outgoing, function(connection) {\n            if (element === connection) {\n              sourceIsResizing = true;\n            }\n          });\n        });\n\n        var targetIsResizing = false;\n\n        forEach(resizingShapes, function(shape) {\n          forEach(shape.incoming, function(connection) {\n            if (element === connection) {\n              targetIsResizing = true;\n            }\n          });\n        });\n\n        return isConnection(element)\n          && (sourceIsMoving || sourceIsResizing)\n          && (targetIsMoving || targetIsResizing);\n      });\n\n\n      addPreviewGfx(movingConnections, dragGroup);\n\n      context.dragGroup = dragGroup;\n    }\n\n    if (!context.frameGroup) {\n      var frameGroup = svgCreate('g');\n      svgAttr(frameGroup, styles.cls('djs-frame-group', [ 'no-events' ]));\n\n      svgAppend(canvas.getActiveLayer(), frameGroup);\n\n      var frames = [];\n\n      forEach(resizingShapes, function(shape) {\n        var frame = previewSupport.addFrame(shape, frameGroup);\n\n        var initialBounds = frame.getBBox();\n\n        frames.push({\n          element: frame,\n          initialBounds: initialBounds\n        });\n\n        canvas.addMarker(shape, MARKER_RESIZING);\n      });\n\n      context.frameGroup = frameGroup;\n      context.frames = frames;\n    }\n\n    var orientation = {\n      x: 'M' + event.x + ', -10000 L' + event.x + ', 10000',\n      y: 'M -10000, ' + event.y + ' L 10000, ' + event.y\n    };\n\n    svgAttr(line, { d: orientation[ axis ] });\n\n    var opposite = { x: 'y', y: 'x' };\n    var delta = { x: event.dx, y: event.dy };\n    delta[ opposite[ context.axis ] ] = 0;\n\n    // update move previews\n    translate(context.dragGroup, delta.x, delta.y);\n\n    // update resize previews\n    forEach(context.frames, function(frame) {\n      var element = frame.element,\n          initialBounds = frame.initialBounds,\n          width,\n          height;\n\n      if (context.direction === 'e') {\n        svgAttr(element, {\n          width: max(initialBounds.width + delta.x, 5)\n        });\n      } else {\n        width = max(initialBounds.width - delta.x, 5);\n\n        svgAttr(element, {\n          width: width,\n          x: initialBounds.x + initialBounds.width - width\n        });\n      }\n\n      if (context.direction === 's') {\n        svgAttr(element, {\n          height: max(initialBounds.height + delta.y, 5)\n        });\n      } else {\n        height = max(initialBounds.height - delta.y, 5);\n\n        svgAttr(element, {\n          height: height,\n          y: initialBounds.y + initialBounds.height - height\n        });\n      }\n    });\n\n  });\n\n  // remove move/resize previews\n  eventBus.on('spaceTool.cleanup', function(event) {\n\n    var context = event.context,\n        movingShapes = context.movingShapes,\n        movingConnections = context.movingConnections,\n        resizingShapes = context.resizingShapes,\n        line = context.line,\n        dragGroup = context.dragGroup,\n        frameGroup = context.frameGroup;\n\n    // moving shapes\n    forEach(movingShapes, function(shape) {\n      canvas.removeMarker(shape, MARKER_DRAGGING);\n    });\n\n    // moving connections\n    forEach(movingConnections, function(connection) {\n      canvas.removeMarker(connection, MARKER_DRAGGING);\n    });\n\n    if (dragGroup) {\n      svgRemove(line);\n      svgRemove(dragGroup);\n    }\n\n    forEach(resizingShapes, function(shape) {\n      canvas.removeMarker(shape, MARKER_RESIZING);\n    });\n\n    if (frameGroup) {\n      svgRemove(frameGroup);\n    }\n  });\n}\n\nSpaceToolPreview.$inject = [\n  'eventBus',\n  'elementRegistry',\n  'canvas',\n  'styles',\n  'previewSupport'\n];\n","import DraggingModule from '../dragging';\nimport RulesModule from '../rules';\nimport ToolManagerModule from '../tool-manager';\nimport PreviewSupportModule from '../preview-support';\nimport MouseModule from '../mouse';\n\nimport SpaceTool from './SpaceTool';\nimport SpaceToolPreview from './SpaceToolPreview';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [ 'spaceToolPreview' ],\n  __depends__: [\n    DraggingModule,\n    RulesModule,\n    ToolManagerModule,\n    PreviewSupportModule,\n    MouseModule\n  ],\n  spaceTool: [ 'type', SpaceTool ],\n  spaceToolPreview: [ 'type', SpaceToolPreview ]\n};\n","import inherits from 'inherits-browser';\n\nimport SpaceTool from 'diagram-js/lib/features/space-tool/SpaceTool';\n\nimport { getEnclosedElements, getBBox } from 'diagram-js/lib/util/Elements';\n\nimport { getBusinessObject, is } from '../../util/ModelUtil';\n\nimport { isHorizontal } from '../../util/DiUtil';\nimport { values } from 'min-dash';\n\n/**\n * @typedef {import('didi').Injector} Injector\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n *\n * @typedef {import('../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').Axis} Axis\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n */\n\n/**\n * @param {Injector} injector\n * @param {Canvas} canvas\n */\nexport default function BpmnSpaceTool(injector, canvas) {\n  injector.invoke(SpaceTool, this);\n\n  this._canvas = canvas;\n}\n\nBpmnSpaceTool.$inject = [\n  'injector',\n  'canvas'\n];\n\ninherits(BpmnSpaceTool, SpaceTool);\n\n/**\n * @param {Shape[]} elements\n * @param {Axis} axis\n * @param {Point} delta\n * @param {number} start\n *\n * @return {Object}\n */\nBpmnSpaceTool.prototype.calculateAdjustments = function(elements, axis, delta, start) {\n\n  var canvasRoot = this._canvas.getRootElement(),\n      spaceRoot = elements[0] === canvasRoot ? null : elements[0],\n      enclosedArtifacts = [];\n\n  // ensure\n  if (spaceRoot) {\n    enclosedArtifacts = values(\n      getEnclosedElements(\n        canvasRoot.children.filter(\n          (child) => is(child, 'bpmn:Artifact')\n        ),\n        getBBox(spaceRoot)\n      )\n    );\n  }\n\n  const elementsToMove = [ ...elements, ...enclosedArtifacts ];\n\n  var adjustments = SpaceTool.prototype.calculateAdjustments.call(this, elementsToMove, axis, delta, start);\n\n  // do not resize:\n  //\n  // * text annotations (horizontally/vertically)\n  // * empty horizontal pools (vertically)\n  // * empty vertical pools (horizontally)\n  adjustments.resizingShapes = adjustments.resizingShapes.filter(function(shape) {\n\n    if (is(shape, 'bpmn:TextAnnotation')) {\n      return false;\n    }\n\n    if (isCollapsedPool(shape)) {\n      if (axis === 'y' && isHorizontal(shape) || axis === 'x' && !isHorizontal(shape)) {\n        return false;\n      }\n    }\n\n    return true;\n  });\n\n  return adjustments;\n};\n\n\n// helpers ///////////\n\nfunction isCollapsedPool(shape) {\n  return is(shape, 'bpmn:Participant') && !getBusinessObject(shape).processRef;\n}","import SpaceToolModule from 'diagram-js/lib/features/space-tool';\n\nimport BpmnSpaceTool from './BpmnSpaceTool';\n\nexport default {\n  __depends__: [ SpaceToolModule ],\n  spaceTool: [ 'type', BpmnSpaceTool ]\n};","import {\n  forEach,\n  filter\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nvar LOW_PRIORITY = 250,\n    HIGH_PRIORITY = 1400;\n\nimport {\n  add as collectionAdd,\n  indexOf as collectionIdx\n} from '../../util/Collections';\n\nimport { saveClear } from '../../util/Removal';\n\nimport CommandInterceptor from '../../command/CommandInterceptor';\n\n/**\n * @typedef {import('../../model/Types').Element} Element\n *\n * @typedef {import('didi').Injector} Injector\n *\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../modeling/Modeling').default} Modeling\n */\n\n/**\n * A handler that makes sure labels are properly moved with\n * their label targets.\n *\n * @param {Injector} injector\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function LabelSupport(injector, eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  var movePreview = injector.get('movePreview', false);\n\n  // remove labels from the collection that are being\n  // moved with other elements anyway\n  eventBus.on('shape.move.start', HIGH_PRIORITY, function(e) {\n\n    var context = e.context,\n        shapes = context.shapes,\n        validatedShapes = context.validatedShapes;\n\n    context.shapes = removeLabels(shapes);\n    context.validatedShapes = removeLabels(validatedShapes);\n  });\n\n  // add labels to visual's group\n  movePreview && eventBus.on('shape.move.start', LOW_PRIORITY, function(e) {\n\n    var context = e.context,\n        shapes = context.shapes;\n\n    var labels = [];\n\n    forEach(shapes, function(element) {\n\n      forEach(element.labels, function(label) {\n\n        if (!label.hidden && context.shapes.indexOf(label) === -1) {\n          labels.push(label);\n        }\n\n        if (element.labelTarget) {\n          labels.push(element);\n        }\n      });\n    });\n\n    forEach(labels, function(label) {\n      movePreview.makeDraggable(context, label, true);\n    });\n\n  });\n\n  // add all labels to move closure\n  this.preExecuted('elements.move', HIGH_PRIORITY, function(e) {\n    var context = e.context,\n        closure = context.closure,\n        enclosedElements = closure.enclosedElements;\n\n    var enclosedLabels = [];\n\n    // find labels that are not part of\n    // move closure yet and add them\n    forEach(enclosedElements, function(element) {\n      forEach(element.labels, function(label) {\n\n        if (!enclosedElements[label.id]) {\n          enclosedLabels.push(label);\n        }\n      });\n    });\n\n    closure.addAll(enclosedLabels);\n  });\n\n\n  this.preExecute([\n    'connection.delete',\n    'shape.delete'\n  ], function(e) {\n\n    var context = e.context,\n        element = context.connection || context.shape;\n\n    saveClear(element.labels, function(label) {\n      modeling.removeShape(label, { nested: true });\n    });\n  });\n\n\n  this.execute('shape.delete', function(e) {\n\n    var context = e.context,\n        shape = context.shape,\n        labelTarget = shape.labelTarget;\n\n    // unset labelTarget\n    if (labelTarget) {\n      context.labelTargetIndex = collectionIdx(labelTarget.labels, shape);\n      context.labelTarget = labelTarget;\n\n      shape.labelTarget = null;\n    }\n  });\n\n  this.revert('shape.delete', function(e) {\n\n    var context = e.context,\n        shape = context.shape,\n        labelTarget = context.labelTarget,\n        labelTargetIndex = context.labelTargetIndex;\n\n    // restore labelTarget\n    if (labelTarget) {\n      collectionAdd(labelTarget.labels, shape, labelTargetIndex);\n\n      shape.labelTarget = labelTarget;\n    }\n  });\n\n}\n\ninherits(LabelSupport, CommandInterceptor);\n\nLabelSupport.$inject = [\n  'injector',\n  'eventBus',\n  'modeling'\n];\n\n\n/**\n * Return a filtered list of elements that do not\n * contain attached elements with hosts being part\n * of the selection.\n *\n * @param {Element[]} elements\n *\n * @return {Element[]} filtered\n */\nfunction removeLabels(elements) {\n\n  return filter(elements, function(element) {\n\n    // filter out labels that are move together\n    // with their label targets\n    return elements.indexOf(element.labelTarget) === -1;\n  });\n}\n","import LabelSupport from './LabelSupport';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [ 'labelSupport' ],\n  labelSupport: [ 'type', LabelSupport ]\n};\n","import {\n  flatten,\n  filter,\n  forEach,\n  groupBy,\n  map,\n  unionBy\n} from 'min-dash';\n\nimport { saveClear } from '../../util/Removal';\n\nimport { getNewAttachShapeDelta } from '../../util/AttachUtil';\n\nimport inherits from 'inherits-browser';\n\nimport CommandInterceptor from '../../command/CommandInterceptor';\n\n/**\n * @typedef {import('didi').Injector} Injector\n *\n * @typedef {import('../../model/Types').Element} Element\n *\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../rules/Rules').default} Rules\n * @typedef {import('../modeling/Modeling').default} Modeling\n */\n\nvar LOW_PRIORITY = 251,\n    HIGH_PRIORITY = 1401;\n\nvar MARKER_ATTACH = 'attach-ok';\n\n\n/**\n * Adds the notion of attached elements to the modeler.\n *\n * Optionally depends on `diagram-js/lib/features/move` to render\n * the attached elements during move preview.\n *\n * Optionally depends on `diagram-js/lib/features/label-support`\n * to render attached labels during move preview.\n *\n * @param {Injector} injector\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {Rules} rules\n * @param {Modeling} modeling\n */\nexport default function AttachSupport(injector, eventBus, canvas, rules, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  var movePreview = injector.get('movePreview', false);\n\n\n  // remove all the attached elements from the shapes to be validated\n  // add all the attached shapes to the overall list of moved shapes\n  eventBus.on('shape.move.start', HIGH_PRIORITY, function(e) {\n\n    var context = e.context,\n        shapes = context.shapes,\n        validatedShapes = context.validatedShapes;\n\n    context.shapes = addAttached(shapes);\n\n    context.validatedShapes = removeAttached(validatedShapes);\n  });\n\n  // add attachers to the visual's group\n  movePreview && eventBus.on('shape.move.start', LOW_PRIORITY, function(e) {\n\n    var context = e.context,\n        shapes = context.shapes,\n        attachers = getAttachers(shapes);\n\n    forEach(attachers, function(attacher) {\n      movePreview.makeDraggable(context, attacher, true);\n\n      forEach(attacher.labels, function(label) {\n        movePreview.makeDraggable(context, label, true);\n      });\n    });\n  });\n\n  // add attach-ok marker to current host\n  movePreview && eventBus.on('shape.move.start', function(event) {\n    var context = event.context,\n        shapes = context.shapes;\n\n    if (shapes.length !== 1) {\n      return;\n    }\n\n    var shape = shapes[0];\n\n    var host = shape.host;\n\n    if (host) {\n      canvas.addMarker(host, MARKER_ATTACH);\n\n      eventBus.once([\n        'shape.move.out',\n        'shape.move.cleanup'\n      ], function() {\n        canvas.removeMarker(host, MARKER_ATTACH);\n      });\n    }\n  });\n\n  // add all attachers to move closure\n  this.preExecuted('elements.move', HIGH_PRIORITY, function(e) {\n    var context = e.context,\n        closure = context.closure,\n        shapes = context.shapes,\n        attachers = getAttachers(shapes);\n\n    forEach(attachers, function(attacher) {\n      closure.add(attacher, closure.topLevel[attacher.host.id]);\n    });\n  });\n\n  // perform the attaching after shapes are done moving\n  this.postExecuted('elements.move', function(e) {\n\n    var context = e.context,\n        shapes = context.shapes,\n        newHost = context.newHost,\n        attachers;\n\n    // only single elements can be attached\n    // multiply elements can be detached\n    if (newHost && shapes.length !== 1) {\n      return;\n    }\n\n    if (newHost) {\n      attachers = shapes;\n    } else {\n\n      // find attachers moved without host\n      attachers = filter(shapes, function(shape) {\n        var host = shape.host;\n\n        return isAttacher(shape) && !includes(shapes, host);\n      });\n    }\n\n    forEach(attachers, function(attacher) {\n      modeling.updateAttachment(attacher, newHost);\n    });\n  });\n\n  // ensure invalid attachment connections are removed\n  this.postExecuted('elements.move', function(e) {\n\n    var shapes = e.context.shapes;\n\n    forEach(shapes, function(shape) {\n\n      forEach(shape.attachers, function(attacher) {\n\n        // remove invalid outgoing connections\n        forEach(attacher.outgoing.slice(), function(connection) {\n          var allowed = rules.allowed('connection.reconnect', {\n            connection: connection,\n            source: connection.source,\n            target: connection.target\n          });\n\n          if (!allowed) {\n            modeling.removeConnection(connection);\n          }\n        });\n\n        // remove invalid incoming connections\n        forEach(attacher.incoming.slice(), function(connection) {\n          var allowed = rules.allowed('connection.reconnect', {\n            connection: connection,\n            source: connection.source,\n            target: connection.target\n          });\n\n          if (!allowed) {\n            modeling.removeConnection(connection);\n          }\n        });\n      });\n    });\n  });\n\n  this.postExecute('shape.create', function(e) {\n    var context = e.context,\n        shape = context.shape,\n        host = context.host;\n\n    if (host) {\n      modeling.updateAttachment(shape, host);\n    }\n  });\n\n  // update attachments if the host is replaced\n  this.postExecute('shape.replace', function(e) {\n\n    var context = e.context,\n        oldShape = context.oldShape,\n        newShape = context.newShape;\n\n    // move the attachers to the new host\n    saveClear(oldShape.attachers, function(attacher) {\n      var allowed = rules.allowed('elements.move', {\n        target: newShape,\n        shapes: [ attacher ]\n      });\n\n      if (allowed === 'attach') {\n        modeling.updateAttachment(attacher, newShape);\n      } else {\n        modeling.removeShape(attacher);\n      }\n    });\n\n    // move attachers if new host has different size\n    if (newShape.attachers.length) {\n\n      forEach(newShape.attachers, function(attacher) {\n        var delta = getNewAttachShapeDelta(attacher, oldShape, newShape);\n        modeling.moveShape(attacher, delta, attacher.parent);\n      });\n    }\n\n  });\n\n  // move shape on host resize\n  this.postExecute('shape.resize', function(event) {\n    var context = event.context,\n        shape = context.shape,\n        oldBounds = context.oldBounds,\n        newBounds = context.newBounds,\n        attachers = shape.attachers,\n        hints = context.hints || {};\n\n    if (hints.attachSupport === false) {\n      return;\n    }\n\n    forEach(attachers, function(attacher) {\n      var delta = getNewAttachShapeDelta(attacher, oldBounds, newBounds);\n\n      modeling.moveShape(attacher, delta, attacher.parent);\n\n      forEach(attacher.labels, function(label) {\n        modeling.moveShape(label, delta, label.parent);\n      });\n    });\n  });\n\n  // remove attachments\n  this.preExecute('shape.delete', function(event) {\n\n    var shape = event.context.shape;\n\n    saveClear(shape.attachers, function(attacher) {\n      modeling.removeShape(attacher);\n    });\n\n    if (shape.host) {\n      modeling.updateAttachment(shape, null);\n    }\n  });\n}\n\ninherits(AttachSupport, CommandInterceptor);\n\nAttachSupport.$inject = [\n  'injector',\n  'eventBus',\n  'canvas',\n  'rules',\n  'modeling'\n];\n\n\n/**\n * Return attachers of the given shapes\n *\n * @param {Element[]} shapes\n * @return {Element[]}\n */\nfunction getAttachers(shapes) {\n  return flatten(map(shapes, function(s) {\n    return s.attachers || [];\n  }));\n}\n\n/**\n * Return a combined list of elements and\n * attachers.\n *\n * @param {Element[]} elements\n * @return {Element[]} filtered\n */\nfunction addAttached(elements) {\n  var attachers = getAttachers(elements);\n\n  return unionBy('id', elements, attachers);\n}\n\n/**\n * Return a filtered list of elements that do not\n * contain attached elements with hosts being part\n * of the selection.\n *\n * @param {Element[]} elements\n *\n * @return {Element[]} filtered\n */\nfunction removeAttached(elements) {\n\n  var ids = groupBy(elements, 'id');\n\n  return filter(elements, function(element) {\n    while (element) {\n\n      // host in selection\n      if (element.host && ids[element.host.id]) {\n        return false;\n      }\n\n      element = element.parent;\n    }\n\n    return true;\n  });\n}\n\nfunction isAttacher(shape) {\n  return !!shape.host;\n}\n\nfunction includes(array, item) {\n  return array.indexOf(item) !== -1;\n}","import RulesModule from '../rules';\n\nimport AttachSupport from './AttachSupport';\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __depends__: [\n    RulesModule\n  ],\n  __init__: [ 'attachSupport' ],\n  attachSupport: [ 'type', AttachSupport ]\n};\n","import {\n  map,\n  assign,\n  pick\n} from 'min-dash';\n\nimport {\n  isAny\n} from './util/ModelingUtil';\n\nimport {\n  is\n} from '../../util/ModelUtil';\n\n/**\n * @typedef {import('../../model/Types').Moddle} Moddle\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n *\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n */\n\n/**\n * A factory for BPMN elements.\n *\n * @param {Moddle} moddle\n */\nexport default function BpmnFactory(moddle) {\n  this._model = moddle;\n}\n\nBpmnFactory.$inject = [ 'moddle' ];\n\n/**\n * @param {ModdleElement} element\n *\n * @return {boolean}\n */\nBpmnFactory.prototype._needsId = function(element) {\n  return isAny(element, [\n    'bpmn:RootElement',\n    'bpmn:FlowElement',\n    'bpmn:MessageFlow',\n    'bpmn:DataAssociation',\n    'bpmn:Artifact',\n    'bpmn:Participant',\n    'bpmn:Lane',\n    'bpmn:LaneSet',\n    'bpmn:Process',\n    'bpmn:Collaboration',\n    'bpmndi:BPMNShape',\n    'bpmndi:BPMNEdge',\n    'bpmndi:BPMNDiagram',\n    'bpmndi:BPMNPlane',\n    'bpmn:Property',\n    'bpmn:CategoryValue'\n  ]);\n};\n\n/**\n * @param {ModdleElement} element\n */\nBpmnFactory.prototype._ensureId = function(element) {\n  if (element.id) {\n    this._model.ids.claim(element.id, element);\n    return;\n  }\n\n  // generate semantic ids for elements\n  // bpmn:SequenceFlow -> SequenceFlow_ID\n  var prefix;\n\n  if (is(element, 'bpmn:Activity')) {\n    prefix = 'Activity';\n  } else if (is(element, 'bpmn:Event')) {\n    prefix = 'Event';\n  } else if (is(element, 'bpmn:Gateway')) {\n    prefix = 'Gateway';\n  } else if (isAny(element, [ 'bpmn:SequenceFlow', 'bpmn:MessageFlow' ])) {\n    prefix = 'Flow';\n  } else {\n    prefix = (element.$type || '').replace(/^[^:]*:/g, '');\n  }\n\n  prefix += '_';\n\n  if (!element.id && this._needsId(element)) {\n    element.id = this._model.ids.nextPrefixed(prefix, element);\n  }\n};\n\n/**\n * Create BPMN element.\n *\n * @param {string} type\n * @param {Object} [attrs]\n *\n * @return {ModdleElement}\n */\nBpmnFactory.prototype.create = function(type, attrs) {\n  var element = this._model.create(type, attrs || {});\n\n  this._ensureId(element);\n\n  return element;\n};\n\n/**\n * @return {ModdleElement}\n */\nBpmnFactory.prototype.createDiLabel = function() {\n  return this.create('bpmndi:BPMNLabel', {\n    bounds: this.createDiBounds()\n  });\n};\n\n/**\n * @param {ModdleElement} semantic\n * @param {Object} [attrs]\n * @return {ModdleElement}\n */\nBpmnFactory.prototype.createDiShape = function(semantic, attrs) {\n  return this.create('bpmndi:BPMNShape', assign({\n    bpmnElement: semantic,\n    bounds: this.createDiBounds()\n  }, attrs));\n};\n\n/**\n * @return {ModdleElement}\n */\nBpmnFactory.prototype.createDiBounds = function(bounds) {\n  return this.create('dc:Bounds', bounds);\n};\n\n/**\n * @param {Point[]} waypoints\n *\n * @return {ModdleElement[]}\n */\nBpmnFactory.prototype.createDiWaypoints = function(waypoints) {\n  var self = this;\n\n  return map(waypoints, function(pos) {\n    return self.createDiWaypoint(pos);\n  });\n};\n\n/**\n * @param {Point} point\n *\n * @return {ModdleElement}\n */\nBpmnFactory.prototype.createDiWaypoint = function(point) {\n  return this.create('dc:Point', pick(point, [ 'x', 'y' ]));\n};\n\n/**\n * @param {ModdleElement} semantic\n * @param {Object} [attrs]\n *\n * @return {ModdleElement}\n */\nBpmnFactory.prototype.createDiEdge = function(semantic, attrs) {\n  return this.create('bpmndi:BPMNEdge', assign({\n    bpmnElement: semantic,\n    waypoint: this.createDiWaypoints([])\n  }, attrs));\n};\n\n/**\n * @param {ModdleElement} semantic\n * @param {Object} [attrs]\n *\n * @return {ModdleElement}\n */\nBpmnFactory.prototype.createDiPlane = function(semantic, attrs) {\n  return this.create('bpmndi:BPMNPlane', assign({\n    bpmnElement: semantic\n  }, attrs));\n};\n","import {\n  assign,\n  forEach\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nimport {\n  add as collectionAdd,\n  remove as collectionRemove\n} from 'diagram-js/lib/util/Collections';\n\nimport {\n  getBusinessObject,\n  getDi,\n  is\n} from '../../util/ModelUtil';\n\nimport { isAny } from './util/ModelingUtil';\n\nimport {\n  getLabel,\n  isLabel,\n  isLabelExternal\n} from '../../util/LabelUtil';\n\nimport { isPlane } from '../../util/DrilldownUtil';\n\nimport { delta } from 'diagram-js/lib/util/PositionUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('./BpmnFactory').default} BpmnFactory\n * @typedef {import('diagram-js/lib/layout/CroppingConnectionDocking').default} CroppingConnectionDocking\n *\n * @typedef {import('../../model/Types').Connection} Connection\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n * @typedef {import('../../model/Types').Parent} Parent\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * A handler responsible for updating the underlying BPMN 2.0 XML & DI\n * once changes on the diagram happen.\n *\n * @param {EventBus} eventBus\n * @param {BpmnFactory} bpmnFactory\n * @param {CroppingConnectionDocking} connectionDocking\n */\nexport default function BpmnUpdater(\n    eventBus,\n    bpmnFactory,\n    connectionDocking\n) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  this._bpmnFactory = bpmnFactory;\n\n  var self = this;\n\n\n  // connection cropping //////////////////////\n\n  // crop connection ends during create/update\n  function cropConnection(e) {\n    var context = e.context,\n        hints = context.hints || {},\n        connection;\n\n    if (!context.cropped && hints.createElementsBehavior !== false) {\n      connection = context.connection;\n      connection.waypoints = connectionDocking.getCroppedWaypoints(connection);\n      context.cropped = true;\n    }\n  }\n\n  this.executed([\n    'connection.layout',\n    'connection.create'\n  ], cropConnection);\n\n  this.reverted([ 'connection.layout' ], function(e) {\n    delete e.context.cropped;\n  });\n\n\n\n  // BPMN + DI update //////////////////////\n\n\n  // update parent\n  function updateParent(e) {\n    var context = e.context;\n\n    self.updateParent(context.shape || context.connection, context.oldParent);\n  }\n\n  function reverseUpdateParent(e) {\n    var context = e.context;\n\n    var element = context.shape || context.connection,\n\n        // oldParent is the (old) new parent, because we are undoing\n        oldParent = context.parent || context.newParent;\n\n    self.updateParent(element, oldParent);\n  }\n\n  this.executed([\n    'shape.move',\n    'shape.create',\n    'shape.delete',\n    'connection.create',\n    'connection.move',\n    'connection.delete'\n  ], ifBpmn(updateParent));\n\n  this.reverted([\n    'shape.move',\n    'shape.create',\n    'shape.delete',\n    'connection.create',\n    'connection.move',\n    'connection.delete'\n  ], ifBpmn(reverseUpdateParent));\n\n  /*\n   * ## Updating Parent\n   *\n   * When morphing a Process into a Collaboration or vice-versa,\n   * make sure that both the *semantic* and *di* parent of each element\n   * is updated.\n   *\n   */\n  function updateRoot(event) {\n    var context = event.context,\n        oldRoot = context.oldRoot,\n        children = oldRoot.children;\n\n    forEach(children, function(child) {\n      if (is(child, 'bpmn:BaseElement')) {\n        self.updateParent(child);\n      }\n    });\n  }\n\n  this.executed([ 'canvas.updateRoot' ], updateRoot);\n  this.reverted([ 'canvas.updateRoot' ], updateRoot);\n\n\n  // update bounds\n  function updateBounds(e) {\n    var shape = e.context.shape;\n\n    if (!is(shape, 'bpmn:BaseElement')) {\n      return;\n    }\n\n    self.updateBounds(shape);\n  }\n\n  this.executed([ 'shape.move', 'shape.create', 'shape.resize' ], ifBpmn(function(event) {\n\n    // exclude labels because they're handled separately during shape.changed\n    if (event.context.shape.type === 'label') {\n      return;\n    }\n\n    updateBounds(event);\n  }));\n\n  this.reverted([ 'shape.move', 'shape.create', 'shape.resize' ], ifBpmn(function(event) {\n\n    // exclude labels because they're handled separately during shape.changed\n    if (event.context.shape.type === 'label') {\n      return;\n    }\n\n    updateBounds(event);\n  }));\n\n  // Handle labels separately. This is necessary, because the label bounds have to be updated\n  // every time its shape changes, not only on move, create and resize.\n  eventBus.on('shape.changed', function(event) {\n    if (event.element.type === 'label') {\n      updateBounds({ context: { shape: event.element } });\n    }\n  });\n\n  // attach / detach connection\n  function updateConnection(e) {\n    self.updateConnection(e.context);\n  }\n\n  this.executed([\n    'connection.create',\n    'connection.move',\n    'connection.delete',\n    'connection.reconnect'\n  ], ifBpmn(updateConnection));\n\n  this.reverted([\n    'connection.create',\n    'connection.move',\n    'connection.delete',\n    'connection.reconnect'\n  ], ifBpmn(updateConnection));\n\n\n  // update waypoints\n  function updateConnectionWaypoints(e) {\n    self.updateConnectionWaypoints(e.context.connection);\n  }\n\n  this.executed([\n    'connection.layout',\n    'connection.move',\n    'connection.updateWaypoints',\n  ], ifBpmn(updateConnectionWaypoints));\n\n  this.reverted([\n    'connection.layout',\n    'connection.move',\n    'connection.updateWaypoints',\n  ], ifBpmn(updateConnectionWaypoints));\n\n  // update conditional/default flows\n  this.executed('connection.reconnect', ifBpmn(function(event) {\n    var context = event.context,\n        connection = context.connection,\n        oldSource = context.oldSource,\n        newSource = context.newSource,\n        connectionBo = getBusinessObject(connection),\n        oldSourceBo = getBusinessObject(oldSource),\n        newSourceBo = getBusinessObject(newSource);\n\n    // remove condition from connection on reconnect to new source\n    // if new source can NOT have condional sequence flow\n    if (connectionBo.conditionExpression && !isAny(newSourceBo, [\n      'bpmn:Activity',\n      'bpmn:ExclusiveGateway',\n      'bpmn:InclusiveGateway'\n    ])) {\n      context.oldConditionExpression = connectionBo.conditionExpression;\n\n      delete connectionBo.conditionExpression;\n    }\n\n    // remove default from old source flow on reconnect to new source\n    // if source changed\n    if (oldSource !== newSource && oldSourceBo.default === connectionBo) {\n      context.oldDefault = oldSourceBo.default;\n\n      delete oldSourceBo.default;\n    }\n  }));\n\n  this.reverted('connection.reconnect', ifBpmn(function(event) {\n    var context = event.context,\n        connection = context.connection,\n        oldSource = context.oldSource,\n        newSource = context.newSource,\n        connectionBo = getBusinessObject(connection),\n        oldSourceBo = getBusinessObject(oldSource),\n        newSourceBo = getBusinessObject(newSource);\n\n    // add condition to connection on revert reconnect to new source\n    if (context.oldConditionExpression) {\n      connectionBo.conditionExpression = context.oldConditionExpression;\n    }\n\n    // add default to old source on revert reconnect to new source\n    if (context.oldDefault) {\n      oldSourceBo.default = context.oldDefault;\n\n      delete newSourceBo.default;\n    }\n  }));\n\n  // update attachments\n  function updateAttachment(e) {\n    self.updateAttachment(e.context);\n  }\n\n  this.executed([ 'element.updateAttachment' ], ifBpmn(updateAttachment));\n  this.reverted([ 'element.updateAttachment' ], ifBpmn(updateAttachment));\n\n\n  // update BPMNLabel\n  this.executed('element.updateLabel', ifBpmn(updateBPMNLabel));\n  this.reverted('element.updateLabel', ifBpmn(updateBPMNLabel));\n\n  function updateBPMNLabel(event) {\n    const { element } = event.context,\n          label = getLabel(element);\n    const di = getDi(element),\n          diLabel = di && di.get('label');\n\n    if (isLabelExternal(element) || isPlane(element)) {\n      return;\n    }\n\n    if (label && !diLabel) {\n      di.set('label', bpmnFactory.create('bpmndi:BPMNLabel'));\n    } else if (!label && diLabel) {\n      di.set('label', undefined);\n    }\n  }\n}\n\ninherits(BpmnUpdater, CommandInterceptor);\n\nBpmnUpdater.$inject = [\n  'eventBus',\n  'bpmnFactory',\n  'connectionDocking'\n];\n\n\n// implementation //////////////////////\n\n/**\n * @param { {\n *   shape: Shape;\n *   host: Shape;\n * } } context\n */\nBpmnUpdater.prototype.updateAttachment = function(context) {\n\n  var shape = context.shape,\n      businessObject = shape.businessObject,\n      host = shape.host;\n\n  businessObject.attachedToRef = host && host.businessObject;\n};\n\n/**\n * @param {Element} element\n * @param {Parent} oldParent\n */\nBpmnUpdater.prototype.updateParent = function(element, oldParent) {\n\n  // do not update BPMN 2.0 label parent\n  if (isLabel(element)) {\n    return;\n  }\n\n  // data stores in collaborations are handled separately by DataStoreBehavior\n  if (is(element, 'bpmn:DataStoreReference') &&\n      element.parent &&\n      is(element.parent, 'bpmn:Collaboration')) {\n    return;\n  }\n\n  var parentShape = element.parent;\n\n  var businessObject = element.businessObject,\n      di = getDi(element),\n      parentBusinessObject = parentShape && parentShape.businessObject,\n      parentDi = getDi(parentShape);\n\n  if (is(element, 'bpmn:FlowNode')) {\n    this.updateFlowNodeRefs(businessObject, parentBusinessObject, oldParent && oldParent.businessObject);\n  }\n\n  if (is(element, 'bpmn:DataOutputAssociation')) {\n    if (element.source) {\n      parentBusinessObject = element.source.businessObject;\n    } else {\n      parentBusinessObject = null;\n    }\n  }\n\n  if (is(element, 'bpmn:DataInputAssociation')) {\n    if (element.target) {\n      parentBusinessObject = element.target.businessObject;\n    } else {\n      parentBusinessObject = null;\n    }\n  }\n\n  this.updateSemanticParent(businessObject, parentBusinessObject);\n\n  if (is(element, 'bpmn:DataObjectReference') && businessObject.dataObjectRef) {\n    this.updateSemanticParent(businessObject.dataObjectRef, parentBusinessObject);\n  }\n\n  this.updateDiParent(di, parentDi);\n};\n\n/**\n * @param {Shape} shape\n */\nBpmnUpdater.prototype.updateBounds = function(shape) {\n\n  var di = getDi(shape),\n      embeddedLabelBounds = getEmbeddedLabelBounds(shape);\n\n  // update embedded label bounds if possible\n  if (embeddedLabelBounds) {\n    var embeddedLabelBoundsDelta = delta(embeddedLabelBounds, di.get('bounds'));\n\n    assign(embeddedLabelBounds, {\n      x: shape.x + embeddedLabelBoundsDelta.x,\n      y: shape.y + embeddedLabelBoundsDelta.y\n    });\n  }\n\n  var target = isLabel(shape) ? this._getLabel(di) : di;\n\n  var bounds = target.bounds;\n\n  if (!bounds) {\n    bounds = this._bpmnFactory.createDiBounds();\n    target.set('bounds', bounds);\n  }\n\n  assign(bounds, {\n    x: shape.x,\n    y: shape.y,\n    width: shape.width,\n    height: shape.height\n  });\n};\n\n/**\n * @param {ModdleElement} businessObject\n * @param {ModdleElement} newContainment\n * @param {ModdleElement} oldContainment\n */\nBpmnUpdater.prototype.updateFlowNodeRefs = function(businessObject, newContainment, oldContainment) {\n\n  if (oldContainment === newContainment) {\n    return;\n  }\n\n  var oldRefs, newRefs;\n\n  if (is (oldContainment, 'bpmn:Lane')) {\n    oldRefs = oldContainment.get('flowNodeRef');\n    collectionRemove(oldRefs, businessObject);\n  }\n\n  if (is(newContainment, 'bpmn:Lane')) {\n    newRefs = newContainment.get('flowNodeRef');\n    collectionAdd(newRefs, businessObject);\n  }\n};\n\n/**\n * @param {Connection} connection\n * @param {Element} newSource\n * @param {Element} newTarget\n */\nBpmnUpdater.prototype.updateDiConnection = function(connection, newSource, newTarget) {\n  var connectionDi = getDi(connection),\n      newSourceDi = getDi(newSource),\n      newTargetDi = getDi(newTarget);\n\n  if (connectionDi.sourceElement && connectionDi.sourceElement.bpmnElement !== getBusinessObject(newSource)) {\n    connectionDi.sourceElement = newSource && newSourceDi;\n  }\n\n  if (connectionDi.targetElement && connectionDi.targetElement.bpmnElement !== getBusinessObject(newTarget)) {\n    connectionDi.targetElement = newTarget && newTargetDi;\n  }\n\n};\n\n/**\n * @param {ModdleElement} di\n * @param {ModdleElement} parentDi\n */\nBpmnUpdater.prototype.updateDiParent = function(di, parentDi) {\n\n  if (parentDi && !is(parentDi, 'bpmndi:BPMNPlane')) {\n    parentDi = parentDi.$parent;\n  }\n\n  if (di.$parent === parentDi) {\n    return;\n  }\n\n  var planeElements = (parentDi || di.$parent).get('planeElement');\n\n  if (parentDi) {\n    planeElements.push(di);\n    di.$parent = parentDi;\n  } else {\n    collectionRemove(planeElements, di);\n    di.$parent = null;\n  }\n};\n\n/**\n * @param {ModdleElement} element\n *\n * @return {ModdleElement}\n */\nfunction getDefinitions(element) {\n  while (element && !is(element, 'bpmn:Definitions')) {\n    element = element.$parent;\n  }\n\n  return element;\n}\n\n/**\n * @param {ModdleElement} container\n *\n * @return {ModdleElement}\n */\nBpmnUpdater.prototype.getLaneSet = function(container) {\n\n  var laneSet, laneSets;\n\n  // bpmn:Lane\n  if (is(container, 'bpmn:Lane')) {\n    laneSet = container.childLaneSet;\n\n    if (!laneSet) {\n      laneSet = this._bpmnFactory.create('bpmn:LaneSet');\n      container.childLaneSet = laneSet;\n      laneSet.$parent = container;\n    }\n\n    return laneSet;\n  }\n\n  // bpmn:Participant\n  if (is(container, 'bpmn:Participant')) {\n    container = container.processRef;\n  }\n\n  // bpmn:FlowElementsContainer\n  laneSets = container.get('laneSets');\n  laneSet = laneSets[0];\n\n  if (!laneSet) {\n    laneSet = this._bpmnFactory.create('bpmn:LaneSet');\n    laneSet.$parent = container;\n    laneSets.push(laneSet);\n  }\n\n  return laneSet;\n};\n\n/**\n * @param {ModdleElement} businessObject\n * @param {ModdleElement} newParent\n * @param {ModdleElement} visualParent\n */\nBpmnUpdater.prototype.updateSemanticParent = function(businessObject, newParent, visualParent) {\n\n  var containment;\n\n  if (businessObject.$parent === newParent) {\n    return;\n  }\n\n  if (is(businessObject, 'bpmn:DataInput') || is(businessObject, 'bpmn:DataOutput')) {\n\n    if (is(newParent, 'bpmn:Participant') && 'processRef' in newParent) {\n      newParent = newParent.processRef;\n    }\n\n    // already in correct ioSpecification\n    if ('ioSpecification' in newParent && newParent.ioSpecification === businessObject.$parent) {\n      return;\n    }\n  }\n\n  if (is(businessObject, 'bpmn:Lane')) {\n\n    if (newParent) {\n      newParent = this.getLaneSet(newParent);\n    }\n\n    containment = 'lanes';\n  } else if (is(businessObject, 'bpmn:FlowElement')) {\n\n    if (newParent) {\n\n      if (is(newParent, 'bpmn:Participant')) {\n        newParent = newParent.processRef;\n      } else if (is(newParent, 'bpmn:Lane')) {\n        do {\n\n          // unwrap Lane -> LaneSet -> (Lane | FlowElementsContainer)\n          newParent = newParent.$parent.$parent;\n        } while (is(newParent, 'bpmn:Lane'));\n\n      }\n    }\n\n    containment = 'flowElements';\n\n  } else if (is(businessObject, 'bpmn:Artifact')) {\n\n    while (newParent &&\n           !is(newParent, 'bpmn:Process') &&\n           !is(newParent, 'bpmn:SubProcess') &&\n           !is(newParent, 'bpmn:Collaboration')) {\n\n      if (is(newParent, 'bpmn:Participant')) {\n        newParent = newParent.processRef;\n        break;\n      } else {\n        newParent = newParent.$parent;\n      }\n    }\n\n    containment = 'artifacts';\n  } else if (is(businessObject, 'bpmn:MessageFlow')) {\n    containment = 'messageFlows';\n  } else if (is(businessObject, 'bpmn:Participant')) {\n    containment = 'participants';\n\n    // make sure the participants process is properly attached / detached\n    // from the XML document\n\n    var process = businessObject.processRef,\n        definitions;\n\n    if (process) {\n      definitions = getDefinitions(businessObject.$parent || newParent);\n\n      if (businessObject.$parent) {\n        collectionRemove(definitions.get('rootElements'), process);\n        process.$parent = null;\n      }\n\n      if (newParent) {\n        collectionAdd(definitions.get('rootElements'), process);\n        process.$parent = definitions;\n      }\n    }\n  } else if (is(businessObject, 'bpmn:DataOutputAssociation')) {\n    containment = 'dataOutputAssociations';\n  } else if (is(businessObject, 'bpmn:DataInputAssociation')) {\n    containment = 'dataInputAssociations';\n  }\n\n  if (!containment) {\n    throw new Error(`no parent for <${ businessObject.id }> in <${ newParent.id }>`);\n  }\n\n  var children;\n\n  if (businessObject.$parent) {\n\n    // remove from old parent\n    children = businessObject.$parent.get(containment);\n    collectionRemove(children, businessObject);\n  }\n\n  if (!newParent) {\n    businessObject.$parent = null;\n  } else {\n\n    // add to new parent\n    children = newParent.get(containment);\n    children.push(businessObject);\n    businessObject.$parent = newParent;\n  }\n\n  if (visualParent) {\n    var diChildren = visualParent.get(containment);\n\n    collectionRemove(children, businessObject);\n\n    if (newParent) {\n\n      if (!diChildren) {\n        diChildren = [];\n        newParent.set(containment, diChildren);\n      }\n\n      diChildren.push(businessObject);\n    }\n  }\n};\n\n/**\n * @param {Connection} connection\n */\nBpmnUpdater.prototype.updateConnectionWaypoints = function(connection) {\n  var di = getDi(connection);\n\n  di.set('waypoint', this._bpmnFactory.createDiWaypoints(connection.waypoints));\n};\n\n/**\n * @param { {\n *   connection: Connection;\n *   parent: Parent;\n *   newParent: Parent;\n * } } context\n */\nBpmnUpdater.prototype.updateConnection = function(context) {\n  var connection = context.connection,\n      businessObject = getBusinessObject(connection),\n      newSource = connection.source,\n      newSourceBo = getBusinessObject(newSource),\n      newTarget = connection.target,\n      newTargetBo = getBusinessObject(connection.target),\n      visualParent;\n\n  if (!is(businessObject, 'bpmn:DataAssociation')) {\n\n    var inverseSet = is(businessObject, 'bpmn:SequenceFlow');\n\n    if (businessObject.sourceRef !== newSourceBo) {\n      if (inverseSet) {\n        collectionRemove(businessObject.sourceRef && businessObject.sourceRef.get('outgoing'), businessObject);\n\n        if (newSourceBo && newSourceBo.get('outgoing')) {\n          newSourceBo.get('outgoing').push(businessObject);\n        }\n      }\n\n      businessObject.sourceRef = newSourceBo;\n    }\n\n    if (businessObject.targetRef !== newTargetBo) {\n      if (inverseSet) {\n        collectionRemove(businessObject.targetRef && businessObject.targetRef.get('incoming'), businessObject);\n\n        if (newTargetBo && newTargetBo.get('incoming')) {\n          newTargetBo.get('incoming').push(businessObject);\n        }\n      }\n\n      businessObject.targetRef = newTargetBo;\n    }\n  } else if (is(businessObject, 'bpmn:DataInputAssociation')) {\n\n    // handle obnoxious isMsome sourceRef\n    businessObject.get('sourceRef')[0] = newSourceBo;\n\n    visualParent = context.parent || context.newParent || newTargetBo;\n\n    this.updateSemanticParent(businessObject, newTargetBo, visualParent);\n  } else if (is(businessObject, 'bpmn:DataOutputAssociation')) {\n    visualParent = context.parent || context.newParent || newSourceBo;\n\n    this.updateSemanticParent(businessObject, newSourceBo, visualParent);\n\n    // targetRef = new target\n    businessObject.targetRef = newTargetBo;\n  }\n\n  this.updateConnectionWaypoints(connection);\n\n  this.updateDiConnection(connection, newSource, newTarget);\n};\n\n\n// helpers //////////////////////\n\nBpmnUpdater.prototype._getLabel = function(di) {\n  if (!di.label) {\n    di.label = this._bpmnFactory.createDiLabel();\n  }\n\n  return di.label;\n};\n\n\n/**\n * Call function if shape or connection is BPMN element.\n *\n * @param  {Function} fn\n *\n * @return {Function}\n */\nfunction ifBpmn(fn) {\n\n  return function(event) {\n\n    var context = event.context,\n        element = context.shape || context.connection || context.element;\n\n    if (is(element, 'bpmn:BaseElement')) {\n      fn(event);\n    }\n  };\n}\n\n/**\n * Return dc:Bounds of bpmndi:BPMNLabel if exists.\n *\n * @param {Shape} shape\n *\n * @return {ModdleElement|undefined}\n */\nfunction getEmbeddedLabelBounds(shape) {\n  if (!is(shape, 'bpmn:Activity')) {\n    return;\n  }\n\n  var di = getDi(shape);\n\n  if (!di) {\n    return;\n  }\n\n  var label = di.get('label');\n\n  if (!label) {\n    return;\n  }\n\n  return label.get('bounds');\n}","import {\n  assign,\n  forEach,\n  has,\n  isDefined,\n  isObject,\n  omit\n} from 'min-dash';\n\nimport inherits from 'inherits-browser';\n\nimport {\n  getBusinessObject,\n  getDi,\n  is\n} from '../../util/ModelUtil';\n\nimport {\n  isAny\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  isExpanded\n} from '../../util/DiUtil';\n\nimport BaseElementFactory from 'diagram-js/lib/core/ElementFactory';\n\nimport {\n  DEFAULT_LABEL_SIZE\n} from '../../util/LabelUtil';\n\nimport {\n  ensureCompatDiRef\n} from '../../util/CompatibilityUtil';\n\n/**\n * @typedef {import('diagram-js/lib/util/Types').Dimensions} Dimensions\n *\n * @typedef {import('./BpmnFactory').default} BpmnFactory\n *\n * @typedef {import('../../model/Types').BpmnAttributes} BpmnAttributes\n * @typedef {import('../../model/Types').Connection} Connection\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Label} Label\n * @typedef {import('../../model/Types').Root} Root\n * @typedef {import('../../model/Types').Shape} Shape\n * @typedef {import('../../model/Types').Moddle} Moddle\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * A BPMN-specific element factory.\n *\n * @template {Connection} [T=Connection]\n * @template {Label} [U=Label]\n * @template {Root} [V=Root]\n * @template {Shape} [W=Shape]\n *\n * @extends {BaseElementFactory<T, U, V, W>}\n *\n * @param {BpmnFactory} bpmnFactory\n * @param {Moddle} moddle\n */\nexport default function ElementFactory(bpmnFactory, moddle) {\n  BaseElementFactory.call(this);\n\n  this._bpmnFactory = bpmnFactory;\n  this._moddle = moddle;\n}\n\ninherits(ElementFactory, BaseElementFactory);\n\nElementFactory.$inject = [\n  'bpmnFactory',\n  'moddle'\n];\n\nElementFactory.prototype._baseCreate = BaseElementFactory.prototype.create;\n\n/**\n * Create a root element.\n *\n * @overlord\n * @param {'root'} elementType\n * @param {Partial<Root> & Partial<BpmnAttributes>} [attrs]\n * @return {V}\n */\n\n/**\n * Create a shape.\n *\n * @overlord\n * @param {'shape'} elementType\n * @param {Partial<Shape> & Partial<BpmnAttributes>} [attrs]\n * @return {W}\n */\n\n/**\n * Create a connection.\n *\n * @overlord\n * @param {'connection'} elementType\n * @param {Partial<Connection> & Partial<BpmnAttributes>} [attrs]\n * @return {T}\n */\n\n/**\n * Create a label.\n *\n * @param {'label'} elementType\n * @param {Partial<Label> & Partial<BpmnAttributes>} [attrs]\n * @return {U}\n */\nElementFactory.prototype.create = function(elementType, attrs) {\n\n  // no special magic for labels,\n  // we assume their businessObjects have already been created\n  // and wired via attrs\n  if (elementType === 'label') {\n    var di = attrs.di || this._bpmnFactory.createDiLabel();\n    return this._baseCreate(elementType, assign({ type: 'label', di: di }, DEFAULT_LABEL_SIZE, attrs));\n  }\n\n  return this.createElement(elementType, attrs);\n};\n\n/**\n * Create a BPMN root element.\n *\n * @overlord\n * @param {'root'} elementType\n * @param {Partial<Root> & Partial<BpmnAttributes>} [attrs]\n * @return {V}\n */\n\n/**\n * Create a BPMN shape.\n *\n * @overlord\n * @param {'shape'} elementType\n * @param {Partial<Shape> & Partial<BpmnAttributes>} [attrs]\n * @return {W}\n */\n\n/**\n * Create a BPMN connection.\n *\n * @param {'connection'} elementType\n * @param {Partial<Connection> & Partial<BpmnAttributes>} [attrs]\n * @return {T}\n */\nElementFactory.prototype.createElement = function(elementType, attrs) {\n\n  attrs = assign({}, attrs || {});\n\n  var size;\n\n  var businessObject = attrs.businessObject,\n      di = attrs.di;\n\n  if (!businessObject) {\n    if (!attrs.type) {\n      throw new Error('no shape type specified');\n    }\n\n    businessObject = this._bpmnFactory.create(attrs.type);\n\n    ensureCompatDiRef(businessObject);\n  }\n\n  if (!isModdleDi(di)) {\n    var diAttrs = assign(\n      {},\n      di || {},\n      { id: businessObject.id + '_di' }\n    );\n\n    if (elementType === 'root') {\n      di = this._bpmnFactory.createDiPlane(businessObject, diAttrs);\n    } else if (elementType === 'connection') {\n      di = this._bpmnFactory.createDiEdge(businessObject, diAttrs);\n    } else {\n      di = this._bpmnFactory.createDiShape(businessObject, diAttrs);\n    }\n  }\n\n  if (is(businessObject, 'bpmn:Group')) {\n    attrs = assign({\n      isFrame: true\n    }, attrs);\n  }\n\n  attrs = applyAttributes(businessObject, attrs, [\n    'processRef',\n    'isInterrupting',\n    'associationDirection',\n    'isForCompensation'\n  ]);\n\n  if (attrs.isExpanded) {\n    attrs = applyAttribute(di, attrs, 'isExpanded');\n  }\n\n  if (isAny(businessObject, [ 'bpmn:Lane', 'bpmn:Participant' ])) {\n    attrs = applyAttribute(di, attrs, 'isHorizontal');\n  }\n\n  if (is(businessObject, 'bpmn:SubProcess')) {\n    attrs.collapsed = !isExpanded(businessObject, di);\n  }\n\n  if (is(businessObject, 'bpmn:ExclusiveGateway')) {\n    if (has(di, 'isMarkerVisible')) {\n      if (di.isMarkerVisible === undefined) {\n        di.isMarkerVisible = false;\n      }\n    } else {\n      di.isMarkerVisible = true;\n    }\n  }\n\n  if (isDefined(attrs.triggeredByEvent)) {\n    businessObject.triggeredByEvent = attrs.triggeredByEvent;\n    delete attrs.triggeredByEvent;\n  }\n\n  if (isDefined(attrs.cancelActivity)) {\n    businessObject.cancelActivity = attrs.cancelActivity;\n    delete attrs.cancelActivity;\n  }\n\n  var eventDefinitions,\n      newEventDefinition;\n\n  if (attrs.eventDefinitionType) {\n    eventDefinitions = businessObject.get('eventDefinitions') || [];\n    newEventDefinition = this._bpmnFactory.create(attrs.eventDefinitionType, attrs.eventDefinitionAttrs);\n\n    if (attrs.eventDefinitionType === 'bpmn:ConditionalEventDefinition') {\n      newEventDefinition.condition = this._bpmnFactory.create('bpmn:FormalExpression');\n    }\n\n    eventDefinitions.push(newEventDefinition);\n\n    newEventDefinition.$parent = businessObject;\n    businessObject.eventDefinitions = eventDefinitions;\n\n    delete attrs.eventDefinitionType;\n  }\n\n  size = this.getDefaultSize(businessObject, di);\n\n  attrs = assign({\n    id: businessObject.id\n  }, size, attrs, {\n    businessObject: businessObject,\n    di: di\n  });\n\n  return this._baseCreate(elementType, attrs);\n};\n\n/**\n * Get the default size of a diagram element.\n *\n * @param {Element} element The element.\n * @param {ModdleElement} di The DI.\n *\n * @return {Dimensions} Default width and height of the element.\n */\nElementFactory.prototype.getDefaultSize = function(element, di) {\n\n  var bo = getBusinessObject(element);\n  di = di || getDi(element);\n\n  if (is(bo, 'bpmn:SubProcess')) {\n    if (isExpanded(bo, di)) {\n      return { width: 350, height: 200 };\n    } else {\n      return { width: 100, height: 80 };\n    }\n  }\n\n  if (is(bo, 'bpmn:Task')) {\n    return { width: 100, height: 80 };\n  }\n\n  if (is(bo, 'bpmn:Gateway')) {\n    return { width: 50, height: 50 };\n  }\n\n  if (is(bo, 'bpmn:Event')) {\n    return { width: 36, height: 36 };\n  }\n\n  if (is(bo, 'bpmn:Participant')) {\n    var isHorizontalPool = di.isHorizontal === undefined || di.isHorizontal === true;\n    if (isExpanded(bo, di)) {\n      if (isHorizontalPool) {\n        return { width: 600, height: 250 };\n      }\n      return { width: 250, height: 600 };\n    } else {\n      if (isHorizontalPool) {\n        return { width: 400, height: 60 };\n      }\n      return { width: 60, height: 400 };\n    }\n  }\n\n  if (is(bo, 'bpmn:Lane')) {\n    return { width: 400, height: 100 };\n  }\n\n  if (is(bo, 'bpmn:DataObjectReference')) {\n    return { width: 36, height: 50 };\n  }\n\n  if (is(bo, 'bpmn:DataStoreReference')) {\n    return { width: 50, height: 50 };\n  }\n\n  if (is(bo, 'bpmn:TextAnnotation')) {\n    return { width: 100, height: 30 };\n  }\n\n  if (is(bo, 'bpmn:Group')) {\n    return { width: 300, height: 300 };\n  }\n\n  return { width: 100, height: 80 };\n};\n\n\n/**\n * Create participant.\n *\n * @param {boolean|Partial<Shape> & Partial<BpmnAttributes>} [attrs]\n * Attributes or whether the participant is expanded.\n *\n * @return {W} The created participant.\n */\nElementFactory.prototype.createParticipantShape = function(attrs) {\n\n  if (!isObject(attrs)) {\n    attrs = { isExpanded: attrs };\n  }\n\n  attrs = assign({ type: 'bpmn:Participant' }, attrs || {});\n\n  // participants are expanded by default\n  if (attrs.isExpanded !== false) {\n    attrs.processRef = this._bpmnFactory.create('bpmn:Process');\n  }\n\n  return this.createShape(attrs);\n};\n\n\n// helpers //////////////////////\n\n/**\n * Apply attributes from a map to the given element, remove attribute from the\n * map on application.\n *\n * @param {Element} element\n * @param {Object} attrs (in/out map of attributes)\n * @param {string[]} attributeNames name of attributes to apply\n *\n * @return {Object} changed attrs\n */\nfunction applyAttributes(element, attrs, attributeNames) {\n\n  forEach(attributeNames, function(property) {\n    attrs = applyAttribute(element, attrs, property);\n  });\n\n  return attrs;\n}\n\n/**\n * Apply named property to element and drain it from the attrs collection.\n *\n * @param {Element} element\n * @param {Object} attrs (in/out map of attributes)\n * @param {string} attributeName to apply\n *\n * @return {Object} changed attrs\n */\nfunction applyAttribute(element, attrs, attributeName) {\n  if (attrs[attributeName] === undefined) {\n    return attrs;\n  }\n\n  element[attributeName] = attrs[attributeName];\n\n  return omit(attrs, [ attributeName ]);\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nfunction isModdleDi(element) {\n  return isAny(element, [\n    'bpmndi:BPMNShape',\n    'bpmndi:BPMNEdge',\n    'bpmndi:BPMNDiagram',\n    'bpmndi:BPMNPlane',\n  ]);\n}\n","import {\n  reduce,\n  keys,\n  forEach\n} from 'min-dash';\n\nimport {\n  is,\n  getBusinessObject\n} from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n *\n * @typedef {import('../../../model/Types').Shape} Shape\n * @typedef {import('../../../model/Types').ModdleElement} ModdleElement\n */\n\n/**\n * @implements {CommandHandler}\n *\n * @param {ElementRegistry} elementRegistry\n */\nexport default function UpdateModdlePropertiesHandler(elementRegistry) {\n  this._elementRegistry = elementRegistry;\n}\n\nUpdateModdlePropertiesHandler.$inject = [ 'elementRegistry' ];\n\nUpdateModdlePropertiesHandler.prototype.execute = function(context) {\n\n  var element = context.element,\n      moddleElement = context.moddleElement,\n      properties = context.properties;\n\n  if (!moddleElement) {\n    throw new Error('<moddleElement> required');\n  }\n\n  // TODO(nikku): we need to ensure that ID properties\n  // are properly registered / unregistered via\n  // this._moddle.ids.assigned(id)\n  var changed = context.changed || this._getVisualReferences(moddleElement).concat(element);\n  var oldProperties = context.oldProperties || getModdleProperties(moddleElement, keys(properties));\n\n  setModdleProperties(moddleElement, properties);\n\n  context.oldProperties = oldProperties;\n  context.changed = changed;\n\n  return changed;\n};\n\nUpdateModdlePropertiesHandler.prototype.revert = function(context) {\n  var oldProperties = context.oldProperties,\n      moddleElement = context.moddleElement,\n      changed = context.changed;\n\n  setModdleProperties(moddleElement, oldProperties);\n\n  return changed;\n};\n\n/**\n * Return visual references of given moddle element within the diagram.\n *\n * @param {ModdleElement} moddleElement\n *\n * @return {Shape[]}\n */\nUpdateModdlePropertiesHandler.prototype._getVisualReferences = function(moddleElement) {\n\n  var elementRegistry = this._elementRegistry;\n\n  if (is(moddleElement, 'bpmn:DataObject')) {\n    return getAllDataObjectReferences(moddleElement, elementRegistry);\n  }\n\n  return [];\n};\n\n\n// helpers /////////////////\n\nfunction getModdleProperties(moddleElement, propertyNames) {\n  return reduce(propertyNames, function(result, key) {\n    result[key] = moddleElement.get(key);\n    return result;\n  }, {});\n}\n\nfunction setModdleProperties(moddleElement, properties) {\n  forEach(properties, function(value, key) {\n    moddleElement.set(key, value);\n  });\n}\n\nfunction getAllDataObjectReferences(dataObject, elementRegistry) {\n  return elementRegistry.filter(function(element) {\n    return (\n      is(element, 'bpmn:DataObjectReference') &&\n          getBusinessObject(element).dataObjectRef === dataObject\n    );\n  });\n}\n","import {\n  reduce,\n  keys,\n  forEach,\n  assign\n} from 'min-dash';\n\nimport {\n  getBusinessObject,\n  getDi\n} from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n * @typedef {import('diagram-js/lib/command/CommandStack').CommandContext} CommandContext\n *\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('../../../model/Types').Moddle} Moddle\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('../../../draw/TextRenderer').default} TextRenderer\n *\n * @typedef {import('../../../model/Types').Element} Element\n */\n\nvar DEFAULT_FLOW = 'default',\n    ID = 'id',\n    DI = 'di';\n\nvar NULL_DIMENSIONS = {\n  width: 0,\n  height: 0\n};\n\n/**\n * A handler that implements a BPMN 2.0 property update.\n *\n * This should be used to set simple properties on elements with\n * an underlying BPMN business object.\n *\n * Use respective diagram-js provided handlers if you would\n * like to perform automated modeling.\n *\n * @implements {CommandHandler}\n *\n * @param {ElementRegistry} elementRegistry\n * @param {Moddle} moddle\n * @param {Modeling} modeling\n * @param {TextRenderer} textRenderer\n */\nexport default function UpdatePropertiesHandler(\n    elementRegistry, moddle,\n    modeling, textRenderer) {\n\n  this._elementRegistry = elementRegistry;\n  this._moddle = moddle;\n  this._modeling = modeling;\n  this._textRenderer = textRenderer;\n}\n\nUpdatePropertiesHandler.$inject = [\n  'elementRegistry',\n  'moddle',\n  'modeling',\n  'textRenderer'\n];\n\n\n// api //////////////////////\n\n/**\n * Update a BPMN element's properties.\n *\n * @param { {\n *   element: Element;\n *   properties: Record<string, any>;\n * } & CommandContext } context\n *\n * @return {Element[]}\n */\nUpdatePropertiesHandler.prototype.execute = function(context) {\n\n  var element = context.element,\n      changed = [ element ];\n\n  if (!element) {\n    throw new Error('element required');\n  }\n\n  var elementRegistry = this._elementRegistry,\n      ids = this._moddle.ids;\n\n  var businessObject = element.businessObject,\n      properties = unwrapBusinessObjects(context.properties),\n      oldProperties = context.oldProperties || getProperties(element, properties);\n\n  if (isIdChange(properties, businessObject)) {\n    ids.unclaim(businessObject[ID]);\n\n    elementRegistry.updateId(element, properties[ID]);\n\n    ids.claim(properties[ID], businessObject);\n  }\n\n  // correctly indicate visual changes on default flow updates\n  if (DEFAULT_FLOW in properties) {\n\n    if (properties[DEFAULT_FLOW]) {\n      changed.push(elementRegistry.get(properties[DEFAULT_FLOW].id));\n    }\n\n    if (businessObject[DEFAULT_FLOW]) {\n      changed.push(elementRegistry.get(businessObject[DEFAULT_FLOW].id));\n    }\n  }\n\n  // update properties\n  setProperties(element, properties);\n\n  // store old values\n  context.oldProperties = oldProperties;\n  context.changed = changed;\n\n  // indicate changed on objects affected by the update\n  return changed;\n};\n\n\nUpdatePropertiesHandler.prototype.postExecute = function(context) {\n  var element = context.element,\n      label = element.label;\n\n  var text = label && getBusinessObject(label).name;\n\n  if (!text) {\n    return;\n  }\n\n  // get layouted text bounds and resize external\n  // external label accordingly\n  var newLabelBounds = this._textRenderer.getExternalLabelBounds(label, text);\n\n  this._modeling.resizeShape(label, newLabelBounds, NULL_DIMENSIONS);\n};\n\n/**\n * Revert updating a BPMN element's properties.\n *\n * @param { {\n *   element: Element;\n *   properties: Record<string, any>;\n *   oldProperties: Record<string, any>;\n * } & CommandContext } context\n *\n * @return {Element[]}\n */\nUpdatePropertiesHandler.prototype.revert = function(context) {\n\n  var element = context.element,\n      properties = context.properties,\n      oldProperties = context.oldProperties,\n      businessObject = element.businessObject,\n      elementRegistry = this._elementRegistry,\n      ids = this._moddle.ids;\n\n  // update properties\n  setProperties(element, oldProperties);\n\n  if (isIdChange(properties, businessObject)) {\n    ids.unclaim(properties[ID]);\n\n    elementRegistry.updateId(element, oldProperties[ID]);\n\n    ids.claim(oldProperties[ID], businessObject);\n  }\n\n  return context.changed;\n};\n\n\nfunction isIdChange(properties, businessObject) {\n  return ID in properties && properties[ID] !== businessObject[ID];\n}\n\n\nfunction getProperties(element, properties) {\n  var propertyNames = keys(properties),\n      businessObject = element.businessObject,\n      di = getDi(element);\n\n  return reduce(propertyNames, function(result, key) {\n\n    // handle DI separately\n    if (key !== DI) {\n      result[key] = businessObject.get(key);\n\n    } else {\n      result[key] = getDiProperties(di, keys(properties.di));\n    }\n\n    return result;\n  }, {});\n}\n\n\nfunction getDiProperties(di, propertyNames) {\n  return reduce(propertyNames, function(result, key) {\n    result[key] = di && di.get(key);\n\n    return result;\n  }, {});\n}\n\n\nfunction setProperties(element, properties) {\n  var businessObject = element.businessObject,\n      di = getDi(element);\n\n  forEach(properties, function(value, key) {\n\n    if (key !== DI) {\n      businessObject.set(key, value);\n    } else {\n\n      // only update, if di exists\n      if (di) {\n        setDiProperties(di, value);\n      }\n    }\n  });\n}\n\n\nfunction setDiProperties(di, properties) {\n  forEach(properties, function(value, key) {\n    di.set(key, value);\n  });\n}\n\n\nvar referencePropertyNames = [ 'default' ];\n\n/**\n * Make sure we unwrap the actual business object behind diagram element that\n * may have been passed as arguments.\n *\n * @param  {Record<string, any>} properties\n *\n * @return {Record<string, any>} unwrappedProps\n */\nfunction unwrapBusinessObjects(properties) {\n\n  var unwrappedProps = assign({}, properties);\n\n  referencePropertyNames.forEach(function(name) {\n    if (name in properties) {\n      unwrappedProps[name] = getBusinessObject(unwrappedProps[name]);\n    }\n  });\n\n  return unwrappedProps;\n}","import {\n  add as collectionAdd,\n  remove as collectionRemove\n} from 'diagram-js/lib/util/Collections';\n\nimport { getDi } from '../../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * @implements {CommandHandler}\n *\n * @param {Canvas} canvas\n * @param {Modeling} modeling\n */\nexport default function UpdateCanvasRootHandler(canvas, modeling) {\n  this._canvas = canvas;\n  this._modeling = modeling;\n}\n\nUpdateCanvasRootHandler.$inject = [\n  'canvas',\n  'modeling'\n];\n\n\nUpdateCanvasRootHandler.prototype.execute = function(context) {\n\n  var canvas = this._canvas;\n\n  var newRoot = context.newRoot,\n      newRootBusinessObject = newRoot.businessObject,\n      oldRoot = canvas.getRootElement(),\n      oldRootBusinessObject = oldRoot.businessObject,\n      bpmnDefinitions = oldRootBusinessObject.$parent,\n      diPlane = getDi(oldRoot);\n\n  // (1) replace process old <> new root\n  canvas.setRootElement(newRoot);\n  canvas.removeRootElement(oldRoot);\n\n  // (2) update root elements\n  collectionAdd(bpmnDefinitions.rootElements, newRootBusinessObject);\n  newRootBusinessObject.$parent = bpmnDefinitions;\n\n  collectionRemove(bpmnDefinitions.rootElements, oldRootBusinessObject);\n  oldRootBusinessObject.$parent = null;\n\n  // (3) wire di\n  oldRoot.di = null;\n\n  diPlane.bpmnElement = newRootBusinessObject;\n  newRoot.di = diPlane;\n\n  context.oldRoot = oldRoot;\n\n  // TODO(nikku): return changed elements?\n  // return [ newRoot, oldRoot ];\n  return [];\n};\n\n\nUpdateCanvasRootHandler.prototype.revert = function(context) {\n\n  var canvas = this._canvas;\n\n  var newRoot = context.newRoot,\n      newRootBusinessObject = newRoot.businessObject,\n      oldRoot = context.oldRoot,\n      oldRootBusinessObject = oldRoot.businessObject,\n      bpmnDefinitions = newRootBusinessObject.$parent,\n      diPlane = getDi(newRoot);\n\n  // (1) replace process old <> new root\n  canvas.setRootElement(oldRoot);\n  canvas.removeRootElement(newRoot);\n\n  // (2) update root elements\n  collectionRemove(bpmnDefinitions.rootElements, newRootBusinessObject);\n  newRootBusinessObject.$parent = null;\n\n  collectionAdd(bpmnDefinitions.rootElements, oldRootBusinessObject);\n  oldRootBusinessObject.$parent = bpmnDefinitions;\n\n  // (3) wire di\n  newRoot.di = null;\n\n  diPlane.bpmnElement = oldRootBusinessObject;\n  oldRoot.di = diPlane;\n\n  // TODO(nikku): return changed elements?\n  // return [ newRoot, oldRoot ];\n\n  return [];\n};","import {\n  filter\n} from 'min-dash';\n\nimport {\n  eachElement\n} from 'diagram-js/lib/util/Elements';\n\nimport {\n  getLanesRoot,\n  getChildLanes,\n  LANE_INDENTATION\n} from '../util/LaneUtil';\n\nimport {\n  isHorizontal\n} from '../../../util/DiUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('../../space-tool/BpmnSpaceTool').default} SpaceTool\n */\n\n/**\n * A handler that allows us to add a new lane\n * above or below an existing one.\n *\n * @implements {CommandHandler}\n *\n * @param {Modeling} modeling\n * @param {SpaceTool} spaceTool\n */\nexport default function AddLaneHandler(modeling, spaceTool) {\n  this._modeling = modeling;\n  this._spaceTool = spaceTool;\n}\n\nAddLaneHandler.$inject = [\n  'modeling',\n  'spaceTool'\n];\n\n\nAddLaneHandler.prototype.preExecute = function(context) {\n\n  var spaceTool = this._spaceTool,\n      modeling = this._modeling;\n\n  var shape = context.shape,\n      location = context.location;\n\n  var lanesRoot = getLanesRoot(shape);\n\n  var isRoot = lanesRoot === shape,\n      laneParent = isRoot ? shape : shape.parent;\n\n  var existingChildLanes = getChildLanes(laneParent);\n\n  var isHorizontalLane = isHorizontal(shape);\n\n  // never mix up horizontal/vertical lanes\n  if (isHorizontalLane) {\n    if (location === 'left') {\n      location = 'top';\n    } else if (location === 'right') {\n      location = 'bottom';\n    }\n  } else {\n    if (location === 'top') {\n      location = 'left';\n    } else if (location === 'bottom') {\n      location = 'right';\n    }\n  }\n\n  // (0) add a lane if we currently got none and are adding to root\n  if (!existingChildLanes.length) {\n    var siblingPosition = isHorizontalLane ? {\n      x: shape.x + LANE_INDENTATION,\n      y: shape.y,\n      width: shape.width - LANE_INDENTATION,\n      height: shape.height\n    } : {\n      x: shape.x,\n      y: shape.y + LANE_INDENTATION,\n      width: shape.width,\n      height: shape.height - LANE_INDENTATION\n    };\n\n    modeling.createShape(\n      {\n        type: 'bpmn:Lane',\n        isHorizontal: isHorizontalLane\n      },\n      siblingPosition,\n      laneParent\n    );\n  }\n\n  // (1) collect affected elements to create necessary space\n  var allAffected = [];\n\n  eachElement(lanesRoot, function(element) {\n    allAffected.push(element);\n\n    // handle element labels in the diagram root\n    if (element.label) {\n      allAffected.push(element.label);\n    }\n\n    if (element === shape) {\n      return [];\n    }\n\n    return filter(element.children, function(c) {\n      return c !== shape;\n    });\n  });\n\n  var offset,\n      lanePosition,\n      spacePos,\n      direction,\n      axis;\n\n  if (location === 'top') {\n    offset = -120;\n    lanePosition = shape.y;\n    spacePos = lanePosition + 10;\n    direction = 'n';\n    axis = 'y';\n  } else if (location === 'left') {\n    offset = -120;\n    lanePosition = shape.x;\n    spacePos = lanePosition + 10;\n    direction = 'w';\n    axis = 'x';\n  } else if (location === 'bottom') {\n    offset = 120;\n    lanePosition = shape.y + shape.height;\n    spacePos = lanePosition - 10;\n    direction = 's';\n    axis = 'y';\n  } else if (location === 'right') {\n    offset = 120;\n    lanePosition = shape.x + shape.width;\n    spacePos = lanePosition - 10;\n    direction = 'e';\n    axis = 'x';\n  }\n\n  var adjustments = spaceTool.calculateAdjustments(allAffected, axis, offset, spacePos);\n\n  var delta = isHorizontalLane ? { x: 0, y: offset } : { x: offset, y: 0 };\n\n  spaceTool.makeSpace(\n    adjustments.movingShapes,\n    adjustments.resizingShapes,\n    delta,\n    direction,\n    spacePos\n  );\n\n  // (2) create new lane at open space\n  var newLanePosition = isHorizontalLane ? {\n    x: shape.x + (isRoot ? LANE_INDENTATION : 0),\n    y: lanePosition - (location === 'top' ? 120 : 0),\n    width: shape.width - (isRoot ? LANE_INDENTATION : 0),\n    height: 120\n  } : {\n    x: lanePosition - (location === 'left' ? 120 : 0),\n    y: shape.y + (isRoot ? LANE_INDENTATION : 0),\n    width: 120,\n    height: shape.height - (isRoot ? LANE_INDENTATION : 0)\n  };\n\n  context.newLane = modeling.createShape(\n    {\n      type: 'bpmn:Lane',\n      isHorizontal: isHorizontalLane\n    },\n    newLanePosition,\n    laneParent\n  );\n};\n","import {\n  getChildLanes,\n  LANE_INDENTATION\n} from '../util/LaneUtil';\n\nimport {\n  isHorizontal\n} from '../../../util/DiUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * A handler that splits a lane into a number of sub-lanes,\n * creating new sub lanes, if necessary.\n *\n * @implements {CommandHandler}\n *\n * @param {Modeling} modeling\n */\nexport default function SplitLaneHandler(modeling) {\n  this._modeling = modeling;\n}\n\nSplitLaneHandler.$inject = [\n  'modeling'\n];\n\n\nSplitLaneHandler.prototype.preExecute = function(context) {\n\n  var modeling = this._modeling;\n\n  var shape = context.shape,\n      newLanesCount = context.count;\n\n  var childLanes = getChildLanes(shape),\n      existingLanesCount = childLanes.length;\n\n  if (existingLanesCount > newLanesCount) {\n    throw new Error(`more than <${ newLanesCount }> child lanes`);\n  }\n\n  var isHorizontalLane = isHorizontal(shape);\n\n  var laneBaseSize = isHorizontalLane ? shape.height : shape.width;\n  var newLanesSize = Math.round(laneBaseSize / newLanesCount);\n\n  // Iterate from first to last in child lane order,\n  // resizing existing lanes and creating new ones\n  // so that they split the parent proportionally.\n  //\n  // Due to rounding related errors, the last lane\n  // needs to take up all the remaining space.\n  var laneSize,\n      laneBounds,\n      newLaneAttrs,\n      idx;\n\n  for (idx = 0; idx < newLanesCount; idx++) {\n\n    // if last lane\n    if (idx === newLanesCount - 1) {\n      laneSize = laneBaseSize - (newLanesSize * idx);\n    } else {\n      laneSize = newLanesSize;\n    }\n\n    laneBounds = isHorizontalLane ? {\n      x: shape.x + LANE_INDENTATION,\n      y: shape.y + idx * newLanesSize,\n      width: shape.width - LANE_INDENTATION,\n      height: laneSize\n    } : {\n      x: shape.x + idx * newLanesSize,\n      y: shape.y + LANE_INDENTATION,\n      width: laneSize,\n      height: shape.height - LANE_INDENTATION\n    };\n\n    if (idx < existingLanesCount) {\n\n      // resize existing lane\n      modeling.resizeShape(childLanes[idx], laneBounds);\n    } else {\n\n      // create a new lane at position\n      newLaneAttrs = {\n        type: 'bpmn:Lane',\n        isHorizontal: isHorizontalLane\n      };\n\n      modeling.createShape(newLaneAttrs, laneBounds, shape);\n    }\n  }\n};\n","import { is } from '../../../util/ModelUtil';\n\nimport {\n  getLanesRoot,\n  computeLanesResize\n} from '../util/LaneUtil';\n\nimport {\n  eachElement\n} from 'diagram-js/lib/util/Elements';\n\nimport {\n  asTRBL\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  substractTRBL\n} from 'diagram-js/lib/features/resize/ResizeUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('../../space-tool/BpmnSpaceTool').default} SpaceTool\n *\n * @typedef {import('../../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n */\n\n/**\n * A handler that resizes a lane.\n *\n * @implements {CommandHandler}\n *\n * @param {Modeling} modeling\n * @param {SpaceTool} spaceTool\n */\nexport default function ResizeLaneHandler(modeling, spaceTool) {\n  this._modeling = modeling;\n  this._spaceTool = spaceTool;\n}\n\nResizeLaneHandler.$inject = [\n  'modeling',\n  'spaceTool'\n];\n\n\nResizeLaneHandler.prototype.preExecute = function(context) {\n\n  var shape = context.shape,\n      newBounds = context.newBounds,\n      balanced = context.balanced;\n\n  if (balanced !== false) {\n    this.resizeBalanced(shape, newBounds);\n  } else {\n    this.resizeSpace(shape, newBounds);\n  }\n};\n\n\n/**\n * Resize balanced, adjusting next / previous lane sizes.\n *\n * @param {Shape} shape\n * @param {Rect} newBounds\n */\nResizeLaneHandler.prototype.resizeBalanced = function(shape, newBounds) {\n\n  var modeling = this._modeling;\n\n  var resizeNeeded = computeLanesResize(shape, newBounds);\n\n  // resize the lane\n  modeling.resizeShape(shape, newBounds);\n\n  // resize other lanes as needed\n  resizeNeeded.forEach(function(r) {\n    modeling.resizeShape(r.shape, r.newBounds);\n  });\n};\n\n\n/**\n * Resize, making actual space and moving below / above elements.\n *\n * @param {Shape} shape\n * @param {Rect} newBounds\n */\nResizeLaneHandler.prototype.resizeSpace = function(shape, newBounds) {\n  var spaceTool = this._spaceTool;\n\n  var shapeTrbl = asTRBL(shape),\n      newTrbl = asTRBL(newBounds);\n\n  var trblDiff = substractTRBL(newTrbl, shapeTrbl);\n\n  var lanesRoot = getLanesRoot(shape);\n\n  var allAffected = [],\n      allLanes = [];\n\n  eachElement(lanesRoot, function(element) {\n    allAffected.push(element);\n\n    if (is(element, 'bpmn:Lane') || is(element, 'bpmn:Participant')) {\n      allLanes.push(element);\n    }\n\n    return element.children;\n  });\n\n  var change,\n      spacePos,\n      direction,\n      offset,\n      adjustments;\n\n  if (trblDiff.bottom || trblDiff.top) {\n\n    change = trblDiff.bottom || trblDiff.top;\n    spacePos = shape.y + (trblDiff.bottom ? shape.height : 0) + (trblDiff.bottom ? -10 : 10);\n    direction = trblDiff.bottom ? 's' : 'n';\n\n    offset = trblDiff.top > 0 || trblDiff.bottom < 0 ? -change : change;\n\n    adjustments = spaceTool.calculateAdjustments(allAffected, 'y', offset, spacePos);\n\n    spaceTool.makeSpace(adjustments.movingShapes, adjustments.resizingShapes, { x: 0, y: change }, direction);\n  }\n\n\n  if (trblDiff.left || trblDiff.right) {\n\n    change = trblDiff.right || trblDiff.left;\n    spacePos = shape.x + (trblDiff.right ? shape.width : 0) + (trblDiff.right ? -10 : 100);\n    direction = trblDiff.right ? 'e' : 'w';\n\n    offset = trblDiff.left > 0 || trblDiff.right < 0 ? -change : change;\n\n    adjustments = spaceTool.calculateAdjustments(allLanes, 'x', offset, spacePos);\n\n    spaceTool.makeSpace(adjustments.movingShapes, adjustments.resizingShapes, { x: change, y: 0 }, direction);\n  }\n};","import {\n  collectLanes,\n  getLanesRoot\n} from '../util/LaneUtil';\n\nimport {\n  is\n} from '../../../util/ModelUtil';\n\nimport {\n  add as collectionAdd,\n  remove as collectionRemove\n} from 'diagram-js/lib/util/Collections';\n\nimport {\n  asTRBL\n} from 'diagram-js/lib/layout/LayoutUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n *\n * @typedef {import('../../../model/Types').Shape} Shape\n */\n\nvar FLOW_NODE_REFS_ATTR = 'flowNodeRef',\n    LANES_ATTR = 'lanes';\n\n\n/**\n * A handler that updates lane refs on changed elements.\n *\n * @implements {CommandHandler}\n *\n * @param {ElementRegistry} elementRegistry\n */\nexport default function UpdateFlowNodeRefsHandler(elementRegistry) {\n  this._elementRegistry = elementRegistry;\n}\n\nUpdateFlowNodeRefsHandler.$inject = [\n  'elementRegistry'\n];\n\n/**\n * @param {Shape} flowNodeShapes\n * @param {Shape} laneShapes\n *\n * @return { {\n *   flowNode: Shape;\n *   add: Shape[];\n *   remove: Shape[];\n * }[] }\n */\nUpdateFlowNodeRefsHandler.prototype._computeUpdates = function(flowNodeShapes, laneShapes) {\n\n  var handledNodes = [];\n\n  var updates = [];\n\n  var participantCache = {};\n\n  var allFlowNodeShapes = [];\n\n  function isInLaneShape(element, laneShape) {\n\n    var laneTrbl = asTRBL(laneShape);\n\n    var elementMid = {\n      x: element.x + element.width / 2,\n      y: element.y + element.height / 2\n    };\n\n    return elementMid.x > laneTrbl.left &&\n           elementMid.x < laneTrbl.right &&\n           elementMid.y > laneTrbl.top &&\n           elementMid.y < laneTrbl.bottom;\n  }\n\n  function addFlowNodeShape(flowNodeShape) {\n    if (handledNodes.indexOf(flowNodeShape) === -1) {\n      allFlowNodeShapes.push(flowNodeShape);\n      handledNodes.push(flowNodeShape);\n    }\n  }\n\n  function getAllLaneShapes(flowNodeShape) {\n\n    var root = getLanesRoot(flowNodeShape);\n\n    if (!participantCache[root.id]) {\n      participantCache[root.id] = collectLanes(root);\n    }\n\n    return participantCache[root.id];\n  }\n\n  function getNewLanes(flowNodeShape) {\n    if (!flowNodeShape.parent) {\n      return [];\n    }\n\n    var allLaneShapes = getAllLaneShapes(flowNodeShape);\n\n    return allLaneShapes.filter(function(l) {\n      return isInLaneShape(flowNodeShape, l);\n    }).map(function(shape) {\n      return shape.businessObject;\n    });\n  }\n\n  laneShapes.forEach(function(laneShape) {\n    var root = getLanesRoot(laneShape);\n\n    if (!root || handledNodes.indexOf(root) !== -1) {\n      return;\n    }\n\n    var children = root.children.filter(function(c) {\n      return is(c, 'bpmn:FlowNode');\n    });\n\n    children.forEach(addFlowNodeShape);\n\n    handledNodes.push(root);\n  });\n\n  flowNodeShapes.forEach(addFlowNodeShape);\n\n\n  allFlowNodeShapes.forEach(function(flowNodeShape) {\n\n    var flowNode = flowNodeShape.businessObject;\n\n    var lanes = flowNode.get(LANES_ATTR),\n        remove = lanes.slice(),\n        add = getNewLanes(flowNodeShape);\n\n    updates.push({ flowNode: flowNode, remove: remove, add: add });\n  });\n\n  laneShapes.forEach(function(laneShape) {\n\n    var lane = laneShape.businessObject;\n\n    // lane got removed XX-)\n    if (!laneShape.parent) {\n      lane.get(FLOW_NODE_REFS_ATTR).forEach(function(flowNode) {\n        updates.push({ flowNode: flowNode, remove: [ lane ], add: [] });\n      });\n    }\n  });\n\n  return updates;\n};\n\nUpdateFlowNodeRefsHandler.prototype.execute = function(context) {\n\n  var updates = context.updates;\n\n  if (!updates) {\n    updates = context.updates = this._computeUpdates(context.flowNodeShapes, context.laneShapes);\n  }\n\n\n  updates.forEach(function(update) {\n\n    var flowNode = update.flowNode,\n        lanes = flowNode.get(LANES_ATTR);\n\n    // unwire old\n    update.remove.forEach(function(oldLane) {\n      collectionRemove(lanes, oldLane);\n      collectionRemove(oldLane.get(FLOW_NODE_REFS_ATTR), flowNode);\n    });\n\n    // wire new\n    update.add.forEach(function(newLane) {\n      collectionAdd(lanes, newLane);\n      collectionAdd(newLane.get(FLOW_NODE_REFS_ATTR), flowNode);\n    });\n  });\n\n  // TODO(nikku): return changed elements\n  // return [ ... ];\n\n  return [];\n};\n\n\nUpdateFlowNodeRefsHandler.prototype.revert = function(context) {\n\n  var updates = context.updates;\n\n  updates.forEach(function(update) {\n\n    var flowNode = update.flowNode,\n        lanes = flowNode.get(LANES_ATTR);\n\n    // unwire new\n    update.add.forEach(function(newLane) {\n      collectionRemove(lanes, newLane);\n      collectionRemove(newLane.get(FLOW_NODE_REFS_ATTR), flowNode);\n    });\n\n    // wire old\n    update.remove.forEach(function(oldLane) {\n      collectionAdd(lanes, oldLane);\n      collectionAdd(oldLane.get(FLOW_NODE_REFS_ATTR), flowNode);\n    });\n  });\n\n  // TODO(nikku): return changed elements\n  // return [ ... ];\n\n  return [];\n};\n","/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('../../../model/Types').Moddle} Moddle\n */\n\n/**\n * @implements {CommandHandler}\n *\n * @param {Moddle} moddle\n */\nexport default function IdClaimHandler(moddle) {\n  this._moddle = moddle;\n}\n\nIdClaimHandler.$inject = [ 'moddle' ];\n\n\nIdClaimHandler.prototype.execute = function(context) {\n  var ids = this._moddle.ids,\n      id = context.id,\n      element = context.element,\n      claiming = context.claiming;\n\n  if (claiming) {\n    ids.claim(id, element);\n  } else {\n    ids.unclaim(id);\n  }\n\n  return [];\n};\n\n/**\n * Command revert implementation.\n */\nIdClaimHandler.prototype.revert = function(context) {\n  var ids = this._moddle.ids,\n      id = context.id,\n      element = context.element,\n      claiming = context.claiming;\n\n  if (claiming) {\n    ids.unclaim(id);\n  } else {\n    ids.claim(id, element);\n  }\n\n  return [];\n};\n\n","import {\r\n  assign,\r\n  forEach,\r\n  isString,\r\n  pick\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getDi,\r\n  isAny\r\n} from '../../../util/ModelUtil';\r\n\r\nimport {\r\n  isLabel\r\n} from '../../../util/LabelUtil';\r\n\r\nimport { isConnection } from 'diagram-js/lib/util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\r\n *\r\n * @typedef {import('diagram-js/lib/command/CommandStack').default} CommandStack\r\n *\r\n * @typedef {import('../../../model/Types').ModdleElement} ModdleElement\r\n */\r\n\r\nvar DEFAULT_COLORS = {\r\n  fill: undefined,\r\n  stroke: undefined\r\n};\r\n\r\n/**\r\n * @implements {CommandHandler}\r\n *\r\n * @param {CommandStack} commandStack\r\n */\r\nexport default function SetColorHandler(commandStack) {\r\n  this._commandStack = commandStack;\r\n\r\n  this._normalizeColor = function(color) {\r\n\r\n    // Remove color for falsy values.\r\n    if (!color) {\r\n      return undefined;\r\n    }\r\n\r\n    if (isString(color)) {\r\n      var hexColor = colorToHex(color);\r\n\r\n      if (hexColor) {\r\n        return hexColor;\r\n      }\r\n    }\r\n\r\n    throw new Error(`invalid color value: ${ color }`);\r\n  };\r\n}\r\n\r\nSetColorHandler.$inject = [\r\n  'commandStack'\r\n];\r\n\r\n\r\nSetColorHandler.prototype.postExecute = function(context) {\r\n  var elements = context.elements,\r\n      colors = context.colors || DEFAULT_COLORS;\r\n\r\n  var self = this;\r\n\r\n  var di = {};\r\n\r\n  if ('fill' in colors) {\r\n    assign(di, {\r\n      'background-color': this._normalizeColor(colors.fill) });\r\n  }\r\n\r\n  if ('stroke' in colors) {\r\n    assign(di, {\r\n      'border-color': this._normalizeColor(colors.stroke) });\r\n  }\r\n\r\n  forEach(elements, function(element) {\r\n    var assignedDi = isConnection(element) ? pick(di, [ 'border-color' ]) : di,\r\n        elementDi = getDi(element);\r\n\r\n    // TODO @barmac: remove once we drop bpmn.io properties\r\n    ensureLegacySupport(assignedDi);\r\n\r\n    if (isLabel(element)) {\r\n\r\n      // set label colors as bpmndi:BPMNLabel#color\r\n      self._commandStack.execute('element.updateModdleProperties', {\r\n        element: element,\r\n        moddleElement: elementDi.label,\r\n        properties: {\r\n          color: di['border-color']\r\n        }\r\n      });\r\n    } else {\r\n\r\n      // ignore non-compliant di\r\n      if (!isAny(elementDi, [ 'bpmndi:BPMNEdge', 'bpmndi:BPMNShape' ])) {\r\n        return;\r\n      }\r\n\r\n      // set colors bpmndi:BPMNEdge or bpmndi:BPMNShape\r\n      self._commandStack.execute('element.updateProperties', {\r\n        element: element,\r\n        properties: {\r\n          di: assignedDi\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n};\r\n\r\n/**\r\n * Convert color from rgb(a)/hsl to hex. Returns `null` for unknown color names\r\n * and for colors with alpha less than 1.0. This depends on `<canvas>`\r\n * serialization of the `context.fillStyle`.\r\n * Cf. https://html.spec.whatwg.org/multipage/canvas.html#dom-context-2d-fillstyle\r\n *\r\n * @example\r\n *\r\n * ```javascript\r\n * colorToHex('fuchsia'); // \"#ff00ff\"\r\n *\r\n * colorToHex('rgba(1, 2, 3, 0.4)'); // null\r\n * ```\r\n *\r\n * @param {string} color\r\n *\r\n * @return {string|null}\r\n */\r\nfunction colorToHex(color) {\r\n  var context = document.createElement('canvas').getContext('2d');\r\n\r\n  // (0) Start with transparent to account for browser default values.\r\n  context.fillStyle = 'transparent';\r\n\r\n  // (1) Assign color so that it's serialized.\r\n  context.fillStyle = color;\r\n\r\n  // (2) Return null for non-hex serialization result.\r\n  return /^#[0-9a-fA-F]{6}$/.test(context.fillStyle) ? context.fillStyle : null;\r\n}\r\n\r\n/**\r\n * Add legacy properties if required.\r\n *\r\n * @param {ModdleElement} di\r\n */\r\nfunction ensureLegacySupport(di) {\r\n  if ('border-color' in di) {\r\n    di.stroke = di['border-color'];\r\n  }\r\n\r\n  if ('background-color' in di) {\r\n    di.fill = di['background-color'];\r\n  }\r\n}\r\n","import {\n  setLabel,\n  getLabel\n} from '../../../util/LabelUtil';\n\nimport {\n  getExternalLabelMid,\n  isLabelExternal,\n  hasExternalLabel,\n  isLabel\n} from '../../../util/LabelUtil';\n\nimport {\n  is\n} from '../../../util/ModelUtil';\n\nvar NULL_DIMENSIONS = {\n  width: 0,\n  height: 0\n};\n\n/**\n * @typedef {import('../../modeling/Modeling').default} Modeling\n * @typedef {import('../../../draw/TextRenderer').default} TextRenderer\n * @typedef {import('../../modeling/BpmnFactory').default} BpmnFactory\n *\n * @typedef {import('../../../model/Types').Element} Element\n */\n\n/**\n * A handler that updates the text of a BPMN element.\n *\n * @param {Modeling} modeling\n * @param {TextRenderer} textRenderer\n * @param {BpmnFactory} bpmnFactory\n */\nexport default function UpdateLabelHandler(modeling, textRenderer, bpmnFactory) {\n\n  /**\n   * Set the label and return the changed elements.\n   *\n   * Element parameter can be label itself or connection (i.e. sequence flow).\n   *\n   * @param {Element} element\n   * @param {string} text\n   */\n  function setText(element, text) {\n\n    // external label if present\n    var label = element.label || element;\n\n    var labelTarget = element.labelTarget || element;\n\n    setLabel(label, text, labelTarget !== label);\n\n    return [ label, labelTarget ];\n  }\n\n  function preExecute(ctx) {\n    var element = ctx.element,\n        businessObject = element.businessObject,\n        newLabel = ctx.newLabel;\n\n    if (!isLabel(element)\n        && isLabelExternal(element)\n        && !hasExternalLabel(element)\n        && !isEmptyText(newLabel)) {\n\n      // create label\n      var paddingTop = 7;\n\n      var labelCenter = getExternalLabelMid(element);\n\n      labelCenter = {\n        x: labelCenter.x,\n        y: labelCenter.y + paddingTop\n      };\n\n      modeling.createLabel(element, labelCenter, {\n        id: businessObject.id + '_label',\n        businessObject: businessObject,\n        di: element.di\n      });\n    }\n  }\n\n  function execute(ctx) {\n    ctx.oldLabel = getLabel(ctx.element);\n    return setText(ctx.element, ctx.newLabel);\n  }\n\n  function revert(ctx) {\n    return setText(ctx.element, ctx.oldLabel);\n  }\n\n  function postExecute(ctx) {\n    var element = ctx.element,\n        label = element.label || element,\n        newLabel = ctx.newLabel,\n        newBounds = ctx.newBounds,\n        hints = ctx.hints || {};\n\n    // ignore internal labels for elements except text annotations\n    if (!isLabel(label) && !is(label, 'bpmn:TextAnnotation')) {\n      return;\n    }\n\n    if (isLabel(label) && isEmptyText(newLabel)) {\n\n      if (hints.removeShape !== false) {\n        modeling.removeShape(label, { unsetLabel: false });\n      }\n\n      return;\n    }\n\n    var text = getLabel(element);\n\n    // resize element based on label _or_ pre-defined bounds\n    if (typeof newBounds === 'undefined') {\n      newBounds = textRenderer.getExternalLabelBounds(label, text);\n    }\n\n    // setting newBounds to false or _null_ will\n    // disable the postExecute resize operation\n    if (newBounds) {\n      modeling.resizeShape(label, newBounds, NULL_DIMENSIONS);\n    }\n  }\n\n  // API\n\n  this.preExecute = preExecute;\n  this.execute = execute;\n  this.revert = revert;\n  this.postExecute = postExecute;\n}\n\nUpdateLabelHandler.$inject = [\n  'modeling',\n  'textRenderer',\n  'bpmnFactory'\n];\n\n\n// helpers //////////\n\nfunction isEmptyText(label) {\n  return !label || !label.trim();\n}","import inherits from 'inherits-browser';\n\nimport BaseModeling from 'diagram-js/lib/features/modeling/Modeling';\n\nimport UpdateModdlePropertiesHandler from './cmd/UpdateModdlePropertiesHandler';\nimport UpdatePropertiesHandler from './cmd/UpdatePropertiesHandler';\nimport UpdateCanvasRootHandler from './cmd/UpdateCanvasRootHandler';\nimport AddLaneHandler from './cmd/AddLaneHandler';\nimport SplitLaneHandler from './cmd/SplitLaneHandler';\nimport ResizeLaneHandler from './cmd/ResizeLaneHandler';\nimport UpdateFlowNodeRefsHandler from './cmd/UpdateFlowNodeRefsHandler';\nimport IdClaimHandler from './cmd/IdClaimHandler';\nimport SetColorHandler from './cmd/SetColorHandler';\n\nimport UpdateLabelHandler from '../label-editing/cmd/UpdateLabelHandler';\n\n/**\n * @typedef {import('../rules/BpmnRules').default} BpmnRules\n * @typedef {import('diagram-js/lib/command/CommandStack').default} CommandStack\n * @typedef {import('./ElementFactory').default} ElementFactory\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n *\n * @typedef {import('diagram-js/lib/features/modeling/Modeling').ModelingHints} ModelingHints\n *\n * @typedef {import('../../model/Types').Connection} Connection\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Label} Label\n * @typedef {import('../../model/Types').Parent} Parent\n * @typedef {import('../../model/Types').Root} Root\n * @typedef {import('../../model/Types').Shape} Shape\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n *\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n *\n * @typedef {import('../../util/Types').Colors} Colors\n *\n * @typedef { {\n *   removeShape?: boolean;\n * } } UpdateLabelHints\n */\n\n/**\n * The BPMN 2.0 modeling entry point.\n *\n * @template {Connection} [T=Connection]\n * @template {Element} [U=Element]\n * @template {Label} [V=Label]\n * @template {Parent} [W=Parent]\n * @template {Shape} [X=Shape]\n *\n * @extends {BaseModeling<T, U, V, W, X>}\n *\n * @param {EventBus} eventBus\n * @param {ElementFactory} elementFactory\n * @param {CommandStack} commandStack\n * @param {BpmnRules} bpmnRules\n */\nexport default function Modeling(\n    eventBus,\n    elementFactory,\n    commandStack,\n    bpmnRules\n) {\n\n  BaseModeling.call(this, eventBus, elementFactory, commandStack);\n\n  this._bpmnRules = bpmnRules;\n}\n\ninherits(Modeling, BaseModeling);\n\nModeling.$inject = [\n  'eventBus',\n  'elementFactory',\n  'commandStack',\n  'bpmnRules'\n];\n\n\nModeling.prototype.getHandlers = function() {\n  var handlers = BaseModeling.prototype.getHandlers.call(this);\n\n  handlers['element.updateModdleProperties'] = UpdateModdlePropertiesHandler;\n  handlers['element.updateProperties'] = UpdatePropertiesHandler;\n  handlers['canvas.updateRoot'] = UpdateCanvasRootHandler;\n  handlers['lane.add'] = AddLaneHandler;\n  handlers['lane.resize'] = ResizeLaneHandler;\n  handlers['lane.split'] = SplitLaneHandler;\n  handlers['lane.updateRefs'] = UpdateFlowNodeRefsHandler;\n  handlers['id.updateClaim'] = IdClaimHandler;\n  handlers['element.setColor'] = SetColorHandler;\n  handlers['element.updateLabel'] = UpdateLabelHandler;\n\n  return handlers;\n};\n\n/**\n * Update an element's label.\n *\n * @param {Element} element The element.\n * @param {string} newLabel The new label.\n * @param {Rect} [newBounds] The optional bounds of the label.\n * @param {UpdateLabelHints} [hints] The optional hints.\n */\nModeling.prototype.updateLabel = function(element, newLabel, newBounds, hints) {\n  this._commandStack.execute('element.updateLabel', {\n    element: element,\n    newLabel: newLabel,\n    newBounds: newBounds,\n    hints: hints || {}\n  });\n};\n\n/**\n * @param {Element} source\n * @param {Element} target\n * @param {Partial<Connection>} [attrs]\n * @param {ModelingHints} [hints]\n *\n * @return {T}\n */\nModeling.prototype.connect = function(source, target, attrs, hints) {\n\n  var bpmnRules = this._bpmnRules;\n\n  if (!attrs) {\n    attrs = bpmnRules.canConnect(source, target);\n  }\n\n  if (!attrs) {\n    return;\n  }\n\n  return this.createConnection(source, target, attrs, source.parent, hints);\n};\n\n/**\n * Update a model element's properties.\n *\n * @param {Element} element The element.\n * @param {ModdleElement} moddleElement The model element.\n * @param {Object} properties The updated properties.\n */\nModeling.prototype.updateModdleProperties = function(element, moddleElement, properties) {\n  this._commandStack.execute('element.updateModdleProperties', {\n    element: element,\n    moddleElement: moddleElement,\n    properties: properties\n  });\n};\n\n/**\n * Update an element's properties.\n *\n * @param {Element} element The element.\n * @param {Object} properties The updated properties.\n */\nModeling.prototype.updateProperties = function(element, properties) {\n  this._commandStack.execute('element.updateProperties', {\n    element: element,\n    properties: properties\n  });\n};\n\n/**\n * Resize a lane.\n *\n * @param {Shape} laneShape The lane.\n * @param {Rect} newBounds The new bounds of the lane.\n * @param {boolean} [balanced] Wether to resize neighboring lanes.\n */\nModeling.prototype.resizeLane = function(laneShape, newBounds, balanced) {\n  this._commandStack.execute('lane.resize', {\n    shape: laneShape,\n    newBounds: newBounds,\n    balanced: balanced\n  });\n};\n\n/**\n * Add a lane.\n *\n * @param {Shape} targetLaneShape The shape to add the lane to.\n * @param {string} location The location.\n *\n * @return {Shape} The added lane.\n */\nModeling.prototype.addLane = function(targetLaneShape, location) {\n  var context = {\n    shape: targetLaneShape,\n    location: location\n  };\n\n  this._commandStack.execute('lane.add', context);\n\n  return context.newLane;\n};\n\n/**\n * Split a lane.\n *\n * @param {Shape} targetLane The lane to split.\n * @param {number} count The number of lanes to split the lane into. Must not\n * exceed the number of existing lanes.\n */\nModeling.prototype.splitLane = function(targetLane, count) {\n  this._commandStack.execute('lane.split', {\n    shape: targetLane,\n    count: count\n  });\n};\n\n/**\n * Turn a process into a collaboration.\n *\n * @return {Root} The root of the collaboration.\n */\nModeling.prototype.makeCollaboration = function() {\n\n  var collaborationElement = this._create('root', {\n    type: 'bpmn:Collaboration'\n  });\n\n  var context = {\n    newRoot: collaborationElement\n  };\n\n  this._commandStack.execute('canvas.updateRoot', context);\n\n  return collaborationElement;\n};\n\n/**\n * Transform a collaboration into a process.\n *\n * @return {Root} The root of the process.\n */\nModeling.prototype.makeProcess = function() {\n\n  var processElement = this._create('root', {\n    type: 'bpmn:Process'\n  });\n\n  var context = {\n    newRoot: processElement\n  };\n\n  this._commandStack.execute('canvas.updateRoot', context);\n\n  return processElement;\n};\n\n/**\n * Update the referenced lanes of each flow node.\n *\n * @param {Shape[]} flowNodeShapes The flow nodes to update.\n * @param {Shape[]} laneShapes The lanes.\n */\nModeling.prototype.updateLaneRefs = function(flowNodeShapes, laneShapes) {\n\n  this._commandStack.execute('lane.updateRefs', {\n    flowNodeShapes: flowNodeShapes,\n    laneShapes: laneShapes\n  });\n};\n\n/**\n * Claim an ID.\n *\n * @param {string} id The ID to claim.\n * @param {ModdleElement} moddleElement The model element the ID is claimed for.\n */\nModeling.prototype.claimId = function(id, moddleElement) {\n  this._commandStack.execute('id.updateClaim', {\n    id: id,\n    element: moddleElement,\n    claiming: true\n  });\n};\n\n/**\n * Unclaim an ID.\n *\n * @param {string} id The ID to unclaim.\n * @param {ModdleElement} moddleElement The model element the ID is claimed for.\n */\nModeling.prototype.unclaimId = function(id, moddleElement) {\n  this._commandStack.execute('id.updateClaim', {\n    id: id,\n    element: moddleElement\n  });\n};\n\n/**\n * Set the color(s) of one or many elements.\n *\n * @param {Element[]} elements The elements to set the color(s) for.\n * @param {Colors} colors The color(s) to set.\n */\nModeling.prototype.setColor = function(elements, colors) {\n  if (!elements.length) {\n    elements = [ elements ];\n  }\n\n  this._commandStack.execute('element.setColor', {\n    elements: elements,\n    colors: colors\n  });\n};\n","import {\n  assign,\n  find,\n  isArray,\n  without\n} from 'min-dash';\n\nimport {\n  getOrientation,\n  getMid\n} from './LayoutUtil';\n\nimport {\n  pointInRect,\n  pointDistance,\n  pointsAligned,\n  pointsOnLine\n} from '../util/Geometry';\n\n/**\n * @typedef {import('../util/Types').Point} Point\n * @typedef {import('../util/Types').Rect} Rect\n */\n\nvar MIN_SEGMENT_LENGTH = 20,\n    POINT_ORIENTATION_PADDING = 5;\n\nvar round = Math.round;\n\nvar INTERSECTION_THRESHOLD = 20,\n    ORIENTATION_THRESHOLD = {\n      'h:h': 20,\n      'v:v': 20,\n      'h:v': -10,\n      'v:h': -10\n    };\n\nfunction needsTurn(orientation, startDirection) {\n  return !{\n    t: /top/,\n    r: /right/,\n    b: /bottom/,\n    l: /left/,\n    h: /./,\n    v: /./\n  }[startDirection].test(orientation);\n}\n\nfunction canLayoutStraight(direction, targetOrientation) {\n  return {\n    t: /top/,\n    r: /right/,\n    b: /bottom/,\n    l: /left/,\n    h: /left|right/,\n    v: /top|bottom/\n  }[direction].test(targetOrientation);\n}\n\nfunction getSegmentBendpoints(a, b, directions) {\n  var orientation = getOrientation(b, a, POINT_ORIENTATION_PADDING);\n\n  var startDirection = directions.split(':')[0];\n\n  var xmid = round((b.x - a.x) / 2 + a.x),\n      ymid = round((b.y - a.y) / 2 + a.y);\n\n  var segmentEnd, segmentDirections;\n\n  var layoutStraight = canLayoutStraight(startDirection, orientation),\n      layoutHorizontal = /h|r|l/.test(startDirection),\n      layoutTurn = false;\n\n  var turnNextDirections = false;\n\n  if (layoutStraight) {\n    segmentEnd = layoutHorizontal ? { x: xmid, y: a.y } : { x: a.x, y: ymid };\n\n    segmentDirections = layoutHorizontal ? 'h:h' : 'v:v';\n  } else {\n    layoutTurn = needsTurn(orientation, startDirection);\n\n    segmentDirections = layoutHorizontal ? 'h:v' : 'v:h';\n\n    if (layoutTurn) {\n\n      if (layoutHorizontal) {\n        turnNextDirections = ymid === a.y;\n\n        segmentEnd = {\n          x: a.x + MIN_SEGMENT_LENGTH * (/l/.test(startDirection) ? -1 : 1),\n          y: turnNextDirections ? ymid + MIN_SEGMENT_LENGTH : ymid\n        };\n      } else {\n        turnNextDirections = xmid === a.x;\n\n        segmentEnd = {\n          x: turnNextDirections ? xmid + MIN_SEGMENT_LENGTH : xmid,\n          y: a.y + MIN_SEGMENT_LENGTH * (/t/.test(startDirection) ? -1 : 1)\n        };\n      }\n\n    } else {\n      segmentEnd = {\n        x: xmid,\n        y: ymid\n      };\n    }\n  }\n\n  return {\n    waypoints: getBendpoints(a, segmentEnd, segmentDirections).concat(segmentEnd),\n    directions:  segmentDirections,\n    turnNextDirections: turnNextDirections\n  };\n}\n\nfunction getStartSegment(a, b, directions) {\n  return getSegmentBendpoints(a, b, directions);\n}\n\nfunction getEndSegment(a, b, directions) {\n  var invertedSegment = getSegmentBendpoints(b, a, invertDirections(directions));\n\n  return {\n    waypoints: invertedSegment.waypoints.slice().reverse(),\n    directions: invertDirections(invertedSegment.directions),\n    turnNextDirections: invertedSegment.turnNextDirections\n  };\n}\n\nfunction getMidSegment(startSegment, endSegment) {\n\n  var startDirection = startSegment.directions.split(':')[1],\n      endDirection = endSegment.directions.split(':')[0];\n\n  if (startSegment.turnNextDirections) {\n    startDirection = startDirection == 'h' ? 'v' : 'h';\n  }\n\n  if (endSegment.turnNextDirections) {\n    endDirection = endDirection == 'h' ? 'v' : 'h';\n  }\n\n  var directions = startDirection + ':' + endDirection;\n\n  var bendpoints = getBendpoints(\n    startSegment.waypoints[startSegment.waypoints.length - 1],\n    endSegment.waypoints[0],\n    directions\n  );\n\n  return {\n    waypoints: bendpoints,\n    directions: directions\n  };\n}\n\nfunction invertDirections(directions) {\n  return directions.split(':').reverse().join(':');\n}\n\n/**\n * Handle simple layouts with maximum two bendpoints.\n */\nfunction getSimpleBendpoints(a, b, directions) {\n\n  var xmid = round((b.x - a.x) / 2 + a.x),\n      ymid = round((b.y - a.y) / 2 + a.y);\n\n  // one point, right or left from a\n  if (directions === 'h:v') {\n    return [ { x: b.x, y: a.y } ];\n  }\n\n  // one point, above or below a\n  if (directions === 'v:h') {\n    return [ { x: a.x, y: b.y } ];\n  }\n\n  // vertical segment between a and b\n  if (directions === 'h:h') {\n    return [\n      { x: xmid, y: a.y },\n      { x: xmid, y: b.y }\n    ];\n  }\n\n  // horizontal segment between a and b\n  if (directions === 'v:v') {\n    return [\n      { x: a.x, y: ymid },\n      { x: b.x, y: ymid }\n    ];\n  }\n\n  throw new Error('invalid directions: can only handle varians of [hv]:[hv]');\n}\n\n\n/**\n * Returns the mid points for a manhattan connection between two points.\n *\n * @example h:h (horizontal:horizontal)\n *\n * [a]----[x]\n *         |\n *        [x]----[b]\n *\n * @example h:v (horizontal:vertical)\n *\n * [a]----[x]\n *         |\n *        [b]\n *\n * @example h:r (horizontal:right)\n *\n * [a]----[x]\n *         |\n *    [b]-[x]\n *\n * @param {Point} a\n * @param {Point} b\n * @param {string} directions\n *\n * @return {Point[]}\n */\nfunction getBendpoints(a, b, directions) {\n  directions = directions || 'h:h';\n\n  if (!isValidDirections(directions)) {\n    throw new Error(\n      'unknown directions: <' + directions + '>: ' +\n      'must be specified as <start>:<end> ' +\n      'with start/end in { h,v,t,r,b,l }'\n    );\n  }\n\n  // compute explicit directions, involving trbl dockings\n  // using a three segmented layouting algorithm\n  if (isExplicitDirections(directions)) {\n    var startSegment = getStartSegment(a, b, directions),\n        endSegment = getEndSegment(a, b, directions),\n        midSegment = getMidSegment(startSegment, endSegment);\n\n    return [].concat(\n      startSegment.waypoints,\n      midSegment.waypoints,\n      endSegment.waypoints\n    );\n  }\n\n  // handle simple [hv]:[hv] cases that can be easily computed\n  return getSimpleBendpoints(a, b, directions);\n}\n\n/**\n * Create a connection between the two points according\n * to the manhattan layout (only horizontal and vertical) edges.\n *\n * @param {Point} a\n * @param {Point} b\n * @param {string} [directions='h:h'] Specifies manhattan directions for each\n * point as {direction}:{direction}. A direction for a point is either\n * `h` (horizontal) or `v` (vertical).\n *\n * @return {Point[]}\n */\nexport function connectPoints(a, b, directions) {\n\n  var points = getBendpoints(a, b, directions);\n\n  points.unshift(a);\n  points.push(b);\n\n  return withoutRedundantPoints(points);\n}\n\n\n/**\n * Connect two rectangles using a manhattan layouted connection.\n *\n * @param {Rect} source source rectangle\n * @param {Rect} target target rectangle\n * @param {Point} [start] source docking\n * @param {Point} [end] target docking\n * @param {Object} [hints]\n * @param {string} [hints.preserveDocking=source] preserve docking on selected side\n * @param {string[]} [hints.preferredLayouts]\n * @param {Point|boolean} [hints.connectionStart] whether the start changed\n * @param {Point|boolean} [hints.connectionEnd] whether the end changed\n *\n * @return {Point[]} connection points\n */\nexport function connectRectangles(source, target, start, end, hints) {\n\n  var preferredLayouts = hints && hints.preferredLayouts || [];\n\n  var preferredLayout = without(preferredLayouts, 'straight')[0] || 'h:h';\n\n  var threshold = ORIENTATION_THRESHOLD[preferredLayout] || 0;\n\n  var orientation = getOrientation(source, target, threshold);\n\n  var directions = getDirections(orientation, preferredLayout);\n\n  start = start || getMid(source);\n  end = end || getMid(target);\n\n  var directionSplit = directions.split(':');\n\n  // compute actual docking points for start / end\n  // this ensures we properly layout only parts of the\n  // connection that lies in between the two rectangles\n  var startDocking = getDockingPoint(start, source, directionSplit[0], invertOrientation(orientation)),\n      endDocking = getDockingPoint(end, target, directionSplit[1], orientation);\n\n  return connectPoints(startDocking, endDocking, directions);\n}\n\n\n/**\n * Repair the connection between two rectangles, of which one has been updated.\n *\n * @param {Rect} source\n * @param {Rect} target\n * @param {Point} [start]\n * @param {Point} [end]\n * @param {Point[]} [waypoints]\n * @param {Object} [hints]\n * @param {string[]} [hints.preferredLayouts] The list of preferred layouts.\n * @param {boolean} [hints.connectionStart]\n * @param {boolean} [hints.connectionEnd]\n *\n * @return {Point[]} The waypoints of the repaired connection.\n */\nexport function repairConnection(source, target, start, end, waypoints, hints) {\n\n  if (isArray(start)) {\n    waypoints = start;\n    hints = end;\n\n    start = getMid(source);\n    end = getMid(target);\n  }\n\n  hints = assign({ preferredLayouts: [] }, hints);\n  waypoints = waypoints || [];\n\n  var preferredLayouts = hints.preferredLayouts,\n      preferStraight = preferredLayouts.indexOf('straight') !== -1,\n      repairedWaypoints;\n\n  // just layout non-existing or simple connections\n  // attempt to render straight lines, if required\n\n  // attempt to layout a straight line\n  repairedWaypoints = preferStraight && tryLayoutStraight(source, target, start, end, hints);\n\n  if (repairedWaypoints) {\n    return repairedWaypoints;\n  }\n\n  // try to layout from end\n  repairedWaypoints = hints.connectionEnd && tryRepairConnectionEnd(target, source, end, waypoints);\n\n  if (repairedWaypoints) {\n    return repairedWaypoints;\n  }\n\n  // try to layout from start\n  repairedWaypoints = hints.connectionStart && tryRepairConnectionStart(source, target, start, waypoints);\n\n  if (repairedWaypoints) {\n    return repairedWaypoints;\n  }\n\n  // or whether nothing seems to have changed\n  if (!hints.connectionStart && !hints.connectionEnd && waypoints && waypoints.length) {\n    return waypoints;\n  }\n\n  // simply reconnect if nothing else worked\n  return connectRectangles(source, target, start, end, hints);\n}\n\n\nfunction inRange(a, start, end) {\n  return a >= start && a <= end;\n}\n\nfunction isInRange(axis, a, b) {\n  var size = {\n    x: 'width',\n    y: 'height'\n  };\n\n  return inRange(a[axis], b[axis], b[axis] + b[size[axis]]);\n}\n\n/**\n * Lay out a straight connection.\n *\n * @param {Rect} source\n * @param {Rect} target\n * @param {Point} start\n * @param {Point} end\n * @param {Object} [hints]\n * @param {string} [hints.preserveDocking]\n *\n * @return {Point[]|null} The waypoints or null if layout isn't possible.\n */\nexport function tryLayoutStraight(source, target, start, end, hints) {\n  var axis = {},\n      primaryAxis,\n      orientation;\n\n  orientation = getOrientation(source, target);\n\n  // only layout a straight connection if shapes are\n  // horizontally or vertically aligned\n  if (!/^(top|bottom|left|right)$/.test(orientation)) {\n    return null;\n  }\n\n  if (/top|bottom/.test(orientation)) {\n    primaryAxis = 'x';\n  }\n\n  if (/left|right/.test(orientation)) {\n    primaryAxis = 'y';\n  }\n\n  if (hints.preserveDocking === 'target') {\n\n    if (!isInRange(primaryAxis, end, source)) {\n      return null;\n    }\n\n    axis[primaryAxis] = end[primaryAxis];\n\n    return [\n      {\n        x: axis.x !== undefined ? axis.x : start.x,\n        y: axis.y !== undefined ? axis.y : start.y,\n        original: {\n          x: axis.x !== undefined ? axis.x : start.x,\n          y: axis.y !== undefined ? axis.y : start.y\n        }\n      },\n      {\n        x: end.x,\n        y: end.y\n      }\n    ];\n\n  } else {\n\n    if (!isInRange(primaryAxis, start, target)) {\n      return null;\n    }\n\n    axis[primaryAxis] = start[primaryAxis];\n\n    return [\n      {\n        x: start.x,\n        y: start.y\n      },\n      {\n        x: axis.x !== undefined ? axis.x : end.x,\n        y: axis.y !== undefined ? axis.y : end.y,\n        original: {\n          x: axis.x !== undefined ? axis.x : end.x,\n          y: axis.y !== undefined ? axis.y : end.y\n        }\n      }\n    ];\n  }\n\n}\n\n/**\n * Repair a connection from start.\n *\n * @param {Rect} moved\n * @param {Rect} other\n * @param {Point} newDocking\n * @param {Point[]} points originalPoints from moved to other\n *\n * @return {Point[]|null} The waypoints of the repaired connection.\n */\nfunction tryRepairConnectionStart(moved, other, newDocking, points) {\n  return _tryRepairConnectionSide(moved, other, newDocking, points);\n}\n\n/**\n * Repair a connection from end.\n *\n * @param {Rect} moved\n * @param {Rect} other\n * @param {Point} newDocking\n * @param {Point[]} points originalPoints from moved to other\n *\n * @return {Point[]|null} The waypoints of the repaired connection.\n */\nfunction tryRepairConnectionEnd(moved, other, newDocking, points) {\n  var waypoints = points.slice().reverse();\n\n  waypoints = _tryRepairConnectionSide(moved, other, newDocking, waypoints);\n\n  return waypoints ? waypoints.reverse() : null;\n}\n\n/**\n * Repair a connection from one side that moved.\n *\n * @param {Rect} moved\n * @param {Rect} other\n * @param {Point} newDocking\n * @param {Point[]} points originalPoints from moved to other\n *\n * @return {Point[]} The waypoints of the repaired connection.\n */\nfunction _tryRepairConnectionSide(moved, other, newDocking, points) {\n\n  function needsRelayout(points) {\n    if (points.length < 3) {\n      return true;\n    }\n\n    if (points.length > 4) {\n      return false;\n    }\n\n    // relayout if two points overlap\n    // this is most likely due to\n    return !!find(points, function(p, idx) {\n      var q = points[idx - 1];\n\n      return q && pointDistance(p, q) < 3;\n    });\n  }\n\n  function repairBendpoint(candidate, oldPeer, newPeer) {\n\n    var alignment = pointsAligned(oldPeer, candidate);\n\n    switch (alignment) {\n    case 'v':\n\n      // repair horizontal alignment\n      return { x: newPeer.x, y: candidate.y };\n    case 'h':\n\n      // repair vertical alignment\n      return { x: candidate.x, y: newPeer.y };\n    }\n\n    return { x: candidate.x, y: candidate. y };\n  }\n\n  function removeOverlapping(points, a, b) {\n    var i;\n\n    for (i = points.length - 2; i !== 0; i--) {\n\n      // intersects (?) break, remove all bendpoints up to this one and relayout\n      if (pointInRect(points[i], a, INTERSECTION_THRESHOLD) ||\n          pointInRect(points[i], b, INTERSECTION_THRESHOLD)) {\n\n        // return sliced old connection\n        return points.slice(i);\n      }\n    }\n\n    return points;\n  }\n\n  // (0) only repair what has layoutable bendpoints\n\n  // (1) if only one bendpoint and on shape moved onto other shapes axis\n  //     (horizontally / vertically), relayout\n\n  if (needsRelayout(points)) {\n    return null;\n  }\n\n  var oldDocking = points[0],\n      newPoints = points.slice(),\n      slicedPoints;\n\n  // (2) repair only last line segment and only if it was layouted before\n\n  newPoints[0] = newDocking;\n  newPoints[1] = repairBendpoint(newPoints[1], oldDocking, newDocking);\n\n\n  // (3) if shape intersects with any bendpoint after repair,\n  //     remove all segments up to this bendpoint and repair from there\n  slicedPoints = removeOverlapping(newPoints, moved, other);\n\n  if (slicedPoints !== newPoints) {\n    newPoints = _tryRepairConnectionSide(moved, other, newDocking, slicedPoints);\n  }\n\n  // (4) do NOT repair if repaired bendpoints are aligned\n  if (newPoints && pointsAligned(newPoints)) {\n    return null;\n  }\n\n  return newPoints;\n}\n\n\n/**\n * Returns the manhattan directions connecting two rectangles\n * with the given orientation.\n *\n * Will always return the default layout, if it is specific\n * regarding sides already (trbl).\n *\n * @example\n *\n * ```javascript\n * getDirections('top'); // -> 'v:v'\n * getDirections('intersect'); // -> 't:t'\n *\n * getDirections('top-right', 'v:h'); // -> 'v:h'\n * getDirections('top-right', 'h:h'); // -> 'h:h'\n * ```\n *\n * @param {string} orientation\n * @param {string} defaultLayout\n *\n * @return {string}\n */\nfunction getDirections(orientation, defaultLayout) {\n\n  // don't override specific trbl directions\n  if (isExplicitDirections(defaultLayout)) {\n    return defaultLayout;\n  }\n\n  switch (orientation) {\n  case 'intersect':\n    return 't:t';\n\n  case 'top':\n  case 'bottom':\n    return 'v:v';\n\n  case 'left':\n  case 'right':\n    return 'h:h';\n\n  // 'top-left'\n  // 'top-right'\n  // 'bottom-left'\n  // 'bottom-right'\n  default:\n    return defaultLayout;\n  }\n}\n\nfunction isValidDirections(directions) {\n  return directions && /^h|v|t|r|b|l:h|v|t|r|b|l$/.test(directions);\n}\n\nfunction isExplicitDirections(directions) {\n  return directions && /t|r|b|l/.test(directions);\n}\n\nfunction invertOrientation(orientation) {\n  return {\n    'top': 'bottom',\n    'bottom': 'top',\n    'left': 'right',\n    'right': 'left',\n    'top-left': 'bottom-right',\n    'bottom-right': 'top-left',\n    'top-right': 'bottom-left',\n    'bottom-left': 'top-right',\n  }[orientation];\n}\n\nfunction getDockingPoint(point, rectangle, dockingDirection, targetOrientation) {\n\n  // ensure we end up with a specific docking direction\n  // based on the targetOrientation, if <h|v> is being passed\n\n  if (dockingDirection === 'h') {\n    dockingDirection = /left/.test(targetOrientation) ? 'l' : 'r';\n  }\n\n  if (dockingDirection === 'v') {\n    dockingDirection = /top/.test(targetOrientation) ? 't' : 'b';\n  }\n\n  if (dockingDirection === 't') {\n    return { original: point, x: point.x, y: rectangle.y };\n  }\n\n  if (dockingDirection === 'r') {\n    return { original: point, x: rectangle.x + rectangle.width, y: point.y };\n  }\n\n  if (dockingDirection === 'b') {\n    return { original: point, x: point.x, y: rectangle.y + rectangle.height };\n  }\n\n  if (dockingDirection === 'l') {\n    return { original: point, x: rectangle.x, y: point.y };\n  }\n\n  throw new Error('unexpected dockingDirection: <' + dockingDirection + '>');\n}\n\n\n/**\n * Return list of waypoints with redundant ones filtered out.\n *\n * @example\n *\n * Original points:\n *\n *   [x] ----- [x] ------ [x]\n *                         |\n *                        [x] ----- [x] - [x]\n *\n * Filtered:\n *\n *   [x] ---------------- [x]\n *                         |\n *                        [x] ----------- [x]\n *\n * @param {Point[]} waypoints\n *\n * @return {Point[]}\n */\nexport function withoutRedundantPoints(waypoints) {\n  return waypoints.reduce(function(points, p, idx) {\n\n    var previous = points[points.length - 1],\n        next = waypoints[idx + 1];\n\n    if (!pointsOnLine(previous, next, p, 0)) {\n      points.push(p);\n    }\n\n    return points;\n  }, []);\n}\n","import inherits from 'inherits-browser';\n\nimport {\n  assign\n} from 'min-dash';\n\nimport BaseLayouter from 'diagram-js/lib/layout/BaseLayouter';\n\nimport {\n  repairConnection,\n  withoutRedundantPoints\n} from 'diagram-js/lib/layout/ManhattanLayout';\n\nimport {\n  getMid,\n  getOrientation\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  isExpanded\n} from '../../util/DiUtil';\n\nimport { is } from '../../util/ModelUtil';\n\nimport { isDirectionHorizontal } from './util/ModelingUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n *\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n *\n * @typedef {import('../../model/Types').Connection} Connection\n * @typedef {import('../../model/Types').Element} Element\n *\n * @typedef {import('diagram-js/lib/layout/BaseLayouter').LayoutConnectionHints} LayoutConnectionHints\n *\n * @typedef { {\n *   source?: Element;\n *   target?: Element;\n *   waypoints?: Point[];\n *   connectionStart?: Point;\n *   connectionEnd?: Point;\n * } & LayoutConnectionHints } BpmnLayoutConnectionHints\n */\n\nvar ATTACH_ORIENTATION_PADDING = -10,\n    BOUNDARY_TO_HOST_THRESHOLD = 40;\n\n// layout all connection between flow elements h:h, except for\n// (1) outgoing of boundary events -> layout based on attach orientation and target orientation\n// (2) incoming/outgoing of gateways -> v:h for outgoing, h:v for incoming\n// (3) loops connect sides clockwise\nvar PREFERRED_LAYOUTS_HORIZONTAL = {\n  default: [ 'h:h' ],\n  fromGateway: [ 'v:h' ],\n  toGateway: [ 'h:v' ],\n  loop: {\n    fromTop: [ 't:r' ],\n    fromRight: [ 'r:b' ],\n    fromLeft: [ 'l:t' ],\n    fromBottom: [ 'b:l' ]\n  },\n  boundaryLoop: {\n    alternateHorizontalSide: 'b',\n    alternateVerticalSide: 'l',\n    default: 'v'\n  },\n  messageFlow: [ 'straight', 'v:v' ],\n  subProcess: [ 'straight', 'h:h' ],\n  isHorizontal: true\n};\n\n// for vertical layouts, switch h and v and loop counter-clockwise\nvar PREFERRED_LAYOUTS_VERTICAL = {\n  default: [ 'v:v' ],\n  fromGateway: [ 'h:v' ],\n  toGateway: [ 'v:h' ],\n  loop: {\n    fromTop: [ 't:l' ],\n    fromRight: [ 'r:t' ],\n    fromLeft: [ 'l:b' ],\n    fromBottom: [ 'b:r' ]\n  },\n  boundaryLoop: {\n    alternateHorizontalSide: 't',\n    alternateVerticalSide: 'r',\n    default: 'h'\n  },\n  messageFlow: [ 'straight', 'h:h' ],\n  subProcess: [ 'straight', 'v:v' ],\n  isHorizontal: false\n};\n\nvar oppositeOrientationMapping = {\n  'top': 'bottom',\n  'top-right': 'bottom-left',\n  'top-left': 'bottom-right',\n  'right': 'left',\n  'bottom': 'top',\n  'bottom-right': 'top-left',\n  'bottom-left': 'top-right',\n  'left': 'right'\n};\n\nvar orientationDirectionMapping = {\n  top: 't',\n  right: 'r',\n  bottom: 'b',\n  left: 'l'\n};\n\nexport default function BpmnLayouter(elementRegistry) {\n  this._elementRegistry = elementRegistry;\n}\n\ninherits(BpmnLayouter, BaseLayouter);\n\n/**\n * Returns waypoints of laid out connection.\n *\n * @param {Connection} connection\n * @param {BpmnLayoutConnectionHints} [hints]\n *\n * @return {Point[]}\n */\nBpmnLayouter.prototype.layoutConnection = function(connection, hints) {\n  if (!hints) {\n    hints = {};\n  }\n\n  var source = hints.source || connection.source,\n      target = hints.target || connection.target,\n      waypoints = hints.waypoints || connection.waypoints,\n      connectionStart = hints.connectionStart,\n      connectionEnd = hints.connectionEnd,\n      elementRegistry = this._elementRegistry;\n\n  var manhattanOptions,\n      updatedWaypoints;\n\n  if (!connectionStart) {\n    connectionStart = getConnectionDocking(waypoints && waypoints[ 0 ], source);\n  }\n\n  if (!connectionEnd) {\n    connectionEnd = getConnectionDocking(waypoints && waypoints[ waypoints.length - 1 ], target);\n  }\n\n  if (is(connection, 'bpmn:Association') ||\n      is(connection, 'bpmn:DataAssociation')) {\n\n    if (waypoints && !isCompensationAssociation(source, target)) {\n      return [].concat([ connectionStart ], waypoints.slice(1, -1), [ connectionEnd ]);\n    }\n  }\n\n  var layout = isDirectionHorizontal(source, elementRegistry) ? PREFERRED_LAYOUTS_HORIZONTAL : PREFERRED_LAYOUTS_VERTICAL;\n\n  if (is(connection, 'bpmn:MessageFlow')) {\n    manhattanOptions = getMessageFlowManhattanOptions(source, target, layout);\n  } else if (is(connection, 'bpmn:SequenceFlow') || isCompensationAssociation(source, target)) {\n\n    if (source === target) {\n      manhattanOptions = {\n        preferredLayouts: getLoopPreferredLayout(source, connection, layout)\n      };\n    } else if (is(source, 'bpmn:BoundaryEvent')) {\n      manhattanOptions = {\n        preferredLayouts: getBoundaryEventPreferredLayouts(source, target, connectionEnd, layout)\n      };\n    } else if (isExpandedSubProcess(source) || isExpandedSubProcess(target)) {\n      manhattanOptions = {\n        preferredLayouts: layout.subProcess,\n        preserveDocking: getSubProcessPreserveDocking(source)\n      };\n    } else if (is(source, 'bpmn:Gateway')) {\n      manhattanOptions = {\n        preferredLayouts: layout.fromGateway\n      };\n    } else if (is(target, 'bpmn:Gateway')) {\n      manhattanOptions = {\n        preferredLayouts: layout.toGateway\n      };\n    } else {\n      manhattanOptions = {\n        preferredLayouts: layout.default\n      };\n    }\n  }\n\n  if (manhattanOptions) {\n    manhattanOptions = assign(manhattanOptions, hints);\n\n    updatedWaypoints = withoutRedundantPoints(repairConnection(\n      source,\n      target,\n      connectionStart,\n      connectionEnd,\n      waypoints,\n      manhattanOptions\n    ));\n  }\n\n  return updatedWaypoints || [ connectionStart, connectionEnd ];\n};\n\n\n// helpers //////////\n\nfunction getAttachOrientation(attachedElement) {\n  var hostElement = attachedElement.host;\n\n  return getOrientation(getMid(attachedElement), hostElement, ATTACH_ORIENTATION_PADDING);\n}\n\nfunction getMessageFlowManhattanOptions(source, target, layout) {\n  return {\n    preferredLayouts: layout.messageFlow,\n    preserveDocking: getMessageFlowPreserveDocking(source, target)\n  };\n}\n\nfunction getMessageFlowPreserveDocking(source, target) {\n\n  // (1) docking element connected to participant has precedence\n  if (is(target, 'bpmn:Participant')) {\n    return 'source';\n  }\n\n  if (is(source, 'bpmn:Participant')) {\n    return 'target';\n  }\n\n  // (2) docking element connected to expanded sub-process has precedence\n  if (isExpandedSubProcess(target)) {\n    return 'source';\n  }\n\n  if (isExpandedSubProcess(source)) {\n    return 'target';\n  }\n\n  // (3) docking event has precedence\n  if (is(target, 'bpmn:Event')) {\n    return 'target';\n  }\n\n  if (is(source, 'bpmn:Event')) {\n    return 'source';\n  }\n\n  return null;\n}\n\nfunction getSubProcessPreserveDocking(source) {\n  return isExpandedSubProcess(source) ? 'target' : 'source';\n}\n\nfunction getConnectionDocking(point, shape) {\n  return point ? (point.original || point) : getMid(shape);\n}\n\nfunction isCompensationAssociation(source, target) {\n  return is(target, 'bpmn:Activity') &&\n    is(source, 'bpmn:BoundaryEvent') &&\n    target.businessObject.isForCompensation;\n}\n\nfunction isExpandedSubProcess(element) {\n  return is(element, 'bpmn:SubProcess') && isExpanded(element);\n}\n\nfunction isSame(a, b) {\n  return a === b;\n}\n\nfunction isAnyOrientation(orientation, orientations) {\n  return orientations.indexOf(orientation) !== -1;\n}\n\nfunction getHorizontalOrientation(orientation) {\n  var matches = /right|left/.exec(orientation);\n\n  return matches && matches[0];\n}\n\nfunction getVerticalOrientation(orientation) {\n  var matches = /top|bottom/.exec(orientation);\n\n  return matches && matches[0];\n}\n\nfunction isOppositeOrientation(a, b) {\n  return oppositeOrientationMapping[a] === b;\n}\n\nfunction isOppositeHorizontalOrientation(a, b) {\n  var horizontalOrientation = getHorizontalOrientation(a);\n\n  var oppositeHorizontalOrientation = oppositeOrientationMapping[horizontalOrientation];\n\n  return b.indexOf(oppositeHorizontalOrientation) !== -1;\n}\n\nfunction isOppositeVerticalOrientation(a, b) {\n  var verticalOrientation = getVerticalOrientation(a);\n\n  var oppositeVerticalOrientation = oppositeOrientationMapping[verticalOrientation];\n\n  return b.indexOf(oppositeVerticalOrientation) !== -1;\n}\n\nfunction isHorizontalOrientation(orientation) {\n  return orientation === 'right' || orientation === 'left';\n}\n\nfunction getLoopPreferredLayout(source, connection, layout) {\n  var waypoints = connection.waypoints;\n\n  var orientation = waypoints && waypoints.length && getOrientation(waypoints[0], source);\n\n  if (orientation === 'top') {\n    return layout.loop.fromTop;\n  } else if (orientation === 'right') {\n    return layout.loop.fromRight;\n  } else if (orientation === 'left') {\n    return layout.loop.fromLeft;\n  }\n\n  return layout.loop.fromBottom;\n}\n\nfunction getBoundaryEventPreferredLayouts(source, target, end, layout) {\n  var sourceMid = getMid(source),\n      targetMid = getMid(target),\n      attachOrientation = getAttachOrientation(source),\n      sourceLayout,\n      targetLayout;\n\n  var isLoop = isSame(source.host, target);\n\n  var attachedToSide = isAnyOrientation(attachOrientation, [ 'top', 'right', 'bottom', 'left' ]);\n\n  var targetOrientation = getOrientation(targetMid, sourceMid, {\n    x: source.width / 2 + target.width / 2,\n    y: source.height / 2 + target.height / 2\n  });\n\n  if (isLoop) {\n    return getBoundaryEventLoopLayout(attachOrientation, attachedToSide, source, target, end, layout);\n  }\n\n  // source layout\n  sourceLayout = getBoundaryEventSourceLayout(attachOrientation, targetOrientation, attachedToSide, layout.isHorizontal);\n\n  // target layout\n  targetLayout = getBoundaryEventTargetLayout(attachOrientation, targetOrientation, attachedToSide, layout.isHorizontal);\n\n  return [ sourceLayout + ':' + targetLayout ];\n}\n\nfunction getBoundaryEventLoopLayout(attachOrientation, attachedToSide, source, target, end, layout) {\n  var orientation = attachedToSide ? attachOrientation : layout.isHorizontal ? getVerticalOrientation(attachOrientation) : getHorizontalOrientation(attachOrientation),\n      sourceLayout = orientationDirectionMapping[ orientation ],\n      targetLayout;\n\n  if (attachedToSide) {\n    if (isHorizontalOrientation(attachOrientation)) {\n      targetLayout = shouldConnectToSameSide('y', source, target, end) ? 'h' : layout.boundaryLoop.alternateHorizontalSide;\n    } else {\n      targetLayout = shouldConnectToSameSide('x', source, target, end) ? 'v' : layout.boundaryLoop.alternateVerticalSide;\n    }\n  } else {\n    targetLayout = layout.boundaryLoop.default;\n  }\n\n  return [ sourceLayout + ':' + targetLayout ];\n}\n\nfunction shouldConnectToSameSide(axis, source, target, end) {\n  var threshold = BOUNDARY_TO_HOST_THRESHOLD;\n\n  return !(\n    areCloseOnAxis(axis, end, target, threshold) ||\n    areCloseOnAxis(axis, end, {\n      x: target.x + target.width,\n      y: target.y + target.height\n    }, threshold) ||\n    areCloseOnAxis(axis, end, getMid(source), threshold)\n  );\n}\n\nfunction areCloseOnAxis(axis, a, b, threshold) {\n  return Math.abs(a[ axis ] - b[ axis ]) < threshold;\n}\n\nfunction getBoundaryEventSourceLayout(attachOrientation, targetOrientation, attachedToSide, isHorizontal) {\n\n  // attached to either top, right, bottom or left side\n  if (attachedToSide) {\n    return orientationDirectionMapping[ attachOrientation ];\n  }\n\n  // attached to either top-right, top-left, bottom-right or bottom-left corner\n\n  var verticalAttachOrientation = getVerticalOrientation(attachOrientation),\n      horizontalAttachOrientation = getHorizontalOrientation(attachOrientation),\n      verticalTargetOrientation = getVerticalOrientation(targetOrientation),\n      horizontalTargetOrientation = getHorizontalOrientation(targetOrientation);\n\n  if (isHorizontal) {\n\n    // same vertical or opposite horizontal orientation\n    if (\n      isSame(verticalAttachOrientation, verticalTargetOrientation) ||\n      isOppositeOrientation(horizontalAttachOrientation, horizontalTargetOrientation)\n    ) {\n      return orientationDirectionMapping[ verticalAttachOrientation ];\n    }\n  } else {\n\n    // same horizontal or opposite vertical orientation\n    if (\n      isSame(horizontalAttachOrientation, horizontalTargetOrientation) ||\n      isOppositeOrientation(verticalAttachOrientation, verticalTargetOrientation)\n    ) {\n      return orientationDirectionMapping[ horizontalAttachOrientation ];\n    }\n  }\n\n  // fallback\n  return orientationDirectionMapping[ isHorizontal ? horizontalAttachOrientation : verticalAttachOrientation ];\n}\n\nfunction getBoundaryEventTargetLayout(attachOrientation, targetOrientation, attachedToSide, isHorizontal) {\n\n  // attached to either top, right, bottom or left side\n  if (attachedToSide) {\n    if (isHorizontalOrientation(attachOrientation)) {\n\n      // orientation is right or left\n\n      // opposite horizontal orientation or same orientation\n      if (\n        isOppositeHorizontalOrientation(attachOrientation, targetOrientation) ||\n        isSame(attachOrientation, targetOrientation)\n      ) {\n        return 'h';\n      }\n\n      // fallback\n      return 'v';\n    } else {\n\n      // orientation is top or bottom\n\n      // opposite vertical orientation or same orientation\n      if (\n        isOppositeVerticalOrientation(attachOrientation, targetOrientation) ||\n        isSame(attachOrientation, targetOrientation)\n      ) {\n        return 'v';\n      }\n\n      // fallback\n      return 'h';\n    }\n  }\n\n  // attached to either top-right, top-left, bottom-right or bottom-left corner\n  // and orientation is same on the counter-axis\n\n  if (isHorizontal) {\n    if (isSame(getVerticalOrientation(attachOrientation), getVerticalOrientation(targetOrientation))) {\n      return 'h';\n    } else {\n      return 'v';\n    }\n  } else {\n    if (isSame(getHorizontalOrientation(attachOrientation), getHorizontalOrientation(targetOrientation))) {\n      return 'v';\n    } else {\n      return 'h';\n    }\n  }\n}\n\nBpmnLayouter.$inject = [ 'elementRegistry' ];\n","import BehaviorModule from './behavior';\nimport RulesModule from '../rules';\nimport DiOrderingModule from '../di-ordering';\nimport OrderingModule from '../ordering';\nimport ReplaceModule from '../replace';\nimport SpaceToolModule from '../space-tool';\n\nimport CommandModule from 'diagram-js/lib/command';\nimport LabelSupportModule from 'diagram-js/lib/features/label-support';\nimport AttachSupportModule from 'diagram-js/lib/features/attach-support';\nimport SelectionModule from 'diagram-js/lib/features/selection';\nimport ChangeSupportModule from 'diagram-js/lib/features/change-support';\n\nimport BpmnFactory from './BpmnFactory';\nimport BpmnUpdater from './BpmnUpdater';\nimport ElementFactory from './ElementFactory';\nimport Modeling from './Modeling';\nimport BpmnLayouter from './BpmnLayouter';\nimport CroppingConnectionDocking from 'diagram-js/lib/layout/CroppingConnectionDocking';\n\n\nexport default {\n  __init__: [\n    'modeling',\n    'bpmnUpdater'\n  ],\n  __depends__: [\n    BehaviorModule,\n    RulesModule,\n    DiOrderingModule,\n    OrderingModule,\n    ReplaceModule,\n    CommandModule,\n    LabelSupportModule,\n    AttachSupportModule,\n    SelectionModule,\n    ChangeSupportModule,\n    SpaceToolModule\n  ],\n  bpmnFactory: [ 'type', BpmnFactory ],\n  bpmnUpdater: [ 'type', BpmnUpdater ],\n  elementFactory: [ 'type', ElementFactory ],\n  modeling: [ 'type', Modeling ],\n  layouter: [ 'type', BpmnLayouter ],\n  connectionDocking: [ 'type', CroppingConnectionDocking ]\n};","import {\n  assign,\n  isNil\n} from 'min-dash';\n\nconst round = Math.round;\n\n/**\n * @typedef {import('diagram-js/lib/features/complex-preview/ComplexPreview').default} ComplexPreview\n * @typedef {import('diagram-js/lib/layout/ConnectionDocking').default} ConnectionDocking\n * @typedef {import('../modeling/ElementFactory').default} ElementFactory\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../modeling/BpmnLayouter').default} BpmnLayouter\n * @typedef {import('diagram-js/lib/features/rules/Rules').default} Rules\n *\n * @typedef {import('../../model/Types').Shape} Shape\n */\n\n/**\n * A preview for appending.\n *\n * @param {ComplexPreview} complexPreview\n * @param {ConnectionDocking} connectionDocking\n * @param {ElementFactory} elementFactory\n * @param {EventBus} eventBus\n * @param {BpmnLayouter} layouter\n * @param {Rules} rules\n */\nexport default function AppendPreview(complexPreview, connectionDocking, elementFactory, eventBus, layouter, rules) {\n  this._complexPreview = complexPreview;\n  this._connectionDocking = connectionDocking;\n  this._elementFactory = elementFactory;\n  this._eventBus = eventBus;\n  this._layouter = layouter;\n  this._rules = rules;\n}\n\n/**\n * Create a preview of appending a shape of the given type to the given source.\n *\n * @param {Shape} source\n * @param {string} type\n * @param {Partial<Shape>} options\n */\nAppendPreview.prototype.create = function(source, type, options) {\n  const complexPreview = this._complexPreview,\n        connectionDocking = this._connectionDocking,\n        elementFactory = this._elementFactory,\n        eventBus = this._eventBus,\n        layouter = this._layouter,\n        rules = this._rules;\n\n  const shape = elementFactory.createShape(assign({ type }, options));\n\n  const position = eventBus.fire('autoPlace', {\n    source,\n    shape\n  });\n\n  if (!position) {\n    return;\n  }\n\n  assign(shape, {\n    x: position.x - round(shape.width / 2),\n    y: position.y - round(shape.height / 2)\n  });\n\n  const connectionCreateAllowed = rules.allowed('connection.create', {\n    source,\n    target: shape,\n    hints: {\n      targetParent: source.parent\n    }\n  });\n\n  let connection = null;\n\n  if (connectionCreateAllowed) {\n    connection = elementFactory.createConnection(connectionCreateAllowed);\n\n    connection.waypoints = layouter.layoutConnection(connection, {\n      source,\n      target: shape\n    });\n\n    connection.waypoints = connectionDocking.getCroppedWaypoints(connection, source, shape);\n  }\n\n  complexPreview.create({\n    created: [\n      shape,\n      connection\n    ].filter((element) => !isNil(element))\n  });\n};\n\nAppendPreview.prototype.cleanUp = function() {\n  this._complexPreview.cleanUp();\n};\n\nAppendPreview.$inject = [\n  'complexPreview',\n  'connectionDocking',\n  'elementFactory',\n  'eventBus',\n  'layouter',\n  'rules'\n];","import AutoPlaceModule from '../auto-place';\nimport ComplexPreviewModule from 'diagram-js/lib/features/complex-preview';\nimport ModelingModule from '../modeling';\n\nimport AppendPreview from './AppendPreview';\n\nexport default {\n  __depends__: [\n    AutoPlaceModule,\n    ComplexPreviewModule,\n    ModelingModule\n  ],\n  __init__: [ 'appendPreview' ],\n  appendPreview: [ 'type', AppendPreview ]\n};\n","/**\n * @typedef { () => string } LabelGetter\n *\n * @typedef { {\n *   label: string | LabelGetter;\n *   actionName: string;\n *   className: string;\n *   target?: {\n *     type: string;\n *     isExpanded?: boolean;\n *     isInterrupting?: boolean;\n *     triggeredByEvent?: boolean;\n *     cancelActivity?: boolean;\n *     eventDefinitionType?: string;\n *     eventDefinitionAttrs?: Record<string, any>\n *   };\n * } } ReplaceOption\n */\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var START_EVENT = [\n  {\n    label: 'Start event',\n    actionName: 'replace-with-none-start',\n    className: 'bpmn-icon-start-event-none',\n    target: {\n      type: 'bpmn:StartEvent'\n    }\n  },\n  {\n    label: 'Intermediate throw event',\n    actionName: 'replace-with-none-intermediate-throwing',\n    className: 'bpmn-icon-intermediate-event-none',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent'\n    }\n  },\n  {\n    label: 'End event',\n    actionName: 'replace-with-none-end',\n    className: 'bpmn-icon-end-event-none',\n    target: {\n      type: 'bpmn:EndEvent'\n    }\n  },\n  {\n    label: 'Message start event',\n    actionName: 'replace-with-message-start',\n    className: 'bpmn-icon-start-event-message',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Timer start event',\n    actionName: 'replace-with-timer-start',\n    className: 'bpmn-icon-start-event-timer',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition'\n    }\n  },\n  {\n    label: 'Conditional start event',\n    actionName: 'replace-with-conditional-start',\n    className: 'bpmn-icon-start-event-condition',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition'\n    }\n  },\n  {\n    label: 'Signal start event',\n    actionName: 'replace-with-signal-start',\n    className: 'bpmn-icon-start-event-signal',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var START_EVENT_SUB_PROCESS = [\n  {\n    label: 'Start event',\n    actionName: 'replace-with-none-start',\n    className: 'bpmn-icon-start-event-none',\n    target: {\n      type: 'bpmn:StartEvent'\n    }\n  },\n  {\n    label: 'Intermediate throw event',\n    actionName: 'replace-with-none-intermediate-throwing',\n    className: 'bpmn-icon-intermediate-event-none',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent'\n    }\n  },\n  {\n    label: 'End event',\n    actionName: 'replace-with-none-end',\n    className: 'bpmn-icon-end-event-none',\n    target: {\n      type: 'bpmn:EndEvent'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var INTERMEDIATE_EVENT = [\n  {\n    label: 'Start event',\n    actionName: 'replace-with-none-start',\n    className: 'bpmn-icon-start-event-none',\n    target: {\n      type: 'bpmn:StartEvent'\n    }\n  },\n  {\n    label: 'Intermediate throw event',\n    actionName: 'replace-with-none-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-none',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent'\n    }\n  },\n  {\n    label: 'End event',\n    actionName: 'replace-with-none-end',\n    className: 'bpmn-icon-end-event-none',\n    target: {\n      type: 'bpmn:EndEvent'\n    }\n  },\n  {\n    label: 'Message intermediate catch event',\n    actionName: 'replace-with-message-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-message',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Message intermediate throw event',\n    actionName: 'replace-with-message-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-message',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Timer intermediate catch event',\n    actionName: 'replace-with-timer-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-timer',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition'\n    }\n  },\n  {\n    label: 'Escalation intermediate throw event',\n    actionName: 'replace-with-escalation-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-escalation',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition'\n    }\n  },\n  {\n    label: 'Conditional intermediate catch event',\n    actionName: 'replace-with-conditional-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-condition',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition'\n    }\n  },\n  {\n    label: 'Link intermediate catch event',\n    actionName: 'replace-with-link-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-link',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:LinkEventDefinition',\n      eventDefinitionAttrs: {\n        name: ''\n      }\n    }\n  },\n  {\n    label: 'Link intermediate throw event',\n    actionName: 'replace-with-link-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-link',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:LinkEventDefinition',\n      eventDefinitionAttrs: {\n        name: ''\n      }\n    }\n  },\n  {\n    label: 'Compensation intermediate throw event',\n    actionName: 'replace-with-compensation-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-compensation',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition'\n    }\n  },\n  {\n    label: 'Signal intermediate catch event',\n    actionName: 'replace-with-signal-intermediate-catch',\n    className: 'bpmn-icon-intermediate-event-catch-signal',\n    target: {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  },\n  {\n    label: 'Signal intermediate throw event',\n    actionName: 'replace-with-signal-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-throw-signal',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var END_EVENT = [\n  {\n    label: 'Start event',\n    actionName: 'replace-with-none-start',\n    className: 'bpmn-icon-start-event-none',\n    target: {\n      type: 'bpmn:StartEvent'\n    }\n  },\n  {\n    label: 'Intermediate throw event',\n    actionName: 'replace-with-none-intermediate-throw',\n    className: 'bpmn-icon-intermediate-event-none',\n    target: {\n      type: 'bpmn:IntermediateThrowEvent'\n    }\n  },\n  {\n    label: 'End event',\n    actionName: 'replace-with-none-end',\n    className: 'bpmn-icon-end-event-none',\n    target: {\n      type: 'bpmn:EndEvent'\n    }\n  },\n  {\n    label: 'Message end event',\n    actionName: 'replace-with-message-end',\n    className: 'bpmn-icon-end-event-message',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition'\n    }\n  },\n  {\n    label: 'Escalation end event',\n    actionName: 'replace-with-escalation-end',\n    className: 'bpmn-icon-end-event-escalation',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition'\n    }\n  },\n  {\n    label: 'Error end event',\n    actionName: 'replace-with-error-end',\n    className: 'bpmn-icon-end-event-error',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:ErrorEventDefinition'\n    }\n  },\n  {\n    label: 'Cancel end event',\n    actionName: 'replace-with-cancel-end',\n    className: 'bpmn-icon-end-event-cancel',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:CancelEventDefinition'\n    }\n  },\n  {\n    label: 'Compensation end event',\n    actionName: 'replace-with-compensation-end',\n    className: 'bpmn-icon-end-event-compensation',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition'\n    }\n  },\n  {\n    label: 'Signal end event',\n    actionName: 'replace-with-signal-end',\n    className: 'bpmn-icon-end-event-signal',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition'\n    }\n  },\n  {\n    label: 'Terminate end event',\n    actionName: 'replace-with-terminate-end',\n    className: 'bpmn-icon-end-event-terminate',\n    target: {\n      type: 'bpmn:EndEvent',\n      eventDefinitionType: 'bpmn:TerminateEventDefinition'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var GATEWAY = [\n  {\n    label: 'Exclusive gateway',\n    actionName: 'replace-with-exclusive-gateway',\n    className: 'bpmn-icon-gateway-xor',\n    target: {\n      type: 'bpmn:ExclusiveGateway'\n    }\n  },\n  {\n    label: 'Parallel gateway',\n    actionName: 'replace-with-parallel-gateway',\n    className: 'bpmn-icon-gateway-parallel',\n    target: {\n      type: 'bpmn:ParallelGateway'\n    }\n  },\n  {\n    label: 'Inclusive gateway',\n    actionName: 'replace-with-inclusive-gateway',\n    className: 'bpmn-icon-gateway-or',\n    target: {\n      type: 'bpmn:InclusiveGateway'\n    }\n  },\n  {\n    label: 'Complex gateway',\n    actionName: 'replace-with-complex-gateway',\n    className: 'bpmn-icon-gateway-complex',\n    target: {\n      type: 'bpmn:ComplexGateway'\n    }\n  },\n  {\n    label: 'Event-based gateway',\n    actionName: 'replace-with-event-based-gateway',\n    className: 'bpmn-icon-gateway-eventbased',\n    target: {\n      type: 'bpmn:EventBasedGateway',\n      instantiate: false,\n      eventGatewayType: 'Exclusive'\n    }\n  }\n\n  // Gateways deactivated until https://github.com/bpmn-io/bpmn-js/issues/194\n  // {\n  //   label: 'Event based instantiating Gateway',\n  //   actionName: 'replace-with-exclusive-event-based-gateway',\n  //   className: 'bpmn-icon-exclusive-event-based',\n  //   target: {\n  //     type: 'bpmn:EventBasedGateway'\n  //   },\n  //   options: {\n  //     businessObject: { instantiate: true, eventGatewayType: 'Exclusive' }\n  //   }\n  // },\n  // {\n  //   label: 'Parallel Event based instantiating Gateway',\n  //   actionName: 'replace-with-parallel-event-based-instantiate-gateway',\n  //   className: 'bpmn-icon-parallel-event-based-instantiate-gateway',\n  //   target: {\n  //     type: 'bpmn:EventBasedGateway'\n  //   },\n  //   options: {\n  //     businessObject: { instantiate: true, eventGatewayType: 'Parallel' }\n  //   }\n  // }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var SUBPROCESS_EXPANDED = [\n  {\n    label: 'Transaction',\n    actionName: 'replace-with-transaction',\n    className: 'bpmn-icon-transaction',\n    target: {\n      type: 'bpmn:Transaction',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Event sub-process',\n    actionName: 'replace-with-event-subprocess',\n    className: 'bpmn-icon-event-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      triggeredByEvent: true,\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Ad-hoc sub-process',\n    actionName: 'replace-with-ad-hoc-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:AdHocSubProcess',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Sub-process (collapsed)',\n    actionName: 'replace-with-collapsed-subprocess',\n    className: 'bpmn-icon-subprocess-collapsed',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: false\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var AD_HOC_SUBPROCESS_EXPANDED = [\n  {\n    label: 'Sub-process',\n    actionName: 'replace-with-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Transaction',\n    actionName: 'replace-with-transaction',\n    className: 'bpmn-icon-transaction',\n    target: {\n      type: 'bpmn:Transaction',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Event sub-process',\n    actionName: 'replace-with-event-subprocess',\n    className: 'bpmn-icon-event-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      triggeredByEvent: true,\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Ad-hoc sub-process (collapsed)',\n    actionName: 'replace-with-collapsed-ad-hoc-subprocess',\n    className: 'bpmn-icon-subprocess-collapsed',\n    target: {\n      type: 'bpmn:AdHocSubProcess',\n      isExpanded: false\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var TRANSACTION = [\n  {\n    label: 'Transaction',\n    actionName: 'replace-with-transaction',\n    className: 'bpmn-icon-transaction',\n    target: {\n      type: 'bpmn:Transaction',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Sub-process',\n    actionName: 'replace-with-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Ad-hoc sub-process',\n    actionName: 'replace-with-ad-hoc-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:AdHocSubProcess',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Event sub-process',\n    actionName: 'replace-with-event-subprocess',\n    className: 'bpmn-icon-event-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      triggeredByEvent: true,\n      isExpanded: true\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var EVENT_SUB_PROCESS = TRANSACTION;\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var TASK = [\n  {\n    label: 'Task',\n    actionName: 'replace-with-task',\n    className: 'bpmn-icon-task',\n    target: {\n      type: 'bpmn:Task'\n    }\n  },\n  {\n    label: 'User task',\n    actionName: 'replace-with-user-task',\n    className: 'bpmn-icon-user',\n    target: {\n      type: 'bpmn:UserTask'\n    }\n  },\n  {\n    label: 'Service task',\n    actionName: 'replace-with-service-task',\n    className: 'bpmn-icon-service',\n    target: {\n      type: 'bpmn:ServiceTask'\n    }\n  },\n  {\n    label: 'Send task',\n    actionName: 'replace-with-send-task',\n    className: 'bpmn-icon-send',\n    target: {\n      type: 'bpmn:SendTask'\n    }\n  },\n  {\n    label: 'Receive task',\n    actionName: 'replace-with-receive-task',\n    className: 'bpmn-icon-receive',\n    target: {\n      type: 'bpmn:ReceiveTask'\n    }\n  },\n  {\n    label: 'Manual task',\n    actionName: 'replace-with-manual-task',\n    className: 'bpmn-icon-manual',\n    target: {\n      type: 'bpmn:ManualTask'\n    }\n  },\n  {\n    label: 'Business rule task',\n    actionName: 'replace-with-rule-task',\n    className: 'bpmn-icon-business-rule',\n    target: {\n      type: 'bpmn:BusinessRuleTask'\n    }\n  },\n  {\n    label: 'Script task',\n    actionName: 'replace-with-script-task',\n    className: 'bpmn-icon-script',\n    target: {\n      type: 'bpmn:ScriptTask'\n    }\n  },\n  {\n    label: 'Call activity',\n    actionName: 'replace-with-call-activity',\n    className: 'bpmn-icon-call-activity',\n    target: {\n      type: 'bpmn:CallActivity'\n    }\n  },\n  {\n    label: 'Sub-process (collapsed)',\n    actionName: 'replace-with-collapsed-subprocess',\n    className: 'bpmn-icon-subprocess-collapsed',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: false\n    }\n  },\n  {\n    label: 'Sub-process (expanded)',\n    actionName: 'replace-with-expanded-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:SubProcess',\n      isExpanded: true\n    }\n  },\n  {\n    label: 'Ad-hoc sub-process (collapsed)',\n    actionName: 'replace-with-collapsed-ad-hoc-subprocess',\n    className: 'bpmn-icon-subprocess-collapsed',\n    target: {\n      type: 'bpmn:AdHocSubProcess',\n      isExpanded: false\n    }\n  },\n  {\n    label: 'Ad-hoc sub-process (expanded)',\n    actionName: 'replace-with-ad-hoc-subprocess',\n    className: 'bpmn-icon-subprocess-expanded',\n    target: {\n      type: 'bpmn:AdHocSubProcess',\n      isExpanded: true\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var DATA_OBJECT_REFERENCE = [\n  {\n    label: 'Data store reference',\n    actionName: 'replace-with-data-store-reference',\n    className: 'bpmn-icon-data-store',\n    target: {\n      type: 'bpmn:DataStoreReference'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var DATA_STORE_REFERENCE = [\n  {\n    label: 'Data object reference',\n    actionName: 'replace-with-data-object-reference',\n    className: 'bpmn-icon-data-object',\n    target: {\n      type: 'bpmn:DataObjectReference'\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var BOUNDARY_EVENT = [\n  {\n    label: 'Message boundary event',\n    actionName: 'replace-with-message-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-message',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Timer boundary event',\n    actionName: 'replace-with-timer-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-timer',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Escalation boundary event',\n    actionName: 'replace-with-escalation-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-escalation',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Conditional boundary event',\n    actionName: 'replace-with-conditional-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-condition',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Error boundary event',\n    actionName: 'replace-with-error-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-error',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:ErrorEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Cancel boundary event',\n    actionName: 'replace-with-cancel-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-cancel',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:CancelEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Signal boundary event',\n    actionName: 'replace-with-signal-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-signal',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Compensation boundary event',\n    actionName: 'replace-with-compensation-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-compensation',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition',\n      cancelActivity: true\n    }\n  },\n  {\n    label: 'Message boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-message-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-message',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Timer boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-timer-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-timer',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Escalation boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-escalation-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-escalation',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Conditional boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-conditional-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-condition',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition',\n      cancelActivity: false\n    }\n  },\n  {\n    label: 'Signal boundary event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-signal-boundary',\n    className: 'bpmn-icon-intermediate-event-catch-non-interrupting-signal',\n    target: {\n      type: 'bpmn:BoundaryEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition',\n      cancelActivity: false\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var EVENT_SUB_PROCESS_START_EVENT = [\n  {\n    label: 'Message start event',\n    actionName: 'replace-with-message-start',\n    className: 'bpmn-icon-start-event-message',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Timer start event',\n    actionName: 'replace-with-timer-start',\n    className: 'bpmn-icon-start-event-timer',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Conditional start event',\n    actionName: 'replace-with-conditional-start',\n    className: 'bpmn-icon-start-event-condition',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Signal start event',\n    actionName: 'replace-with-signal-start',\n    className: 'bpmn-icon-start-event-signal',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Error start event',\n    actionName: 'replace-with-error-start',\n    className: 'bpmn-icon-start-event-error',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:ErrorEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Escalation start event',\n    actionName: 'replace-with-escalation-start',\n    className: 'bpmn-icon-start-event-escalation',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Compensation start event',\n    actionName: 'replace-with-compensation-start',\n    className: 'bpmn-icon-start-event-compensation',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:CompensateEventDefinition',\n      isInterrupting: true\n    }\n  },\n  {\n    label: 'Message start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-message-start',\n    className: 'bpmn-icon-start-event-non-interrupting-message',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:MessageEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Timer start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-timer-start',\n    className: 'bpmn-icon-start-event-non-interrupting-timer',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:TimerEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Conditional start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-conditional-start',\n    className: 'bpmn-icon-start-event-non-interrupting-condition',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:ConditionalEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Signal start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-signal-start',\n    className: 'bpmn-icon-start-event-non-interrupting-signal',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:SignalEventDefinition',\n      isInterrupting: false\n    }\n  },\n  {\n    label: 'Escalation start event (non-interrupting)',\n    actionName: 'replace-with-non-interrupting-escalation-start',\n    className: 'bpmn-icon-start-event-non-interrupting-escalation',\n    target: {\n      type: 'bpmn:StartEvent',\n      eventDefinitionType: 'bpmn:EscalationEventDefinition',\n      isInterrupting: false\n    }\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var SEQUENCE_FLOW = [\n  {\n    label: 'Sequence flow',\n    actionName: 'replace-with-sequence-flow',\n    className: 'bpmn-icon-connection'\n  },\n  {\n    label: 'Default flow',\n    actionName: 'replace-with-default-flow',\n    className: 'bpmn-icon-default-flow'\n  },\n  {\n    label: 'Conditional flow',\n    actionName: 'replace-with-conditional-flow',\n    className: 'bpmn-icon-conditional-flow'\n  }\n];\n\n/**\n * @type {ReplaceOption[]}\n */\nexport var PARTICIPANT = [\n  {\n    label: 'Expanded pool/participant',\n    actionName: 'replace-with-expanded-pool',\n    className: 'bpmn-icon-participant',\n    target: {\n      type: 'bpmn:Participant',\n      isExpanded: true\n    }\n  },\n  {\n    label: function(element) {\n      var label = 'Empty pool/participant';\n\n      if (element.children && element.children.length) {\n        label += ' (removes content)';\n      }\n\n      return label;\n    },\n    actionName: 'replace-with-collapsed-pool',\n\n    // TODO(@janstuemmel): maybe design new icon\n    className: 'bpmn-icon-lane',\n    target: {\n      type: 'bpmn:Participant',\n      isExpanded: false\n    }\n  }\n];\n\n/**\n * @type {{ [key: string]: ReplaceOption[]}}\n */\nexport var TYPED_EVENT = {\n  'bpmn:MessageEventDefinition': [\n    {\n      label: 'Message start event',\n      actionName: 'replace-with-message-start',\n      className: 'bpmn-icon-start-event-message',\n      target: {\n        type: 'bpmn:StartEvent',\n        eventDefinitionType: 'bpmn:MessageEventDefinition'\n      }\n    },\n    {\n      label: 'Message intermediate catch event',\n      actionName: 'replace-with-message-intermediate-catch',\n      className: 'bpmn-icon-intermediate-event-catch-message',\n      target: {\n        type: 'bpmn:IntermediateCatchEvent',\n        eventDefinitionType: 'bpmn:MessageEventDefinition'\n      }\n    },\n    {\n      label: 'Message intermediate throw event',\n      actionName: 'replace-with-message-intermediate-throw',\n      className: 'bpmn-icon-intermediate-event-throw-message',\n      target: {\n        type: 'bpmn:IntermediateThrowEvent',\n        eventDefinitionType: 'bpmn:MessageEventDefinition'\n      }\n    },\n    {\n      label: 'Message end event',\n      actionName: 'replace-with-message-end',\n      className: 'bpmn-icon-end-event-message',\n      target: {\n        type: 'bpmn:EndEvent',\n        eventDefinitionType: 'bpmn:MessageEventDefinition'\n      }\n    }\n  ],\n  'bpmn:TimerEventDefinition': [\n    {\n      label: 'Timer start event',\n      actionName: 'replace-with-timer-start',\n      className: 'bpmn-icon-start-event-timer',\n      target: {\n        type: 'bpmn:StartEvent',\n        eventDefinitionType: 'bpmn:TimerEventDefinition'\n      }\n    },\n    {\n      label: 'Timer intermediate catch event',\n      actionName: 'replace-with-timer-intermediate-catch',\n      className: 'bpmn-icon-intermediate-event-catch-timer',\n      target: {\n        type: 'bpmn:IntermediateCatchEvent',\n        eventDefinitionType: 'bpmn:TimerEventDefinition'\n      }\n    }\n  ],\n  'bpmn:ConditionalEventDefinition': [\n    {\n      label: 'Conditional start event',\n      actionName: 'replace-with-conditional-start',\n      className: 'bpmn-icon-start-event-condition',\n      target: {\n        type: 'bpmn:StartEvent',\n        eventDefinitionType: 'bpmn:ConditionalEventDefinition'\n      }\n    },\n    {\n      label: 'Conditional intermediate catch event',\n      actionName: 'replace-with-conditional-intermediate-catch',\n      className: 'bpmn-icon-intermediate-event-catch-condition',\n      target: {\n        type: 'bpmn:IntermediateCatchEvent',\n        eventDefinitionType: 'bpmn:ConditionalEventDefinition'\n      }\n    }\n  ],\n  'bpmn:SignalEventDefinition': [\n    {\n      label: 'Signal start event',\n      actionName: 'replace-with-signal-start',\n      className: 'bpmn-icon-start-event-signal',\n      target: {\n        type: 'bpmn:StartEvent',\n        eventDefinitionType: 'bpmn:SignalEventDefinition'\n      }\n    },\n    {\n      label: 'Signal intermediate catch event',\n      actionName: 'replace-with-signal-intermediate-catch',\n      className: 'bpmn-icon-intermediate-event-catch-signal',\n      target: {\n        type: 'bpmn:IntermediateCatchEvent',\n        eventDefinitionType: 'bpmn:SignalEventDefinition'\n      }\n    },\n    {\n      label: 'Signal intermediate throw event',\n      actionName: 'replace-with-signal-intermediate-throw',\n      className: 'bpmn-icon-intermediate-event-throw-signal',\n      target: {\n        type: 'bpmn:IntermediateThrowEvent',\n        eventDefinitionType: 'bpmn:SignalEventDefinition'\n      }\n    },\n    {\n      label: 'Signal end event',\n      actionName: 'replace-with-signal-end',\n      className: 'bpmn-icon-end-event-signal',\n      target: {\n        type: 'bpmn:EndEvent',\n        eventDefinitionType: 'bpmn:SignalEventDefinition'\n      }\n    }\n  ],\n  'bpmn:ErrorEventDefinition': [\n    {\n      label: 'Error start event',\n      actionName: 'replace-with-error-start',\n      className: 'bpmn-icon-start-event-error',\n      target: {\n        type: 'bpmn:StartEvent',\n        eventDefinitionType: 'bpmn:ErrorEventDefinition'\n      }\n    },\n    {\n      label: 'Error end event',\n      actionName: 'replace-with-error-end',\n      className: 'bpmn-icon-end-event-error',\n      target: {\n        type: 'bpmn:EndEvent',\n        eventDefinitionType: 'bpmn:ErrorEventDefinition'\n      }\n    }\n  ],\n  'bpmn:EscalationEventDefinition': [\n    {\n      label: 'Escalation start event',\n      actionName: 'replace-with-escalation-start',\n      className: 'bpmn-icon-start-event-escalation',\n      target: {\n        type: 'bpmn:StartEvent',\n        eventDefinitionType: 'bpmn:EscalationEventDefinition'\n      }\n    },\n    {\n      label: 'Escalation intermediate throw event',\n      actionName: 'replace-with-escalation-intermediate-throw',\n      className: 'bpmn-icon-intermediate-event-throw-escalation',\n      target: {\n        type: 'bpmn:IntermediateThrowEvent',\n        eventDefinitionType: 'bpmn:EscalationEventDefinition'\n      }\n    },\n    {\n      label: 'Escalation end event',\n      actionName: 'replace-with-escalation-end',\n      className: 'bpmn-icon-end-event-escalation',\n      target: {\n        type: 'bpmn:EndEvent',\n        eventDefinitionType: 'bpmn:EscalationEventDefinition'\n      }\n    }\n  ],\n  'bpmn:CompensateEventDefinition': [\n    {\n      label: 'Compensation start event',\n      actionName: 'replace-with-compensation-start',\n      className: 'bpmn-icon-start-event-compensation',\n      target: {\n        type: 'bpmn:StartEvent',\n        eventDefinitionType: 'bpmn:CompensateEventDefinition'\n      }\n    },\n    {\n      label: 'Compensation intermediate throw event',\n      actionName: 'replace-with-compensation-intermediate-throw',\n      className: 'bpmn-icon-intermediate-event-throw-compensation',\n      target: {\n        type: 'bpmn:IntermediateThrowEvent',\n        eventDefinitionType: 'bpmn:CompensateEventDefinition'\n      }\n    },\n    {\n      label: 'Compensation end event',\n      actionName: 'replace-with-compensation-end',\n      className: 'bpmn-icon-end-event-compensation',\n      target: {\n        type: 'bpmn:EndEvent',\n        eventDefinitionType: 'bpmn:CompensateEventDefinition'\n      }\n    }\n  ]\n};\n","export default {\n  'start-event-non-interrupting': `\n  <svg viewBox=\"0 0 2048 2048\" xmlns=\"http://www.w3.org/2000/svg\">\n    <g transform=\"translate(0 995.64)\">\n      <path d=\"m1899 28.357c21.545 567.43-598.38 1023.5-1133.6 835.92-548.09-147.21-801.57-873.95-463.59-1330 302.62-480.3 1071.7-507.54 1407.6-49.847 122.14 153.12 190.07 348.07 189.59 543.91z\" fill=\"none\" stroke=\"currentColor\" stroke-dasharray=\"418.310422, 361.2328165\" stroke-linecap=\"round\" stroke-width=\"100\"/>\n    </g>\n  </svg>`,\n  'intermediate-event-non-interrupting': `\n  <svg viewBox=\"0 0 2048 2048\" xmlns=\"http://www.w3.org/2000/svg\">\n     <g transform=\"translate(0 995.64)\" fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\">\n        <circle cx=\"1024\" cy=\"28.357\" r=\"875\" stroke-dasharray=\"418.310422, 361.2328165\" stroke-width=\"100\"/>\n        <circle cx=\"1024\" cy=\"28.357\" r=\"685\" stroke-dasharray=\"348.31044857,261.23283643\" stroke-dashoffset=\"500\" stroke-width=\"100\"/>\n     </g>\n  </svg>`\n};","import {\n  getBusinessObject,\n  is\n} from '../../util/ModelUtil';\n\nimport {\n  isEventSubProcess,\n  isExpanded\n} from '../../util/DiUtil';\n\nimport {\n  isDifferentType\n} from './util/TypeUtil';\n\nimport {\n  forEach,\n  filter,\n  isArray\n} from 'min-dash';\n\nimport * as replaceOptions from '../replace/ReplaceOptions';\nimport { canBeNonInterrupting, getInterruptingProperty } from '../modeling/behavior/util/NonInterruptingUtil';\nimport Icons from './util/Icons';\n\n/**\n * @typedef {import('../modeling/BpmnFactory').default} BpmnFactory\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').default} PopupMenu\n * @typedef {import('../modeling/Modeling').default} Modeling\n * @typedef {import('../replace/BpmnReplace').default} BpmnReplace\n * @typedef {import('diagram-js/lib/features/Rules').default} Rules\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n * @typedef {import('../copy-paste/ModdleCopy').default} ModdleCopy\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Moddle} Moddle\n *\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').PopupMenuEntries} PopupMenuEntries\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').PopupMenuEntry} PopupMenuEntry\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').PopupMenuEntryAction} PopupMenuEntryAction\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').PopupMenuHeaderEntries} PopupMenuHeaderEntries\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').default} PopupMenuProvider\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').PopupMenuTarget} PopupMenuTarget\n *\n * @typedef {import('./ReplaceOptions').ReplaceOption} ReplaceOption\n */\n\n/**\n * A BPMN-specific popup menu provider.\n *\n * @implements {PopupMenuProvider}\n *\n * @param {BpmnFactory} bpmnFactory\n * @param {PopupMenu} popupMenu\n * @param {Modeling} modeling\n * @param {Moddle} moddle\n * @param {BpmnReplace} bpmnReplace\n * @param {Rules} rules\n * @param {Translate} translate\n * @param {ModdleCopy} moddleCopy\n */\nexport default function ReplaceMenuProvider(\n    bpmnFactory, popupMenu, modeling, moddle,\n    bpmnReplace, rules, translate, moddleCopy) {\n\n  this._bpmnFactory = bpmnFactory;\n  this._popupMenu = popupMenu;\n  this._modeling = modeling;\n  this._moddle = moddle;\n  this._bpmnReplace = bpmnReplace;\n  this._rules = rules;\n  this._translate = translate;\n  this._moddleCopy = moddleCopy;\n\n  this._register();\n}\n\nReplaceMenuProvider.$inject = [\n  'bpmnFactory',\n  'popupMenu',\n  'modeling',\n  'moddle',\n  'bpmnReplace',\n  'rules',\n  'translate',\n  'moddleCopy'\n];\n\nReplaceMenuProvider.prototype._register = function() {\n  this._popupMenu.registerProvider('bpmn-replace', this);\n};\n\n/**\n * @param {PopupMenuTarget} target\n *\n * @return {PopupMenuEntries}\n */\nReplaceMenuProvider.prototype.getPopupMenuEntries = function(target) {\n\n  var businessObject = target.businessObject;\n\n  var rules = this._rules;\n\n  var sameTypeEventOptions = [],\n      eventDefinitionType;\n\n  var filteredReplaceOptions = [];\n\n  if (isArray(target) || !rules.allowed('shape.replace', { element: target })) {\n    return {};\n  }\n\n  var differentType = isDifferentType(target);\n\n  if (is(businessObject, 'bpmn:DataObjectReference')) {\n    return this._createEntries(target, replaceOptions.DATA_OBJECT_REFERENCE);\n  }\n\n  if (is(businessObject, 'bpmn:DataStoreReference') && !is(target.parent, 'bpmn:Collaboration')) {\n    return this._createEntries(target, replaceOptions.DATA_STORE_REFERENCE);\n  }\n\n  // typed start, intermediate, and end events\n  if (is(businessObject, 'bpmn:Event') && !is(businessObject, 'bpmn:BoundaryEvent')) {\n    eventDefinitionType = businessObject.get('eventDefinitions')[0]?.$type;\n\n    sameTypeEventOptions = replaceOptions.TYPED_EVENT[eventDefinitionType] || [];\n\n    if (!isEventSubProcess(businessObject.$parent) && is(businessObject.$parent, 'bpmn:SubProcess')) {\n      sameTypeEventOptions = filter(sameTypeEventOptions, function(option) {\n        return option.target.type !== 'bpmn:StartEvent';\n      });\n    }\n  }\n\n  // start events outside sub processes\n  if (is(businessObject, 'bpmn:StartEvent') && !is(businessObject.$parent, 'bpmn:SubProcess')) {\n\n    filteredReplaceOptions = filter(\n      replaceOptions.START_EVENT.concat(sameTypeEventOptions),\n      differentType\n    );\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // expanded/collapsed pools\n  if (is(businessObject, 'bpmn:Participant')) {\n\n    filteredReplaceOptions = filter(replaceOptions.PARTICIPANT, function(replaceOption) {\n      return isExpanded(target) !== replaceOption.target.isExpanded;\n    });\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // start events inside event sub processes\n  if (is(businessObject, 'bpmn:StartEvent') && isEventSubProcess(businessObject.$parent)) {\n    filteredReplaceOptions = filter(\n      replaceOptions.EVENT_SUB_PROCESS_START_EVENT.concat(sameTypeEventOptions), function(replaceOption) {\n\n        var target = replaceOption.target;\n\n        var isInterrupting = target.isInterrupting !== false;\n\n        var isInterruptingEqual = businessObject.isInterrupting === isInterrupting;\n\n        // filters elements which types and event definition are equal but have have different interrupting types\n        return differentType(replaceOption) || !differentType(replaceOption) && !isInterruptingEqual;\n\n      }\n    );\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // start events inside sub processes\n  if (is(businessObject, 'bpmn:StartEvent') && !isEventSubProcess(businessObject.$parent)\n      && is(businessObject.$parent, 'bpmn:SubProcess')) {\n    filteredReplaceOptions = filter(\n      replaceOptions.START_EVENT_SUB_PROCESS.concat(sameTypeEventOptions),\n      differentType\n    );\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // end events\n  if (is(businessObject, 'bpmn:EndEvent')) {\n\n    filteredReplaceOptions = filter(replaceOptions.END_EVENT.concat(sameTypeEventOptions), function(replaceOption) {\n      var target = replaceOption.target;\n\n      // hide cancel end events outside transactions\n      if (target.eventDefinitionType == 'bpmn:CancelEventDefinition' && !is(businessObject.$parent, 'bpmn:Transaction')) {\n        return false;\n      }\n\n      return differentType(replaceOption);\n    });\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // boundary events\n  if (is(businessObject, 'bpmn:BoundaryEvent')) {\n\n    filteredReplaceOptions = filter(replaceOptions.BOUNDARY_EVENT, function(replaceOption) {\n\n      var target = replaceOption.target;\n\n      if (target.eventDefinitionType == 'bpmn:CancelEventDefinition' &&\n         !is(businessObject.attachedToRef, 'bpmn:Transaction')) {\n        return false;\n      }\n      var cancelActivity = target.cancelActivity !== false;\n\n      var isCancelActivityEqual = businessObject.cancelActivity == cancelActivity;\n\n      return differentType(replaceOption) || !differentType(replaceOption) && !isCancelActivityEqual;\n    });\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // intermediate events\n  if (is(businessObject, 'bpmn:IntermediateCatchEvent') ||\n      is(businessObject, 'bpmn:IntermediateThrowEvent')) {\n\n    filteredReplaceOptions = filter(\n      replaceOptions.INTERMEDIATE_EVENT.concat(sameTypeEventOptions),\n      differentType\n    );\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // gateways\n  if (is(businessObject, 'bpmn:Gateway')) {\n\n    filteredReplaceOptions = filter(replaceOptions.GATEWAY, differentType);\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // transactions\n  if (is(businessObject, 'bpmn:Transaction')) {\n\n    filteredReplaceOptions = filter(replaceOptions.TRANSACTION, differentType);\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // expanded event sub processes\n  if (isEventSubProcess(businessObject) && isExpanded(target)) {\n\n    filteredReplaceOptions = filter(replaceOptions.EVENT_SUB_PROCESS, differentType);\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // expanded ad hoc sub processes\n  if (is(businessObject, 'bpmn:AdHocSubProcess') && isExpanded(target)) {\n\n    filteredReplaceOptions = filter(replaceOptions.AD_HOC_SUBPROCESS_EXPANDED, differentType);\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // expanded sub processes\n  if (is(businessObject, 'bpmn:SubProcess') && isExpanded(target)) {\n\n    filteredReplaceOptions = filter(replaceOptions.SUBPROCESS_EXPANDED, differentType);\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // collapsed sub process or collapsed ad hoc sub process\n  if (is(businessObject, 'bpmn:SubProcess') && !isExpanded(target)) {\n\n    filteredReplaceOptions = filter(replaceOptions.TASK, function(replaceOption) {\n\n      var isTargetSameType = replaceOption.target.type === target.type;\n      var isTargetExpanded = replaceOption.target.isExpanded === true;\n\n      // Collapsed subprocess cannot be replaced with itself or expanded subprocess of different type.\n      return isTargetSameType === isTargetExpanded;\n    });\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  // sequence flows\n  if (is(businessObject, 'bpmn:SequenceFlow')) {\n    return this._createSequenceFlowEntries(target, replaceOptions.SEQUENCE_FLOW);\n  }\n\n  // flow nodes\n  if (is(businessObject, 'bpmn:FlowNode')) {\n    filteredReplaceOptions = filter(replaceOptions.TASK, differentType);\n\n    return this._createEntries(target, filteredReplaceOptions);\n  }\n\n  return {};\n};\n\n/**\n * @param {PopupMenuTarget} target\n *\n * @return {PopupMenuHeaderEntries}\n */\nReplaceMenuProvider.prototype.getPopupMenuHeaderEntries = function(target) {\n\n  var headerEntries = {};\n\n  if (is(target, 'bpmn:Activity') && !isEventSubProcess(target)) {\n    headerEntries = {\n      ...headerEntries,\n      ...this._getLoopCharacteristicsHeaderEntries(target)\n    };\n  }\n\n  if (is(target, 'bpmn:DataObjectReference')) {\n    headerEntries = {\n      ...headerEntries,\n      ...this._getCollectionHeaderEntries(target)\n    };\n  }\n\n  if (is(target, 'bpmn:Participant')) {\n    headerEntries = {\n      ...headerEntries,\n      ...this._getParticipantMultiplicityHeaderEntries(target)\n    };\n  }\n\n  if (canBeNonInterrupting(target)) {\n    headerEntries = {\n      ...headerEntries,\n      ...this._getNonInterruptingHeaderEntries(target)\n    };\n  }\n\n  return headerEntries;\n};\n\n\n/**\n * Create popup menu entries for the given target.\n *\n * @param  {PopupMenuTarget} target\n * @param  {ReplaceOption[]} replaceOptions\n *\n * @return {PopupMenuEntries}\n */\nReplaceMenuProvider.prototype._createEntries = function(target, replaceOptions) {\n  var entries = {};\n\n  var self = this;\n\n  forEach(replaceOptions, function(replaceOption) {\n    entries[ replaceOption.actionName ] = self._createEntry(replaceOption, target);\n  });\n\n  return entries;\n};\n\n/**\n * Creates popup menu entries for the given sequence flow.\n *\n * @param  {PopupMenuTarget} target\n * @param  {ReplaceOption[]} replaceOptions\n *\n * @return {PopupMenuEntries}\n */\nReplaceMenuProvider.prototype._createSequenceFlowEntries = function(target, replaceOptions) {\n\n  var businessObject = getBusinessObject(target);\n\n  var entries = {};\n\n  var modeling = this._modeling,\n      moddle = this._moddle;\n\n  var self = this;\n\n  forEach(replaceOptions, function(replaceOption) {\n\n    switch (replaceOption.actionName) {\n    case 'replace-with-default-flow':\n      if (businessObject.sourceRef.default !== businessObject &&\n            (is(businessObject.sourceRef, 'bpmn:ExclusiveGateway') ||\n             is(businessObject.sourceRef, 'bpmn:InclusiveGateway') ||\n             is(businessObject.sourceRef, 'bpmn:ComplexGateway') ||\n             is(businessObject.sourceRef, 'bpmn:Activity'))) {\n\n        entries = {\n          ...entries,\n          [ replaceOption.actionName ]: self._createEntry(replaceOption, target, function() {\n            modeling.updateProperties(target.source, { default: businessObject });\n          })\n        };\n      }\n      break;\n    case 'replace-with-conditional-flow':\n      if (!businessObject.conditionExpression && is(businessObject.sourceRef, 'bpmn:Activity')) {\n\n        entries = {\n          ...entries,\n          [ replaceOption.actionName ]: self._createEntry(replaceOption, target, function() {\n            var conditionExpression = moddle.create('bpmn:FormalExpression', { body: '' });\n\n            modeling.updateProperties(target, { conditionExpression: conditionExpression });\n          })\n        };\n      }\n      break;\n    default:\n\n      // conditional flow -> sequence flow\n      if (is(businessObject.sourceRef, 'bpmn:Activity') && businessObject.conditionExpression) {\n        entries = {\n          ...entries,\n          [ replaceOption.actionName ]: self._createEntry(replaceOption, target, function() {\n            modeling.updateProperties(target, { conditionExpression: undefined });\n          })\n        };\n      }\n\n      // default flow -> sequence flow\n      if ((is(businessObject.sourceRef, 'bpmn:ExclusiveGateway') ||\n           is(businessObject.sourceRef, 'bpmn:InclusiveGateway') ||\n           is(businessObject.sourceRef, 'bpmn:ComplexGateway') ||\n           is(businessObject.sourceRef, 'bpmn:Activity')) &&\n           businessObject.sourceRef.default === businessObject) {\n        entries = {\n          ...entries,\n          [ replaceOption.actionName ]: self._createEntry(replaceOption, target, function() {\n            modeling.updateProperties(target.source, { default: undefined });\n          })\n        };\n      }\n    }\n  });\n\n  return entries;\n};\n\n/**\n * Create a popup menu entry for the given replace option.\n *\n * @param  {ReplaceOption} replaceOption\n * @param  {PopupMenuTarget} target\n * @param  {PopupMenuEntryAction} [action]\n *\n * @return {PopupMenuEntry}\n */\nReplaceMenuProvider.prototype._createEntry = function(replaceOption, target, action) {\n  var translate = this._translate;\n  var replaceElement = this._bpmnReplace.replaceElement;\n\n  var replaceAction = function() {\n    return replaceElement(target, replaceOption.target);\n  };\n\n  var label = replaceOption.label;\n  if (label && typeof label === 'function') {\n    label = label(target);\n  }\n\n  action = action || replaceAction;\n\n  return {\n    label: translate(label),\n    className: replaceOption.className,\n    action: action\n  };\n};\n\n/**\n * Get popup menu header entries for the loop characteristics of the given BPMN element.\n *\n * @param  {PopupMenuTarget} target\n *\n * @return {PopupMenuHeaderEntries}\n */\nReplaceMenuProvider.prototype._getLoopCharacteristicsHeaderEntries = function(target) {\n\n  var self = this;\n  var translate = this._translate;\n\n  function toggleLoopCharacteristics(event, entry) {\n    if (entry.active) {\n      self._modeling.updateProperties(target, { loopCharacteristics: undefined });\n\n      return;\n    }\n\n    var loopCharacteristics = target.businessObject.get('loopCharacteristics');\n\n    if (loopCharacteristics && is(loopCharacteristics, entry.options.loopCharacteristics)) {\n      self._modeling.updateModdleProperties(target, loopCharacteristics, { isSequential: entry.options.isSequential });\n    } else {\n      loopCharacteristics = self._moddle.create(entry.options.loopCharacteristics, {\n        isSequential: entry.options.isSequential\n      });\n\n      self._modeling.updateProperties(target, { loopCharacteristics: loopCharacteristics });\n    }\n  }\n\n  var businessObject = getBusinessObject(target),\n      loopCharacteristics = businessObject.loopCharacteristics;\n\n  var isSequential,\n      isLoop,\n      isParallel;\n\n  if (loopCharacteristics) {\n    isSequential = loopCharacteristics.isSequential;\n    isLoop = loopCharacteristics.isSequential === undefined;\n    isParallel = loopCharacteristics.isSequential !== undefined && !loopCharacteristics.isSequential;\n  }\n\n\n  return {\n    'toggle-parallel-mi' : {\n      className: 'bpmn-icon-parallel-mi-marker',\n      title: translate('Parallel multi-instance'),\n      active: isParallel,\n      action: toggleLoopCharacteristics,\n      options: {\n        loopCharacteristics: 'bpmn:MultiInstanceLoopCharacteristics',\n        isSequential: false\n      }\n    },\n    'toggle-sequential-mi': {\n      className: 'bpmn-icon-sequential-mi-marker',\n      title: translate('Sequential multi-instance'),\n      active: isSequential,\n      action: toggleLoopCharacteristics,\n      options: {\n        loopCharacteristics: 'bpmn:MultiInstanceLoopCharacteristics',\n        isSequential: true\n      }\n    },\n    'toggle-loop': {\n      className: 'bpmn-icon-loop-marker',\n      title: translate('Loop'),\n      active: isLoop,\n      action: toggleLoopCharacteristics,\n      options: {\n        loopCharacteristics: 'bpmn:StandardLoopCharacteristics'\n      }\n    }\n  };\n};\n\n/**\n * Get popup menu header entries for the collection property of the given BPMN element.\n *\n * @param  {PopupMenuTarget} target\n *\n * @return {PopupMenuHeaderEntries}\n */\nReplaceMenuProvider.prototype._getCollectionHeaderEntries = function(target) {\n\n  var self = this;\n  var translate = this._translate;\n\n  var dataObject = target.businessObject.dataObjectRef;\n\n  if (!dataObject) {\n    return {};\n  }\n\n  function toggleIsCollection(event, entry) {\n    self._modeling.updateModdleProperties(\n      target,\n      dataObject,\n      { isCollection: !entry.active });\n  }\n\n  var isCollection = dataObject.isCollection;\n\n  return {\n    'toggle-is-collection': {\n      className: 'bpmn-icon-parallel-mi-marker',\n      title: translate('Collection'),\n      active: isCollection,\n      action: toggleIsCollection,\n    }\n  };\n};\n\n/**\n * Get popup menu header entries for the participant multiplicity property of the given BPMN element.\n *\n * @param  {PopupMenuTarget} target\n *\n * @return {PopupMenuHeaderEntries}\n */\nReplaceMenuProvider.prototype._getParticipantMultiplicityHeaderEntries = function(target) {\n\n  var self = this;\n  var bpmnFactory = this._bpmnFactory;\n  var translate = this._translate;\n\n  function toggleParticipantMultiplicity(event, entry) {\n    var isActive = entry.active;\n    var participantMultiplicity;\n\n    if (!isActive) {\n      participantMultiplicity = bpmnFactory.create('bpmn:ParticipantMultiplicity');\n    }\n\n    self._modeling.updateProperties(\n      target,\n      { participantMultiplicity: participantMultiplicity });\n  }\n\n  var participantMultiplicity = target.businessObject.participantMultiplicity;\n\n  return {\n    'toggle-participant-multiplicity': {\n      className: 'bpmn-icon-parallel-mi-marker',\n      title: translate('Participant multiplicity'),\n      active: !!participantMultiplicity,\n      action: toggleParticipantMultiplicity,\n    }\n  };\n};\n\nReplaceMenuProvider.prototype._getNonInterruptingHeaderEntries = function(element) {\n  const translate = this._translate;\n  const businessObject = getBusinessObject(element);\n  const self = this;\n\n  const interruptingProperty = getInterruptingProperty(element);\n\n  const icon = is(element, 'bpmn:BoundaryEvent') ? Icons['intermediate-event-non-interrupting'] : Icons['start-event-non-interrupting'];\n\n  const isNonInterrupting = !businessObject[interruptingProperty];\n\n  return {\n    'toggle-non-interrupting': {\n      imageHtml: icon,\n      title: translate('Toggle non-interrupting'),\n      active: isNonInterrupting,\n      action: function() {\n        self._modeling.updateProperties(element, {\n          [interruptingProperty]: !!isNonInterrupting\n        });\n      }\n    }\n  };\n};","import {\n  getBusinessObject\n} from '../../../util/ModelUtil';\n\nimport {\n  isExpanded\n} from '../../../util/DiUtil';\n\n/**\n * @typedef {import('../../../model/Types').Element} Element\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').PopupMenuTarget} PopupMenuTarget\n *\n * @typedef {(entry: PopupMenuTarget) => boolean} DifferentTypeValidator\n */\n\n/**\n * Returns true, if an element is from a different type\n * than a target definition. Takes into account the type,\n * event definition type and triggeredByEvent property.\n *\n * @param {Element} element\n *\n * @return {DifferentTypeValidator}\n */\nexport function isDifferentType(element) {\n\n  return function(entry) {\n    var target = entry.target;\n\n    var businessObject = getBusinessObject(element),\n        eventDefinition = businessObject.eventDefinitions && businessObject.eventDefinitions[0];\n\n    var isTypeEqual = businessObject.$type === target.type;\n\n    var isEventDefinitionEqual = (\n      (eventDefinition && eventDefinition.$type) === target.eventDefinitionType\n    );\n\n    var isTriggeredByEventEqual = (\n\n      // coherse to <false>\n      !!target.triggeredByEvent === !!businessObject.triggeredByEvent\n    );\n\n    var isExpandedEqual = (\n      target.isExpanded === undefined ||\n      target.isExpanded === isExpanded(element)\n    );\n\n    return !isTypeEqual || !isEventDefinitionEqual || !isTriggeredByEventEqual || !isExpandedEqual;\n  };\n}\n","import PopupMenuModule from 'diagram-js/lib/features/popup-menu';\nimport ReplaceModule from '../replace';\n\nimport ReplaceMenuProvider from './ReplaceMenuProvider';\nimport AutoPlaceModule from '../auto-place';\n\nexport default {\n  __depends__: [\n    PopupMenuModule,\n    ReplaceModule,\n    AutoPlaceModule\n  ],\n  __init__: [\n    'replaceMenuProvider'\n  ],\n  replaceMenuProvider: [ 'type', ReplaceMenuProvider ]\n};","import {\n  assign,\n  forEach,\n  isArray,\n  every\n} from 'min-dash';\n\nimport {\n  is\n} from '../../util/ModelUtil';\n\nimport {\n  isExpanded,\n  isHorizontal,\n  isEventSubProcess\n} from '../../util/DiUtil';\n\nimport {\n  isAny\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  getChildLanes\n} from '../modeling/util/LaneUtil';\n\nimport {\n  hasPrimaryModifier\n} from 'diagram-js/lib/util/Mouse';\n\n/**\n * @typedef {import('didi').Injector} Injector\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/features/context-pad/ContextPad').default} ContextPad\n * @typedef {import('../modeling/Modeling').default} Modeling\n * @typedef {import('../modeling/ElementFactory').default} ElementFactory\n * @typedef {import('../append-preview/AppendPreview').default} AppendPreview\n * @typedef {import('diagram-js/lib/features/connect/Connect').default} Connect\n * @typedef {import('diagram-js/lib/features/create/Create').default} Create\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').default} PopupMenu\n * @typedef {import('diagram-js/lib/features/canvas/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/features/rules/Rules').default} Rules\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').ModdleElement} ModdleElement\n *\n * @typedef {import('diagram-js/lib/features/context-pad/ContextPadProvider').default<Element>} BaseContextPadProvider\n * @typedef {import('diagram-js/lib/features/context-pad/ContextPadProvider').ContextPadEntries} ContextPadEntries\n * @typedef {import('diagram-js/lib/features/context-pad/ContextPadProvider').ContextPadEntry} ContextPadEntry\n *\n * @typedef { { autoPlace?: boolean; } } ContextPadConfig\n */\n\n/**\n * BPMN-specific context pad provider.\n *\n * @implements {BaseContextPadProvider}\n *\n * @param {ContextPadConfig} config\n * @param {Injector} injector\n * @param {EventBus} eventBus\n * @param {ContextPad} contextPad\n * @param {Modeling} modeling\n * @param {ElementFactory} elementFactory\n * @param {Connect} connect\n * @param {Create} create\n * @param {PopupMenu} popupMenu\n * @param {Canvas} canvas\n * @param {Rules} rules\n * @param {Translate} translate\n * @param {AppendPreview} appendPreview\n */\nexport default function ContextPadProvider(\n    config, injector, eventBus,\n    contextPad, modeling, elementFactory,\n    connect, create, popupMenu,\n    canvas, rules, translate, appendPreview) {\n\n  config = config || {};\n\n  contextPad.registerProvider(this);\n\n  this._contextPad = contextPad;\n\n  this._modeling = modeling;\n\n  this._elementFactory = elementFactory;\n  this._connect = connect;\n  this._create = create;\n  this._popupMenu = popupMenu;\n  this._canvas = canvas;\n  this._rules = rules;\n  this._translate = translate;\n  this._eventBus = eventBus;\n  this._appendPreview = appendPreview;\n\n  if (config.autoPlace !== false) {\n    this._autoPlace = injector.get('autoPlace', false);\n  }\n\n  eventBus.on('create.end', 250, function(event) {\n    var context = event.context,\n        shape = context.shape;\n\n    if (!hasPrimaryModifier(event) || !contextPad.isOpen(shape)) {\n      return;\n    }\n\n    var entries = contextPad.getEntries(shape);\n\n    if (entries.replace) {\n      entries.replace.action.click(event, shape);\n    }\n  });\n\n  eventBus.on('contextPad.close', function() {\n    appendPreview.cleanUp();\n  });\n}\n\nContextPadProvider.$inject = [\n  'config.contextPad',\n  'injector',\n  'eventBus',\n  'contextPad',\n  'modeling',\n  'elementFactory',\n  'connect',\n  'create',\n  'popupMenu',\n  'canvas',\n  'rules',\n  'translate',\n  'appendPreview'\n];\n\n/**\n * @param {Element[]} elements\n *\n * @return {ContextPadEntries}\n */\nContextPadProvider.prototype.getMultiElementContextPadEntries = function(elements) {\n  var modeling = this._modeling;\n\n  var actions = {};\n\n  if (this._isDeleteAllowed(elements)) {\n    assign(actions, {\n      'delete': {\n        group: 'edit',\n        className: 'bpmn-icon-trash',\n        title: this._translate('Delete'),\n        action: {\n          click: function(event, elements) {\n            modeling.removeElements(elements.slice());\n          }\n        }\n      }\n    });\n  }\n\n  return actions;\n};\n\n/**\n * @param {Element[]} elements\n *\n * @return {boolean}\n */\nContextPadProvider.prototype._isDeleteAllowed = function(elements) {\n\n  var baseAllowed = this._rules.allowed('elements.delete', {\n    elements: elements\n  });\n\n  if (isArray(baseAllowed)) {\n    return every(elements, el => baseAllowed.includes(el));\n  }\n\n  return baseAllowed;\n};\n\n/**\n * @param {Element} element\n *\n * @return {ContextPadEntries}\n */\nContextPadProvider.prototype.getContextPadEntries = function(element) {\n  var contextPad = this._contextPad,\n      modeling = this._modeling,\n      elementFactory = this._elementFactory,\n      connect = this._connect,\n      create = this._create,\n      popupMenu = this._popupMenu,\n      autoPlace = this._autoPlace,\n      translate = this._translate,\n      appendPreview = this._appendPreview;\n\n  var actions = {};\n\n  if (element.type === 'label') {\n    if (this._isDeleteAllowed([ element ])) {\n      assign(actions, deleteAction());\n    }\n\n    return actions;\n  }\n\n  var businessObject = element.businessObject;\n\n  function startConnect(event, element) {\n    connect.start(event, element);\n  }\n\n  function removeElement(e, element) {\n    modeling.removeElements([ element ]);\n  }\n\n  function deleteAction() {\n    return {\n      'delete': {\n        group: 'edit',\n        className: 'bpmn-icon-trash',\n        title: translate('Delete'),\n        action: {\n          click: removeElement\n        }\n      }\n    };\n  }\n\n  function getReplaceMenuPosition(element) {\n\n    var Y_OFFSET = 5;\n\n    var pad = contextPad.getPad(element).html;\n\n    var padRect = pad.getBoundingClientRect();\n\n    var pos = {\n      x: padRect.left,\n      y: padRect.bottom + Y_OFFSET\n    };\n\n    return pos;\n  }\n\n  /**\n   * Create an append action.\n   *\n   * @param {string} type\n   * @param {string} className\n   * @param {string} title\n   * @param {Object} [options]\n   *\n   * @return {ContextPadEntry}\n   */\n  function appendAction(type, className, title, options) {\n\n    function appendStart(event, element) {\n\n      var shape = elementFactory.createShape(assign({ type: type }, options));\n\n      create.start(event, shape, {\n        source: element\n      });\n    }\n\n    var append = autoPlace ? function(_, element) {\n      var shape = elementFactory.createShape(assign({ type: type }, options));\n\n      autoPlace.append(element, shape);\n    } : appendStart;\n\n    var previewAppend = autoPlace ? function(_, element) {\n\n      // mouseover\n      appendPreview.create(element, type, options);\n\n      return () => {\n\n        // mouseout\n        appendPreview.cleanUp();\n      };\n    } : null;\n\n    return {\n      group: 'model',\n      className: className,\n      title: title,\n      action: {\n        dragstart: appendStart,\n        click: append,\n        hover: previewAppend\n      }\n    };\n  }\n\n  function splitLaneHandler(count) {\n\n    return function(_, element) {\n\n      // actual split\n      modeling.splitLane(element, count);\n\n      // refresh context pad after split to\n      // get rid of split icons\n      contextPad.open(element, true);\n    };\n  }\n\n\n  if (isAny(businessObject, [ 'bpmn:Lane', 'bpmn:Participant' ]) && isExpanded(element)) {\n\n    var childLanes = getChildLanes(element);\n\n    assign(actions, {\n      'lane-insert-above': {\n        group: 'lane-insert-above',\n        className: 'bpmn-icon-lane-insert-above',\n        title: translate('Add lane above'),\n        action: {\n          click: function(event, element) {\n            modeling.addLane(element, 'top');\n          }\n        }\n      }\n    });\n\n    if (childLanes.length < 2) {\n\n      if (isHorizontal(element) ? element.height >= 120 : element.width >= 120) {\n        assign(actions, {\n          'lane-divide-two': {\n            group: 'lane-divide',\n            className: 'bpmn-icon-lane-divide-two',\n            title: translate('Divide into two lanes'),\n            action: {\n              click: splitLaneHandler(2)\n            }\n          }\n        });\n      }\n\n      if (isHorizontal(element) ? element.height >= 180 : element.width >= 180) {\n        assign(actions, {\n          'lane-divide-three': {\n            group: 'lane-divide',\n            className: 'bpmn-icon-lane-divide-three',\n            title: translate('Divide into three lanes'),\n            action: {\n              click: splitLaneHandler(3)\n            }\n          }\n        });\n      }\n    }\n\n    assign(actions, {\n      'lane-insert-below': {\n        group: 'lane-insert-below',\n        className: 'bpmn-icon-lane-insert-below',\n        title: translate('Add lane below'),\n        action: {\n          click: function(event, element) {\n            modeling.addLane(element, 'bottom');\n          }\n        }\n      }\n    });\n\n  }\n\n  if (is(businessObject, 'bpmn:FlowNode')) {\n\n    if (is(businessObject, 'bpmn:EventBasedGateway')) {\n\n      assign(actions, {\n        'append.receive-task': appendAction(\n          'bpmn:ReceiveTask',\n          'bpmn-icon-receive-task',\n          translate('Append receive task')\n        ),\n        'append.message-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-message',\n          translate('Append message intermediate catch event'),\n          { eventDefinitionType: 'bpmn:MessageEventDefinition' }\n        ),\n        'append.timer-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-timer',\n          translate('Append timer intermediate catch event'),\n          { eventDefinitionType: 'bpmn:TimerEventDefinition' }\n        ),\n        'append.condition-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-condition',\n          translate('Append conditional intermediate catch event'),\n          { eventDefinitionType: 'bpmn:ConditionalEventDefinition' }\n        ),\n        'append.signal-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-signal',\n          translate('Append signal intermediate catch event'),\n          { eventDefinitionType: 'bpmn:SignalEventDefinition' }\n        )\n      });\n    } else if (isEventType(businessObject, 'bpmn:BoundaryEvent', 'bpmn:CompensateEventDefinition')) {\n\n      assign(actions, {\n        'append.compensation-activity':\n            appendAction(\n              'bpmn:Task',\n              'bpmn-icon-task',\n              translate('Append compensation activity'),\n              {\n                isForCompensation: true\n              }\n            )\n      });\n    } else if (!is(businessObject, 'bpmn:EndEvent') &&\n        !businessObject.isForCompensation &&\n        !isEventType(businessObject, 'bpmn:IntermediateThrowEvent', 'bpmn:LinkEventDefinition') &&\n        !isEventSubProcess(businessObject)) {\n\n      assign(actions, {\n        'append.end-event': appendAction(\n          'bpmn:EndEvent',\n          'bpmn-icon-end-event-none',\n          translate('Append end event')\n        ),\n        'append.gateway': appendAction(\n          'bpmn:ExclusiveGateway',\n          'bpmn-icon-gateway-none',\n          translate('Append gateway')\n        ),\n        'append.append-task': appendAction(\n          'bpmn:Task',\n          'bpmn-icon-task',\n          translate('Append task')\n        ),\n        'append.intermediate-event': appendAction(\n          'bpmn:IntermediateThrowEvent',\n          'bpmn-icon-intermediate-event-none',\n          translate('Append intermediate/boundary event')\n        )\n      });\n    }\n  }\n\n  if (!popupMenu.isEmpty(element, 'bpmn-replace')) {\n\n    // Replace menu entry\n    assign(actions, {\n      'replace': {\n        group: 'edit',\n        className: 'bpmn-icon-screw-wrench',\n        title: translate('Change element'),\n        action: {\n          click: function(event, element) {\n\n            var position = assign(getReplaceMenuPosition(element), {\n              cursor: { x: event.x, y: event.y }\n            });\n\n            popupMenu.open(element, 'bpmn-replace', position, {\n              title: translate('Change element'),\n              width: 300,\n              search: true\n            });\n          }\n        }\n      }\n    });\n  }\n\n  if (is(businessObject, 'bpmn:SequenceFlow')) {\n    assign(actions, {\n      'append.text-annotation': appendAction(\n        'bpmn:TextAnnotation',\n        'bpmn-icon-text-annotation',\n        translate('Add text annotation')\n      )\n    });\n  }\n\n  if (is(businessObject, 'bpmn:MessageFlow')) {\n    assign(actions, {\n      'append.text-annotation': appendAction(\n        'bpmn:TextAnnotation',\n        'bpmn-icon-text-annotation',\n        translate('Add text annotation')\n      )\n    });\n  }\n\n  if (\n    isAny(businessObject, [\n      'bpmn:FlowNode',\n      'bpmn:InteractionNode',\n      'bpmn:DataObjectReference',\n      'bpmn:DataStoreReference',\n    ])\n  ) {\n    assign(actions, {\n      'append.text-annotation': appendAction(\n        'bpmn:TextAnnotation',\n        'bpmn-icon-text-annotation',\n        translate('Add text annotation')\n      ),\n      'connect': {\n        group: 'connect',\n        className: 'bpmn-icon-connection-multi',\n        title: translate('Connect to other element'),\n        action: {\n          click: startConnect,\n          dragstart: startConnect,\n        },\n      },\n    });\n  }\n\n  if (is(businessObject, 'bpmn:TextAnnotation')) {\n    assign(actions, {\n      'connect': {\n        group: 'connect',\n        className: 'bpmn-icon-connection-multi',\n        title: translate('Connect using association'),\n        action: {\n          click: startConnect,\n          dragstart: startConnect,\n        },\n      },\n    });\n  }\n\n  if (isAny(businessObject, [ 'bpmn:DataObjectReference', 'bpmn:DataStoreReference' ])) {\n    assign(actions, {\n      'connect': {\n        group: 'connect',\n        className: 'bpmn-icon-connection-multi',\n        title: translate('Connect using data input association'),\n        action: {\n          click: startConnect,\n          dragstart: startConnect\n        }\n      }\n    });\n  }\n\n  if (is(businessObject, 'bpmn:Group')) {\n    assign(actions, {\n      'append.text-annotation': appendAction(\n        'bpmn:TextAnnotation',\n        'bpmn-icon-text-annotation',\n        translate('Add text annotation')\n      )\n    });\n  }\n\n  if (this._isDeleteAllowed([ element ])) {\n    assign(actions, deleteAction());\n  }\n\n  return actions;\n};\n\n\n// helpers /////////\n\n/**\n * @param {ModdleElement} businessObject\n * @param {string} type\n * @param {string} eventDefinitionType\n *\n * @return {boolean}\n */\nfunction isEventType(businessObject, type, eventDefinitionType) {\n\n  var isType = businessObject.$instanceOf(type);\n  var isDefinition = false;\n\n  var definitions = businessObject.eventDefinitions || [];\n  forEach(definitions, function(def) {\n    if (def.$type === eventDefinitionType) {\n      isDefinition = true;\n    }\n  });\n\n  return isType && isDefinition;\n}\n","import AppendPreviewModule from '../append-preview';\nimport DirectEditingModule from 'diagram-js-direct-editing';\nimport ContextPadModule from 'diagram-js/lib/features/context-pad';\nimport SelectionModule from 'diagram-js/lib/features/selection';\nimport ConnectModule from 'diagram-js/lib/features/connect';\nimport CreateModule from 'diagram-js/lib/features/create';\nimport PopupMenuModule from '../popup-menu';\n\nimport ContextPadProvider from './ContextPadProvider';\n\nexport default {\n  __depends__: [\n    AppendPreviewModule,\n    DirectEditingModule,\n    ContextPadModule,\n    SelectionModule,\n    ConnectModule,\n    CreateModule,\n    PopupMenuModule\n  ],\n  __init__: [ 'contextPadProvider' ],\n  contextPadProvider: [ 'type', ContextPadProvider ]\n};","import inherits from 'inherits-browser';\n\nimport RuleProvider from 'diagram-js/lib/features/rules/RuleProvider';\nimport { getParents } from 'diagram-js/lib/util/Elements';\n\nimport {\n  filter\n} from 'min-dash';\n\nimport {\n  isAny\n} from '../modeling/util/ModelingUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * Registers element exclude filters for elements that currently do not support\n * distribution.\n *\n * @param {EventBus} eventBus\n */\nexport default function BpmnDistributeElements(eventBus) {\n  RuleProvider.call(this, eventBus);\n}\n\nBpmnDistributeElements.$inject = [ 'eventBus' ];\n\ninherits(BpmnDistributeElements, RuleProvider);\n\nBpmnDistributeElements.prototype.init = function() {\n  this.addRule('elements.distribute', function(context) {\n    var elements = context.elements;\n\n    elements = filter(elements, function(element) {\n      var cannotDistribute = isAny(element, [\n        'bpmn:Association',\n        'bpmn:BoundaryEvent',\n        'bpmn:DataInputAssociation',\n        'bpmn:DataOutputAssociation',\n        'bpmn:Lane',\n        'bpmn:MessageFlow',\n        'bpmn:SequenceFlow',\n        'bpmn:TextAnnotation'\n      ]);\n\n      return !(element.labelTarget || cannotDistribute);\n    });\n\n    // filter out elements which are children of any of the selected elements\n    elements = getParents(elements);\n\n    if (elements.length < 3) {\n      return false;\n    }\n\n    return elements;\n  });\n};\n","/**\n * To change the icons, modify the SVGs in `./resources`, execute `npx svgo -f resources --datauri enc -o dist`,\n * and then replace respective icons with the optimized data URIs in `./dist`.\n */\nvar icons = {\n  horizontal: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n                <polyline points=\"450 400 450 150 1350 150 1350 400\" style=\"fill:none;stroke:currentColor;stroke-width:100;stroke-linejoin:round;\"/>\n                <rect x=\"150\" y=\"450\" width=\"600\" height=\"1200\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n                <rect x=\"1050\" y=\"450\" width=\"600\" height=\"800\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n              </svg>`,\n  vertical: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1800 1800\">\n              <polyline points=\"400 1350 150 1350 150 450 400 450\" style=\"fill:none;stroke:currentColor;stroke-width:100;stroke-linejoin:round;\"/>\n              <rect x=\"450\" y=\"150\" width=\"1200\" height=\"600\" rx=\"1\" style=\"fill:none;stroke:currentColor;stroke-width:100;\"></rect>\n              <rect x=\"450\" y=\"1050\" width=\"800\" height=\"600\" rx=\"1\" style=\"fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;\"></rect>\n            </svg>`\n};\n\nexport default icons;\n","import ICONS from './DistributeElementsIcons';\n\nimport { assign } from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').default} PopupMenu\n * @typedef {import('./BpmnDistributeElements').default} DistributeElements\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n * @typedef {import('diagram-js/lib/features/rules/Rules').default} Rules\n *\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').PopupMenuEntries} PopupMenuEntries\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenuProvider').default} PopupMenuProvider\n * @typedef {import('diagram-js/lib/features/popup-menu/PopupMenu').PopupMenuTarget} PopupMenuTarget\n */\n\nvar LOW_PRIORITY = 900;\n\n/**\n * A provider for the distribute elements popup menu.\n *\n * @implements {PopupMenuProvider}\n *\n * @param {PopupMenu} popupMenu\n * @param {DistributeElements} distributeElements\n * @param {Translate} translate\n * @param {Rules} rules\n */\nexport default function DistributeElementsMenuProvider(\n    popupMenu, distributeElements, translate, rules) {\n  this._distributeElements = distributeElements;\n  this._translate = translate;\n  this._popupMenu = popupMenu;\n  this._rules = rules;\n\n  popupMenu.registerProvider('align-elements', LOW_PRIORITY, this);\n}\n\nDistributeElementsMenuProvider.$inject = [\n  'popupMenu',\n  'distributeElements',\n  'translate',\n  'rules'\n];\n\n/**\n * @param {PopupMenuTarget} target\n *\n * @return {PopupMenuEntries}\n */\nDistributeElementsMenuProvider.prototype.getPopupMenuEntries = function(target) {\n  var entries = {};\n\n  if (this._isAllowed(target)) {\n    assign(entries, this._getEntries(target));\n  }\n\n  return entries;\n};\n\nDistributeElementsMenuProvider.prototype._isAllowed = function(elements) {\n  return this._rules.allowed('elements.distribute', { elements: elements });\n};\n\nDistributeElementsMenuProvider.prototype._getEntries = function(elements) {\n  var distributeElements = this._distributeElements,\n      translate = this._translate,\n      popupMenu = this._popupMenu;\n\n  var entries = {\n    'distribute-elements-horizontal': {\n      group: 'distribute',\n      title: translate('Distribute elements horizontally'),\n      className: 'bjs-align-elements-menu-entry',\n      imageHtml: ICONS['horizontal'],\n      action: function(event, entry) {\n        distributeElements.trigger(elements, 'horizontal');\n        popupMenu.close();\n      }\n    },\n    'distribute-elements-vertical': {\n      group: 'distribute',\n      title: translate('Distribute elements vertically'),\n      imageHtml: ICONS['vertical'],\n      action: function(event, entry) {\n        distributeElements.trigger(elements, 'vertical');\n        popupMenu.close();\n      }\n    },\n  };\n\n  return entries;\n};\n","import DistributeElementsModule from 'diagram-js/lib/features/distribute-elements';\nimport PopupMenuModule from 'diagram-js/lib/features/popup-menu';\n\nimport BpmnDistributeElements from './BpmnDistributeElements';\nimport DistributeElementsMenuProvider from './DistributeElementsMenuProvider';\n\n\nexport default {\n  __depends__: [\n    PopupMenuModule,\n    DistributeElementsModule\n  ],\n  __init__: [\n    'bpmnDistributeElements',\n    'distributeElementsMenuProvider'\n  ],\n  bpmnDistributeElements: [ 'type', BpmnDistributeElements ],\n  distributeElementsMenuProvider: [ 'type', DistributeElementsMenuProvider ]\n};\n","import inherits from 'inherits-browser';\n\nimport EditorActions from 'diagram-js/lib/features/editor-actions/EditorActions';\n\nimport { filter } from 'min-dash';\n\nimport { is } from '../../util/ModelUtil';\n\nimport {\n  getBBox\n} from 'diagram-js/lib/util/Elements';\n\n/**\n * @typedef {import('didi').Injector} Injector\n */\n\n/**\n * Registers and executes BPMN specific editor actions.\n *\n * @param {Injector} injector\n */\nexport default function BpmnEditorActions(injector) {\n  injector.invoke(EditorActions, this);\n}\n\ninherits(BpmnEditorActions, EditorActions);\n\nBpmnEditorActions.$inject = [\n  'injector'\n];\n\n/**\n * Register default actions.\n *\n * @param {Injector} injector\n */\nBpmnEditorActions.prototype._registerDefaultActions = function(injector) {\n\n  // (0) invoke super method\n\n  EditorActions.prototype._registerDefaultActions.call(this, injector);\n\n  // (1) retrieve optional components to integrate with\n\n  var canvas = injector.get('canvas', false);\n  var elementRegistry = injector.get('elementRegistry', false);\n  var selection = injector.get('selection', false);\n  var spaceTool = injector.get('spaceTool', false);\n  var lassoTool = injector.get('lassoTool', false);\n  var handTool = injector.get('handTool', false);\n  var globalConnect = injector.get('globalConnect', false);\n  var distributeElements = injector.get('distributeElements', false);\n  var alignElements = injector.get('alignElements', false);\n  var directEditing = injector.get('directEditing', false);\n  var searchPad = injector.get('searchPad', false);\n  var modeling = injector.get('modeling', false);\n  var contextPad = injector.get('contextPad', false);\n\n  // (2) check components and register actions\n\n  if (canvas && elementRegistry && selection) {\n    this._registerAction('selectElements', function() {\n\n      // select all elements except for the invisible\n      // root element\n      var rootElement = canvas.getRootElement();\n\n      var elements = elementRegistry.filter(function(element) {\n        return element !== rootElement;\n      });\n\n      selection.select(elements);\n\n      return elements;\n    });\n  }\n\n  if (spaceTool) {\n    this._registerAction('spaceTool', function() {\n      spaceTool.toggle();\n    });\n  }\n\n  if (lassoTool) {\n    this._registerAction('lassoTool', function() {\n      lassoTool.toggle();\n    });\n  }\n\n  if (handTool) {\n    this._registerAction('handTool', function() {\n      handTool.toggle();\n    });\n  }\n\n  if (globalConnect) {\n    this._registerAction('globalConnectTool', function() {\n      globalConnect.toggle();\n    });\n  }\n\n  if (selection && distributeElements) {\n    this._registerAction('distributeElements', function(opts) {\n      var currentSelection = selection.get(),\n          type = opts.type;\n\n      if (currentSelection.length) {\n        distributeElements.trigger(currentSelection, type);\n      }\n    });\n  }\n\n  if (selection && alignElements) {\n    this._registerAction('alignElements', function(opts) {\n      var currentSelection = selection.get(),\n          aligneableElements = [],\n          type = opts.type;\n\n      if (currentSelection.length) {\n        aligneableElements = filter(currentSelection, function(element) {\n          return !is(element, 'bpmn:Lane');\n        });\n\n        alignElements.trigger(aligneableElements, type);\n      }\n    });\n  }\n\n  if (selection && modeling) {\n    this._registerAction('setColor', function(opts) {\n      var currentSelection = selection.get();\n\n      if (currentSelection.length) {\n        modeling.setColor(currentSelection, opts);\n      }\n    });\n  }\n\n  if (selection && directEditing) {\n    this._registerAction('directEditing', function() {\n      var currentSelection = selection.get();\n\n      if (currentSelection.length) {\n        directEditing.activate(currentSelection[0]);\n      }\n    });\n  }\n\n  if (searchPad) {\n    this._registerAction('find', function() {\n      searchPad.toggle();\n    });\n  }\n\n  if (canvas && modeling) {\n    this._registerAction('moveToOrigin', function() {\n      var rootElement = canvas.getRootElement(),\n          boundingBox,\n          elements;\n\n      if (is(rootElement, 'bpmn:Collaboration')) {\n        elements = elementRegistry.filter(function(element) {\n          return is(element.parent, 'bpmn:Collaboration');\n        });\n      } else {\n        elements = elementRegistry.filter(function(element) {\n          return element !== rootElement && !is(element.parent, 'bpmn:SubProcess');\n        });\n      }\n\n      boundingBox = getBBox(elements);\n\n      modeling.moveElements(\n        elements,\n        { x: -boundingBox.x, y: -boundingBox.y },\n        rootElement\n      );\n    });\n  }\n\n  if (selection && contextPad) {\n    this._registerAction('replaceElement', function(event) {\n      contextPad.triggerEntry('replace', 'click', event);\n    });\n  }\n\n};\n","import EditorActionsModule from 'diagram-js/lib/features/editor-actions';\n\nimport BpmnEditorActions from './BpmnEditorActions';\n\nexport default {\n  __depends__: [\n    EditorActionsModule\n  ],\n  editorActions: [ 'type', BpmnEditorActions ]\n};\n","import { isAny } from '../modeling/util/ModelingUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n */\r\n\r\n/**\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function BpmnGridSnapping(eventBus) {\r\n  eventBus.on([\r\n    'create.init',\r\n    'shape.move.init'\r\n  ], function(event) {\r\n    var context = event.context,\r\n        shape = event.shape;\r\n\r\n    if (isAny(shape, [\r\n      'bpmn:Participant',\r\n      'bpmn:SubProcess',\r\n      'bpmn:TextAnnotation'\r\n    ])) {\r\n      if (!context.gridSnappingContext) {\r\n        context.gridSnappingContext = {};\r\n      }\r\n\r\n      context.gridSnappingContext.snapLocation = 'top-left';\r\n    }\r\n  });\r\n}\r\n\r\nBpmnGridSnapping.$inject = [ 'eventBus' ];","import { getNewShapePosition } from '../../auto-place/BpmnAutoPlaceUtil';\r\n\r\nimport { getMid } from 'diagram-js/lib/layout/LayoutUtil';\r\nimport { is } from '../../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('diagram-js/lib/features/grid-snapping/GridSnapping').default} GridSnapping\r\n *\r\n * @typedef {import('diagram-js/lib/util/Types').Axis} Axis\r\n */\r\n\r\nvar HIGH_PRIORITY = 2000;\r\n\r\n/**\r\n * @param {EventBus} eventBus\r\n * @param {GridSnapping} gridSnapping\r\n * @param {ElementRegistry} elementRegistry\r\n */\r\nexport default function GridSnappingAutoPlaceBehavior(eventBus, gridSnapping, elementRegistry) {\r\n  eventBus.on('autoPlace', HIGH_PRIORITY, function(context) {\r\n    var source = context.source,\r\n        sourceMid = getMid(source),\r\n        shape = context.shape;\r\n\r\n    var position = getNewShapePosition(source, shape, elementRegistry);\r\n\r\n    [ 'x', 'y' ].forEach(function(axis) {\r\n      var options = {};\r\n\r\n      // do not snap if x/y equal\r\n      if (position[ axis ] === sourceMid[ axis ]) {\r\n        return;\r\n      }\r\n\r\n      if (position[ axis ] > sourceMid[ axis ]) {\r\n        options.min = position[ axis ];\r\n      } else {\r\n        options.max = position[ axis ];\r\n      }\r\n\r\n      if (is(shape, 'bpmn:TextAnnotation')) {\r\n\r\n        if (isHorizontal(axis)) {\r\n          options.offset = -shape.width / 2;\r\n        } else {\r\n          options.offset = -shape.height / 2;\r\n        }\r\n\r\n      }\r\n\r\n      position[ axis ] = gridSnapping.snapValue(position[ axis ], options);\r\n\r\n    });\r\n\r\n    // must be returned to be considered by auto place\r\n    return position;\r\n  });\r\n}\r\n\r\nGridSnappingAutoPlaceBehavior.$inject = [\r\n  'eventBus',\r\n  'gridSnapping',\r\n  'elementRegistry'\r\n];\r\n\r\n// helpers //////////\r\n\r\n/**\r\n * @param {Axis} axis\r\n *\r\n * @return {boolean}\r\n */\r\nfunction isHorizontal(axis) {\r\n  return axis === 'x';\r\n}","import { is } from '../../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('diagram-js/lib/features/grid-snapping/GridSnapping').default} GridSnapping\r\n */\r\n\r\nvar HIGHER_PRIORITY = 1750;\r\n\r\n/**\r\n * @param {Canvas} canvas\r\n * @param {EventBus} eventBus\r\n * @param {GridSnapping} gridSnapping\r\n */\r\nexport default function GridSnappingParticipantBehavior(canvas, eventBus, gridSnapping) {\r\n  eventBus.on([\r\n    'create.start',\r\n    'shape.move.start'\r\n  ], HIGHER_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        shape = context.shape,\r\n        rootElement = canvas.getRootElement();\r\n\r\n    if (!is(shape, 'bpmn:Participant') ||\r\n      !is(rootElement, 'bpmn:Process') ||\r\n      !rootElement.children.length) {\r\n      return;\r\n    }\r\n\r\n    var createConstraints = context.createConstraints;\r\n\r\n    if (!createConstraints) {\r\n      return;\r\n    }\r\n\r\n    shape.width = gridSnapping.snapValue(shape.width, { min: shape.width });\r\n    shape.height = gridSnapping.snapValue(shape.height, { min: shape.height });\r\n  });\r\n}\r\n\r\nGridSnappingParticipantBehavior.$inject = [\r\n  'canvas',\r\n  'eventBus',\r\n  'gridSnapping'\r\n];","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { pointsAligned } from 'diagram-js/lib/util/Geometry';\n\nimport {\n  assign\n} from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/features/grid-snapping/GridSnapping').default} GridSnapping\n * @typedef {import('../../modeling/Modeling').default} Modeling\n *\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\n */\n\nvar HIGH_PRIORITY = 3000;\n\n\n/**\n * Snaps connections with Manhattan layout.\n *\n * @param {EventBus} eventBus\n * @param {GridSnapping} gridSnapping\n * @param {Modeling} modeling\n */\nexport default function GridSnappingLayoutConnectionBehavior(eventBus, gridSnapping, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  this._gridSnapping = gridSnapping;\n\n  var self = this;\n\n  this.postExecuted([\n    'connection.create',\n    'connection.layout'\n  ], HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        connection = context.connection,\n        hints = context.hints || {},\n        waypoints = connection.waypoints;\n\n    if (hints.connectionStart || hints.connectionEnd || hints.createElementsBehavior === false) {\n      return;\n    }\n\n    if (!hasMiddleSegments(waypoints)) {\n      return;\n    }\n\n    modeling.updateWaypoints(connection, self.snapMiddleSegments(waypoints));\n  });\n}\n\nGridSnappingLayoutConnectionBehavior.$inject = [\n  'eventBus',\n  'gridSnapping',\n  'modeling'\n];\n\ninherits(GridSnappingLayoutConnectionBehavior, CommandInterceptor);\n\n/**\n * Snap middle segments of a given connection.\n *\n * @param {Point[]} waypoints\n *\n * @return {Point[]}\n */\nGridSnappingLayoutConnectionBehavior.prototype.snapMiddleSegments = function(waypoints) {\n  var gridSnapping = this._gridSnapping,\n      snapped;\n\n  waypoints = waypoints.slice();\n\n  for (var i = 1; i < waypoints.length - 2; i++) {\n\n    snapped = snapSegment(gridSnapping, waypoints[i], waypoints[i + 1]);\n\n    waypoints[i] = snapped[0];\n    waypoints[i + 1] = snapped[1];\n  }\n\n  return waypoints;\n};\n\n\n// helpers //////////\n\n/**\n * Check whether a connection has a middle segments.\n *\n * @param {Point[]} waypoints\n *\n * @return {boolean}\n */\nfunction hasMiddleSegments(waypoints) {\n  return waypoints.length > 3;\n}\n\n/**\n * Check whether an alignment is horizontal.\n *\n * @param {string} aligned\n *\n * @return {boolean}\n */\nfunction horizontallyAligned(aligned) {\n  return aligned === 'h';\n}\n\n/**\n * Check whether an alignment is vertical.\n *\n * @param {string} aligned\n *\n * @return {boolean}\n */\nfunction verticallyAligned(aligned) {\n  return aligned === 'v';\n}\n\n/**\n * Get middle segments from a given connection.\n *\n * @param {Point[]} waypoints\n *\n * @return {Point[]}\n */\nfunction snapSegment(gridSnapping, segmentStart, segmentEnd) {\n\n  var aligned = pointsAligned(segmentStart, segmentEnd);\n\n  var snapped = {};\n\n  if (horizontallyAligned(aligned)) {\n\n    // snap horizontally\n    snapped.y = gridSnapping.snapValue(segmentStart.y);\n  }\n\n  if (verticallyAligned(aligned)) {\n\n    // snap vertically\n    snapped.x = gridSnapping.snapValue(segmentStart.x);\n  }\n\n  if ('x' in snapped || 'y' in snapped) {\n    segmentStart = assign({}, segmentStart, snapped);\n    segmentEnd = assign({}, segmentEnd, snapped);\n  }\n\n  return [ segmentStart, segmentEnd ];\n}","import GridSnappingAutoPlaceBehavior from './GridSnappingAutoPlaceBehavior';\r\nimport GridSnappingParticipantBehavior from './GridSnappingParticipantBehavior';\r\nimport GridSnappingLayoutConnectionBehavior from './GridSnappingLayoutConnectionBehavior';\r\n\r\nexport default {\r\n  __init__: [\r\n    'gridSnappingAutoPlaceBehavior',\r\n    'gridSnappingParticipantBehavior',\r\n    'gridSnappingLayoutConnectionBehavior',\r\n  ],\r\n  gridSnappingAutoPlaceBehavior: [ 'type', GridSnappingAutoPlaceBehavior ],\r\n  gridSnappingParticipantBehavior: [ 'type', GridSnappingParticipantBehavior ],\r\n  gridSnappingLayoutConnectionBehavior: [ 'type', GridSnappingLayoutConnectionBehavior ]\r\n};","import BpmnGridSnapping from './BpmnGridSnapping';\r\nimport GridSnappingModule from 'diagram-js/lib/features/grid-snapping';\r\n\r\nimport GridSnappingBehaviorModule from './behavior';\r\n\r\nexport default {\r\n  __depends__: [\r\n    GridSnappingModule,\r\n    GridSnappingBehaviorModule\r\n  ],\r\n  __init__: [ 'bpmnGridSnapping' ],\r\n  bpmnGridSnapping: [ 'type', BpmnGridSnapping ]\r\n};","import { is } from '../../util/ModelUtil';\n\nimport {\n  isExpanded,\n  isHorizontal\n} from '../../util/DiUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/features/interaction-events/InteractionEvents').default} InteractionEvents\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n */\n\nvar LABEL_WIDTH = 30,\n    LABEL_HEIGHT = 30;\n\n\n/**\n * BPMN-specific hit zones and interaction fixes.\n *\n * @param {EventBus} eventBus\n * @param {InteractionEvents} interactionEvents\n */\nexport default function BpmnInteractionEvents(eventBus, interactionEvents) {\n\n  this._interactionEvents = interactionEvents;\n\n  var self = this;\n\n  eventBus.on([\n    'interactionEvents.createHit',\n    'interactionEvents.updateHit'\n  ], function(context) {\n    var element = context.element,\n        gfx = context.gfx;\n\n    if (is(element, 'bpmn:Lane')) {\n      return self._createParticipantHit(element, gfx);\n    } else if (is(element, 'bpmn:Participant')) {\n      if (isExpanded(element)) {\n        return self._createParticipantHit(element, gfx);\n      } else {\n        return self._createDefaultHit(element, gfx);\n      }\n    } else if (is(element, 'bpmn:SubProcess')) {\n      if (isExpanded(element)) {\n        return self._createSubProcessHit(element, gfx);\n      } else {\n        return self._createDefaultHit(element, gfx);\n      }\n    }\n  });\n\n}\n\nBpmnInteractionEvents.$inject = [\n  'eventBus',\n  'interactionEvents'\n];\n\n/**\n * @param {Element} element\n * @param {SVGElement} gfx\n *\n * @return {boolean}\n */\nBpmnInteractionEvents.prototype._createDefaultHit = function(element, gfx) {\n  this._interactionEvents.removeHits(gfx);\n\n  this._interactionEvents.createDefaultHit(element, gfx);\n\n  // indicate that we created a hit\n  return true;\n};\n\n/**\n * @param {Shape} element\n * @param {SVGElement} gfx\n *\n * @return {boolean}\n */\nBpmnInteractionEvents.prototype._createParticipantHit = function(element, gfx) {\n\n  // remove existing hits\n  this._interactionEvents.removeHits(gfx);\n\n  // add body hit\n  this._interactionEvents.createBoxHit(gfx, 'no-move', {\n    width: element.width,\n    height: element.height\n  });\n\n  // add outline hit\n  this._interactionEvents.createBoxHit(gfx, 'click-stroke', {\n    width: element.width,\n    height: element.height\n  });\n\n  // add label hit\n  var box = isHorizontal(element) ? {\n    width: LABEL_WIDTH,\n    height: element.height\n  } : {\n    width: element.width,\n    height: LABEL_HEIGHT\n  };\n\n  this._interactionEvents.createBoxHit(gfx, 'all', box);\n\n  // indicate that we created a hit\n  return true;\n};\n\n/**\n * @param {Shape} element\n * @param {SVGElement} gfx\n *\n * @return {boolean}\n */\nBpmnInteractionEvents.prototype._createSubProcessHit = function(element, gfx) {\n\n  // remove existing hits\n  this._interactionEvents.removeHits(gfx);\n\n  // add body hit\n  this._interactionEvents.createBoxHit(gfx, 'no-move', {\n    width: element.width,\n    height: element.height\n  });\n\n  // add outline hit\n  this._interactionEvents.createBoxHit(gfx, 'click-stroke', {\n    width: element.width,\n    height: element.height\n  });\n\n  // add label hit\n  this._interactionEvents.createBoxHit(gfx, 'all', {\n    width: element.width,\n    height: LABEL_HEIGHT\n  });\n\n  // indicate that we created a hit\n  return true;\n};","import BpmnInteractionEvents from './BpmnInteractionEvents';\n\nexport default {\n  __init__: [ 'bpmnInteractionEvents' ],\n  bpmnInteractionEvents: [ 'type', BpmnInteractionEvents ]\n};","import inherits from 'inherits-browser';\n\nimport KeyboardBindings from 'diagram-js/lib/features/keyboard/KeyboardBindings';\n\n/**\n * @typedef {import('didi').Injector} Injector\n * @typedef {import('diagram-js/lib/features/editor-actions/EditorActions').default} EditorActions\n * @typedef {import('diagram-js/lib/features/keyboard/Keyboard').default} Keyboard\n */\n\n/**\n * BPMN 2.0 specific keyboard bindings.\n *\n * @param {Injector} injector\n */\nexport default function BpmnKeyboardBindings(injector) {\n  injector.invoke(KeyboardBindings, this);\n}\n\ninherits(BpmnKeyboardBindings, KeyboardBindings);\n\nBpmnKeyboardBindings.$inject = [\n  'injector'\n];\n\n\n/**\n * Register available keyboard bindings.\n *\n * @param {Keyboard} keyboard\n * @param {EditorActions} editorActions\n */\nBpmnKeyboardBindings.prototype.registerBindings = function(keyboard, editorActions) {\n\n  // inherit default bindings\n  KeyboardBindings.prototype.registerBindings.call(this, keyboard, editorActions);\n\n  /**\n   * Add keyboard binding if respective editor action\n   * is registered.\n   *\n   * @param {string} action name\n   * @param {Function} fn that implements the key binding\n   */\n  function addListener(action, fn) {\n\n    if (editorActions.isRegistered(action)) {\n      keyboard.addListener(fn);\n    }\n  }\n\n  // select all elements\n  // CTRL + A\n  addListener('selectElements', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.isKey([ 'a', 'A' ], event) && keyboard.isCmd(event)) {\n      editorActions.trigger('selectElements');\n\n      return true;\n    }\n  });\n\n  // search labels\n  // CTRL + F\n  addListener('find', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.isKey([ 'f', 'F' ], event) && keyboard.isCmd(event)) {\n      editorActions.trigger('find');\n\n      return true;\n    }\n  });\n\n  // activate space tool\n  // S\n  addListener('spaceTool', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([ 's', 'S' ], event)) {\n      editorActions.trigger('spaceTool');\n\n      return true;\n    }\n  });\n\n  // activate lasso tool\n  // L\n  addListener('lassoTool', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([ 'l', 'L' ], event)) {\n      editorActions.trigger('lassoTool');\n\n      return true;\n    }\n  });\n\n  // activate hand tool\n  // H\n  addListener('handTool', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([ 'h', 'H' ], event)) {\n      editorActions.trigger('handTool');\n\n      return true;\n    }\n  });\n\n  // activate global connect tool\n  // C\n  addListener('globalConnectTool', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([ 'c', 'C' ], event)) {\n      editorActions.trigger('globalConnectTool');\n\n      return true;\n    }\n  });\n\n  // activate direct editing\n  // E\n  addListener('directEditing', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([ 'e', 'E' ], event)) {\n      editorActions.trigger('directEditing');\n\n      return true;\n    }\n  });\n\n  // activate replace element\n  // R\n  addListener('replaceElement', function(context) {\n\n    var event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([ 'r', 'R' ], event)) {\n      editorActions.trigger('replaceElement', event);\n\n      return true;\n    }\n  });\n\n};","import KeyboardModule from 'diagram-js/lib/features/keyboard';\n\nimport BpmnKeyboardBindings from './BpmnKeyboardBindings';\n\nexport default {\n  __depends__: [\n    KeyboardModule\n  ],\n  __init__: [ 'keyboardBindings' ],\n  keyboardBindings: [ 'type', BpmnKeyboardBindings ]\n};\n","import {\n  assign\n} from 'min-dash';\n\nimport {\n  getLabel\n} from '../../util/LabelUtil';\n\nimport {\n  is\n} from '../../util/ModelUtil';\n\nimport { isAny } from '../modeling/util/ModelingUtil';\n\nimport {\n  isExpanded,\n  isHorizontal\n} from '../../util/DiUtil';\n\nimport {\n  getExternalLabelMid,\n  isLabelExternal,\n  hasExternalLabel,\n  isLabel\n} from '../../util/LabelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../modeling/BpmnFactory').default} BpmnFactory\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js-direct-editing/lib/DirectEditing').default} DirectEditing\n * @typedef {import('../modeling/Modeling').default} Modeling\n * @typedef {import('diagram-js/lib/features/resize/ResizeHandles').default} ResizeHandles\n * @typedef {import('../../draw/TextRenderer').default} TextRenderer\n *\n * @typedef {import('../../model/Types').Element} Element\n *\n * @typedef { {\n *   bounds: {\n *     x: number;\n *     y: number;\n *     width: number;\n *     height: number;\n *     minWidth?: number;\n *     minHeight?: number;\n *   };\n *   style: Object;\n * } } DirectEditingContext\n */\n\nvar HIGH_PRIORITY = 2000;\n\n/**\n * @param {EventBus} eventBus\n * @param {BpmnFactory} bpmnFactory\n * @param {Canvas} canvas\n * @param {DirectEditing} directEditing\n * @param {Modeling} modeling\n * @param {ResizeHandles} resizeHandles\n * @param {TextRenderer} textRenderer\n */\nexport default function LabelEditingProvider(\n    eventBus, bpmnFactory, canvas, directEditing,\n    modeling, resizeHandles, textRenderer) {\n\n  this._bpmnFactory = bpmnFactory;\n  this._canvas = canvas;\n  this._modeling = modeling;\n  this._textRenderer = textRenderer;\n\n  directEditing.registerProvider(this);\n\n  // listen to dblclick on non-root elements\n  eventBus.on('element.dblclick', function(event) {\n    activateDirectEdit(event.element, true);\n  });\n\n  // complete on followup canvas operation\n  eventBus.on([\n    'autoPlace.start',\n    'canvas.viewbox.changing',\n    'drag.init',\n    'element.mousedown',\n    'popupMenu.open',\n    'root.set',\n    'selection.changed'\n  ], function() {\n    if (directEditing.isActive()) {\n      directEditing.complete();\n    }\n  });\n\n  eventBus.on([\n    'shape.remove',\n    'connection.remove'\n  ], HIGH_PRIORITY, function(event) {\n\n    if (directEditing.isActive(event.element)) {\n      directEditing.cancel();\n    }\n  });\n\n  // cancel on command stack changes\n  eventBus.on([ 'commandStack.changed' ], function(e) {\n    if (directEditing.isActive()) {\n      directEditing.cancel();\n    }\n  });\n\n\n  eventBus.on('directEditing.activate', function(event) {\n    resizeHandles.removeResizers();\n  });\n\n  eventBus.on('create.end', 500, function(event) {\n\n    var context = event.context,\n        element = context.shape,\n        canExecute = event.context.canExecute,\n        isTouch = event.isTouch;\n\n    // TODO(nikku): we need to find a way to support the\n    // direct editing on mobile devices; right now this will\n    // break for desworkflowediting on mobile devices\n    // as it breaks the user interaction workflow\n\n    // TODO(nikku): we should temporarily focus the edited element\n    // here and release the focused viewport after the direct edit\n    // operation is finished\n    if (isTouch) {\n      return;\n    }\n\n    if (!canExecute) {\n      return;\n    }\n\n    if (context.hints && context.hints.createElementsBehavior === false) {\n      return;\n    }\n\n    activateDirectEdit(element);\n  });\n\n  eventBus.on('autoPlace.end', 500, function(event) {\n    activateDirectEdit(event.shape);\n  });\n\n\n  function activateDirectEdit(element, force) {\n    if (force ||\n        isAny(element, [ 'bpmn:Task', 'bpmn:TextAnnotation', 'bpmn:Participant' ]) ||\n        isCollapsedSubProcess(element)) {\n\n      directEditing.activate(element);\n    }\n  }\n\n}\n\nLabelEditingProvider.$inject = [\n  'eventBus',\n  'bpmnFactory',\n  'canvas',\n  'directEditing',\n  'modeling',\n  'resizeHandles',\n  'textRenderer'\n];\n\n\n/**\n * Activate direct editing for activities and text annotations.\n *\n * @param {Element} element\n *\n * @return { {\n *   text: string;\n *   options?: {\n *     autoResize?: boolean;\n *     centerVertically?: boolean;\n *     resizable?: boolean;\n *   }\n * } & DirectEditingContext }\n */\nLabelEditingProvider.prototype.activate = function(element) {\n\n  // text\n  var text = getLabel(element);\n\n  if (text === undefined) {\n    return;\n  }\n\n  var context = {\n    text: text\n  };\n\n  // bounds\n  var bounds = this.getEditingBBox(element);\n\n  assign(context, bounds);\n\n  var options = {};\n  var style = context.style || {};\n\n  // Remove background and border\n  assign(style, {\n    backgroundColor: null,\n    border: null\n  });\n\n  // tasks\n  if (\n    isAny(element, [\n      'bpmn:Task',\n      'bpmn:Participant',\n      'bpmn:Lane',\n      'bpmn:CallActivity'\n    ]) ||\n    isCollapsedSubProcess(element)\n  ) {\n    assign(options, {\n      centerVertically: true\n    });\n  }\n\n  // external labels\n  if (isLabelExternal(element)) {\n    assign(options, {\n      autoResize: true\n    });\n\n    // keep background and border for external labels\n    assign(style, {\n      backgroundColor: '#ffffff',\n      border: '1px solid #ccc'\n    });\n  }\n\n  // text annotations\n  if (is(element, 'bpmn:TextAnnotation')) {\n    assign(options, {\n      resizable: true,\n      autoResize: true\n    });\n\n    // keep background and border for text annotations\n    assign(style, {\n      backgroundColor: '#ffffff',\n      border: '1px solid #ccc'\n    });\n  }\n\n  assign(context, {\n    options: options,\n    style: style\n  });\n\n  return context;\n};\n\n\n/**\n * Get the editing bounding box based on the element's size and position.\n *\n * @param {Element} element\n *\n * @return {DirectEditingContext}\n */\nLabelEditingProvider.prototype.getEditingBBox = function(element) {\n  var canvas = this._canvas;\n\n  var target = element.label || element;\n\n  var bbox = canvas.getAbsoluteBBox(target);\n\n  var mid = {\n    x: bbox.x + bbox.width / 2,\n    y: bbox.y + bbox.height / 2\n  };\n\n  // default position\n  var bounds = { x: bbox.x, y: bbox.y };\n\n  var zoom = canvas.zoom();\n\n  var defaultStyle = this._textRenderer.getDefaultStyle(),\n      externalStyle = this._textRenderer.getExternalStyle();\n\n  // take zoom into account\n  var externalFontSize = externalStyle.fontSize * zoom,\n      externalLineHeight = externalStyle.lineHeight,\n      defaultFontSize = defaultStyle.fontSize * zoom,\n      defaultLineHeight = defaultStyle.lineHeight;\n\n  var style = {\n    fontFamily: this._textRenderer.getDefaultStyle().fontFamily,\n    fontWeight: this._textRenderer.getDefaultStyle().fontWeight\n  };\n\n  // adjust for expanded pools AND lanes\n  if (is(element, 'bpmn:Lane') || isExpandedPool(element)) {\n    var isHorizontalLane = isHorizontal(element);\n\n    var laneBounds = isHorizontalLane ? {\n      width: bbox.height,\n      height: 30 * zoom,\n      x: bbox.x - bbox.height / 2 + (15 * zoom),\n      y: mid.y - (30 * zoom) / 2\n    } : {\n      width: bbox.width,\n      height: 30 * zoom\n    };\n\n    assign(bounds, laneBounds);\n\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: (7 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (5 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px',\n      transform: isHorizontalLane ? 'rotate(-90deg)' : null\n    });\n  }\n\n\n  // internal labels for collapsed participants\n  if (isCollapsedPool(element)) {\n    var isHorizontalPool = isHorizontal(element);\n\n    var poolBounds = isHorizontalPool ? {\n      width: bbox.width,\n      height: bbox.height\n    } : {\n      width: bbox.height,\n      height: bbox.width,\n      x: mid.x - bbox.height / 2,\n      y: mid.y - bbox.width / 2\n    };\n\n    assign(bounds, poolBounds);\n\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: (7 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (5 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px',\n      transform: isHorizontalPool ? null : 'rotate(-90deg)'\n    });\n  }\n\n\n  // internal labels for tasks and collapsed call activities\n  // and sub processes\n  if (isAny(element, [ 'bpmn:Task', 'bpmn:CallActivity' ]) ||\n      isCollapsedSubProcess(element)) {\n\n    assign(bounds, {\n      width: bbox.width,\n      height: bbox.height\n    });\n\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: (7 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (5 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px'\n    });\n  }\n\n\n  // internal labels for expanded sub processes\n  if (isExpandedSubProcess(element)) {\n    assign(bounds, {\n      width: bbox.width,\n      x: bbox.x\n    });\n\n    assign(style, {\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight,\n      paddingTop: (7 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (5 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px'\n    });\n  }\n\n  var width = 90 * zoom,\n      paddingTop = 7 * zoom,\n      paddingBottom = 4 * zoom;\n\n  // external labels for events, data elements, gateways, groups and connections\n  if (target.labelTarget) {\n    assign(bounds, {\n      width: width,\n      height: bbox.height + paddingTop + paddingBottom,\n      x: mid.x - width / 2,\n      y: bbox.y - paddingTop\n    });\n\n    assign(style, {\n      fontSize: externalFontSize + 'px',\n      lineHeight: externalLineHeight,\n      paddingTop: paddingTop + 'px',\n      paddingBottom: paddingBottom + 'px'\n    });\n  }\n\n  // external label not yet created\n  if (isLabelExternal(target)\n      && !hasExternalLabel(target)\n      && !isLabel(target)) {\n\n    var externalLabelMid = getExternalLabelMid(element);\n\n    var absoluteBBox = canvas.getAbsoluteBBox({\n      x: externalLabelMid.x,\n      y: externalLabelMid.y,\n      width: 0,\n      height: 0\n    });\n\n    var height = externalFontSize + paddingTop + paddingBottom;\n\n    assign(bounds, {\n      width: width,\n      height: height,\n      x: absoluteBBox.x - width / 2,\n      y: absoluteBBox.y - height / 2\n    });\n\n    assign(style, {\n      fontSize: externalFontSize + 'px',\n      lineHeight: externalLineHeight,\n      paddingTop: paddingTop + 'px',\n      paddingBottom: paddingBottom + 'px'\n    });\n  }\n\n  // text annotations\n  if (is(element, 'bpmn:TextAnnotation')) {\n    assign(bounds, {\n      width: bbox.width,\n      height: bbox.height,\n      minWidth: 30 * zoom,\n      minHeight: 10 * zoom\n    });\n\n    assign(style, {\n      textAlign: 'left',\n      paddingTop: (5 * zoom) + 'px',\n      paddingBottom: (7 * zoom) + 'px',\n      paddingLeft: (7 * zoom) + 'px',\n      paddingRight: (5 * zoom) + 'px',\n      fontSize: defaultFontSize + 'px',\n      lineHeight: defaultLineHeight\n    });\n  }\n\n  return { bounds: bounds, style: style };\n};\n\n\nLabelEditingProvider.prototype.update = function(\n    element, newLabel,\n    activeContextText, bounds) {\n\n  var newBounds,\n      bbox;\n\n  if (is(element, 'bpmn:TextAnnotation')) {\n\n    bbox = this._canvas.getAbsoluteBBox(element);\n\n    newBounds = {\n      x: element.x,\n      y: element.y,\n      width: element.width / bbox.width * bounds.width,\n      height: element.height / bbox.height * bounds.height\n    };\n  }\n\n  if (isEmptyText(newLabel)) {\n    newLabel = null;\n  }\n\n  this._modeling.updateLabel(element, newLabel, newBounds);\n};\n\n\n\n// helpers //////////\n\nfunction isCollapsedSubProcess(element) {\n  return is(element, 'bpmn:SubProcess') && !isExpanded(element);\n}\n\nfunction isExpandedSubProcess(element) {\n  return is(element, 'bpmn:SubProcess') && isExpanded(element);\n}\n\nfunction isCollapsedPool(element) {\n  return is(element, 'bpmn:Participant') && !isExpanded(element);\n}\n\nfunction isExpandedPool(element) {\n  return is(element, 'bpmn:Participant') && isExpanded(element);\n}\n\nfunction isEmptyText(label) {\n  return !label || !label.trim();\n}","import {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  getDi,\n  is\n} from '../../util/ModelUtil';\n\nimport {\n  translate\n} from 'diagram-js/lib/util/SvgTransformUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../draw/PathMap').default} PathMap\n */\n\nvar MARKER_HIDDEN = 'djs-element-hidden',\n    MARKER_LABEL_HIDDEN = 'djs-label-hidden';\n\n/**\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {PathMap} pathMap\n */\nexport default function LabelEditingPreview(eventBus, canvas, pathMap) {\n\n  var self = this;\n\n  var defaultLayer = canvas.getDefaultLayer();\n\n  var element, absoluteElementBBox, gfx;\n\n  eventBus.on('directEditing.activate', function(context) {\n    var activeProvider = context.active;\n\n    element = activeProvider.element.label || activeProvider.element;\n\n    // text annotation\n    if (is(element, 'bpmn:TextAnnotation')) {\n      absoluteElementBBox = canvas.getAbsoluteBBox(element);\n\n      gfx = svgCreate('g');\n\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n\n      var path = self.path = svgCreate('path');\n\n      svgAttr(path, {\n        d: textPathData,\n        strokeWidth: 2,\n        stroke: getStrokeColor(element)\n      });\n\n      svgAppend(gfx, path);\n\n      svgAppend(defaultLayer, gfx);\n\n      translate(gfx, element.x, element.y);\n    }\n\n    if (is(element, 'bpmn:TextAnnotation') ||\n        element.labelTarget) {\n      canvas.addMarker(element, MARKER_HIDDEN);\n    } else if (is(element, 'bpmn:Task') ||\n               is(element, 'bpmn:CallActivity') ||\n               is(element, 'bpmn:SubProcess') ||\n               is(element, 'bpmn:Participant') ||\n               is(element, 'bpmn:Lane')) {\n      canvas.addMarker(element, MARKER_LABEL_HIDDEN);\n    }\n  });\n\n  eventBus.on('directEditing.resize', function(context) {\n\n    // text annotation\n    if (is(element, 'bpmn:TextAnnotation')) {\n      var height = context.height,\n          dy = context.dy;\n\n      var newElementHeight = Math.max(element.height / absoluteElementBBox.height * (height + dy), 0);\n\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: newElementHeight,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n\n      svgAttr(self.path, {\n        d: textPathData\n      });\n    }\n  });\n\n  eventBus.on([ 'directEditing.complete', 'directEditing.cancel' ], function(context) {\n    var activeProvider = context.active;\n\n    if (activeProvider) {\n      canvas.removeMarker(activeProvider.element.label || activeProvider.element, MARKER_HIDDEN);\n      canvas.removeMarker(element, MARKER_LABEL_HIDDEN);\n    }\n\n    element = undefined;\n    absoluteElementBBox = undefined;\n\n    if (gfx) {\n      svgRemove(gfx);\n\n      gfx = undefined;\n    }\n  });\n}\n\nLabelEditingPreview.$inject = [\n  'eventBus',\n  'canvas',\n  'pathMap'\n];\n\n\n// helpers //////////\n\nfunction getStrokeColor(element, defaultColor) {\n  var di = getDi(element);\n\n  return di.get('stroke') || defaultColor || 'black';\n}","import ChangeSupportModule from 'diagram-js/lib/features/change-support';\nimport ResizeModule from 'diagram-js/lib/features/resize';\nimport DirectEditingModule from 'diagram-js-direct-editing';\n\nimport LabelEditingProvider from './LabelEditingProvider';\nimport LabelEditingPreview from './LabelEditingPreview';\n\n\nexport default {\n  __depends__: [\n    ChangeSupportModule,\n    ResizeModule,\n    DirectEditingModule\n  ],\n  __init__: [\n    'labelEditingProvider',\n    'labelEditingPreview'\n  ],\n  labelEditingProvider: [ 'type', LabelEditingProvider ],\n  labelEditingPreview: [ 'type', LabelEditingPreview ]\n};\n","import { queryAll as domQueryAll } from 'min-dom';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  remove as svgRemove,\n} from 'tiny-svg';\n\nimport { createLine, updateLine } from 'diagram-js/lib/util/RenderUtil';\nimport { getMid, getElementLineIntersection } from 'diagram-js/lib/layout/LayoutUtil';\nimport { getDistancePointPoint } from 'diagram-js/lib/features/bendpoints/GeometricUtil';\nimport { isLabel } from 'diagram-js/lib/util/ModelUtil';\n\nimport { isAny } from '../modeling/util/ModelingUtil';\nimport { getRoundRectPath, getCirclePath } from '../../draw/BpmnRenderUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/GraphicsFactory').default} GraphicsFactory\n * @typedef {import('../outline/OutlineProvider').default} Outline\n * @typedef {import('diagram-js/lib/features/selection').default} Selection\n *\n * @typedef {import('diagram-js/lib/model/Types').Element} Element\n */\n\nconst ALLOWED_ELEMENTS = [ 'bpmn:Event', 'bpmn:SequenceFlow', 'bpmn:Gateway' ];\n\nconst LINE_STYLE = {\n  class: 'bjs-label-link',\n  stroke: 'var(--element-selected-outline-secondary-stroke-color)',\n  strokeDasharray: '5, 5',\n};\n\nconst DISTANCE_THRESHOLD = 15;\nconst PATH_OFFSET = 2;\n\n/**\n * Render a line between an external label and its target element,\n * when either is selected.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {GraphicsFactory} graphicsFactory\n * @param {Outline} outline\n */\nexport default function LabelLink(eventBus, canvas, graphicsFactory, outline, selection) {\n\n  const layer = canvas.getLayer('overlays');\n\n  eventBus.on([ 'selection.changed', 'shape.changed' ], function() {\n    cleanUp();\n  });\n\n  eventBus.on('selection.changed', function({ newSelection }) {\n\n    const allowedElements = newSelection.filter(element => isAny(element, ALLOWED_ELEMENTS));\n\n    if (allowedElements.length === 1) {\n      const element = allowedElements[0];\n      if (isLabel(element)) {\n        createLink(element, element.labelTarget, newSelection);\n      } else if (element.labels?.length) {\n        createLink(element.labels[0], element, newSelection);\n      }\n    }\n\n    // Only allowed when both label and its target are selected\n    if (allowedElements.length === 2) {\n      const label = allowedElements.find(isLabel);\n      const target = allowedElements.find(el => el.labels?.includes(label));\n      if (label && target) {\n        createLink(label, target, newSelection);\n      }\n    }\n  });\n\n  eventBus.on('shape.changed', function({ element }) {\n\n    if (!isAny(element, ALLOWED_ELEMENTS) || !isElementSelected(element)) {\n      return;\n    }\n\n    if (isLabel(element)) {\n      createLink(element, element.labelTarget, selection.get());\n    } else if (element.labels?.length) {\n      createLink(element.labels[0], element, selection.get());\n    }\n  });\n\n  /**\n   * Render a line between an external label and its target.\n   *\n   * @param {Element} label\n   * @param {Element} target\n   * @param {Element[]} selection\n   */\n  function createLink(label, target, selection = []) {\n\n    // Create an auxiliary line between label and target mid points\n    const line = createLine(\n      [ getMid(target), getMid(label) ],\n      LINE_STYLE\n    );\n    const linePath = line.getAttribute('d');\n\n    // Calculate the intersection point between line and label\n    const labelSelected = selection.includes(label);\n    const labelPath = labelSelected ? getElementOutlinePath(label) : getElementPath(label);\n    const labelInter = getElementLineIntersection(labelPath, linePath);\n\n    // Label on top of the target\n    if (!labelInter) {\n      return;\n    }\n\n    // Calculate the intersection point between line and label\n    // If the target is a sequence flow, there is no intersection,\n    // so we link to the middle of it.\n    const targetSelected = selection.includes(target);\n    const targetPath = targetSelected ? getElementOutlinePath(target) : getElementPath(target);\n    const targetInter = getElementLineIntersection(targetPath, linePath) || getMid(target);\n\n    // Do not draw a link if the points are too close\n    const distance = getDistancePointPoint(targetInter, labelInter);\n    if (distance < DISTANCE_THRESHOLD) {\n      return;\n    }\n\n    // Connect the actual closest points\n    updateLine(line, [ targetInter, labelInter ]);\n    svgAppend(layer, line);\n  }\n\n  /**\n   * Remove all existing label links.\n   */\n  function cleanUp() {\n    domQueryAll(`.${LINE_STYLE.class}`, layer).forEach(svgRemove);\n  }\n\n  /**\n   * Get element's slightly expanded outline path.\n   *\n   * @param {Element} element\n   * @returns {string} svg path\n   */\n  function getElementOutlinePath(element) {\n    const outlineShape = outline.getOutline(element);\n    const outlineOffset = outline.offset;\n\n    if (!outlineShape) {\n      return getElementPath(element);\n    }\n\n    if (outlineShape.x) {\n      const shape = {\n        x: element.x + parseSvgNumAttr(outlineShape, 'x') - PATH_OFFSET,\n        y: element.y + parseSvgNumAttr(outlineShape, 'y') - PATH_OFFSET,\n        width: parseSvgNumAttr(outlineShape, 'width') + PATH_OFFSET * 2,\n        height: parseSvgNumAttr(outlineShape, 'height') + PATH_OFFSET * 2\n      };\n\n      return getRoundRectPath(shape, parseSvgNumAttr(outlineShape, 'rx'));\n    }\n\n    if (outlineShape.cx) {\n      const shape = {\n        x: element.x - outlineOffset,\n        y: element.y - outlineOffset,\n        width: parseSvgNumAttr(outlineShape, 'r') * 2,\n        height: parseSvgNumAttr(outlineShape, 'r') * 2,\n      };\n\n      return getCirclePath(shape);\n    }\n  }\n\n  function getElementPath(element) {\n    return graphicsFactory.getShapePath(element);\n  }\n\n  function isElementSelected(element) {\n    return selection.get().includes(element);\n  }\n}\n\nLabelLink.$inject = [\n  'eventBus',\n  'canvas',\n  'graphicsFactory',\n  'outline',\n  'selection'\n];\n\n/**\n * Get numeric attribute from SVG element\n * or 0 if not present.\n *\n * @param {SVGElement} node\n * @param {string} attr\n * @returns {number}\n */\nfunction parseSvgNumAttr(node, attr) {\n  return parseFloat(svgAttr(node, attr) || 0);\n}\n","import SelectionModule from 'diagram-js/lib/features/selection';\nimport OutlineModule from 'diagram-js/lib/features/outline';\n\nimport LabelLink from './LabelLink';\n\nexport default {\n  __depends__: [\n    SelectionModule,\n    OutlineModule\n  ],\n  __init__: [\n    'labelLink'\n  ],\n  labelLink: [ 'type', LabelLink ]\n};\n","import {\n  isString,\n  assign,\n  forEach\n} from 'min-dash';\n\nimport {\n  assignStyle,\n  domify,\n  attr as domAttr,\n  classes as domClasses,\n  remove as domRemove,\n  delegate as domDelegate\n} from 'min-dom';\n\nimport Ids from '../../util/IdGenerator';\n\n/**\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/EventBus').default} EventBus\n *\n * @typedef {import('../../util/Types').RectTRBL} RectTRBL\n *\n * @typedef { {\n *   html: string | HTMLElement;\n *   position: RectTRBL;\n *   show?: {\n *     minZoom?: number;\n *     maxZoom?: number;\n *   };\n *   timeout?: number;\n * } } Tooltip\n */\n\n// document wide unique tooltip ids\nvar ids = new Ids('tt');\n\n\nfunction createRoot(parentNode) {\n  var root = domify(\n    '<div class=\"djs-tooltip-container\" />'\n  );\n\n  assignStyle(root, {\n    position: 'absolute',\n    width: '0',\n    height: '0'\n  });\n\n  parentNode.insertBefore(root, parentNode.firstChild);\n\n  return root;\n}\n\n\nfunction setPosition(el, x, y) {\n  assignStyle(el, { left: x + 'px', top: y + 'px' });\n}\n\nfunction setVisible(el, visible) {\n  el.style.display = visible === false ? 'none' : '';\n}\n\n\nvar tooltipClass = 'djs-tooltip',\n    tooltipSelector = '.' + tooltipClass;\n\n/**\n * A service that allows users to render tool tips on the diagram.\n *\n * The tooltip service will take care of updating the tooltip positioning\n * during navigation + zooming.\n *\n * @example\n *\n * ```javascript\n *\n * // add a pink badge on the top left of the shape\n * tooltips.add({\n *   position: {\n *     x: 50,\n *     y: 100\n *   },\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>'\n * });\n *\n * // or with optional life span\n * tooltips.add({\n *   position: {\n *     top: -5,\n *     left: -5\n *   },\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>',\n *   ttl: 2000\n * });\n *\n * // remove a tool tip\n * var id = tooltips.add(...);\n *\n * tooltips.remove(id);\n * ```\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function Tooltips(eventBus, canvas) {\n\n  this._eventBus = eventBus;\n  this._canvas = canvas;\n\n  this._ids = ids;\n\n  this._tooltipDefaults = {\n    show: {\n      minZoom: 0.7,\n      maxZoom: 5.0\n    }\n  };\n\n  /**\n   * @type {Record<string, Tooltip>}\n   */\n  this._tooltips = {};\n\n  // root html element for all tooltips\n  this._tooltipRoot = createRoot(canvas.getContainer());\n\n\n  var self = this;\n\n  domDelegate.bind(this._tooltipRoot, tooltipSelector, 'mousedown', function(event) {\n    event.stopPropagation();\n  });\n\n  domDelegate.bind(this._tooltipRoot, tooltipSelector, 'mouseover', function(event) {\n    self.trigger('mouseover', event);\n  });\n\n  domDelegate.bind(this._tooltipRoot, tooltipSelector, 'mouseout', function(event) {\n    self.trigger('mouseout', event);\n  });\n\n  this._init();\n}\n\n\nTooltips.$inject = [ 'eventBus', 'canvas' ];\n\n\n/**\n * Adds an HTML tooltip to the diagram.\n *\n * @param {Tooltip} tooltip\n *\n * @return {string} ID of the tooltip.\n */\nTooltips.prototype.add = function(tooltip) {\n\n  if (!tooltip.position) {\n    throw new Error('must specifiy tooltip position');\n  }\n\n  if (!tooltip.html) {\n    throw new Error('must specifiy tooltip html');\n  }\n\n  var id = this._ids.next();\n\n  tooltip = assign({}, this._tooltipDefaults, tooltip, {\n    id: id\n  });\n\n  this._addTooltip(tooltip);\n\n  if (tooltip.timeout) {\n    this.setTimeout(tooltip);\n  }\n\n  return id;\n};\n\n/**\n * @param {string} action\n * @param {Event} event\n */\nTooltips.prototype.trigger = function(action, event) {\n\n  var node = event.delegateTarget || event.target;\n\n  var tooltip = this.get(domAttr(node, 'data-tooltip-id'));\n\n  if (!tooltip) {\n    return;\n  }\n\n  if (action === 'mouseover' && tooltip.timeout) {\n    this.clearTimeout(tooltip);\n  }\n\n  if (action === 'mouseout' && tooltip.timeout) {\n\n    // cut timeout after mouse out\n    tooltip.timeout = 1000;\n\n    this.setTimeout(tooltip);\n  }\n};\n\n/**\n * Get tooltip with given ID.\n *\n * @param {Tooltip|string} id\n *\n * @return {Tooltip|undefined}\n */\nTooltips.prototype.get = function(id) {\n\n  if (typeof id !== 'string') {\n    id = id.id;\n  }\n\n  return this._tooltips[id];\n};\n\n/**\n * @param {Tooltip} tooltip\n */\nTooltips.prototype.clearTimeout = function(tooltip) {\n\n  tooltip = this.get(tooltip);\n\n  if (!tooltip) {\n    return;\n  }\n\n  var removeTimer = tooltip.removeTimer;\n\n  if (removeTimer) {\n    clearTimeout(removeTimer);\n    tooltip.removeTimer = null;\n  }\n};\n\n/**\n * @param {Tooltip} tooltip\n */\nTooltips.prototype.setTimeout = function(tooltip) {\n\n  tooltip = this.get(tooltip);\n\n  if (!tooltip) {\n    return;\n  }\n\n  this.clearTimeout(tooltip);\n\n  var self = this;\n\n  tooltip.removeTimer = setTimeout(function() {\n    self.remove(tooltip);\n  }, tooltip.timeout);\n};\n\n/**\n * Remove tooltip with given ID.\n *\n * @param {string | Tooltip} id\n */\nTooltips.prototype.remove = function(id) {\n\n  var tooltip = this.get(id);\n\n  if (tooltip) {\n    domRemove(tooltip.html);\n    domRemove(tooltip.htmlContainer);\n\n    delete tooltip.htmlContainer;\n\n    delete this._tooltips[tooltip.id];\n  }\n};\n\n\nTooltips.prototype.show = function() {\n  setVisible(this._tooltipRoot);\n};\n\n\nTooltips.prototype.hide = function() {\n  setVisible(this._tooltipRoot, false);\n};\n\n\nTooltips.prototype._updateRoot = function(viewbox) {\n  var a = viewbox.scale || 1;\n  var d = viewbox.scale || 1;\n\n  var matrix = 'matrix(' + a + ',0,0,' + d + ',' + (-1 * viewbox.x * a) + ',' + (-1 * viewbox.y * d) + ')';\n\n  this._tooltipRoot.style.transform = matrix;\n  this._tooltipRoot.style['-ms-transform'] = matrix;\n};\n\n\nTooltips.prototype._addTooltip = function(tooltip) {\n\n  var id = tooltip.id,\n      html = tooltip.html,\n      htmlContainer,\n      tooltipRoot = this._tooltipRoot;\n\n  // unwrap jquery (for those who need it)\n  if (html.get && html.constructor.prototype.jquery) {\n    html = html.get(0);\n  }\n\n  // create proper html elements from\n  // tooltip HTML strings\n  if (isString(html)) {\n    html = domify(html);\n  }\n\n  htmlContainer = domify('<div data-tooltip-id=\"' + id + '\" class=\"' + tooltipClass + '\">');\n  assignStyle(htmlContainer, { position: 'absolute' });\n\n  htmlContainer.appendChild(html);\n\n  if (tooltip.type) {\n    domClasses(htmlContainer).add('djs-tooltip-' + tooltip.type);\n  }\n\n  if (tooltip.className) {\n    domClasses(htmlContainer).add(tooltip.className);\n  }\n\n  tooltip.htmlContainer = htmlContainer;\n\n  tooltipRoot.appendChild(htmlContainer);\n\n  this._tooltips[id] = tooltip;\n\n  this._updateTooltip(tooltip);\n};\n\n\nTooltips.prototype._updateTooltip = function(tooltip) {\n\n  var position = tooltip.position,\n      htmlContainer = tooltip.htmlContainer;\n\n  // update overlay html based on tooltip x, y\n\n  setPosition(htmlContainer, position.x, position.y);\n};\n\n\nTooltips.prototype._updateTooltipVisibilty = function(viewbox) {\n\n  forEach(this._tooltips, function(tooltip) {\n    var show = tooltip.show,\n        htmlContainer = tooltip.htmlContainer,\n        visible = true;\n\n    if (show) {\n      if (show.minZoom > viewbox.scale ||\n          show.maxZoom < viewbox.scale) {\n        visible = false;\n      }\n\n      setVisible(htmlContainer, visible);\n    }\n  });\n};\n\nTooltips.prototype._init = function() {\n\n  var self = this;\n\n  // scroll/zoom integration\n\n  function updateViewbox(viewbox) {\n    self._updateRoot(viewbox);\n    self._updateTooltipVisibilty(viewbox);\n\n    self.show();\n  }\n\n  this._eventBus.on('canvas.viewbox.changing', function(event) {\n    self.hide();\n  });\n\n  this._eventBus.on('canvas.viewbox.changed', function(event) {\n    updateViewbox(event.viewbox);\n  });\n};\n","import Tooltips from './Tooltips';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [ 'tooltips' ],\n  tooltips: [ 'type', Tooltips ]\n};","import { is } from '../../util/ModelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/features/tooltips/Tooltips').default} Tooltips\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n */\n\nvar COLLAB_ERR_MSG = 'flow elements must be children of pools/participants';\nvar DATA_OBJECT_ERR_MSG = 'Data object must be placed within a pool/participant.';\n\n/**\n * @param {EventBus} eventBus\n * @param {Tooltips} tooltips\n * @param {Translate} translate\n */\nexport default function ModelingFeedback(eventBus, tooltips, translate) {\n\n  function showError(position, message, timeout) {\n    tooltips.add({\n      position: {\n        x: position.x + 5,\n        y: position.y + 5\n      },\n      type: 'error',\n      timeout: timeout || 2000,\n      html: '<div>' + message + '</div>'\n    });\n  }\n\n  eventBus.on([ 'shape.move.rejected', 'create.rejected' ], function(event) {\n    var context = event.context,\n        shape = context.shape,\n        target = context.target;\n\n    if (is(target, 'bpmn:Collaboration')) {\n      if (is(shape, 'bpmn:FlowNode')) {\n        showError(event, translate(COLLAB_ERR_MSG));\n      } else if (is(shape, 'bpmn:DataObjectReference')) {\n        showError(event, translate(DATA_OBJECT_ERR_MSG));\n      }\n    }\n  });\n\n}\n\nModelingFeedback.$inject = [\n  'eventBus',\n  'tooltips',\n  'translate'\n];\n","import TooltipsModule from 'diagram-js/lib/features/tooltips';\n\nimport ModelingFeedback from './ModelingFeedback';\n\nexport default {\n  __depends__: [\n    TooltipsModule\n  ],\n  __init__: [\n    'modelingFeedback'\n  ],\n  modelingFeedback: [ 'type', ModelingFeedback ]\n};","var MARKER_OK = 'connect-ok',\n    MARKER_NOT_OK = 'connect-not-ok';\n\n/**\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../connect/Connect').default} Connect\n * @typedef {import('../dragging/Dragging').default} Dragging\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../mouse/Mouse').default} Mouse\n * @typedef {import('../rules/Rules').default} Rules\n * @typedef {import('../tool-manager/ToolManager').default} ToolManager\n *\n * @typedef {import('../../model/Types').Element} Element\n */\n\n/**\n * @class\n * @constructor\n *\n * @param {EventBus} eventBus\n * @param {Dragging} dragging\n * @param {Connect} connect\n * @param {Canvas} canvas\n * @param {ToolManager} toolManager\n * @param {Rules} rules\n * @param {Mouse} mouse\n */\nexport default function GlobalConnect(\n    eventBus, dragging, connect,\n    canvas, toolManager, rules,\n    mouse) {\n\n  var self = this;\n\n  this._dragging = dragging;\n  this._rules = rules;\n  this._mouse = mouse;\n\n  toolManager.registerTool('global-connect', {\n    tool: 'global-connect',\n    dragging: 'global-connect.drag'\n  });\n\n  eventBus.on('global-connect.hover', function(event) {\n    var context = event.context,\n        startTarget = event.hover;\n\n    var canStartConnect = context.canStartConnect = self.canStartConnect(startTarget);\n\n    // simply ignore hover\n    if (canStartConnect === null) {\n      return;\n    }\n\n    context.startTarget = startTarget;\n\n    canvas.addMarker(startTarget, canStartConnect ? MARKER_OK : MARKER_NOT_OK);\n  });\n\n\n  eventBus.on([ 'global-connect.out', 'global-connect.cleanup' ], function(event) {\n    var startTarget = event.context.startTarget,\n        canStartConnect = event.context.canStartConnect;\n\n    if (startTarget) {\n      canvas.removeMarker(startTarget, canStartConnect ? MARKER_OK : MARKER_NOT_OK);\n    }\n  });\n\n\n  eventBus.on([ 'global-connect.ended' ], function(event) {\n    var context = event.context,\n        startTarget = context.startTarget,\n        startPosition = {\n          x: event.x,\n          y: event.y\n        };\n\n    var canStartConnect = self.canStartConnect(startTarget);\n\n    if (!canStartConnect) {\n      return;\n    }\n\n    eventBus.once('element.out', function() {\n      eventBus.once([ 'connect.ended', 'connect.canceled' ], function() {\n        eventBus.fire('global-connect.drag.ended');\n      });\n\n      connect.start(null, startTarget, startPosition);\n    });\n\n    return false;\n  });\n}\n\nGlobalConnect.$inject = [\n  'eventBus',\n  'dragging',\n  'connect',\n  'canvas',\n  'toolManager',\n  'rules',\n  'mouse'\n];\n\n/**\n * Initiates tool activity.\n */\nGlobalConnect.prototype.start = function(event, autoActivate) {\n  this._dragging.init(event, 'global-connect', {\n    autoActivate: autoActivate,\n    trapClick: false,\n    data: {\n      context: {}\n    }\n  });\n};\n\nGlobalConnect.prototype.toggle = function() {\n\n  if (this.isActive()) {\n    return this._dragging.cancel();\n  }\n\n  var mouseEvent = this._mouse.getLastMoveEvent();\n\n  return this.start(mouseEvent, !!mouseEvent);\n};\n\nGlobalConnect.prototype.isActive = function() {\n  var context = this._dragging.context();\n\n  return context && /^global-connect/.test(context.prefix);\n};\n\n/**\n * Check if source element can initiate connection.\n *\n * @param {Element} startTarget\n * @return {boolean}\n */\nGlobalConnect.prototype.canStartConnect = function(startTarget) {\n  return this._rules.allowed('connection.start', { source: startTarget });\n};\n","import ConnectModule from '../connect';\nimport RulesModule from '../rules';\nimport DraggingModule from '../dragging';\nimport ToolManagerModule from '../tool-manager';\nimport MouseModule from '../mouse';\n\nimport GlobalConnect from './GlobalConnect';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __depends__: [\n    ConnectModule,\n    RulesModule,\n    DraggingModule,\n    ToolManagerModule,\n    MouseModule\n  ],\n  globalConnect: [ 'type', GlobalConnect ]\n};\n","import {\n  assign\n} from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/features/palette/Palette').default} Palette\n * @typedef {import('diagram-js/lib/features/create/Create').default} Create\n * @typedef {import('diagram-js/lib/core/ElementFactory').default} ElementFactory\n * @typedef {import('../space-tool/BpmnSpaceTool').default} SpaceTool\n * @typedef {import('diagram-js/lib/features/lasso-tool/LassoTool').default} LassoTool\n * @typedef {import('diagram-js/lib/features/hand-tool/HandTool').default} HandTool\n * @typedef {import('diagram-js/lib/features/global-connect/GlobalConnect').default} GlobalConnect\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\n *\n * @typedef {import('diagram-js/lib/features/palette/Palette').PaletteEntries} PaletteEntries\n */\n\n/**\n * A palette provider for BPMN 2.0 elements.\n *\n * @param {Palette} palette\n * @param {Create} create\n * @param {ElementFactory} elementFactory\n * @param {SpaceTool} spaceTool\n * @param {LassoTool} lassoTool\n * @param {HandTool} handTool\n * @param {GlobalConnect} globalConnect\n * @param {Translate} translate\n */\nexport default function PaletteProvider(\n    palette, create, elementFactory,\n    spaceTool, lassoTool, handTool,\n    globalConnect, translate) {\n\n  this._palette = palette;\n  this._create = create;\n  this._elementFactory = elementFactory;\n  this._spaceTool = spaceTool;\n  this._lassoTool = lassoTool;\n  this._handTool = handTool;\n  this._globalConnect = globalConnect;\n  this._translate = translate;\n\n  palette.registerProvider(this);\n}\n\nPaletteProvider.$inject = [\n  'palette',\n  'create',\n  'elementFactory',\n  'spaceTool',\n  'lassoTool',\n  'handTool',\n  'globalConnect',\n  'translate'\n];\n\n/**\n * @return {PaletteEntries}\n */\nPaletteProvider.prototype.getPaletteEntries = function() {\n\n  var actions = {},\n      create = this._create,\n      elementFactory = this._elementFactory,\n      spaceTool = this._spaceTool,\n      lassoTool = this._lassoTool,\n      handTool = this._handTool,\n      globalConnect = this._globalConnect,\n      translate = this._translate;\n\n  function createAction(type, group, className, title, options) {\n\n    function createListener(event) {\n      var shape = elementFactory.createShape(assign({ type: type }, options));\n      create.start(event, shape);\n    }\n\n    return {\n      group: group,\n      className: className,\n      title: title,\n      action: {\n        dragstart: createListener,\n        click: createListener\n      }\n    };\n  }\n\n  function createSubprocess(event) {\n    var subProcess = elementFactory.createShape({\n      type: 'bpmn:SubProcess',\n      x: 0,\n      y: 0,\n      isExpanded: true\n    });\n\n    var startEvent = elementFactory.createShape({\n      type: 'bpmn:StartEvent',\n      x: 40,\n      y: 82,\n      parent: subProcess\n    });\n\n    create.start(event, [ subProcess, startEvent ], {\n      hints: {\n        autoSelect: [ subProcess ]\n      }\n    });\n  }\n\n  function createParticipant(event) {\n    create.start(event, elementFactory.createParticipantShape());\n  }\n\n  assign(actions, {\n    'hand-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-hand-tool',\n      title: translate('Activate hand tool'),\n      action: {\n        click: function(event) {\n          handTool.activateHand(event);\n        }\n      }\n    },\n    'lasso-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-lasso-tool',\n      title: translate('Activate lasso tool'),\n      action: {\n        click: function(event) {\n          lassoTool.activateSelection(event);\n        }\n      }\n    },\n    'space-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-space-tool',\n      title: translate('Activate create/remove space tool'),\n      action: {\n        click: function(event) {\n          spaceTool.activateSelection(event);\n        }\n      }\n    },\n    'global-connect-tool': {\n      group: 'tools',\n      className: 'bpmn-icon-connection-multi',\n      title: translate('Activate global connect tool'),\n      action: {\n        click: function(event) {\n          globalConnect.start(event);\n        }\n      }\n    },\n    'tool-separator': {\n      group: 'tools',\n      separator: true\n    },\n    'create.start-event': createAction(\n      'bpmn:StartEvent', 'event', 'bpmn-icon-start-event-none',\n      translate('Create start event')\n    ),\n    'create.intermediate-event': createAction(\n      'bpmn:IntermediateThrowEvent', 'event', 'bpmn-icon-intermediate-event-none',\n      translate('Create intermediate/boundary event')\n    ),\n    'create.end-event': createAction(\n      'bpmn:EndEvent', 'event', 'bpmn-icon-end-event-none',\n      translate('Create end event')\n    ),\n    'create.exclusive-gateway': createAction(\n      'bpmn:ExclusiveGateway', 'gateway', 'bpmn-icon-gateway-none',\n      translate('Create gateway')\n    ),\n    'create.task': createAction(\n      'bpmn:Task', 'activity', 'bpmn-icon-task',\n      translate('Create task')\n    ),\n    'create.data-object': createAction(\n      'bpmn:DataObjectReference', 'data-object', 'bpmn-icon-data-object',\n      translate('Create data object reference')\n    ),\n    'create.data-store': createAction(\n      'bpmn:DataStoreReference', 'data-store', 'bpmn-icon-data-store',\n      translate('Create data store reference')\n    ),\n    'create.subprocess-expanded': {\n      group: 'activity',\n      className: 'bpmn-icon-subprocess-expanded',\n      title: translate('Create expanded sub-process'),\n      action: {\n        dragstart: createSubprocess,\n        click: createSubprocess\n      }\n    },\n    'create.participant-expanded': {\n      group: 'collaboration',\n      className: 'bpmn-icon-participant',\n      title: translate('Create pool/participant'),\n      action: {\n        dragstart: createParticipant,\n        click: createParticipant\n      }\n    },\n    'create.group': createAction(\n      'bpmn:Group', 'artifact', 'bpmn-icon-group',\n      translate('Create group')\n    ),\n  });\n\n  return actions;\n};\n","import PaletteModule from 'diagram-js/lib/features/palette';\nimport CreateModule from 'diagram-js/lib/features/create';\nimport SpaceToolModule from '../space-tool';\nimport LassoToolModule from 'diagram-js/lib/features/lasso-tool';\nimport HandToolModule from 'diagram-js/lib/features/hand-tool';\nimport GlobalConnectModule from 'diagram-js/lib/features/global-connect';\nimport translate from 'diagram-js/lib/i18n/translate';\n\nimport PaletteProvider from './PaletteProvider';\n\nexport default {\n  __depends__: [\n    PaletteModule,\n    CreateModule,\n    SpaceToolModule,\n    LassoToolModule,\n    HandToolModule,\n    GlobalConnectModule,\n    translate\n  ],\n  __init__: [ 'paletteProvider' ],\n  paletteProvider: [ 'type', PaletteProvider ]\n};\n","import CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport inherits from 'inherits-browser';\n\nimport { escapeCSS as cssEscape } from 'diagram-js/lib/util/EscapeUtil';\n\nimport {\n  assign,\n  forEach\n} from 'min-dash';\n\nimport {\n  query as domQuery\n} from 'min-dom';\n\nimport {\n  attr as svgAttr\n} from 'tiny-svg';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('diagram-js/lib/core/ElementFactory').default} ElementFactory\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/features/preview-support/PreviewSupport').default} PreviewSupport\n */\n\nvar LOW_PRIORITY = 250;\n\n/**\n * @param {EventBus} eventBus\n * @param {ElementRegistry} elementRegistry\n * @param {ElementFactory} elementFactory\n * @param {Canvas} canvas\n * @param {PreviewSupport} previewSupport\n */\nexport default function BpmnReplacePreview(\n    eventBus, elementRegistry, elementFactory,\n    canvas, previewSupport) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Replace the visuals of all elements in the context which can be replaced\n   *\n   * @param  {Object} context\n   */\n  function replaceVisual(context) {\n\n    var replacements = context.canExecute.replacements;\n\n    forEach(replacements, function(replacement) {\n\n      var id = replacement.oldElementId;\n\n      var newElement = {\n        type: replacement.newElementType\n      };\n\n      // if the visual of the element is already replaced\n      if (context.visualReplacements[id]) {\n        return;\n      }\n\n      var element = elementRegistry.get(id);\n\n      assign(newElement, { x: element.x, y: element.y });\n\n      // create a temporary shape\n      var tempShape = elementFactory.createShape(newElement);\n\n      canvas.addShape(tempShape, element.parent);\n\n      // select the original SVG element related to the element and hide it\n      var gfx = domQuery('[data-element-id=\"' + cssEscape(element.id) + '\"]', context.dragGroup);\n\n      if (gfx) {\n        svgAttr(gfx, { display: 'none' });\n      }\n\n      // clone the gfx of the temporary shape and add it to the drag group\n      var dragger = previewSupport.addDragger(tempShape, context.dragGroup);\n\n      context.visualReplacements[id] = dragger;\n\n      canvas.removeShape(tempShape);\n    });\n  }\n\n  /**\n   * Restore the original visuals of the previously replaced elements\n   *\n   * @param  {Object} context\n   */\n  function restoreVisual(context) {\n\n    var visualReplacements = context.visualReplacements;\n\n    forEach(visualReplacements, function(dragger, id) {\n\n      var originalGfx = domQuery('[data-element-id=\"' + cssEscape(id) + '\"]', context.dragGroup);\n\n      if (originalGfx) {\n        svgAttr(originalGfx, { display: 'inline' });\n      }\n\n      dragger.remove();\n\n      if (visualReplacements[id]) {\n        delete visualReplacements[id];\n      }\n    });\n  }\n\n  eventBus.on('shape.move.move', LOW_PRIORITY, function(event) {\n\n    var context = event.context,\n        canExecute = context.canExecute;\n\n    if (!context.visualReplacements) {\n      context.visualReplacements = {};\n    }\n\n    if (canExecute && canExecute.replacements) {\n      replaceVisual(context);\n    } else {\n      restoreVisual(context);\n    }\n  });\n}\n\nBpmnReplacePreview.$inject = [\n  'eventBus',\n  'elementRegistry',\n  'elementFactory',\n  'canvas',\n  'previewSupport'\n];\n\ninherits(BpmnReplacePreview, CommandInterceptor);","import PreviewSupportModule from 'diagram-js/lib/features/preview-support';\n\nimport BpmnReplacePreview from './BpmnReplacePreview';\n\nexport default {\n  __depends__: [\n    PreviewSupportModule\n  ],\n  __init__: [ 'bpmnReplacePreview' ],\n  bpmnReplacePreview: [ 'type', BpmnReplacePreview ]\n};\n","import {\r\n  mid,\r\n  setSnapped\r\n} from 'diagram-js/lib/features/snapping/SnapUtil';\r\n\r\nimport { isCmd } from 'diagram-js/lib/features/keyboard/KeyboardUtil';\r\n\r\nimport {\r\n  getOrientation\r\n} from 'diagram-js/lib/layout/LayoutUtil';\r\n\r\nimport { is } from '../../util/ModelUtil';\r\n\r\nimport { isAny } from '../modeling/util/ModelingUtil';\r\n\r\nimport { some } from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n *\r\n * @typedef {import('diagram-js/lib/core/EventBus').Event} Event\r\n *\r\n * @typedef {import('../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('diagram-js/lib/util/Types').Axis} Axis\r\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\r\n */\r\n\r\nvar HIGHER_PRIORITY = 1250;\r\n\r\nvar BOUNDARY_TO_HOST_THRESHOLD = 40;\r\n\r\nvar TARGET_BOUNDS_PADDING = 20,\r\n    TASK_BOUNDS_PADDING = 10;\r\n\r\nvar TARGET_CENTER_PADDING = 20;\r\n\r\nvar AXES = [ 'x', 'y' ];\r\n\r\nvar abs = Math.abs;\r\n\r\n/**\r\n * Snap during connect.\r\n *\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function BpmnConnectSnapping(eventBus) {\r\n  eventBus.on([\r\n    'connect.hover',\r\n    'connect.move',\r\n    'connect.end',\r\n  ], HIGHER_PRIORITY, function(event) {\r\n    var context = event.context,\r\n        canExecute = context.canExecute,\r\n        start = context.start,\r\n        hover = context.hover,\r\n        source = context.source,\r\n        target = context.target;\r\n\r\n    // do NOT snap on CMD\r\n    if (event.originalEvent && isCmd(event.originalEvent)) {\r\n      return;\r\n    }\r\n\r\n    if (!context.initialConnectionStart) {\r\n      context.initialConnectionStart = context.connectionStart;\r\n    }\r\n\r\n    // snap hover\r\n    if (canExecute && hover) {\r\n      snapToShape(event, hover, getTargetBoundsPadding(hover));\r\n    }\r\n\r\n    if (hover && isAnyType(canExecute, [\r\n      'bpmn:Association',\r\n      'bpmn:DataInputAssociation',\r\n      'bpmn:DataOutputAssociation',\r\n      'bpmn:SequenceFlow'\r\n    ])) {\r\n      context.connectionStart = mid(start);\r\n\r\n      // snap hover\r\n      if (isAny(hover, [ 'bpmn:Event', 'bpmn:Gateway' ])) {\r\n        snapToPosition(event, mid(hover));\r\n      }\r\n\r\n      // snap hover\r\n      if (isAny(hover, [ 'bpmn:Task', 'bpmn:SubProcess' ])) {\r\n        snapToTargetMid(event, hover);\r\n      }\r\n\r\n      // snap source and target\r\n      if (is(source, 'bpmn:BoundaryEvent') && target === source.host) {\r\n        snapBoundaryEventLoop(event);\r\n      }\r\n\r\n    } else if (isType(canExecute, 'bpmn:MessageFlow')) {\r\n\r\n      if (is(start, 'bpmn:Event')) {\r\n\r\n        // snap start\r\n        context.connectionStart = mid(start);\r\n      }\r\n\r\n      if (is(hover, 'bpmn:Event')) {\r\n\r\n        // snap hover\r\n        snapToPosition(event, mid(hover));\r\n      }\r\n\r\n    } else {\r\n\r\n      // un-snap source\r\n      context.connectionStart = context.initialConnectionStart;\r\n    }\r\n  });\r\n}\r\n\r\nBpmnConnectSnapping.$inject = [ 'eventBus' ];\r\n\r\n\r\n// helpers //////////\r\n\r\n/**\r\n * Snap to the given target if the event is inside the bounds of the target.\r\n *\r\n * @param {Event} event\r\n * @param {Shape} target\r\n * @param {number} padding\r\n */\r\nfunction snapToShape(event, target, padding) {\r\n  AXES.forEach(function(axis) {\r\n    var dimensionForAxis = getDimensionForAxis(axis, target);\r\n\r\n    if (event[ axis ] < target[ axis ] + padding) {\r\n      setSnapped(event, axis, target[ axis ] + padding);\r\n    } else if (event[ axis ] > target[ axis ] + dimensionForAxis - padding) {\r\n      setSnapped(event, axis, target[ axis ] + dimensionForAxis - padding);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Snap to the target mid if the event is in the target mid.\r\n *\r\n * @param {Event} event\r\n * @param {Shape} target\r\n */\r\nfunction snapToTargetMid(event, target) {\r\n  var targetMid = mid(target);\r\n\r\n  AXES.forEach(function(axis) {\r\n    if (isMid(event, target, axis)) {\r\n      setSnapped(event, axis, targetMid[ axis ]);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Snap to prevent a loop overlapping a boundary event.\r\n *\r\n * @param {Event} event\r\n */\r\nfunction snapBoundaryEventLoop(event) {\r\n  var context = event.context,\r\n      source = context.source,\r\n      target = context.target;\r\n\r\n  if (isReverse(context)) {\r\n    return;\r\n  }\r\n\r\n  var sourceMid = mid(source),\r\n      orientation = getOrientation(sourceMid, target, -10),\r\n      axes = [];\r\n\r\n  if (/top|bottom/.test(orientation)) {\r\n    axes.push('x');\r\n  }\r\n\r\n  if (/left|right/.test(orientation)) {\r\n    axes.push('y');\r\n  }\r\n\r\n  axes.forEach(function(axis) {\r\n    var coordinate = event[ axis ], newCoordinate;\r\n\r\n    if (abs(coordinate - sourceMid[ axis ]) < BOUNDARY_TO_HOST_THRESHOLD) {\r\n      if (coordinate > sourceMid[ axis ]) {\r\n        newCoordinate = sourceMid[ axis ] + BOUNDARY_TO_HOST_THRESHOLD;\r\n      }\r\n      else {\r\n        newCoordinate = sourceMid[ axis ] - BOUNDARY_TO_HOST_THRESHOLD;\r\n      }\r\n\r\n      setSnapped(event, axis, newCoordinate);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * @param {Event} event\r\n * @param {Point} position\r\n */\r\nfunction snapToPosition(event, position) {\r\n  setSnapped(event, 'x', position.x);\r\n  setSnapped(event, 'y', position.y);\r\n}\r\n\r\nfunction isType(attrs, type) {\r\n  return attrs && attrs.type === type;\r\n}\r\n\r\nfunction isAnyType(attrs, types) {\r\n  return some(types, function(type) {\r\n    return isType(attrs, type);\r\n  });\r\n}\r\n\r\n/**\r\n * @param {Axis} axis\r\n * @param {Shape} element\r\n *\r\n * @return {number}\r\n */\r\nfunction getDimensionForAxis(axis, element) {\r\n  return axis === 'x' ? element.width : element.height;\r\n}\r\n\r\n/**\r\n * @param {Shape} target\r\n *\r\n * @return {number}\r\n */\r\nfunction getTargetBoundsPadding(target) {\r\n  if (is(target, 'bpmn:Task')) {\r\n    return TASK_BOUNDS_PADDING;\r\n  } else {\r\n    return TARGET_BOUNDS_PADDING;\r\n  }\r\n}\r\n\r\n/**\r\n * @param {Event} event\r\n * @param {Shape} target\r\n * @param {Axis} axis\r\n *\r\n * @return {boolean}\r\n */\r\nfunction isMid(event, target, axis) {\r\n  return event[ axis ] > target[ axis ] + TARGET_CENTER_PADDING\r\n    && event[ axis ] < target[ axis ] + getDimensionForAxis(axis, target) - TARGET_CENTER_PADDING;\r\n}\r\n\r\nfunction isReverse(context) {\r\n  var hover = context.hover,\r\n      source = context.source;\r\n\r\n  return hover && source && hover === source;\r\n}","import inherits from 'inherits-browser';\n\nimport CreateMoveSnapping from 'diagram-js/lib/features/snapping/CreateMoveSnapping';\n\nimport {\n  isSnapped,\n  setSnapped,\n  topLeft,\n  bottomRight\n} from 'diagram-js/lib/features/snapping/SnapUtil';\n\nimport { isExpanded } from '../../util/DiUtil';\n\nimport { is } from '../../util/ModelUtil';\n\nimport {\n  asTRBL,\n  getMid\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport { getBoundaryAttachment } from './BpmnSnappingUtil';\n\nimport { forEach } from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('didi').Injector} Injector\n *\n * @typedef {import('diagram-js/lib/features/snapping/SnapContext').default} SnapContext\n * @typedef {import('diagram-js/lib/features/snapping/SnapContext').SnapPoints} SnapPoints\n *\n * @typedef {import('diagram-js/lib/core/EventBus').Event} Event\n *\n * @typedef {import('../../model/Types').Element} Element\n * @typedef {import('../../model/Types').Shape} Shape\n */\n\nvar HIGH_PRIORITY = 1500;\n\n\n/**\n * Snap during create and move.\n *\n * @param {EventBus} eventBus\n * @param {Injector} injector\n */\nexport default function BpmnCreateMoveSnapping(eventBus, injector) {\n  injector.invoke(CreateMoveSnapping, this);\n\n  // creating first participant\n  eventBus.on([ 'create.move', 'create.end' ], HIGH_PRIORITY, setSnappedIfConstrained);\n\n  // snap boundary events\n  eventBus.on([\n    'create.move',\n    'create.end',\n    'shape.move.move',\n    'shape.move.end'\n  ], HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        canExecute = context.canExecute,\n        target = context.target;\n\n    var canAttach = canExecute && (canExecute === 'attach' || canExecute.attach);\n\n    if (canAttach && !isSnapped(event)) {\n      snapBoundaryEvent(event, target);\n    }\n  });\n}\n\ninherits(BpmnCreateMoveSnapping, CreateMoveSnapping);\n\nBpmnCreateMoveSnapping.$inject = [\n  'eventBus',\n  'injector'\n];\n\n/**\n * @param {Event} event\n *\n * @return {SnapContext}\n */\nBpmnCreateMoveSnapping.prototype.initSnap = function(event) {\n  var snapContext = CreateMoveSnapping.prototype.initSnap.call(this, event);\n\n  var shape = event.shape;\n\n  var isMove = !!this._elementRegistry.get(shape.id);\n\n  // snap to docking points\n  forEach(shape.outgoing, function(connection) {\n    var docking = connection.waypoints[0];\n\n    docking = docking.original || docking;\n\n    snapContext.setSnapOrigin(connection.id + '-docking', getDockingSnapOrigin(docking, isMove, event));\n  });\n\n  forEach(shape.incoming, function(connection) {\n    var docking = connection.waypoints[connection.waypoints.length - 1];\n\n    docking = docking.original || docking;\n\n    snapContext.setSnapOrigin(connection.id + '-docking', getDockingSnapOrigin(docking, isMove, event));\n  });\n\n  if (is(shape, 'bpmn:Participant')) {\n\n    // snap to borders with higher priority\n    snapContext.setSnapLocations([ 'top-left', 'bottom-right', 'mid' ]);\n  }\n\n  return snapContext;\n};\n\n/**\n * @param {SnapPoints} snapPoints\n * @param {Shape} shape\n * @param {Shape} target\n *\n * @return {SnapPoints}\n */\nBpmnCreateMoveSnapping.prototype.addSnapTargetPoints = function(snapPoints, shape, target) {\n  CreateMoveSnapping.prototype.addSnapTargetPoints.call(this, snapPoints, shape, target);\n\n  var snapTargets = this.getSnapTargets(shape, target);\n\n  forEach(snapTargets, function(snapTarget) {\n\n    // handle TRBL alignment\n    //\n    // * with container elements\n    // * with text annotations\n    if (isContainer(snapTarget) || areAll([ shape, snapTarget ], 'bpmn:TextAnnotation')) {\n      snapPoints.add('top-left', topLeft(snapTarget));\n      snapPoints.add('bottom-right', bottomRight(snapTarget));\n    }\n  });\n\n  var elementRegistry = this._elementRegistry;\n\n  // snap to docking points if not create mode\n  forEach(shape.incoming, function(connection) {\n    if (elementRegistry.get(shape.id)) {\n\n      if (!includes(snapTargets, connection.source)) {\n        snapPoints.add('mid', getMid(connection.source));\n      }\n\n      var docking = connection.waypoints[0];\n      snapPoints.add(connection.id + '-docking', docking.original || docking);\n    }\n  });\n\n  forEach(shape.outgoing, function(connection) {\n    if (elementRegistry.get(shape.id)) {\n\n      if (!includes(snapTargets, connection.target)) {\n        snapPoints.add('mid', getMid(connection.target));\n      }\n\n      var docking = connection.waypoints[ connection.waypoints.length - 1 ];\n\n      snapPoints.add(connection.id + '-docking', docking.original || docking);\n    }\n  });\n\n  // add sequence flow parents as snap targets\n  if (is(target, 'bpmn:SequenceFlow')) {\n    snapPoints = this.addSnapTargetPoints(snapPoints, shape, target.parent);\n  }\n\n  return snapPoints;\n};\n\n/**\n * @param {Shape} shape\n * @param {Shape} target\n *\n * @return {Shape[]}\n */\nBpmnCreateMoveSnapping.prototype.getSnapTargets = function(shape, target) {\n  return CreateMoveSnapping.prototype.getSnapTargets.call(this, shape, target)\n    .filter(function(snapTarget) {\n\n      // do not snap to lanes\n      return !is(snapTarget, 'bpmn:Lane');\n    });\n};\n\n// helpers //////////\n\n/**\n * @param {Shape} event\n * @param {Shape} target\n */\nfunction snapBoundaryEvent(event, target) {\n  var targetTRBL = asTRBL(target);\n\n  var direction = getBoundaryAttachment(event, target);\n\n  var context = event.context,\n      shape = context.shape;\n\n  var offset;\n\n  if (shape.parent) {\n    offset = { x: 0, y: 0 };\n  } else {\n    offset = getMid(shape);\n  }\n\n  if (/top/.test(direction)) {\n    setSnapped(event, 'y', targetTRBL.top - offset.y);\n  } else if (/bottom/.test(direction)) {\n    setSnapped(event, 'y', targetTRBL.bottom - offset.y);\n  }\n\n  if (/left/.test(direction)) {\n    setSnapped(event, 'x', targetTRBL.left - offset.x);\n  } else if (/right/.test(direction)) {\n    setSnapped(event, 'x', targetTRBL.right - offset.x);\n  }\n}\n\n/**\n * @param {Element[]} elements\n * @param {string} type\n *\n * @return {boolean}\n */\nfunction areAll(elements, type) {\n  return elements.every(function(el) {\n    return is(el, type);\n  });\n}\n\n/**\n * @param {Element} element\n */\nfunction isContainer(element) {\n  if (is(element, 'bpmn:SubProcess') && isExpanded(element)) {\n    return true;\n  }\n\n  return is(element, 'bpmn:Participant');\n}\n\n/**\n * @param {Event} event\n */\nfunction setSnappedIfConstrained(event) {\n  var context = event.context,\n      createConstraints = context.createConstraints;\n\n  if (!createConstraints) {\n    return;\n  }\n\n  var top = createConstraints.top,\n      right = createConstraints.right,\n      bottom = createConstraints.bottom,\n      left = createConstraints.left;\n\n  if ((left && left >= event.x) || (right && right <= event.x)) {\n    setSnapped(event, 'x', event.x);\n  }\n\n  if ((top && top >= event.y) || (bottom && bottom <= event.y)) {\n    setSnapped(event, 'y', event.y);\n  }\n}\n\nfunction includes(array, value) {\n  return array.indexOf(value) !== -1;\n}\n\nfunction getDockingSnapOrigin(docking, isMove, event) {\n  return isMove ? (\n    {\n      x: docking.x - event.x,\n      y: docking.y - event.y\n    }\n  ) : {\n    x: docking.x,\n    y: docking.y\n  };\n}\n","import BpmnConnectSnapping from './BpmnConnectSnapping';\nimport BpmnCreateMoveSnapping from './BpmnCreateMoveSnapping';\nimport SnappingModule from 'diagram-js/lib/features/snapping';\n\nexport default {\n  __depends__: [ SnappingModule ],\n  __init__: [\n    'connectSnapping',\n    'createMoveSnapping'\n  ],\n  connectSnapping: [ 'type', BpmnConnectSnapping ],\n  createMoveSnapping: [ 'type', BpmnCreateMoveSnapping ]\n};","import {\n  getLabel,\n  isLabel\n} from '../../util/LabelUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\n * @typedef {import('diagram-js/lib/features/search-pad/SearchPad').default} SearchPad\n *\n * @typedef {import('diagram-js/lib/features/search-pad/SearchPadProvider').default} SearchPadProvider\n * @typedef {import('diagram-js/lib/features/search-pad/SearchPadProvider').SearchResult} SearchPadResult\n * @typedef {import('diagram-js/lib/features/search-pad/SearchPadProvider').Token} SearchPadToken\n * @typedef {import('diagram-js/lib/features/search/search').default} Search\n * @typedef {import('diagram-js/lib/features/search/search').SearchResult} SearchResult\n * @typedef {import('diagram-js/lib/features/search/search').Token} SearchToken\n */\n\n/**\n * Provides ability to search for BPMN elements.\n *\n * @implements {SearchPadProvider}\n *\n * @param {ElementRegistry} elementRegistry\n * @param {SearchPad} searchPad\n * @param {Canvas} canvas\n * @param {Search} search\n */\nexport default function BpmnSearchProvider(elementRegistry, searchPad, canvas, search) {\n  this._elementRegistry = elementRegistry;\n  this._canvas = canvas;\n  this._search = search;\n\n  searchPad.registerProvider(this);\n}\n\nBpmnSearchProvider.$inject = [\n  'elementRegistry',\n  'searchPad',\n  'canvas',\n  'search'\n];\n\n/**\n * @param {string} pattern\n *\n * @return {SearchPadResult[]}\n */\nBpmnSearchProvider.prototype.find = function(pattern) {\n  var rootElements = this._canvas.getRootElements();\n\n  var elements = this._elementRegistry.filter(function(element) {\n    return !isLabel(element) && !rootElements.includes(element);\n  });\n\n  return this._search(\n    elements.map(element => {\n      return {\n        element,\n        label: getLabel(element),\n        id: element.id\n      };\n    }),\n    pattern, {\n      keys: [\n        'label',\n        'id'\n      ]\n    }\n  ).map(toSearchPadResult);\n};\n\n/**\n * @param {SearchResult} token\n *\n * @return {SearchPadResult}\n */\nfunction toSearchPadResult(result) {\n\n  const {\n    item: {\n      element\n    },\n    tokens\n  } = result;\n\n  return {\n    element,\n    primaryTokens: tokens.label,\n    secondaryTokens: tokens.id\n  };\n}","import SearchPadModule from 'diagram-js/lib/features/search-pad';\nimport SearchModule from 'diagram-js/lib/features/search';\n\nimport BpmnSearchProvider from './BpmnSearchProvider';\n\n\nexport default {\n  __depends__: [\n    SearchPadModule,\n    SearchModule\n  ],\n  __init__: [ 'bpmnSearch' ],\n  bpmnSearch: [ 'type', BpmnSearchProvider ]\n};\n","import {\n  create as svgCreate\n} from 'tiny-svg';\n\nexport const DATA_OBJECT_REFERENCE_OUTLINE_PATH = 'M44.7648 11.3263L36.9892 2.64074C36.0451 1.58628 34.5651 0.988708 33.1904 0.988708H5.98667C3.22688 0.988708 0.989624 3.34892 0.989624 6.26039V55.0235C0.989624 57.9349 3.22688 60.2952 5.98667 60.2952H40.966C43.7257 60.2952 45.963 57.9349 45.963 55.0235V14.9459C45.963 13.5998 45.6407 12.3048 44.7648 11.3263Z';\nexport const DATA_STORE_REFERENCE_OUTLINE_PATH = 'M1.03845 48.1347C1.03845 49.3511 1.07295 50.758 1.38342 52.064C1.69949 53.3938 2.32428 54.7154 3.56383 55.6428C6.02533 57.4841 10.1161 58.7685 14.8212 59.6067C19.5772 60.4538 25.1388 60.8738 30.6831 60.8738C36.2276 60.8738 41.7891 60.4538 46.545 59.6067C51.2504 58.7687 55.3412 57.4842 57.8028 55.6429C59.0424 54.7156 59.6673 53.3938 59.9834 52.064C60.2938 50.7579 60.3285 49.351 60.3285 48.1344V13.8415C60.3285 12.6249 60.2938 11.218 59.9834 9.91171C59.6673 8.58194 59.0423 7.2602 57.8027 6.33294C55.341 4.49168 51.2503 3.20723 46.545 2.36914C41.7891 1.522 36.2276 1.10204 30.6831 1.10205C25.1388 1.10206 19.5772 1.52206 14.8213 2.36923C10.1162 3.20734 6.02543 4.49183 3.5639 6.33314C2.32433 7.26038 1.69951 8.58206 1.38343 9.91181C1.07295 11.2179 1.03845 12.6247 1.03845 13.8411V48.1347Z';\n\n/**\n * @typedef { import('diagram-js/lib/util/Types').Dimensions} Dimensions\n */\n\n/**\n * @type {Dimensions}\n */\nexport const DATA_OBJECT_REFERENCE_STANDARD_SIZE = { width: 36, height: 50 };\n\n/**\n * @type {Dimensions}\n */\nexport const DATA_STORE_REFERENCE_STANDARD_SIZE = { width: 50, height: 50 };\n\n/**\n * Create a path element with given attributes.\n * @param {string} path\n * @param {Object} attrs\n * @param {Object} OUTLINE_STYLE\n * @return {SVGElement}\n */\nexport function createPath(path, attrs, OUTLINE_STYLE) {\n  return svgCreate('path', {\n    d: path,\n    strokeWidth: 2,\n    transform: `translate(${attrs.x}, ${attrs.y})`,\n    ...OUTLINE_STYLE\n  });\n}","import { assign } from 'min-dash';\n\nimport {\n  attr as svgAttr,\n  create as svgCreate\n} from 'tiny-svg';\n\nimport {\n  is,\n  isAny\n} from '../../util/ModelUtil';\n\nimport { isLabel, isExternalLabel } from '../../util/LabelUtil';\n\nimport {\n  DATA_OBJECT_REFERENCE_OUTLINE_PATH,\n  DATA_STORE_REFERENCE_OUTLINE_PATH,\n  DATA_OBJECT_REFERENCE_STANDARD_SIZE,\n  DATA_STORE_REFERENCE_STANDARD_SIZE,\n  createPath\n} from './OutlineUtil';\n\n/**\n * @typedef { import('diagram-js/lib/features/outline/OutlineProvider').default } BaseOutlineProvider\n *\n * @typedef { import('diagram-js/lib/features/outline/OutlineProvider').Outline } Outline\n *\n * @typedef { import('diagram-js/lib/draw/Styles').default } Styles\n *\n * @typedef { import('diagram-js/lib/model/Types').Element } Element\n */\n\nconst DEFAULT_OFFSET = 5;\n\n/**\n * BPMN-specific outline provider.\n *\n * @implements {BaseOutlineProvider}\n *\n * @param {Outline} outline\n * @param {Styles} styles\n */\nexport default function OutlineProvider(outline, styles) {\n\n  this._styles = styles;\n  outline.registerProvider(this);\n}\n\nOutlineProvider.$inject = [\n  'outline',\n  'styles'\n];\n\n/**\n * Returns outline for a given element.\n *\n * @param {Element} element\n *\n * @return {Outline}\n */\nOutlineProvider.prototype.getOutline = function(element) {\n\n  const OUTLINE_STYLE = this._styles.cls('djs-outline', [ 'no-fill' ]);\n\n  var outline;\n\n  if (isExternalLabel(element)) {\n    outline = svgCreate('rect');\n\n    svgAttr(outline, assign({\n      x: -DEFAULT_OFFSET,\n      y: -DEFAULT_OFFSET,\n      rx: 4,\n      width: element.width + DEFAULT_OFFSET * 2,\n      height: element.height + DEFAULT_OFFSET * 2\n    }, OUTLINE_STYLE));\n\n    return outline;\n  }\n\n  if (isLabel(element)) {\n    return;\n  }\n\n  if (is(element, 'bpmn:Gateway')) {\n    outline = svgCreate('rect');\n\n    assign(outline.style, {\n      'transform-box': 'fill-box',\n      'transform': 'rotate(45deg)',\n      'transform-origin': 'center'\n    });\n\n    svgAttr(outline, assign({\n      x: 2,\n      y: 2,\n      rx: 4,\n      width: element.width - 4,\n      height: element.height - 4,\n    }, OUTLINE_STYLE));\n\n  } else if (isAny(element, [ 'bpmn:Task', 'bpmn:SubProcess', 'bpmn:Group', 'bpmn:CallActivity' ])) {\n    outline = svgCreate('rect');\n\n    svgAttr(outline, assign({\n      x: -DEFAULT_OFFSET,\n      y: -DEFAULT_OFFSET,\n      rx: 14,\n      width: element.width + DEFAULT_OFFSET * 2,\n      height: element.height + DEFAULT_OFFSET * 2\n    }, OUTLINE_STYLE));\n\n  } else if (is(element, 'bpmn:EndEvent')) {\n\n    outline = svgCreate('circle');\n\n    // Extra 1px offset needed due to increased stroke-width of end event\n    // which makes it bigger than other events.\n\n    svgAttr(outline, assign({\n      cx: element.width / 2,\n      cy: element.height / 2,\n      r: element.width / 2 + DEFAULT_OFFSET + 1\n    }, OUTLINE_STYLE));\n\n  } else if (is(element, 'bpmn:Event')) {\n    outline = svgCreate('circle');\n\n    svgAttr(outline, assign({\n      cx: element.width / 2,\n      cy: element.height / 2,\n      r: element.width / 2 + DEFAULT_OFFSET\n    }, OUTLINE_STYLE));\n\n  } else if (is(element, 'bpmn:DataObjectReference') && isStandardSize(element, 'bpmn:DataObjectReference')) {\n\n    outline = createPath(\n      DATA_OBJECT_REFERENCE_OUTLINE_PATH,\n      { x: -6, y: -6 },\n      OUTLINE_STYLE\n    );\n\n  } else if (is(element, 'bpmn:DataStoreReference') && isStandardSize(element, 'bpmn:DataStoreReference')) {\n\n    outline = createPath(\n      DATA_STORE_REFERENCE_OUTLINE_PATH,\n      { x: -6, y: -6 },\n      OUTLINE_STYLE\n    );\n  }\n\n  return outline;\n};\n\n/**\n * Updates the outline for a given element.\n * Returns true if the update for the given element was handled by this provider.\n *\n * @param {Element} element\n * @param {Outline} outline\n * @returns {boolean}\n */\nOutlineProvider.prototype.updateOutline = function(element, outline) {\n\n  if (isLabel(element)) {\n    return;\n  }\n\n  if (isAny(element, [ 'bpmn:SubProcess', 'bpmn:Group' ])) {\n\n    svgAttr(outline, {\n      width: element.width + DEFAULT_OFFSET * 2,\n      height: element.height + DEFAULT_OFFSET * 2\n    });\n\n    return true;\n\n  } else if (isAny(element, [\n    'bpmn:Event',\n    'bpmn:Gateway',\n    'bpmn:DataStoreReference',\n    'bpmn:DataObjectReference'\n  ])) {\n    return true;\n  }\n\n  return false;\n};\n\n\n// helpers //////////\n\nfunction isStandardSize(element, type) {\n  var standardSize;\n\n  if (type === 'bpmn:DataObjectReference') {\n    standardSize = DATA_OBJECT_REFERENCE_STANDARD_SIZE;\n  } else if (type === 'bpmn:DataStoreReference') {\n    standardSize = DATA_STORE_REFERENCE_STANDARD_SIZE;\n  }\n\n  return element.width === standardSize.width\n          && element.height === standardSize.height;\n}","import Outline from 'diagram-js/lib/features/outline';\nimport OutlineProvider from './OutlineProvider';\n\nexport default {\n  __depends__: [\n    Outline\n  ],\n  __init__: [ 'outlineProvider' ],\n  outlineProvider: [ 'type', OutlineProvider ]\n};\n","import inherits from 'inherits-browser';\n\nimport BaseModeler from './BaseModeler';\n\nimport Viewer from './Viewer';\nimport NavigatedViewer from './NavigatedViewer';\n\nimport KeyboardMoveModule from 'diagram-js/lib/navigation/keyboard-move';\nimport MoveCanvasModule from 'diagram-js/lib/navigation/movecanvas';\nimport ZoomScrollModule from 'diagram-js/lib/navigation/zoomscroll';\n\nimport AlignElementsModule from './features/align-elements';\nimport AutoPlaceModule from './features/auto-place';\nimport AutoResizeModule from './features/auto-resize';\nimport AutoScrollModule from 'diagram-js/lib/features/auto-scroll';\nimport BendpointsModule from 'diagram-js/lib/features/bendpoints';\nimport ConnectModule from 'diagram-js/lib/features/connect';\nimport ConnectionPreviewModule from 'diagram-js/lib/features/connection-preview';\nimport ContextPadModule from './features/context-pad';\nimport CopyPasteModule from './features/copy-paste';\nimport CreateModule from 'diagram-js/lib/features/create';\nimport DistributeElementsModule from './features/distribute-elements';\nimport EditorActionsModule from './features/editor-actions';\nimport GridSnappingModule from './features/grid-snapping';\nimport InteractionEventsModule from './features/interaction-events';\nimport KeyboardModule from './features/keyboard';\nimport KeyboardMoveSelectionModule from 'diagram-js/lib/features/keyboard-move-selection';\nimport LabelEditingModule from './features/label-editing';\nimport LabelLink from './features/label-link';\nimport ModelingModule from './features/modeling';\nimport ModelingFeedbackModule from './features/modeling-feedback';\nimport MoveModule from 'diagram-js/lib/features/move';\nimport PaletteModule from './features/palette';\nimport ReplacePreviewModule from './features/replace-preview';\nimport ResizeModule from 'diagram-js/lib/features/resize';\nimport SnappingModule from './features/snapping';\nimport SearchModule from './features/search';\nimport OutlineModule from './features/outline';\n\nvar initialDiagram =\n  '<?xml version=\"1.0\" encoding=\"UTF-8\"?>' +\n  '<bpmn:definitions xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" ' +\n                    'xmlns:bpmn=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" ' +\n                    'xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" ' +\n                    'xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\" ' +\n                    'targetNamespace=\"http://bpmn.io/schema/bpmn\" ' +\n                    'id=\"Definitions_1\">' +\n    '<bpmn:process id=\"Process_1\" isExecutable=\"false\">' +\n      '<bpmn:startEvent id=\"StartEvent_1\"/>' +\n    '</bpmn:process>' +\n    '<bpmndi:BPMNDiagram id=\"BPMNDiagram_1\">' +\n      '<bpmndi:BPMNPlane id=\"BPMNPlane_1\" bpmnElement=\"Process_1\">' +\n        '<bpmndi:BPMNShape id=\"_BPMNShape_StartEvent_2\" bpmnElement=\"StartEvent_1\">' +\n          '<dc:Bounds height=\"36.0\" width=\"36.0\" x=\"173.0\" y=\"102.0\"/>' +\n        '</bpmndi:BPMNShape>' +\n      '</bpmndi:BPMNPlane>' +\n    '</bpmndi:BPMNDiagram>' +\n  '</bpmn:definitions>';\n\n\n/**\n * @typedef {import('./BaseViewer').BaseViewerOptions} BaseViewerOptions\n * @typedef {import('./BaseViewer').ImportXMLResult} ImportXMLResult\n */\n\n/**\n * A modeler for BPMN 2.0 diagrams.\n *\n * ## Extending the Modeler\n *\n * In order to extend the viewer pass extension modules to bootstrap via the\n * `additionalModules` option. An extension module is an object that exposes\n * named services.\n *\n * The following example depicts the integration of a simple\n * logging component that integrates with interaction events:\n *\n *\n * ```javascript\n *\n * // logging component\n * function InteractionLogger(eventBus) {\n *   eventBus.on('element.hover', function(event) {\n *     console.log()\n *   })\n * }\n *\n * InteractionLogger.$inject = [ 'eventBus' ]; // minification save\n *\n * // extension module\n * var extensionModule = {\n *   __init__: [ 'interactionLogger' ],\n *   interactionLogger: [ 'type', InteractionLogger ]\n * };\n *\n * // extend the viewer\n * var bpmnModeler = new Modeler({ additionalModules: [ extensionModule ] });\n * bpmnModeler.importXML(...);\n * ```\n *\n *\n * ## Customizing / Replacing Components\n *\n * You can replace individual diagram components by redefining them in override modules.\n * This works for all components, including those defined in the core.\n *\n * Pass in override modules via the `options.additionalModules` flag like this:\n *\n * ```javascript\n * function CustomContextPadProvider(contextPad) {\n *\n *   contextPad.registerProvider(this);\n *\n *   this.getContextPadEntries = function(element) {\n *     // no entries, effectively disable the context pad\n *     return {};\n *   };\n * }\n *\n * CustomContextPadProvider.$inject = [ 'contextPad' ];\n *\n * var overrideModule = {\n *   contextPadProvider: [ 'type', CustomContextPadProvider ]\n * };\n *\n * var bpmnModeler = new Modeler({ additionalModules: [ overrideModule ]});\n * ```\n *\n * @template [ServiceMap=null]\n *\n * @extends BaseModeler<ServiceMap>\n *\n * @param {BaseViewerOptions} [options] The options to configure the modeler.\n */\nexport default function Modeler(options) {\n  BaseModeler.call(this, options);\n}\n\ninherits(Modeler, BaseModeler);\n\n\nModeler.Viewer = Viewer;\nModeler.NavigatedViewer = NavigatedViewer;\n\n/**\n * Create a new diagram to start modeling.\n *\n * @throws {ImportXMLError} An error thrown during the import of the XML.\n *\n * @return {Promise<ImportXMLResult>} A promise resolving with warnings that were produced during the import.\n */\nModeler.prototype.createDiagram = function createDiagram() {\n  return this.importXML(initialDiagram);\n};\n\n\nModeler.prototype._interactionModules = [\n\n  // non-modeling components\n  KeyboardMoveModule,\n  MoveCanvasModule,\n  ZoomScrollModule\n];\n\nModeler.prototype._modelingModules = [\n\n  // modeling components\n  AlignElementsModule,\n  AutoPlaceModule,\n  AutoScrollModule,\n  AutoResizeModule,\n  BendpointsModule,\n  ConnectModule,\n  ConnectionPreviewModule,\n  ContextPadModule,\n  CopyPasteModule,\n  CreateModule,\n  DistributeElementsModule,\n  EditorActionsModule,\n  GridSnappingModule,\n  InteractionEventsModule,\n  KeyboardModule,\n  KeyboardMoveSelectionModule,\n  LabelEditingModule,\n  LabelLink,\n  ModelingModule,\n  ModelingFeedbackModule,\n  MoveModule,\n  PaletteModule,\n  ReplacePreviewModule,\n  ResizeModule,\n  SnappingModule,\n  SearchModule,\n  OutlineModule\n];\n\n\n// modules the modeler is composed of\n//\n// - viewer modules\n// - interaction modules\n// - modeling modules\n\nModeler.prototype._modules = [].concat(\n  Viewer.prototype._modules,\n  Modeler.prototype._interactionModules,\n  Modeler.prototype._modelingModules\n);\n","import { event, classes, attr as attr$1, query, queryAll } from 'min-dom';\nimport { create, attr, append, classes as classes$1, remove, clone, clear } from 'tiny-svg';\nimport { assign, every, isObject, isNumber } from 'min-dash';\nimport { escapeCSS } from 'diagram-js/lib/util/EscapeUtil';\nimport { getVisual } from 'diagram-js/lib/util/GraphicsUtil';\nimport IdGenerator from 'diagram-js/lib/util/IdGenerator';\n\nvar MINIMAP_VIEWBOX_PADDING = 50;\n\nvar IDS = new IdGenerator();\n\nvar RANGE = { min: 0.2, max: 4 },\n    NUM_STEPS = 10;\n\nvar DELTA_THRESHOLD = 0.1;\n\nvar LOW_PRIORITY = 250;\n\n\n/**\n * A minimap that reflects and lets you navigate the diagram.\n */\nfunction Minimap(\n    config, injector, eventBus,\n    canvas, elementRegistry) {\n\n  var self = this;\n\n  this._canvas = canvas;\n  this._elementRegistry = elementRegistry;\n  this._eventBus = eventBus;\n  this._injector = injector;\n\n  this._state = {\n    isOpen: undefined,\n    isDragging: false,\n    initialDragPosition: null,\n    offsetViewport: null,\n    cachedViewbox: null,\n    dragger: null,\n    svgClientRect: null,\n    parentClientRect: null,\n    zoomDelta: 0\n  };\n\n  this._minimapId = IDS.next();\n\n  this._init();\n\n  this.toggle((config && config.open) || false);\n\n  function centerViewbox(point) {\n\n    // getBoundingClientRect might return zero-dimensional when called for the first time\n    if (!self._state._svgClientRect || isZeroDimensional(self._state._svgClientRect)) {\n      self._state._svgClientRect = self._svg.getBoundingClientRect();\n    }\n\n    var diagramPoint = mapMousePositionToDiagramPoint({\n      x: point.x - self._state._svgClientRect.left,\n      y: point.y - self._state._svgClientRect.top\n    }, self._svg, self._lastViewbox);\n\n    setViewboxCenteredAroundPoint(diagramPoint, self._canvas);\n\n    self._update();\n  }\n\n  function mousedown(center) {\n\n    return function onMousedown(event$1) {\n      var point = getPoint(event$1);\n\n      // getBoundingClientRect might return zero-dimensional when called for the first time\n      if (!self._state._svgClientRect || isZeroDimensional(self._state._svgClientRect)) {\n        self._state._svgClientRect = self._svg.getBoundingClientRect();\n      }\n\n      if (center) {\n        centerViewbox(point);\n      }\n\n      var diagramPoint = mapMousePositionToDiagramPoint({\n        x: point.x - self._state._svgClientRect.left,\n        y: point.y - self._state._svgClientRect.top\n      }, self._svg, self._lastViewbox);\n\n      var viewbox = canvas.viewbox();\n\n      var offsetViewport = getOffsetViewport(diagramPoint, viewbox);\n\n      var initialViewportDomRect = self._viewportDom.getBoundingClientRect();\n\n      // take border into account (regardless of width)\n      var offsetViewportDom = {\n        x: point.x - initialViewportDomRect.left + 1,\n        y: point.y - initialViewportDomRect.top + 1\n      };\n\n      // init dragging\n      assign(self._state, {\n        cachedViewbox: viewbox,\n        initialDragPosition: {\n          x: point.x,\n          y: point.y\n        },\n        isDragging: true,\n        offsetViewport: offsetViewport,\n        offsetViewportDom: offsetViewportDom,\n        viewportClientRect: self._viewport.getBoundingClientRect(),\n        parentClientRect: self._parent.getBoundingClientRect()\n      });\n\n      event.bind(document, 'mousemove', onMousemove);\n      event.bind(document, 'mouseup', onMouseup);\n    };\n  }\n\n  function onMousemove(event) {\n    var point = getPoint(event);\n\n    // set viewbox if dragging active\n    if (self._state.isDragging) {\n\n      // getBoundingClientRect might return zero-dimensional when called for the first time\n      if (!self._state._svgClientRect || isZeroDimensional(self._state._svgClientRect)) {\n        self._state._svgClientRect = self._svg.getBoundingClientRect();\n      }\n\n      // update viewport DOM\n      var offsetViewportDom = self._state.offsetViewportDom,\n          viewportClientRect = self._state.viewportClientRect,\n          parentClientRect = self._state.parentClientRect;\n\n      assign(self._viewportDom.style, {\n        top: (point.y - offsetViewportDom.y - parentClientRect.top) + 'px',\n        left: (point.x - offsetViewportDom.x - parentClientRect.left) + 'px'\n      });\n\n      // update overlay\n      var clipPath = getOverlayClipPath(parentClientRect, {\n        top: point.y - offsetViewportDom.y - parentClientRect.top,\n        left: point.x - offsetViewportDom.x - parentClientRect.left,\n        width: viewportClientRect.width,\n        height: viewportClientRect.height\n      });\n\n      assign(self._overlay.style, {\n        clipPath: clipPath\n      });\n\n      var diagramPoint = mapMousePositionToDiagramPoint({\n        x: point.x - self._state._svgClientRect.left,\n        y: point.y - self._state._svgClientRect.top\n      }, self._svg, self._lastViewbox);\n\n      setViewboxCenteredAroundPoint({\n        x: diagramPoint.x - self._state.offsetViewport.x,\n        y: diagramPoint.y - self._state.offsetViewport.y\n      }, self._canvas);\n    }\n  }\n\n  function onMouseup(event$1) {\n    var point = getPoint(event$1);\n\n    if (self._state.isDragging) {\n\n      // treat event as click\n      if (self._state.initialDragPosition.x === point.x\n          && self._state.initialDragPosition.y === point.y) {\n        centerViewbox(event$1);\n      }\n\n      self._update();\n\n      // end dragging\n      assign(self._state, {\n        cachedViewbox: null,\n        initialDragPosition: null,\n        isDragging: false,\n        offsetViewport: null,\n        offsetViewportDom: null\n      });\n\n      event.unbind(document, 'mousemove', onMousemove);\n      event.unbind(document, 'mouseup', onMouseup);\n    }\n  }\n\n  // dragging viewport scrolls canvas\n  event.bind(this._viewportDom, 'mousedown', mousedown(false));\n  event.bind(this._svg, 'mousedown', mousedown(true));\n\n  event.bind(this._parent, 'wheel', function(event) {\n\n    // stop propagation and handle scroll differently\n    event.preventDefault();\n    event.stopPropagation();\n\n    // only zoom in on ctrl; this aligns with diagram-js navigation behavior\n    if (!event.ctrlKey) {\n      return;\n    }\n\n    // getBoundingClientRect might return zero-dimensional when called for the first time\n    if (!self._state._svgClientRect || isZeroDimensional(self._state._svgClientRect)) {\n      self._state._svgClientRect = self._svg.getBoundingClientRect();\n    }\n\n    // disallow zooming through viewport outside of minimap as it is very confusing\n    if (!isPointInside(event, self._state._svgClientRect)) {\n      return;\n    }\n\n    var factor = event.deltaMode === 0 ? 0.020 : 0.32;\n\n    var delta = (\n      Math.sqrt(\n        Math.pow(event.deltaY, 2) +\n        Math.pow(event.deltaX, 2)\n      ) * sign(event.deltaY) * -factor\n    );\n\n    // add until threshold reached\n    self._state.zoomDelta += delta;\n\n    if (Math.abs(self._state.zoomDelta) > DELTA_THRESHOLD) {\n      var direction = delta > 0 ? 1 : -1;\n\n      var currentLinearZoomLevel = Math.log(canvas.zoom()) / Math.log(10);\n\n      // zoom with half the step size of stepZoom\n      var stepSize = getStepSize(RANGE, NUM_STEPS * 2);\n\n      // snap to a proximate zoom step\n      var newLinearZoomLevel = Math.round(currentLinearZoomLevel / stepSize) * stepSize;\n\n      // increase or decrease one zoom step in the given direction\n      newLinearZoomLevel += stepSize * direction;\n\n      // calculate the absolute logarithmic zoom level based on the linear zoom level\n      // (e.g. 2 for an absolute x2 zoom)\n      var newLogZoomLevel = Math.pow(10, newLinearZoomLevel);\n\n      canvas.zoom(cap(RANGE, newLogZoomLevel), diagramPoint);\n\n      // reset\n      self._state.zoomDelta = 0;\n\n      var diagramPoint = mapMousePositionToDiagramPoint({\n        x: event.clientX - self._state._svgClientRect.left,\n        y: event.clientY - self._state._svgClientRect.top\n      }, self._svg, self._lastViewbox);\n\n      setViewboxCenteredAroundPoint(diagramPoint, self._canvas);\n\n      self._update();\n    }\n  });\n\n  event.bind(this._toggle, 'click', function(event) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    self.toggle();\n  });\n\n  // add shape on shape/connection added\n  eventBus.on([ 'shape.added', 'connection.added' ], function(context) {\n    var element = context.element;\n\n    self._addElement(element);\n\n    self._update();\n  });\n\n  // remove shape on shape/connection removed\n  eventBus.on([ 'shape.removed', 'connection.removed' ], function(context) {\n    var element = context.element;\n\n    self._removeElement(element);\n\n    self._update();\n  });\n\n  // update on elements changed\n  eventBus.on('elements.changed', LOW_PRIORITY, function(context) {\n    var elements = context.elements;\n\n    elements.forEach(function(element) {\n      self._updateElement(element);\n    });\n\n    self._update();\n  });\n\n  // update on element ID update\n  eventBus.on('element.updateId', function(context) {\n    var element = context.element,\n        newId = context.newId;\n\n    self._updateElementId(element, newId);\n  });\n\n  // update on viewbox changed\n  eventBus.on('canvas.viewbox.changed', function() {\n    if (!self._state.isDragging) {\n      self._update();\n    }\n  });\n\n  eventBus.on('canvas.resized', function() {\n\n    // only update if present in DOM\n    if (document.body.contains(self._parent)) {\n      if (!self._state.isDragging) {\n        self._update();\n      }\n\n      self._state._svgClientRect = self._svg.getBoundingClientRect();\n    }\n\n  });\n\n  eventBus.on([ 'root.set', 'plane.set' ], function(event) {\n    self._clear();\n\n    var element = event.element || event.plane.rootElement;\n\n    element.children.forEach(function(el) {\n      self._addElement(el);\n    });\n\n    self._update();\n  });\n\n}\n\nMinimap.$inject = [\n  'config.minimap',\n  'injector',\n  'eventBus',\n  'canvas',\n  'elementRegistry'\n];\n\nMinimap.prototype._init = function() {\n  var canvas = this._canvas,\n      container = canvas.getContainer();\n\n  // create parent div\n  var parent = this._parent = document.createElement('div');\n\n  classes(parent).add('djs-minimap');\n\n  container.appendChild(parent);\n\n  // create toggle\n  var toggle = this._toggle = document.createElement('div');\n\n  classes(toggle).add('toggle');\n\n  parent.appendChild(toggle);\n\n  // create map\n  var map = this._map = document.createElement('div');\n\n  classes(map).add('map');\n\n  parent.appendChild(map);\n\n  // create svg\n  var svg = this._svg = create('svg');\n  attr(svg, { width: '100%', height: '100%' });\n  append(map, svg);\n\n  // add groups\n  var elementsGroup = this._elementsGroup = create('g');\n  append(svg, elementsGroup);\n\n  var viewportGroup = this._viewportGroup = create('g');\n  append(svg, viewportGroup);\n\n  // add viewport SVG\n  var viewport = this._viewport = create('rect');\n\n  classes$1(viewport).add('viewport');\n\n  append(viewportGroup, viewport);\n\n  // prevent drag propagation\n  event.bind(parent, 'mousedown', function(event) {\n    event.stopPropagation();\n  });\n\n  // add viewport DOM\n  var viewportDom = this._viewportDom = document.createElement('div');\n\n  classes(viewportDom).add('viewport-dom');\n\n  this._parent.appendChild(viewportDom);\n\n  // add overlay\n  var overlay = this._overlay = document.createElement('div');\n\n  classes(overlay).add('overlay');\n\n  this._parent.appendChild(overlay);\n};\n\nMinimap.prototype._update = function() {\n  var viewbox = this._canvas.viewbox(),\n      innerViewbox = viewbox.inner,\n      outerViewbox = viewbox.outer;\n\n  if (!validViewbox(viewbox)) {\n    return;\n  }\n\n  var x, y, width, height;\n\n  var widthDifference = outerViewbox.width - innerViewbox.width,\n      heightDifference = outerViewbox.height - innerViewbox.height;\n\n  // update viewbox\n  // x\n  if (innerViewbox.width < outerViewbox.width) {\n    x = innerViewbox.x - widthDifference / 2;\n    width = outerViewbox.width;\n\n    if (innerViewbox.x + innerViewbox.width < outerViewbox.width) {\n      x = Math.min(0, innerViewbox.x);\n    }\n  } else {\n    x = innerViewbox.x;\n    width = innerViewbox.width;\n  }\n\n  // y\n  if (innerViewbox.height < outerViewbox.height) {\n    y = innerViewbox.y - heightDifference / 2;\n    height = outerViewbox.height;\n\n    if (innerViewbox.y + innerViewbox.height < outerViewbox.height) {\n      y = Math.min(0, innerViewbox.y);\n    }\n  } else {\n    y = innerViewbox.y;\n    height = innerViewbox.height;\n  }\n\n  // apply some padding\n  x = x - MINIMAP_VIEWBOX_PADDING;\n  y = y - MINIMAP_VIEWBOX_PADDING;\n  width = width + MINIMAP_VIEWBOX_PADDING * 2;\n  height = height + MINIMAP_VIEWBOX_PADDING * 2;\n\n  this._lastViewbox = {\n    x: x,\n    y: y,\n    width: width,\n    height: height\n  };\n\n  attr(this._svg, {\n    viewBox: x + ', ' + y + ', ' + width + ', ' + height\n  });\n\n  // update viewport SVG\n  attr(this._viewport, {\n    x: viewbox.x,\n    y: viewbox.y,\n    width: viewbox.width,\n    height: viewbox.height\n  });\n\n  // update viewport DOM\n  var parentClientRect = this._state._parentClientRect = this._parent.getBoundingClientRect();\n  var viewportClientRect = this._viewport.getBoundingClientRect();\n\n  var withoutParentOffset = {\n    top: viewportClientRect.top - parentClientRect.top,\n    left: viewportClientRect.left - parentClientRect.left,\n    width: viewportClientRect.width,\n    height: viewportClientRect.height\n  };\n\n  assign(this._viewportDom.style, {\n    top: withoutParentOffset.top + 'px',\n    left: withoutParentOffset.left + 'px',\n    width: withoutParentOffset.width + 'px',\n    height: withoutParentOffset.height + 'px'\n  });\n\n  // update overlay\n  var clipPath = getOverlayClipPath(parentClientRect, withoutParentOffset);\n\n  assign(this._overlay.style, {\n    clipPath: clipPath\n  });\n};\n\nMinimap.prototype.open = function() {\n  assign(this._state, { isOpen: true });\n\n  classes(this._parent).add('open');\n\n  var translate = this._injector.get('translate', false) || function(s) { return s; };\n\n  attr$1(this._toggle, 'title', translate('Close minimap'));\n\n  this._update();\n\n  this._eventBus.fire('minimap.toggle', { open: true });\n};\n\nMinimap.prototype.close = function() {\n  assign(this._state, { isOpen: false });\n\n  classes(this._parent).remove('open');\n\n  var translate = this._injector.get('translate', false) || function(s) { return s; };\n\n  attr$1(this._toggle, 'title', translate('Open minimap'));\n\n  this._eventBus.fire('minimap.toggle', { open: false });\n};\n\nMinimap.prototype.toggle = function(open) {\n\n  var currentOpen = this.isOpen();\n\n  if (typeof open === 'undefined') {\n    open = !currentOpen;\n  }\n\n  if (open == currentOpen) {\n    return;\n  }\n\n  if (open) {\n    this.open();\n  } else {\n    this.close();\n  }\n};\n\nMinimap.prototype.isOpen = function() {\n  return this._state.isOpen;\n};\n\nMinimap.prototype._updateElement = function(element) {\n\n  try {\n\n    // if parent is null element has been removed, if parent is undefined parent is root\n    if (element.parent !== undefined && element.parent !== null) {\n      this._removeElement(element);\n      this._addElement(element);\n    }\n  } catch (error) {\n    console.warn('Minimap#_updateElement errored', error);\n  }\n\n};\n\nMinimap.prototype._updateElementId = function(element, newId) {\n\n  try {\n    var elementGfx = query('#' + escapeCSS(this._prefixId(element.id)), this._elementsGroup);\n\n    if (elementGfx) {\n      elementGfx.id = this._prefixId(newId);\n    }\n  } catch (error) {\n    console.warn('Minimap#_updateElementId errored', error);\n  }\n\n};\n\n/**\n * Checks if an element is on the currently active plane.\n */\nMinimap.prototype.isOnActivePlane = function(element) {\n  var canvas = this._canvas;\n\n  // diagram-js@8\n  if (canvas.findRoot) {\n    return canvas.findRoot(element) === canvas.getRootElement();\n  }\n\n  // diagram-js>=7.4.0\n  if (canvas.findPlane) {\n    return canvas.findPlane(element) === canvas.getActivePlane();\n  }\n\n  // diagram-js<7.4.0\n  return true;\n};\n\n\n/**\n * Adds an element to the minimap.\n */\nMinimap.prototype._addElement = function(element) {\n  var self = this;\n\n  this._removeElement(element);\n\n  if (!this.isOnActivePlane(element)) {\n    return;\n  }\n\n  var parent,\n      x, y;\n\n  var newElementGfx = this._createElement(element);\n  var newElementParentGfx = query('#' + escapeCSS(this._prefixId(element.parent.id)), this._elementsGroup);\n\n  if (newElementGfx) {\n\n    var elementGfx = this._elementRegistry.getGraphics(element);\n    var parentGfx = this._elementRegistry.getGraphics(element.parent);\n\n    var index = getIndexOfChildInParentChildren(elementGfx, parentGfx);\n\n    // index can be 0\n    if (index !== 'undefined') {\n      if (newElementParentGfx) {\n\n        // in cases of doubt add as last child\n        if (newElementParentGfx.childNodes.length > index) {\n          insertChildAtIndex(newElementGfx, newElementParentGfx, index);\n        } else {\n          insertChildAtIndex(newElementGfx, newElementParentGfx, newElementParentGfx.childNodes.length - 1);\n        }\n\n      } else {\n        this._elementsGroup.appendChild(newElementGfx);\n      }\n\n    } else {\n\n      // index undefined\n      this._elementsGroup.appendChild(newElementGfx);\n    }\n\n    if (isConnection(element)) {\n      parent = element.parent;\n      x = 0;\n      y = 0;\n\n      if (typeof parent.x !== 'undefined' && typeof parent.y !== 'undefined') {\n        x = -parent.x;\n        y = -parent.y;\n      }\n\n      attr(newElementGfx, { transform: 'translate(' + x + ' ' + y + ')' });\n    } else {\n      x = element.x;\n      y = element.y;\n\n      if (newElementParentGfx) {\n        parent = element.parent;\n\n        x -= parent.x;\n        y -= parent.y;\n      }\n\n      attr(newElementGfx, { transform: 'translate(' + x + ' ' + y + ')' });\n    }\n\n    if (element.children && element.children.length) {\n      element.children.forEach(function(child) {\n        self._addElement(child);\n      });\n    }\n\n    return newElementGfx;\n  }\n};\n\nMinimap.prototype._removeElement = function(element) {\n  var elementGfx = this._svg.getElementById(this._prefixId(element.id));\n\n  if (elementGfx) {\n    remove(elementGfx);\n  }\n};\n\nMinimap.prototype._createElement = function(element) {\n  var gfx = this._elementRegistry.getGraphics(element),\n      visual;\n\n  if (gfx) {\n    visual = getVisual(gfx);\n\n    if (visual) {\n      var elementGfx = sanitize(clone(visual));\n\n      attr(elementGfx, { id: this._prefixId(element.id) });\n\n      return elementGfx;\n    }\n  }\n};\n\nMinimap.prototype._clear = function() {\n  clear(this._elementsGroup);\n};\n\nMinimap.prototype._prefixId = function(id) {\n  return 'djs-minimap-' + id + '-' + this._minimapId;\n};\n\n\nfunction isConnection(element) {\n  return element.waypoints;\n}\n\nfunction getOffsetViewport(diagramPoint, viewbox) {\n  var viewboxCenter = {\n    x: viewbox.x + (viewbox.width / 2),\n    y: viewbox.y + (viewbox.height / 2)\n  };\n\n  return {\n    x: diagramPoint.x - viewboxCenter.x,\n    y: diagramPoint.y - viewboxCenter.y\n  };\n}\n\nfunction mapMousePositionToDiagramPoint(position, svg, lastViewbox) {\n\n  // firefox returns 0 for clientWidth and clientHeight\n  var boundingClientRect = svg.getBoundingClientRect();\n\n  // take different aspect ratios of default layers bounding box and minimap into account\n  var bBox =\n    fitAspectRatio(lastViewbox, boundingClientRect.width / boundingClientRect.height);\n\n  // map click position to diagram position\n  var diagramX = map(position.x, 0, boundingClientRect.width, bBox.x, bBox.x + bBox.width),\n      diagramY = map(position.y, 0, boundingClientRect.height, bBox.y, bBox.y + bBox.height);\n\n  return {\n    x: diagramX,\n    y: diagramY\n  };\n}\n\nfunction setViewboxCenteredAroundPoint(point, canvas) {\n\n  // get cached viewbox to preserve zoom\n  var cachedViewbox = canvas.viewbox(),\n      cachedViewboxWidth = cachedViewbox.width,\n      cachedViewboxHeight = cachedViewbox.height;\n\n  canvas.viewbox({\n    x: point.x - cachedViewboxWidth / 2,\n    y: point.y - cachedViewboxHeight / 2,\n    width: cachedViewboxWidth,\n    height: cachedViewboxHeight\n  });\n}\n\nfunction fitAspectRatio(bounds, targetAspectRatio) {\n  var aspectRatio = bounds.width / bounds.height;\n\n  // assigning to bounds throws exception in IE11\n  var newBounds = assign({}, {\n    x: bounds.x,\n    y: bounds.y,\n    width: bounds.width,\n    height: bounds.height\n  });\n\n  if (aspectRatio > targetAspectRatio) {\n\n    // height needs to be fitted\n    var height = newBounds.width * (1 / targetAspectRatio),\n        y = newBounds.y - ((height - newBounds.height) / 2);\n\n    assign(newBounds, {\n      y: y,\n      height: height\n    });\n  } else if (aspectRatio < targetAspectRatio) {\n\n    // width needs to be fitted\n    var width = newBounds.height * targetAspectRatio,\n        x = newBounds.x - ((width - newBounds.width) / 2);\n\n    assign(newBounds, {\n      x: x,\n      width: width\n    });\n  }\n\n  return newBounds;\n}\n\nfunction map(x, inMin, inMax, outMin, outMax) {\n  var inRange = inMax - inMin,\n      outRange = outMax - outMin;\n\n  return (x - inMin) * outRange / inRange + outMin;\n}\n\n/**\n * Returns index of child in children of parent.\n *\n * g\n * '- g.djs-element // parentGfx\n * '- g.djs-children\n *    '- g\n *       '-g.djs-element // childGfx\n */\nfunction getIndexOfChildInParentChildren(childGfx, parentGfx) {\n  var childrenGroup = query('.djs-children', parentGfx.parentNode);\n\n  if (!childrenGroup) {\n    return;\n  }\n\n  var childrenArray = [].slice.call(childrenGroup.childNodes);\n\n  var indexOfChild = -1;\n\n  childrenArray.forEach(function(childGroup, index) {\n    if (query('.djs-element', childGroup) === childGfx) {\n      indexOfChild = index;\n    }\n  });\n\n  return indexOfChild;\n}\n\nfunction insertChildAtIndex(childGfx, parentGfx, index) {\n  var childContainer = getChildContainer(parentGfx);\n\n  var childrenArray = [].slice.call(childContainer.childNodes);\n\n  var childAtIndex = childrenArray[index];\n\n  if (childAtIndex) {\n    parentGfx.insertBefore(childGfx, childAtIndex.nextSibling);\n  } else {\n    parentGfx.appendChild(childGfx);\n  }\n}\n\nfunction getChildContainer(parentGfx) {\n  var container = query('.children', parentGfx);\n\n  if (!container) {\n    container = create('g', { class: 'children' });\n    append(parentGfx, container);\n  }\n\n  return container;\n}\n\nfunction isZeroDimensional(clientRect) {\n  return clientRect.width === 0 && clientRect.height === 0;\n}\n\nfunction isPointInside(point, rect) {\n  return point.x > rect.left\n    && point.x < rect.left + rect.width\n    && point.y > rect.top\n    && point.y < rect.top + rect.height;\n}\n\nvar sign = Math.sign || function(n) {\n  return n >= 0 ? 1 : -1;\n};\n\n/**\n * Get step size for given range and number of steps.\n *\n * @param {Object} range - Range.\n * @param {number} range.min - Range minimum.\n * @param {number} range.max - Range maximum.\n */\nfunction getStepSize(range, steps) {\n\n  var minLinearRange = Math.log(range.min) / Math.log(10),\n      maxLinearRange = Math.log(range.max) / Math.log(10);\n\n  var absoluteLinearRange = Math.abs(minLinearRange) + Math.abs(maxLinearRange);\n\n  return absoluteLinearRange / steps;\n}\n\nfunction cap(range, scale) {\n  return Math.max(range.min, Math.min(range.max, scale));\n}\n\nfunction getOverlayClipPath(outer, inner) {\n  var coordinates = [\n    toCoordinatesString(inner.left, inner.top),\n    toCoordinatesString(inner.left + inner.width, inner.top),\n    toCoordinatesString(inner.left + inner.width, inner.top + inner.height),\n    toCoordinatesString(inner.left, inner.top + inner.height),\n    toCoordinatesString(inner.left, outer.height),\n    toCoordinatesString(outer.width, outer.height),\n    toCoordinatesString(outer.width, 0),\n    toCoordinatesString(0, 0),\n    toCoordinatesString(0, outer.height),\n    toCoordinatesString(inner.left, outer.height)\n  ].join(', ');\n\n  return 'polygon(' + coordinates + ')';\n}\n\nfunction toCoordinatesString(x, y) {\n  return x + 'px ' + y + 'px';\n}\n\nfunction validViewbox(viewBox) {\n\n  return every(viewBox, function(value) {\n\n    // check deeper structures like inner or outer viewbox\n    if (isObject(value)) {\n      return validViewbox(value);\n    }\n\n    return isNumber(value) && isFinite(value);\n  });\n}\n\nfunction getPoint(event) {\n  if (event.center) {\n    return event.center;\n  }\n\n  return {\n    x: event.clientX,\n    y: event.clientY\n  };\n}\n\n// removes all elements with an id attribute\nfunction sanitize(gfx) {\n  queryAll('[id]', gfx).forEach(function(element) {\n    element.remove();\n  });\n\n  return gfx;\n}\n\nvar index = {\r\n  __init__: [ 'minimap' ],\r\n  minimap: [ 'type', Minimap ]\r\n};\n\nexport { index as default };\n","import { create, append, attr, clear } from 'tiny-svg';\nimport { query } from 'min-dom';\nimport { SPACING, quantize } from 'diagram-js/lib/features/grid-snapping/GridUtil.js';\nimport { getMid } from 'diagram-js/lib/layout/LayoutUtil.js';\n\n/**\r\n * @typedef {import('diagram-js/lib/core/Canvas.js').default} Canvas\r\n * @typedef {import('diagram-js/lib/core/EventBus.js').default} EventBus\r\n */\r\n\r\nvar GRID_COLOR = '#ccc',\r\n    LAYER_NAME = 'djs-grid';\r\n\r\nvar GRID_DIMENSIONS = {\r\n  width: 100000,\r\n  height: 100000\r\n};\r\n\r\n/**\r\n * @param {Canvas} canvas\r\n * @param {EventBus} eventBus\r\n */\r\nfunction Grid(canvas, eventBus) {\r\n  this._canvas = canvas;\r\n\r\n  var self = this;\r\n\r\n  eventBus.on('diagram.init', function() {\r\n    self._init();\r\n    self.toggle(true);\r\n  });\r\n\r\n  eventBus.on('gridSnapping.toggle', function(event) {\r\n    var active = event.active;\r\n\r\n    self.toggle(active);\r\n\r\n    self._centerGridAroundViewbox();\r\n  });\r\n\r\n  eventBus.on('canvas.viewbox.changed', function(context) {\r\n    var viewbox = context.viewbox;\r\n\r\n    self._centerGridAroundViewbox(viewbox);\r\n  });\r\n}\r\n\r\nGrid.prototype._init = function() {\r\n  var defs = query('defs', this._canvas._svg);\r\n\r\n  if (!defs) {\r\n    defs = create('defs');\r\n\r\n    append(this._canvas._svg, defs);\r\n  }\r\n\r\n  var pattern = this._pattern = create('pattern');\r\n\r\n  var patternId = 'djs-grid-pattern-' + randomNumber();\r\n\r\n  attr(pattern, {\r\n    id: patternId,\r\n    width: SPACING,\r\n    height: SPACING,\r\n    patternUnits: 'userSpaceOnUse'\r\n  });\r\n\r\n  var circle = this._circle = create('circle');\r\n\r\n  attr(circle, {\r\n    cx: 0.5,\r\n    cy: 0.5,\r\n    r: 0.5,\r\n    fill: GRID_COLOR\r\n  });\r\n\r\n  append(pattern, circle);\r\n\r\n  append(defs, pattern);\r\n\r\n  var grid = this._gfx = create('rect');\r\n\r\n  attr(grid, {\r\n    x: -5e4,\r\n    y: -5e4,\r\n    width: GRID_DIMENSIONS.width,\r\n    height: GRID_DIMENSIONS.height,\r\n    fill: `url(#${ patternId })`\r\n  });\r\n};\r\n\r\nGrid.prototype._centerGridAroundViewbox = function(viewbox) {\r\n  if (!viewbox) {\r\n    viewbox = this._canvas.viewbox();\r\n  }\r\n\r\n  var mid = getMid(viewbox);\r\n\r\n  attr(this._gfx, {\r\n    x: -5e4 + quantize(mid.x, SPACING),\r\n    y: -5e4 + quantize(mid.y, SPACING)\r\n  });\r\n};\r\n\r\n/**\r\n * Return the current grid visibility.\r\n *\r\n * @return {boolean}\r\n */\r\nGrid.prototype.isVisible = function() {\r\n  return this._visible;\r\n};\r\n\r\n/**\r\n * Toggle grid visibility.\r\n *\r\n * @param {boolean} [visible] new visible state\r\n */\r\nGrid.prototype.toggle = function(visible) {\r\n\r\n  if (typeof visible === 'undefined') {\r\n    visible = !this._visible;\r\n  }\r\n\r\n  if (visible === this._visible) {\r\n    return;\r\n  }\r\n\r\n  var parent = this._getParent();\r\n\r\n  if (visible) {\r\n    append(parent, this._gfx);\r\n  } else {\r\n    clear(parent);\r\n  }\r\n\r\n  this._visible = visible;\r\n};\r\n\r\nGrid.prototype._getParent = function() {\r\n  return this._canvas.getLayer(LAYER_NAME, -2);\r\n};\r\n\r\nGrid.$inject = [\r\n  'canvas',\r\n  'eventBus'\r\n];\r\n\r\n\r\n// helpers ///////////////\r\n\r\nfunction randomNumber() {\r\n  return Math.trunc(Math.random() * 1000000);\r\n}\n\nvar index = {\n  __init__: [ 'grid' ],\n  grid: [ 'type', Grid ]\n};\n\nexport { index as default };\n","import {\n  getBusinessObject,\n  is\n} from 'bpmn-js/lib/util/ModelUtil';\n\n/**\n * Fix bpmn:Process#isExecutable to always be set to either\n * true or false after edit.\n *\n * This is an initializer that may be passed to a modules\n * __init__ block.\n *\n * @param {EventBus} eventBus\n */\nexport default function fixIsExecutable(eventBus) {\n\n  function fixIfProcess(element) {\n\n    // exclude labels\n    if (element.labelTarget) {\n      return;\n    }\n\n    var bo = getBusinessObject(element);\n\n    if (is(bo, 'bpmn:Participant')) {\n      bo = bo.processRef;\n    }\n\n    if (is(bo, 'bpmn:Process')) {\n      bo.isExecutable = !!bo.isExecutable;\n    }\n  }\n\n  eventBus.on([ 'shape.added', 'root.added' ], function(event) {\n    fixIfProcess(event.element);\n  });\n\n  eventBus.on('elements.changed', function(event) {\n\n    var elements = event.elements;\n\n    elements.forEach(function(element) {\n      fixIfProcess(element);\n    });\n\n  });\n}\n\nfixIsExecutable.$inject = [ 'eventBus' ];\n","import ExecutableFix from './ExecutableFix';\n\n\nexport default {\n  __init__: [\n    ExecutableFix\n  ]\n};\n","import ExecutableFixModule from './src';\n\nexport default ExecutableFixModule;\n","import {\n  createReviver\n} from './PasteUtil.js';\n\n\nconst HIGHER_PRIORITY = 2050;\n\nconst PREFIX = 'bpmn-js-clip----';\n\n/**\n * An extension that adds browser native copy + paste\n * to an existing bpmn-js instance.\n *\n * Contents of the diagram will be pushed into the\n * system clipboard instead of the local clipboard and read from the\n * system clipboard during paste.\n *\n * Integrates with both API (triggered through user actions, following\n * standard browser security practices) and keyboard shortcuts.\n */\nexport default class NativeCopyPaste {\n\n  constructor(\n      eventBus, copyPaste, moddle\n  ) {\n\n    this._eventBus = eventBus;\n\n    this._handleCopied = (context) => {\n      if (context.hints?.clip !== false) {\n\n        // populate global clipboard\n        navigator.clipboard.writeText(PREFIX + JSON.stringify(context.tree)).catch(err => {\n          this._handleError('failed to populate clipboard', err);\n        });\n\n        // prevent further clipboard integration\n        context.hints.clip = false;\n      }\n    };\n\n    this._handlePaste = (context) => {\n      if (context.tree) {\n        return;\n      }\n\n      const contextCopy = { ...context };\n\n      // (1) restore from global clipboard,\n      // (3) then re-trigger paste (with context)\n      navigator.clipboard.readText().then(text => {\n\n        if (!text?.startsWith(PREFIX)) {\n          return;\n        }\n\n        const tree = JSON.parse(text.substring(PREFIX.length), createReviver(moddle));\n\n        copyPaste.paste({\n          ...contextCopy,\n          tree\n        });\n      }).catch(err => {\n        this._handleError('failed to paste from clipboard', err);\n      });\n\n      // (2) prevent the first paste attempt\n      return false;\n    };\n\n    this._handleError = (message, error) => {\n      console.error('[native-copy-paste]', message, error);\n\n      this._eventBus.fire('native-copy-paste:error', { message, error });\n    }\n\n    // enable depending on `navigator.clipboard` availability\n    this.toggle(typeof navigator.clipboard !== 'undefined');\n  }\n\n  /**\n   * Enable or disable native copy and paste.\n   *\n   * @param {boolean} active\n   */\n  toggle(active) {\n\n    if (this._active === active) {\n      return;\n    }\n\n    if (active) {\n      this._eventBus.on('copyPaste.elementsCopied', HIGHER_PRIORITY, this._handleCopied);\n      this._eventBus.on('copyPaste.pasteElements', HIGHER_PRIORITY, this._handlePaste);\n    } else {\n      this._eventBus.off('copyPaste.elementsCopied', this._handleCopied);\n      this._eventBus.off('copyPaste.pasteElements', this._handlePaste);\n    }\n\n    this._active = active;\n  }\n\n}\n\nNativeCopyPaste.$inject = [\n  'eventBus',\n  'copyPaste',\n  'moddle'\n];","import {\n  isObject,\n  isString\n} from 'min-dash';\n\n\n/**\n * A factory function that returns a reviver to be\n * used with JSON#parse to reinstantiate moddle instances.\n *\n * @param { import('moddle') } moddle\n *\n * @return {Function}\n */\nexport function createReviver(moddle) {\n\n  const elementCache = {};\n\n  /**\n   * The actual reviewer that creates model instances\n   * for elements with a $type attribute.\n   *\n   * Elements with ids will be re-used, if already\n   * created.\n   *\n   * @param  {String} key\n   * @param  {Object} object\n   *\n   * @return {Object} actual element\n   */\n  return function(key, object) {\n\n    if (isObject(object) && isString(object.$type)) {\n\n      const { id } = object;\n\n      if (id && elementCache[ id ]) {\n        return elementCache[ id ];\n      }\n\n      const type = object.$type;\n\n      const attrs = Object.assign({}, object);\n\n      delete attrs.$type;\n\n      const descriptor = moddle.getTypeDescriptor(type);\n\n      if (!descriptor) {\n        return;\n      }\n\n      const newElement = moddle.create(type, attrs);\n\n      if (id) {\n        elementCache[ id ] = newElement;\n      }\n\n      return newElement;\n    }\n\n    return object;\n  };\n}","import NativeCopyPaste from './NativeCopyPaste.js';\n\nexport default {\n  __init__: [ 'nativeCopyPaste' ],\n  nativeCopyPaste: [ 'type', NativeCopyPaste ]\n};","/**\n * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH\n * under one or more contributor license agreements. See the NOTICE file\n * distributed with this work for additional information regarding copyright\n * ownership.\n *\n * Camunda licenses this file to you under the MIT; you may not use this file\n * except in compliance with the MIT License.\n */\n\nimport inherits from 'inherits-browser';\n\nimport BpmnModeler from 'bpmn-js/lib/Modeler';\n\nimport minimapModule from 'diagram-js-minimap';\n\nimport gridModule from 'diagram-js-grid';\nimport diagramOriginModule from 'diagram-js-origin';\nimport alignToOriginModule from '@bpmn-io/align-to-origin';\n\nimport executableFixModule from 'bpmn-js-executable-fix';\nimport nativeCopyPasteModule from 'bpmn-js-native-copy-paste';\n\nimport {\n  BpmnPropertiesPanelModule as propertiesPanelModule,\n  BpmnPropertiesProviderModule as bpmnPropertiesProviderModule\n} from 'bpmn-js-properties-panel';\n\n/**\n * @typedef {import('bpmn-js/lib/BaseViewer').BaseViewerOptions} BaseViewerOptions\n *\n * @typedef {import('didi').ModuleDeclaration} ModuleDeclaration\n */\n\n/**\n *\n * @param {BaseViewerOptions} options\n */\nexport default function Modeler(options = {}) {\n  BpmnModeler.call(this, options);\n}\n\ninherits(Modeler, BpmnModeler);\n\n/**\n * @param { {\n *  disableAdjustOrigin?: boolean;\n *  disableGrid?: boolean;\n * } } [options]\n *\n * @returns {ModuleDeclaration[]}\n */\nModeler.prototype.getModules = function(options = {}) {\n  const modules = BpmnModeler.prototype.getModules.call(this, options);\n\n  return [\n    ...modules,\n    options.disableAdjustOrigin\n      ? diagramOriginModule\n      : alignToOriginModule,\n    options.disableGrid\n      ? {}\n      : gridModule\n  ];\n};\n\nModeler.prototype._extensionModules = [\n  minimapModule,\n  executableFixModule,\n  nativeCopyPasteModule,\n  propertiesPanelModule,\n  bpmnPropertiesProviderModule\n];\n\nModeler.prototype._modules = [].concat(\n  BpmnModeler.prototype._modules,\n  Modeler.prototype._extensionModules\n);"],"names":["__init__","A","VariableProvider","constructor","variableResolver","this","_variableResolver","register","getVariables","element","registerProvider","$inject","getElements","type","property","elements","extensionElements","get","extensionValues","filter","value","$instanceOf","is$2","getExtensionElements","getParameters","inputOutput","getInputOutput","eachElement","fn","depth","isArray","forEach","s","i","length","add","e","unique","canAdd","indexOf","push","selfAndFlowElements","maxDepth","result","processedFlowElements","flowElements","addVariableToList","variablesList","newVariable","a","b","foundIdx","findIndex","variable","name","scope","origin","concat","createProcessVariable","flowElement","defaultScope","globalScope","variableName","parents","scopedParent","current","$parent","getParents","find","parent","getInputParameters","input","hasInputParameter","getEventDefinitions","eventDefinitions","definition","is","extractors","options","containerElement","processVariables","outputParameters","getOutputParameters","parameter","resultVariable","getResultVariable","formFields","formData","getFormData","getFormFields","field","id","outMappings","getOutMappings","mapping","local","target","addVariable","errorEventDefinitions","getErrorEventDefinitions","errorCodeVariable","errorMessageVariable","escalationEventDefinitions","getEscalationEventDefinitions","escalationCodeVariable","getProcessVariables","additionalExtractors","allPromises","allowDuplicates","selfAndAllFlowElements","extractor","Promise","all","then","CachedValue","generatorFunction","_generate","valid","invalidate","getExtensionElementsList","businessObject","undefined","values","hasOutputMappings","BaseVariableResolver","eventBus","bpmnjs","providers","_eventBus","_bpmnjs","rawVariables","_generateRawVariables","bind","parsedVariables","async","context","variables","getRawVariables","fire","on","invalidateCache","_parseVariables","_baseExtractor","workerTasks","getDefinitions","map","elementVariables","_extractor","provider","key","mergedVariables","existingVariable","v","merge","mergeEntries","mapToEditorFormat","self","flatMap","newVariables","cloneVariable","bo","getVariablesForElement","root","processRef","getRootElement","allVariables","scopeVariables","reversedVariables","reverse","seenNames","Set","has","source","propertiesToAdd","o","includes","visited","extendList","info","isList","entries","existingEntry","separator","existingTypes","split","join","detail","inMappings","inputParameters","getInMappings","loopCharacteristics","inputElement","extensionElement","getInputElement","outputCollection","getOutputCollection","getCalledDecision","getScript","hasOutMappings","some","EntriesContext","super","entry","Object","of","getKeys","keys","atomicValue","set","__unwrap","isAtomic","__merge","other","contextEntries","contextRest","otherEntries","otherRest","parseVariables","variablesToResolve","expressionDetails","expression","getIoExpression","getScriptExpression","unresolved","findUnresolvedVariables","getResultContext","getExpressionDetails","sortedVariables","details","insertBefore","u","splice","insertAfter","findLastIndex","rootContext","toOptimizedFormat","resultContext","scopedResults","validScopes","filterForScope","computedResult","computedValue","toUnifiedFormat","oldVariable","resolveReferences","contextTracker","latestVariables","start","customContextTracker","reduce","args","contextualParser","configure","strict","parse","error","ioMapping","mappings","slice","substring","script","node","results","children","raw","annotate","getType","getInfo","string","charAt","toUpperCase","ConnectorVariableProvider","taskheaders","headers","header","resultExpression","expressionVariables","ZeebeVariableResolverModule","_resolveVariables","moddleElement","namesToFilter","allInputs","inputsToFilter","allOutputs","outputsToFilter","getElementNamesToRemove","mappedVariables","connectorVariableProvider","CamundaVariableResolverModule","Linting","canvas","config","elementRegistry","lintingAnnotations","selection","_canvas","_elementRegistry","_lintingAnnotations","_selection","_active","active","_reports","_update","report","showError","propertiesPanel","selectableElement","_getSelectableElement","scrollToElement","select","entryIds","setTimeout","Math","max","setErrors","reports","activate","deactivate","isActive","selectedElement","_getSelectedElement","errors","labelTarget","icons","warn","OverlayComponent","props","onClick","category","renderOverlay","el","render","LintingAnnotations","overlays","_overlays","_reportsByElement","_overlayIds","groupBy","reportsByElement","remove","html","position","bottom","left","top","getAnnotationPosition","overlayId","scale","min","linting","ColorContextPadProvider","contextPad","popupMenu","translate","_contextPad","_popupMenu","_translate","getStartPosition","padRect","getPad","getBoundingClientRect","x","y","prototype","getContextPadEntries","_createPopupAction","getMultiElementContextPadEntries","group","className","title","action","click","event","cursor","open","COLORS","label","fill","stroke","ColorPopupProvider","bpmnRendererConfig","modeling","_modeling","_colors","colors","_defaultFillColor","defaultFillColor","_defaultStrokeColor","defaultStrokeColor","createAction","color","setColor","getEntries","entryColorIconHtml","replace","toLowerCase","imageHtml","colorContextPadProvider","colorPopupProvider","nativeToString","toString","nativeHasOwnProperty","hasOwnProperty","isUndefined","obj","call","isObject","isNumber","isFunction","tag","collection","matcher","matchFn","toMatcher","match","val","iterator","convertKey","toNum","identity","arg","Number","assign","others","EVENT_GROUP","TASK_GROUP","DATA_GROUP","PARTICIPANT_GROUP","SUBPROCESS_GROUP","GATEWAY_GROUP","NONE_EVENTS","actionName","option","TYPED_START_EVENTS","eventDefinitionType","TYPED_NON_INTERRUPTING_START_EVENTS","isInterrupting","rank","TYPED_INTERMEDIATE_EVENT","eventDefinitionAttrs","TYPED_BOUNDARY_EVENT","cancelActivity","TYPED_END_EVENT","GATEWAY$1","search","instantiate","eventGatewayType","SUBPROCESS","isExpanded","triggeredByEvent","CREATE_OPTIONS","AppendMenuProvider","elementFactory","create","autoPlace","rules","mouse","_elementFactory","_create","_autoPlace","_rules","_mouse","AppendContextPadProvider","t","super_","enumerable","writable","configurable","getBusinessObject","CommandInterceptor","createHook","hook","events","priority","handlerFn","unwrap","that","RuleProvider","init","AppendRules","getPopupMenuEntries","allowed","_filterEntries","description","_createEntryAction","manualPlaceElement","newElement","KeyboardEvent","getLastMoveEvent","_canAutoPlaceElement","append","dragstart","getAppendMenuPosition","_getAppendMenuPosition","width","getContainer","querySelector","right","Error","fullEvent","command","unwrapEvent","canExecute","preExecute","preExecuted","execute","executed","postExecute","postExecuted","revert","reverted","addRule","actions","waypoints","hasEventDefinition","bugTestDiv","AppendMenuModule","appendMenuProvider","appendContextPadProvider","appendRules","CreateMenuProvider","CreatePaletteProvider","palette","_palette","targetAction","close","createParticipantShape","document","createElement","innerHTML","getElementsByTagName","getPaletteEntries","targetPosition","height","getPosition","CreateMenuModule","createMenuProvider","createPaletteProvider","CreateAppendEditorActions","injector","_injector","registerActions","editorActions","selected","isEmpty","triggerEntry","EditorActionsModule","__depends__","createAppendEditorActions","KEYS_COPY","KEYS_PASTE","KEYS_REDO","KEYS_UNDO","isCmd","altKey","ctrlKey","metaKey","isKey","code","isShift","shiftKey","KeyboardBindings","keyboard","registerBindings","CreateAppendKeyboardBindings","_keyboard","_editorActions","invoke","addListener","isRegistered","keyEvent","trigger","hasModifier","index$1","createAppendKeyboardBindings","ElementTemplatesAppendProvider","elementTemplates","_elementTemplates","canAutoPlaceElement","elementTemplate","appliesTo","elementType","eventDefinition","filteredTemplates","_filterTemplates","getLatest","getTemplateEntries","templates","templateEntries","template","icon","keywords","entryId","defaultGroup","documentationRef","imageUrl","contents","_getEntryAction","AppendElementTemplatesModule","elementTemplatesAppendProvider","ElementTemplatesCreateProvider","CreateElementTemplatesModule","elementTemplatesCreateProvider","ElementTemplatesReplaceProvider","entrySet","_getMatchingTemplates","applyTemplate","isTemplateApplied","ReplaceElementTemplatesModule","elementTemplatesReplaceProvider","TRANSACTION","EVENT_SUB_PROCESS","replaceOptions","freeze","__proto__","AD_HOC_SUBPROCESS_EXPANDED","BOUNDARY_EVENT","DATA_OBJECT_REFERENCE","DATA_STORE_REFERENCE","END_EVENT","EVENT_SUB_PROCESS_START_EVENT","GATEWAY","INTERMEDIATE_EVENT","PARTICIPANT","SEQUENCE_FLOW","START_EVENT","START_EVENT_SUB_PROCESS","SUBPROCESS_EXPANDED","TASK","TYPED_EVENT","ALL_OPTIONS","RemoveTemplateReplaceProvider","getOptionIndex","index","addPlainElementEntry","replaceOption","getPlainEntry","insertIndex","optionIndex","isSameType","isTypeEqual","$type","isEventDefinitionEqual","isTriggeredByEventEqual","isExpandedEqual","di","getDi","isDifferentType","findReplaceOptions","removeTemplate","previousIndex","nextIndex","RemoveTemplatesModule","removeTemplateReplaceProvider","getEventType","PointerEvent","DragEvent","ContextPadTracking","bpmnJSTracking","_bpmnJSTracking","trackTrigger","entryElement","closest","entryAction","getAttribute","track","data","entryGroup","entryTitle","triggerType","contextPadTracking","ElementTemplatesTracking","trackTemplateSelect","trackTemplateUpdate","trackTemplateUnlink","trackTemplateRemove","newTemplate","elementTemplatesTracking","PopupEditorTracking","trackOpen","trackClosed","feelPopupTracking","ModelingTracking","trackElementsCreate","trackElementAppend","trackElementReplace","shape","sourceElement","oldShape","newShape","oldElement","modelingTracking","PaletteTracking","paletteTracking","PopupMenuTracking","entryLabel","popupMenuTracking","BpmnJSTracking","_isEnabled","isEnabled","enable","disable","Array","sanitizeValue","sanitizeEvent","isElement","collapsed","attachers","incoming","outgoing","trackRefactoring","refactoring","SelectionTracking","trackEvent","oldSelection","newSelection","DeleteParticipantBehaviour","collaborationRoot","newRoot","oldProcessBusinessObject","updateProperties","isExecutable","removeExtensionElements","extensionElementsToRemove","commandStack","properties","getDefaultExportFromCjs","__esModule","hasRequiredHat","hat$1","exports","hatExports","hat","bits","base","digits","log","pow","Infinity","rem","floor","res","random","parsed","parseInt","rack","expandBy","iters","hats","requireHat","Ids","seed","_seed","next","nextPrefixed","prefix","assigned","claim","unclaim","clear","Base","Factory","model","$model","createType","descriptor","p","isMany","default","defineModel","defineDescriptor","ns","ModdleElement","attrs","define","hasType","BUILTINS","String","Boolean","Integer","Real","Element","TYPE_CONVERTERS","parseFloat","coerceType","converter","isBuiltIn","isSimple","parseName","defaultPrefix","localName","parts","DescriptorBuilder","nameNs","allTypes","allTypesByName","propertiesByName","Registry","packages","packageMap","typeMap","registerPackage","ensureAvailable","pkg","identifierKey","Properties","defineProperty","isReference","stripGlobal","Moddle","factory","registry","typeCache","build","pick","addProperty","idx","validate","addNamedProperty","replaceProperty","oldProperty","newProperty","oldNameNs","rename","isId","setIdProperty","isBody","setBodyProperty","redefineProperty","targetPropertyName","nsPrefix","attrName","redefinedProperty","redefines","propsByName","assertNotDefined","removeNamedProperty","bodyProperty","idProperty","assertNotTrait","typeDescriptor","extends","propertyName","definedProperty","definedBy","hasProperty","addTrait","inherited","typesByName","types","typeName","replaces","getPackage","uriOrPrefix","getPackages","pkgMap","registerType","uri","superClass","meta","propertyNs","extendsName","extendsNameNs","extended","traits","definePackage","mapTypes","nsName","trait","traverse","cls","parentNs","traverseTrait","getEffectiveDescriptor","builder","$pkg","isString","TypeError","getProperty","$attrs","getPropertyDescriptor","console","Type","cache","createAny","nsUri","isGeneric","getElementDescriptor","$descriptor","getTypeDescriptor","hasLowerCaseAlias","xml","tagAlias","DEFAULT_NS_MAP","SERIALIZE_PROPERTY","getSerialization","serialize","aliasToName","aliasNs","str","message","getModdleDescriptor","Context","elementsById","references","warnings","addReference","reference","addElement","test","addWarning","warning","BaseHandler","NoopHandler","BodyHandler","ReferenceHandler","ValueHandler","propertyDesc","BaseElementHandler","ElementHandler","RootElementHandler","GenericElementHandler","Reader","lax","handleEnd","handleText","handleNode","text","body","createReference","parser","handleChild","propNameNs","attributes","instance","prop","getPropertyForNode","isAttr","serializationType","getSerializationType","elementTypeName","normalizedTypeName","nsMap","xmlns","normalizedNameNs","typePrefix","prefixedToName","normalizeTypeName","effectiveType","isVirtual","isAttribute","valueHandler","referenceHandler","handler","childHandler","originalName","$children","$body","fromXML","done","rootHandler","proxy","stack","createStack","handleError","err","getContext","ctx","line","column","handleWarning","PREAMBLE_START_PATTERN","ENCODING_PATTERN","UTF_8_PATTERN","handleCData","peek","uriMap","url","decodeStr","selfClosing","decodedAttrs","d","handleOpen","question","exec","encoding","pop","decodeEntities","trim","resolve","reject","r","rootElement","ESCAPE_ATTR_CHARS","ESCAPE_CHARS","Namespaces","prefixMap","used","wellknown","custom","defaultPrefixMap","inherits","ctor","superCtor","mapDefaultPrefixes","defaultUriByPrefix","byUri","isWellknown","mapPrefix","uriByPrefix","getNSKey","logUsed","nsKey","getUsed","ESCAPE_ATTR_MAP","ESCAPE_MAP","charPattern","replaceMap","ReferenceSerializer","tagName","BodySerializer","ValueSerializer","ElementSerializer","propertyDescriptor","TypeSerializer","serialization","SavingWriter","write","FormatingWriter","out","format","indent","appendNewLine","appendIndent","unindent","Writer","preamble","toXML","tree","writer","internalWriter","formatingWriter","serializer","getNamespaces","getDefaultPrefixMappings","serializeTo","BpmnModdle","serializeValue","escape","otherAttrs","elementDescriptor","parseGenericNsAttributes","parseNsAttributes","nsPropertyTagName","nsTagName","addTagName","parseGenericContainments","getSerializableProperties","parseAttributes","parseContainments","filterContained","parseGenericAttributes","getElementNs","logNamespaceUsed","getPropertyNs","isLocalNs","nsAttributeName","effectiveNs","startsWith","parseNsAttribute","child","logNamespace","actualNs","genericAttrs","nonNsAttr","attr","addAttribute","parentNamespaces","namespaces","newPrefix","wellknownUri","serializeAttributes","getNsAttrs","firstBody","typeNs","xmlStr","reader","bpmn","associations","isAbstract","enumerations","literalValues","bpmndi","dc","isReadOnly","isUnique","subsettedProperty","bioc","SimpleBpmnModdle","additionalPackages","elementToString","ensureCompatDiRef","BpmnTreeWalker","handledElements","deferred","diMap","contextual","handled","visitIfDi","gfx","visit","logError","registerDi","bpmnElement","handlePlaneElement","planeElement","handleDefinitions","definitions","diagram","diagrams","plane","handleDiagram","rootElements","findDisplayCandidate","collaboration","visitRoot","handleProcess","participants","handleParticipant","messageFlows","handleMessageFlow","handleMessageFlows","handleArtifacts","artifacts","laneSets","handleUnhandledProcesses","handleDeferred","shift","process","handleFlowElementsContainer","handleIoSpecification","ioSpecification","messageFlow","handleDataAssociation","association","handleDataInput","dataInput","handleDataOutput","dataOutput","handleArtifact","artifact","dataInputs","dataOutputs","handleSubProcess","subProcess","handleFlowNode","flowNode","childCtx","dataInputAssociations","dataOutputAssociations","handleLane","lane","newContext","childLaneSet","handleLaneSet","flowNodeRef","lanes","wireFlowNodeRefs","laneSet","container","sequenceFlow","handleSequenceFlow","unshift","dataObject","handleDataElement","handleFlowElements","handleLaneSets","participant","newCtx","importBpmnDiagram","bpmnDiagram","importer","walker","parentShape","diagramsToImport","findRootProcess","allChildren","getDiagramsToImport","rootId","setRootElement","findRoot","lightbox","BPMNIO_IMG","LOGO_STYLES","verticalAlign","LINK_STYLES","LIGHTBOX_STYLES","BACKDROP_STYLES","NOTICE_STYLES","LIGHTBOX_MARKUP","BaseViewer","DEFAULT_OPTIONS","_moddle","_createModdle","_container","_createContainer","_init","linkMarkup","linkElement","zIndex","appendChild","removeChild","preventDefault","addProjectLogo","addWarningsToError","warningsAry","Diagram","importXML","aggregatedWarnings","parseResult","_emit","parseWarnings","createEvent","importResult","importDefinitions","checkValidationError","_setDefinitions","bpmnDiagramOrId","_definitions","diagramId","findBPMNDiagram","saveXML","saveSVG","svg","contentNode","getActiveLayer","defsNode","_svg","defs","bbox","getBBox","getModules","_modules","destroy","callback","off","attachTo","parentNode","detach","jquery","resized","moddle","baseModules","modules","additionalModules","diagramModules","diagramOptions","omit","ensureUnit","_moddleExtensions","moddleExtensions","BaseModeler","_collectIds","ids","black","isTypedEvent","getFillColor","defaultColor","overrideColor","getStrokeColor","getLabelColor","getCirclePath","cx","cy","radius","circlePath","getRoundRectPath","borderRadius","roundRectPath","getBounds","bounds","overrides","getWidth","getHeight","markerIds","DEFAULT_OPACITY","BpmnRenderer","styles","pathMap","textRenderer","BaseRenderer","defaultLabelColor","shapeStyle","computeStyle","strokeLinecap","strokeLinejoin","strokeWidth","lineStyle","addMarker","ref","parentGfx","marker","viewBox","refX","refY","markerWidth","markerHeight","orient","strokeDasharray","createMarker","drawCircle","offset","circle","round","drawRect","rect","rx","ry","drawLine","drawConnectionSegments","drawPath","path","drawMarker","renderer","handlers","as","renderEventIcon","proxyElement","semantic","isThrowing","nodeElement","getScaledPath","xScaleFactor","yScaleFactor","containerWidth","containerHeight","mx","my","eventIconRenderers","baseWidth","baseHeight","transform","taskMarkerRenderers","markerRect","parallel","seq","compensation","loop","strokeMiterlimit","adhoc","renderTaskMarker","renderTaskMarkers","taskMarkers","subprocess","isSequential","renderLabel","size","createText","renderEmbeddedLabel","align","box","padding","style","renderLaneLabel","isHorizontalLane","textBox","renderActivity","fillOpacity","renderAssociation","markerEnd","markerStart","pickAttrs","renderDataObject","dataObjectRef","isCollection","renderEvent","renderGateway","x_2","y_2","pointsString","point","polygon","points","drawDiamond","renderLane","renderSubProcess","activity","expanded","startEvents","startEvent","proxyAttrs","interrupting","renderEventSubProcessIcon","renderTask","renderIcon","task","businessPath","abspos","businessHeaderPath","gateway","arrowPathData","getRawPath","diamond","pathData","drawEvent","pointerEvents","outer","midPoint","getPointAtLength","getTotalLength","markerPathData","messageAttrs","fitBox","messageBounds","labelBounds","translateX","translateY","expandedParticipant","horizontalParticipant","connection","sourceSemantic","textElement","innerAttrs","TASK_BORDER_RADIUS","getExternalStyle","renderExternalLabel","_drawPath","_renderer","pickedAttrs","canRender","drawShape","drawConnection","getShapePath","halfWidth","halfHeight","diamondPath","getDiamondPath","rectPath","getRectPath","TextRenderer","defaultStyle","fontFamily","fontSize","fontWeight","lineHeight","externalStyle","textUtil","Text","getExternalLabelBounds","layoutedDimensions","getDimensions","ceil","getTextAnnotationBounds","getDefaultStyle","tokenRegex","objNotationRegex","bpmnRenderer","heightElements","widthElements","pathId","param","rawPath","coordinates","heightRatio","widthRatio","heightIndex","widthIndex","quote","quotedName","isFunc","replacer","elementData","getWaypoints","waypoint","notYetDrawn","refSemantic","BpmnImporter","_textRenderer","parentElement","hidden","parentIndex","createRoot","addRootElement","isFrame","isFrameElement","createShape","_attachBoundary","addShape","_getSource","_getTarget","createConnection","addConnection","addLabel","boundarySemantic","boundaryElement","hostSemantic","attachedToRef","host","createLabel","_getConnectedElement","side","_getElement","bpmnImporter","RootElementsBehavior","rootElementsBehavior","DrilldownBreadcrumbs","breadcrumbs","containerClasses","businessObjectParents","updateBreadcrumbs","getBusinessObjectParentChain","parentPlane","link","addEventListener","visible","toggle","DrilldownCentering","currentRoot","positionMap","Map","currentViewbox","viewbox","storedViewbox","zoom","dx","dy","scroll","_entries","found","k","SubprocessCompatibility","_handleImport","findRootDiagram","_processToDiagramMap","_createNewDiagrams","_movePlaneElementsToOrigin","collapsedElements","elementsToMove","diElement","shouldMoveToPlane","newDiagrams","_createDiagram","_moveToDiPlane","planeBounds","planeTrbl","trbl","getPlaneBounds","newPlane","parentPlaneElement","LOW_PRIORITY","DrilldownOverlayBehavior","_canDrillDown","_addOverlay","_removeOverlay","oldParent","newParent","_updateDrilldownOverlay","_updateOverlayVisibility","overlay","hasFlowElements","button","elementName","setAttribute","drilldownBreadcrumbs","drilldownCentering","drilldownOverlayBehavior","subprocessCompatibility","Viewer","NavigatedViewer","_navigationModules","center","middle","AlignElementsContextPadProvider","_isAllowed","_getEntries","_getMenuPosition","ALIGNMENT_OPTIONS","AlignElementsMenuProvider","alignElements","_alignElements","alignment","BpmnAlignElements","filteredElements","alignElementsContextPadProvider","alignElementsMenuProvider","bpmnAlignElements","getParent","anyType","isDirectionHorizontal","pool","getNewShapePosition","placeHorizontally","sourceTrbl","nextPosition","margin","minDistance","nextPositionDirection","getTextAnnotationPosition","getDataElementPosition","sourceMid","placement","directionHint","baseOrientation","boundaryOrientation","end","connectedDistance","direction","orientation","getDistance","getFlowNodePosition","AutoPlace","bpmnAutoPlace","AutoResize","hints","autoResize","_expand","flatten","closure","topLevel","expandings","parentId","matchPattern","BpmnAutoResize","AutoResizeProvider","canResize","BpmnAutoResizeProvider","_getOptimalBounds","getOffset","getPadding","elementsTrbl","targetTrbl","newTrbl","newBounds","oldBounds","boundsChanged","resizeDirections","directions","getResizeDirections","resize","resizeShape","resizeLane","bpmnAutoResize","bpmnAutoResizeProvider","LAYER_NAME","ComplexPreview","graphicsFactory","previewSupport","_graphicsFactory","_previewSupport","_markers","cleanUp","created","moved","removed","layer","getLayer","isHidden","addDragger","delta","dragger","removeMarker","show","showLayer","hide","hideLayer","complexPreview","ALIGNMENTS","AdaptiveLabelPositioningBehavior","checkLabelAdjustment","optimalPosition","labelMid","labelOrientation","getApproximateOrientation","takenAlignments","elementMid","c","getTakenConnectionAlignments","takenHostAlignments","freeAlignments","hostElement","hostOrientation","getTakenHostAlignments","getOptimalPosition","newLabelMid","elementTrbl","moveShape","adjustLabelPosition","createElementsBehavior","p0","p1","AppendBehavior","AssociationBehavior","moveConnection","AttachEventBehavior","bpmnReplace","_bpmnReplace","shouldReplace","_replaceShape","shapes","newHost","BoundaryEventBehavior","getBoundaryEvents","attacher","boundaryEvents","removeElements","oldSource","newSource","attachedboundaryEvents","CompensateBoundaryEventBehavior","bpmnRules","addIsForCompensationProperty","isForCompensation","removeIsForCompensationProperty","newData","isCompensationBoundaryEvent","targetConnection","_connectionTarget","isForCompensationAllowed","sequenceFlows","removeOutgoingSequenceFlows","connect","boundaryEvent","ignoredAssociations","removeConnection","removeExistingAssociations","newTarget","oldTarget","canConnect","removeDisallowedConnections","attachments","removeAttachments","compensationAssociations","removeIncomingCompensationAssociations","CreateBehavior","CreateDataObjectBehavior","bpmnFactory","replaceElement","layoutConnection","HIGH_PRIORITY","CreateParticipantBehavior","getOrCreateCollaboration","makeCollaboration","childrenBBox","participantBounds","HORIZONTAL_PARTICIPANT_PADDING","VERTICAL_PARTICIPANT_PADDING","getParticipantBounds","createConstraints","getParticipantCreateConstraints","rootElementGfx","getGraphics","ensureHoveringProcess","once","findParticipant","moveElements","TARGET_REF_PLACEHOLDER_NAME","DataInputAssociationBehavior","getTargetRef","targetRefProp","cleanupTargetRef","targetRef","removedConnection","inputAssociations","usesTargetRef","fixTargetRef","connectionBo","targetBo","newTargetBo","oldTargetBo","dataAssociation","ifDataInputAssociation","UpdateSemanticParentHandler","bpmnUpdater","_bpmnUpdater","DataStoreBehavior","getDataStores","updateDataStoreParent","dataStore","newDataStoreParent","dataStoreBo","newDataStoreParentBo","dataStoreDi","newSemanticParent","newDiParent","registerHandler","getAncestor","descendant","ancestor","descendantBo","ancestorBo","isDescendant","oldRoot","oldSemanticParent","oldDiParent","updateSemanticParent","updateDiParent","abs","LANE_PARENTS","LANE_INDENTATION","collectLanes","collectedShapes","getChildLanes","getLanesRoot","DeleteLaneBehavior","spaceTool","nested","topAdjustments","bottomAdjustments","leftAdjustments","rightAdjustments","siblings","topAffected","bottomAffected","leftAffected","rightAffected","calculateAdjustments","makeSpace","movingShapes","resizingShapes","compensateLaneDelete","DetachEventBehavior","item","intermediateEvent","DropOnFlowBehavior","insertShape","targetFlow","positionOrBounds","waypointsBefore","waypointsAfter","dockingPoint","incomingConnection","outgoingConnection","mid","oldOutgoing","oldIncoming","intersection","bendpoint","copy","reconnectEnd","reconnectStart","duplicateConnections","shapeMid","newShapeMid","canInsert","EventBasedGatewayBehavior","isSequenceFlow","flow","targets","sequenceFlowsFromNewShape","FixHoverBehavior","hover","hoverGfx","GroupBehavior","moddleCopy","removeCategoryValue","categoryValue","groups","categoryValueRef","isReferencedCategory","unlinkCategory","isReferencedCategoryValue","unlinkCategoryValue","addCategoryValue","linkCategoryValue","setCategoryValue","createCategoryValue","createCategory","unsetCategoryValue","clone","copyElement","groupBo","lineIntersect","l1s","l1e","l2s","l2e","denominator","ImportDockingFix","adjustDocking","startPoint","nextPoint","centerIntersect","elementTop","elementLeft","verticalIntersect","horizontalIntersect","original","p2","sqrt","IsHorizontalFix","elementTypesToUpdate","isHorizontal","sq","n","getCircleSegmentIntersections","s1","s2","cc","cr","baX","baY","caX","caY","pBy2","disc","tmpSqrt","abScalingFactor1","abScalingFactor2","i1","segmentStart","segmentEnd","fenced","isPointInSegment","rangeStart","rangeEnd","EQUAL_THRESHOLD","pointsEqual","getAnchorPointAdjustment","newWaypoints","oldWaypoints","oldPosition","attachment","segmentStartDistance","segmentEndDistance","attachmentPosition","intersections","attachmentDistance","closestAttachmentDistance","closestAttachment","segmentIndex","bendpointIndex","relativeLocation","getAttachment","oldLabelLineIndex","newLabelLineIndex","segmentMove","oldSegmentStartIndex","segmentStartIndex","newSegmentStartIndex","bendpointMove","newIndex","insert","relativePositionMidWaypoint","connectionStart","connectionEnd","findNewLineStartIndex","l1","l2","a1","foot","lengthToFoot","oldLabelLine","getLine","newLabelLine","oldFoot","relativeFootPosition","angleDelta","oldBendpointIndex","oldBendpoint","newBendpoint","newFoot","newLabelVector","distanceSegment1","NAME_PROPERTY","TEXT_PROPERTY","LabelBehavior","onPropertyUpdate","updateLabel","unsetLabel","removeShape","labelBehavior","labelAdjustment","startChanged","endChanged","getLabelAdjustment","getVisibleLabelAdjustment","referencePoint","newReferencePoint","getReferencePointDelta","lines","nearestLine","distances","l","distance","sortBy","getNearestLine","getReferencePoint","LayoutConnectionBehavior","getnewAnchorPoint","endPoint","newEndpoint","updateWaypoints","startpoint","newStartpoint","MessageFlowBehavior","isParticipantCollapse","anchor","NON_INTERRUPTING_EVENT_TYPES","canBeNonInterrupting","getInterruptingProperty","NonInterruptingBehavior","targetElement","isOldInterrupting","RemoveEmbeddedLabelBoundsBehavior","updateModdleProperties","RemoveElementBehavior","inWaypoints","outWaypoints","inConnection","outConnection","getDocking","RemoveParticipantBehavior","makeProcess","ReplaceConnectionBehavior","dragging","fixConnection","replacementType","canConnectSequenceFlow","canConnectMessageFlow","allConnections","replacement","associationDirection","oldConnection","newConnection","previousSelection","payload","cleanDraggingSelection","conditionExpression","sourceRef","ReplaceElementBehaviour","elementReplacements","replacements","canReplace","_replaceElements","topLevelElements","unclaimId","newElements","newElementType","oldElementId","GROUP_MIN_DIMENSIONS","LANE_MIN_DIMENSIONS","VERTICAL_LANE_MIN_DIMENSIONS","PARTICIPANT_MIN_DIMENSIONS","VERTICAL_PARTICIPANT_MIN_DIMENSIONS","SUB_PROCESS_MIN_DIMENSIONS","TEXT_ANNOTATION_MIN_DIMENSIONS","ResizeBehavior","balanced","resizeConstraints","laneShape","resizeDirection","lanesRoot","isFirst","isLast","allLanes","laneTrbl","maxTrbl","minTrbl","minDimensions","otherTrbl","addMax","addMin","LANE_PADDING","VERTICAL_LANE_PADDING","flowElementTrbl","getParticipantResizeConstraints","addToTrbl","choice","ResizeLaneBehavior","SLIGHTLY_HIGHER_PRIORITY","RootElementReferenceBehavior","canHaveRootElementReference","hasAnyEventDefinition","hasRootElement","getRootElementReferencePropertyName","addedRootElement","referencedRootElement","SpaceToolBehavior","axis","isHorizontalResize","isHorizontalAxis","getParticipantMinWidth","getParticipantMinHeight","getParticipantMinDimensions","lanesMinHeight","resizeStart","resizedLane","findResizedLane","getLanesMinHeight","lanesMinWidth","getLanesMinWidth","childLanes","SubProcessPlaneBehavior","_bpmnFactory","isCollapsedSubProcess","newRootElement","_addDiagram","removeRoot","_removeDiagram","removeRootElement","_showRecursively","_moveChildrenToShape","attachedRoot","oldId","oldProperties","newId","updateId","primaryShape","apply","referencedShape","SubProcessStartEventBehavior","TextAnnotationBehavior","ToggleCollapseConnectionBehaviour","incomingConnections","outgoingConnections","handleConnection","ToggleElementCollapseBehaviour","defaultSize","getDefaultSize","collapsedBounds","visibleElements","visibleBBox","expandedBounds","UnclaimIdBehavior","shapeBo","rootElementBo","DeleteSequenceFlowBehavior","sourceBo","isDefaultFlow","UpdateFlowNodeRefsBehavior","laneRefUpdateEvents","UpdateContext","enter","leave","updateLaneRefs","flowNodes","releaseContext","updateContext","addLane","addFlowNode","counter","SetCompensationActivityAfterPasteBehavior","isConnectedToCompensationBoundaryEvent","visibleChildren","labels","childrenBounds","targetMid","childrenMid","_createNewDiagram","diPlane","diDiagram","removedDiagram","adaptiveLabelPositioningBehavior","appendBehavior","associationBehavior","attachEventBehavior","boundaryEventBehavior","compensateBoundaryEventBehaviour","createBehavior","createDataObjectBehavior","createParticipantBehavior","dataInputAssociationBehavior","dataStoreBehavior","deleteLaneBehavior","detachEventBehavior","dropOnFlowBehavior","eventBasedGatewayBehavior","fixHoverBehavior","groupBehavior","importDockingFix","isHorizontalFix","layoutConnectionBehavior","messageFlowBehavior","nonInterruptingBehavior","removeElementBehavior","removeEmbeddedLabelBoundsBehavior","removeParticipantBehavior","replaceConnectionBehavior","replaceElementBehaviour","resizeBehavior","resizeLaneBehavior","rootElementReferenceBehavior","spaceToolBehavior","subProcessPlaneBehavior","subProcessStartEventBehavior","textAnnotationBehavior","toggleCollapseConnectionBehaviour","toggleElementCollapseBehaviour","unclaimIdBehavior","unsetDefaultFlowBehavior","updateFlowNodeRefsBehavior","setCompensationActivityAfterPasteBehavior","getBoundaryAttachment","targetBounds","BpmnRules","nonExistingOrLabel","getOrganizationalParent","isTextAnnotation","isGroup","isCompensationBoundary","getScopeParent","isSameScope","hasEventDefinitionOrNone","every","isParent","possibleParent","allParents","canConnectDataAssociation","canConnectCompensationAssociation","canConnectAssociation","canDrop","hasNoEventDefinition","hasCommonBoundaryIntermediateEventDefinition","isBoundaryEvent","isLane","hasOneOfEventDefinitions","canAttach","isBoundaryCandidate","isReceiveTaskAfterEventBasedGateway","canMove","canCreate","sourceTextAnnotation","targetTextAnnotation","isOneTextAnnotation","isMessageFlowTarget","isSequenceFlowTarget","isEventBasedTarget","canCopy","targetParent","targetAttach","keyboardMove","BpmnDiOrdering","getRootElements","diElements","rootDi","bpmnDiOrdering","OrderingProvider","ordering","getOrdering","newParentIndex","BpmnOrderingProvider","orders","order","level","containers","getOrder","computeOrder","elementOrder","actualParent","findActualParent","currentIndex","bpmnOrderingProvider","CopyPaste","clipboard","isAttacher","copyWaypoint","copyWaypoints","clip","removeElement","createTree","paste","pasteEvent","_createElements","_paste","duplicate","pasteContext","cut","copiedElementIds","_getElementIdsFromTree","elementsToCut","elementIds","branch","createElements","hasRelations","elementsData","addElementData","foundElementData","removeElementData","_index","copyPaste","copyProperties","BpmnCopyPaste","businessObjectCopy","diCopy","referencesKey","participantBo","setReferences","array","getReferences","DISALLOWED_PROPERTIES","ALLOWED_REFERENCES","ModdleCopy","propertyNames","parentDescriptor","getPropertyNames","keepDefaultProperties","canCopyProperties","sourceProperty","copiedProperty","copyProperty","isDefined","_copyId","childProperties","childProperty","bpmnCopyPaste","CUSTOM_PROPERTIES","BpmnReplace","oldBusinessObject","isSubProcess","oldCollapsed","shouldToggleCollapsed","toggleCollapse","newBusinessObject","isMarkerVisible","elementProps","newElementProps","copyProps","moveChildren","isHorizontalPool","AXIS_TO_DIMENSION","CURSOR_CROSSHAIR","DIRECTION_TO_TRBL","w","DIRECTION_TO_OPPOSITE","SpaceTool","toolManager","_dragging","_toolManager","registerTool","tool","activateMakeSpace","originalEvent","initialized","ensureConstraints","activateSelection","addPadding","spaceToolConstraints","autoActivate","reactivate","trapClick","createSpace","resizingShape","minOrMax","nonMovingResizingChildrenBBox","movingChildrenBBox","movingAttachersBBox","movingAttachersConstraint","nonMovingAttachersConstraint","resizingShapeBBox","nonMovingResizingChildren","movingChildren","movingAttachers","nonMovingAttachers","resizingShapeMinDimensions","getSpaceToolConstraints","connections","shapeStart","shapeEnd","allShapes","cancel","mouseEvent","MARKER_DRAGGING","MARKER_RESIZING","SpaceToolPreview","addPreviewGfx","dragGroup","space","crosshairGroup","pathX","pathY","spaceLayer","movingConnections","sourceIsMoving","targetIsMoving","sourceIsResizing","targetIsResizing","frameGroup","frames","frame","addFrame","initialBounds","spaceToolPreview","BpmnSpaceTool","canvasRoot","spaceRoot","enclosedArtifacts","adjustments","isCollapsedPool","LabelSupport","movePreview","validatedShapes","removeLabels","makeDraggable","enclosedElements","enclosedLabels","addAll","labelTargetIndex","labelSupport","MARKER_ATTACH","AttachSupport","getAttachers","unionBy","removeAttached","updateAttachment","attachSupport","BpmnFactory","_model","BpmnUpdater","connectionDocking","updateRoot","updateParent","updateBounds","updateConnection","updateConnectionWaypoints","updateBPMNLabel","diLabel","cropped","getCroppedWaypoints","ifBpmn","oldSourceBo","newSourceBo","oldConditionExpression","oldDefault","_needsId","_ensureId","createDiLabel","createDiBounds","createDiShape","createDiWaypoints","pos","createDiWaypoint","createDiEdge","createDiPlane","parentBusinessObject","parentDi","updateFlowNodeRefs","embeddedLabelBounds","getEmbeddedLabelBounds","embeddedLabelBoundsDelta","_getLabel","newContainment","oldContainment","oldRefs","newRefs","updateDiConnection","connectionDi","newSourceDi","newTargetDi","planeElements","getLaneSet","visualParent","containment","diChildren","inverseSet","applyAttribute","attributeName","_baseCreate","newEventDefinition","diAttrs","applyAttributes","condition","UpdateModdlePropertiesHandler","setModdleProperties","changed","_getVisualReferences","getModdleProperties","getAllDataObjectReferences","DEFAULT_FLOW","ID","NULL_DIMENSIONS","UpdatePropertiesHandler","isIdChange","setProperties","setDiProperties","unwrappedProps","referencePropertyNames","unwrapBusinessObjects","getDiProperties","getProperties","newLabelBounds","UpdateCanvasRootHandler","AddLaneHandler","_spaceTool","SplitLaneHandler","ResizeLaneHandler","newRootBusinessObject","oldRootBusinessObject","bpmnDefinitions","location","isRoot","laneParent","existingChildLanes","siblingPosition","lanePosition","spacePos","allAffected","newLanePosition","newLane","newLanesCount","count","existingLanesCount","laneSize","laneBounds","newLaneAttrs","laneBaseSize","newLanesSize","resizeBalanced","resizeSpace","resizeNeeded","shapeTrbl","shapeNewTrbl","trblResize","getTRBLResize","topResize","rightResize","bottomResize","leftResize","computeLanesResize","change","trblDiff","FLOW_NODE_REFS_ATTR","LANES_ATTR","UpdateFlowNodeRefsHandler","IdClaimHandler","_computeUpdates","flowNodeShapes","laneShapes","handledNodes","updates","participantCache","allFlowNodeShapes","addFlowNodeShape","flowNodeShape","allLaneShapes","getAllLaneShapes","getNewLanes","update","oldLane","claiming","DEFAULT_COLORS","SetColorHandler","_commandStack","_normalizeColor","hexColor","fillStyle","colorToHex","assignedDi","elementDi","ensureLegacySupport","UpdateLabelHandler","setText","newLabel","isEmptyText","labelCenter","oldLabel","_bpmnRules","getHandlers","targetLaneShape","splitLane","targetLane","collaborationElement","processElement","claimId","ORIENTATION_THRESHOLD","getSegmentBendpoints","segmentDirections","targetOrientation","startDirection","xmid","ymid","layoutStraight","h","layoutHorizontal","layoutTurn","turnNextDirections","needsTurn","getBendpoints","invertDirections","isValidDirections","isExplicitDirections","startSegment","getStartSegment","endSegment","invertedSegment","getEndSegment","midSegment","endDirection","getMidSegment","getSimpleBendpoints","repairConnection","repairedWaypoints","preferredLayouts","primaryAxis","preserveDocking","isInRange","tryLayoutStraight","newDocking","_tryRepairConnectionSide","tryRepairConnectionEnd","preferredLayout","without","threshold","defaultLayout","getDirections","directionSplit","startDocking","getDockingPoint","invertOrientation","withoutRedundantPoints","connectPoints","connectRectangles","inRange","q","needsRelayout","slicedPoints","oldDocking","newPoints","candidate","oldPeer","newPeer","repairBendpoint","removeOverlapping","rectangle","dockingDirection","previous","PREFERRED_LAYOUTS_HORIZONTAL","fromGateway","toGateway","fromTop","fromRight","fromLeft","fromBottom","boundaryLoop","alternateHorizontalSide","alternateVerticalSide","PREFERRED_LAYOUTS_VERTICAL","oppositeOrientationMapping","orientationDirectionMapping","BpmnLayouter","getMessageFlowPreserveDocking","isExpandedSubProcess","getSubProcessPreserveDocking","getConnectionDocking","isCompensationAssociation","getHorizontalOrientation","matches","getVerticalOrientation","isOppositeOrientation","isHorizontalOrientation","getLoopPreferredLayout","layout","getBoundaryEventPreferredLayouts","sourceLayout","targetLayout","attachedElement","attachOrientation","isLoop","attachedToSide","shouldConnectToSameSide","getBoundaryEventLoopLayout","verticalAttachOrientation","horizontalAttachOrientation","verticalTargetOrientation","horizontalTargetOrientation","getBoundaryEventSourceLayout","horizontalOrientation","oppositeHorizontalOrientation","verticalOrientation","oppositeVerticalOrientation","isOppositeVerticalOrientation","getBoundaryEventTargetLayout","areCloseOnAxis","BaseLayouter","manhattanOptions","updatedWaypoints","getMessageFlowManhattanOptions","layouter","CroppingConnectionDocking","AppendPreview","_complexPreview","_connectionDocking","_layouter","connectionCreateAllowed","isNil","appendPreview","ReplaceMenuProvider","_moddleCopy","_register","sameTypeEventOptions","filteredReplaceOptions","differentType","_createEntries","isInterruptingEqual","isCancelActivityEqual","_createSequenceFlowEntries","getPopupMenuHeaderEntries","headerEntries","_getLoopCharacteristicsHeaderEntries","_getCollectionHeaderEntries","_getParticipantMultiplicityHeaderEntries","_getNonInterruptingHeaderEntries","_createEntry","toggleLoopCharacteristics","isParallel","participantMultiplicity","interruptingProperty","Icons","isNonInterrupting","replaceMenuProvider","ContextPadProvider","_connect","_appendPreview","isOpen","isEventType","isType","isDefinition","def","_isDeleteAllowed","baseAllowed","deleteAction","startConnect","appendAction","appendStart","_","previewAppend","splitLaneHandler","getReplaceMenuPosition","contextPadProvider","BpmnDistributeElements","cannotDistribute","DistributeElementsMenuProvider","distributeElements","_distributeElements","bpmnDistributeElements","distributeElementsMenuProvider","BpmnEditorActions","EditorActions","_registerDefaultActions","lassoTool","handTool","globalConnect","directEditing","searchPad","_registerAction","opts","currentSelection","aligneableElements","boundingBox","BpmnGridSnapping","gridSnappingContext","snapLocation","GridSnappingAutoPlaceBehavior","gridSnapping","snapValue","GridSnappingParticipantBehavior","GridSnappingLayoutConnectionBehavior","_gridSnapping","hasMiddleSegments","snapMiddleSegments","snapSegment","aligned","snapped","horizontallyAligned","verticallyAligned","gridSnappingAutoPlaceBehavior","gridSnappingParticipantBehavior","gridSnappingLayoutConnectionBehavior","bpmnGridSnapping","BpmnInteractionEvents","interactionEvents","_interactionEvents","_createParticipantHit","_createDefaultHit","_createSubProcessHit","removeHits","createDefaultHit","createBoxHit","bpmnInteractionEvents","BpmnKeyboardBindings","keyboardBindings","LabelEditingProvider","resizeHandles","activateDirectEdit","force","complete","removeResizers","isTouch","getEditingBBox","backgroundColor","border","centerVertically","resizable","getAbsoluteBBox","externalFontSize","externalLineHeight","defaultFontSize","defaultLineHeight","isExpandedPool","paddingTop","paddingBottom","paddingLeft","paddingRight","poolBounds","externalLabelMid","absoluteBBox","minWidth","minHeight","textAlign","activeContextText","MARKER_HIDDEN","MARKER_LABEL_HIDDEN","LabelEditingPreview","absoluteElementBBox","defaultLayer","getDefaultLayer","activeProvider","textPathData","newElementHeight","labelEditingProvider","labelEditingPreview","ALLOWED_ELEMENTS","LINE_STYLE","class","LabelLink","outline","createLink","linePath","labelPath","getElementOutlinePath","getElementPath","labelInter","targetPath","targetInter","outlineShape","getOutline","outlineOffset","parseSvgNumAttr","PATH_OFFSET","allowedElements","isElementSelected","labelLink","setVisible","display","tooltipClass","tooltipSelector","Tooltips","_ids","_tooltipDefaults","minZoom","maxZoom","_tooltips","_tooltipRoot","firstChild","stopPropagation","tooltip","_addTooltip","timeout","delegateTarget","clearTimeout","removeTimer","htmlContainer","_updateRoot","matrix","tooltipRoot","_updateTooltip","_updateTooltipVisibilty","tooltips","ModelingFeedback","modelingFeedback","MARKER_OK","MARKER_NOT_OK","GlobalConnect","startTarget","canStartConnect","startPosition","PaletteProvider","_lassoTool","_handTool","_globalConnect","createListener","createSubprocess","autoSelect","createParticipant","activateHand","paletteProvider","BpmnReplacePreview","visualReplacements","tempShape","replaceVisual","originalGfx","restoreVisual","bpmnReplacePreview","AXES","BpmnConnectSnapping","initialConnectionStart","dimensionForAxis","getDimensionForAxis","snapToShape","getTargetBoundsPadding","snapToPosition","isMid","snapToTargetMid","isReverse","axes","newCoordinate","coordinate","snapBoundaryEventLoop","BpmnCreateMoveSnapping","CreateMoveSnapping","setSnappedIfConstrained","attach","targetTRBL","snapBoundaryEvent","getDockingSnapOrigin","docking","isMove","initSnap","snapContext","setSnapOrigin","setSnapLocations","addSnapTargetPoints","snapPoints","snapTargets","getSnapTargets","snapTarget","connectSnapping","createMoveSnapping","BpmnSearchProvider","_search","toSearchPadResult","tokens","primaryTokens","secondaryTokens","pattern","bpmnSearch","DATA_OBJECT_REFERENCE_STANDARD_SIZE","DATA_STORE_REFERENCE_STANDARD_SIZE","createPath","OUTLINE_STYLE","OutlineProvider","_styles","isStandardSize","standardSize","DEFAULT_OFFSET","updateOutline","outlineProvider","Modeler","createDiagram","_interactionModules","_modelingModules","IDS","IdGenerator","RANGE","Minimap","centerViewbox","_state","_svgClientRect","isZeroDimensional","setViewboxCenteredAroundPoint","mapMousePositionToDiagramPoint","_lastViewbox","mousedown","event$1","getPoint","diagramPoint","offsetViewport","viewboxCenter","getOffsetViewport","initialViewportDomRect","_viewportDom","offsetViewportDom","cachedViewbox","initialDragPosition","isDragging","viewportClientRect","_viewport","parentClientRect","_parent","onMousemove","onMouseup","clipPath","getOverlayClipPath","_overlay","unbind","svgClientRect","zoomDelta","_minimapId","range","minLinearRange","maxLinearRange","factor","deltaMode","deltaY","deltaX","sign","currentLinearZoomLevel","stepSize","NUM_STEPS","newLinearZoomLevel","newLogZoomLevel","cap","clientX","clientY","_toggle","_addElement","_removeElement","_updateElement","_updateElementId","contains","_clear","lastViewbox","boundingClientRect","bBox","targetAspectRatio","aspectRatio","fitAspectRatio","cachedViewboxWidth","cachedViewboxHeight","inMin","inMax","outMin","outMax","insertChildAtIndex","childGfx","childContainer","getChildContainer","childAtIndex","childNodes","nextSibling","clientRect","_map","elementsGroup","_elementsGroup","viewportGroup","_viewportGroup","viewport","viewportDom","innerViewbox","inner","outerViewbox","validViewbox","widthDifference","heightDifference","MINIMAP_VIEWBOX_PADDING","_parentClientRect","withoutParentOffset","currentOpen","elementGfx","_prefixId","isOnActivePlane","findPlane","getActivePlane","newElementGfx","_createElement","newElementParentGfx","childrenGroup","childrenArray","indexOfChild","childGroup","getIndexOfChildInParentChildren","isConnection","getElementById","visual","sanitize","toCoordinatesString","isFinite","minimap","Grid","_centerGridAroundViewbox","_pattern","patternId","trunc","patternUnits","_circle","grid","_gfx","isVisible","_visible","_getParent","fixIsExecutable","fixIfProcess","PREFIX","NativeCopyPaste","_handleCopied","navigator","writeText","JSON","stringify","catch","_handleError","_handlePaste","contextCopy","readText","elementCache","object","createReviver","nativeCopyPaste","disableAdjustOrigin","disableGrid","_extensionModules"],"sourceRoot":""}