"use strict";(self.webpackChunkcamunda_modeler_client=self.webpackChunkcamunda_modeler_client||[]).push([[7001],{67001:(e,t,i)=>{i.r(t),i.d(t,{default:()=>W});var r=i(63696),o=i(29905),n=i(4452),s=i.n(n),a=i(45782),d=i(46165),c=i(17779),l=i(99492),h=i(3999),g=i(28340),v=i(68523),p=i(52023),u=i(93366),m=i(76566),w=i(23395),f=i(63417),y=i(3038),C=i(73619),A=i(83587),M=i(15210),x=i(27616);const P=["value",null],k={poweredBy:P};class E extends v.f8{constructor(e={}){const{moddleExtensions:t={},drd:i,decisionTable:r,literalExpression:o,exporter:n,overview:s,settings:a,...d}=e;let c=[];a.get("app.newContextPad")&&(c=[...c,x.q_]),super({...d,boxedExpression:S(d.boxedExpression,[k,A.A,{viewDrd:P}]),drd:S({...i,disableAdjustOrigin:f.Ay.get(f.Uo)},[w.A,A.A,...c]),decisionTable:S(r,[k,A.A,{viewDrd:P}]),literalExpression:S(o,[k,A.A,{viewDrd:P}]),moddleExtensions:{...t,modeler:M},canvas:{autoFocus:!0}}),this.on("viewer.created",(({viewer:e})=>{e.on("commandStack.changed",(e=>{this._emit("view.contentChanged",e)})),e.on("selection.changed",(e=>{this._emit("view.selectionChanged",e)})),e.on(["directEditing.activate","directEditing.deactivate"],(e=>{this._emit("view.directEditingChanged",e)})),e.on("error",(({error:t})=>{this._emit("error",{viewer:e,error:t})})),e.on("propertiesPanel.focusin",(e=>{this._emit("propertiesPanel.focusin",e)})),e.on("propertiesPanel.focusout",(e=>{this._emit("propertiesPanel.focusout",e)}))})),(0,u.A)(n,this),this._addOverview(s)}showOverview(e){return this._overview.importXML(e).then((()=>{}),(e=>e)).then((e=>this._handleOverviewImport(e)))}getStackIdx(){const e=this.getActiveViewer();if(!e)return null;const t=e.get("commandStack",!1);return t?t._stackIdx:null}_addOverview(e={}){const{layout:t}=e,i=this._overview=new p.A({drd:{additionalModules:[y.A,C.A],openDrgElement:{layout:t}}});let r,o;this.on("import.parse.start",(({xml:e})=>{this.showOverview(e)})),this.on("views.changed",500,(({activeView:e})=>{r=e.type})),this.on("views.changed",(({activeView:e})=>{if(r===e.type)return;o&&o();const t=()=>{o(),this.once("saveXML.done",n),this._updateOverview()},i=this._viewers[e.type].get("eventBus",!1),n=()=>{i.on("commandStack.changed",t)};o=()=>{i.off("commandStack.changed",t)},n()})),this.on("views.changed",(({activeView:e})=>{if("drd"!==e.type){const t=i.getActiveViewer();t&&t.get("eventBus").fire("drgElementOpened",{id:e.element.id})}})),this.on("overviewOpen",(()=>{const e=this._overview.getActiveViewer();e&&e.get("eventBus").fire("overviewOpen")})),i.once("import.done",(()=>{const e=i.getActiveViewer();e&&e.on("openDrgElement",(({id:e})=>{const t=this.getViews().find((({element:t})=>t.id===e));t&&"drd"!==t.type&&this.open(t)}))}))}_updateOverview=()=>{if(this._overview)return this.once("saveXML.start",2500,(()=>!1)),this.saveXML().then((({xml:e})=>this.showOverview(e))).catch((e=>{console.error(e)}))};_handleOverviewImport=e=>{this._overview&&this._overview.getActiveViewer()&&(e?console.error(e):this._overview.getActiveViewer().get("canvas").zoom(.66))};attachOverviewTo=e=>{this.detachOverview();const t=this._overview.getActiveViewer();t&&(this._emit("attachOverview"),this._overview.attachTo(e),t.get("canvas").resized())};detachOverview=()=>{this._overview.getActiveViewer()&&(this._emit("detachOverview"),this._overview.detach())}}function S(e={},t){const i=e.additionalModules||[];return{...e,additionalModules:[m.A,...i,...t]}}var b=i(2249),V=i(13644),O=i(20932),_=i(32959),D=i(63062),I=i(32901),L=i(82472),R=i(72692),z=i(32133),X=i(45369),N=i(82665);const T=["png","jpeg","svg"],U="editor.askDmnMigration",j={executionPlatform:N.ug.PLATFORM,executionPlatformVersion:void 0};class G extends l.OB{constructor(e){super(e),this.state={},this.ref=r.createRef(),this.overviewRef=r.createRef(),this.propertiesPanelRef=r.createRef(),this.handleResize=(0,d.sg)(this.handleResize),this.engineProfile=new X.A({get:()=>{const e=this.getModeler().getActiveViewer().get("executionPlatform").getExecutionPlatform();return e?{executionPlatform:e.name,executionPlatformVersion:(0,z.Ud)(e.version)}:j},set:e=>{this.getModeler().getActiveViewer().get("executionPlatform").setExecutionPlatform({name:e.executionPlatform,version:e.executionPlatformVersion})},getCached:()=>this.getCached(),setCached:e=>this.setCached(e)})}componentDidMount(){this._isMounted=!0;const e=this.getModeler();this.listen("on"),e.attachTo(this.ref.current);const t=e.getActiveViewer();let i;t&&(i=t.get("propertiesPanel",!1),i&&i.attachTo(this.propertiesPanelRef.current),this.overviewRef.current&&(e.attachOverviewTo(this.overviewRef.current),F(this.props)&&e._emit("overviewOpen"))),t&&t.get("grid",!1)?.toggle(!1!==this.props.layout?.grid?.visible),this.checkImport()}componentWillUnmount(){this._isMounted=!1;const e=this.getModeler();this.listen("off"),e.detach()}componentDidUpdate(e){if(this.checkImport(e),function(e,t){return!1===F(e)&&!0===F(t)}(e,this.props)&&this.getModeler()._emit("overviewOpen"),function(e,t){return t.layout?.grid?.visible!==e.layout?.grid?.visible}(e,this.props)){const e=this.getModeler().getActiveViewer();e.get("grid",!1)?.toggle(!1!==this.props.layout?.grid?.visible)}(function(e,t){return e.cachedState!==t.cachedState})(e,this.props)&&this.handleChanged()}ifMounted=e=>(...t)=>{this._isMounted&&e(...t)};listen(e){const t=this.getModeler();["saveXML.done","attach","view.selectionChanged","view.directEditingChanged","propertiesPanel.focusin","propertiesPanel.focusout"].forEach((i=>{t[e](i,this.handleChanged)})),t[e]("views.changed",this.viewsChanged),t[e]("view.contentChanged",this.viewContentChanged),t[e]("error",this.handleError)}isDirty=()=>{let{dirty:e,modeler:t,stackIdx:i}=this.getCached();return e||t.getStackIdx()!==i};viewContentChanged=()=>{this.handleChanged()};handleImport(e,t){const{activeSheet:i,onImport:r,xml:o}=this.props,n=this.getModeler(),s=n.getStackIdx();let a=null;if(!e)try{a=this.engineProfile.get()}catch(t){e=t}if(r(e,t),e)this.setCached({dirty:!1,engineProfile:a,lastXML:null});else{if(this.setCached({dirty:!1,engineProfile:a,lastXML:o,stackIdx:s}),this.setState({importing:!1}),i&&i.element)return this.open(i.element);const e=n._getInitialView(n._views);this.open(e.element)}}viewsChanged=({activeView:e})=>{const{activeSheet:t,onSheetsChanged:i}=this.props,{dirty:r,stackIdx:o}=this.getCached(),n=this.getCached().activeView,s=this.getModeler(),{element:a}=e,d={...e,id:a.id,name:"Diagram",order:-1};t.id!==d.id&&i([d],d);const c=s.getActiveViewer();let l;!c||n&&n.element===e.element||(l=c.get("propertiesPanel",!1),l&&l.attachTo(this.propertiesPanelRef.current)),c&&c.get("grid",!1)?.toggle(!1!==this.props.layout?.grid?.visible),"drd"===e.type?s.detachOverview():n&&"drd"===n.type&&(s.attachOverviewTo(this.overviewRef.current),F(this.props)&&s._emit("overviewOpen")),this.setCached({activeView:e,dirty:r||s.getStackIdx()!==o}),this.handleChanged()};undo=()=>{this.getModeler().getActiveViewer().get("commandStack").undo()};redo=()=>{this.getModeler().getActiveViewer().get("commandStack").redo()};handleChanged=()=>{const e=this.getModeler(),{onChanged:t}=this.props,i=e.getActiveViewer(),r=e.getActiveView();if(!i)return;const n=this.isDirty(),s=i.get("commandStack"),a=!!i.get("propertiesPanel",!1),d=!!i.get("grid",!1),c="drd"!==r.type,l=(0,b.v)(),h={close:!0,copy:!1,cut:!1,dirty:n,exportAs:"saveSVG"in i&&T,inputActive:l,overview:c,paste:!1,grid:d,platform:"platform",propertiesPanel:a,redo:s.canRedo(),save:!0,undo:s.canUndo()},g=i.get("selection",!1),v=g&&g.get()?g.get().length:0;let p;if("drd"===r.type){const e=i.get("canvas").isFocused();(0,o.kp)(h,{align:v>1,canvasFocused:e,defaultCopyCutPaste:!e,defaultUndoRedo:!e,distribute:v>2,editLabel:e&&!!v,find:e,lassoTool:e,moveCanvas:e,moveSelection:e&&!!v,removeSelected:!e||!!v,selectAll:e||l,zoom:!0}),p=(0,V.D6)(h)}else"decisionTable"===r.type?((0,o.kp)(h,{defaultCopyCutPaste:!0,defaultUndoRedo:!1,hasSelection:i.get("selection").hasSelection(),removeSelected:l,selectAll:l}),h.dmnRuleEditing=!!v,h.dmnClauseEditing=!!v,p=(0,V.zm)(h)):"literalExpression"===r.type?((0,o.kp)(h,{defaultCopyCutPaste:!0,defaultUndoRedo:!0,removeSelected:!0,selectAll:!0}),h.inputActive=!0,p=(0,V.kb)(h)):"boxedExpression"===r.type&&((0,o.kp)(h,{defaultCopyCutPaste:!0,defaultUndoRedo:!0,removeSelected:!0,selectAll:!0}),h.inputActive=!0,p=(0,V.XG)(h));h.activeEditor=r.type,h.dmn=!0,h.editable=!0,h.elementsSelected=!!v,h.inactiveInput=!l;const u=(0,O.A)(h);"function"==typeof t&&t({...h,editMenu:p,windowMenu:u});const m=this.engineProfile.get();this.engineProfile.setCached(m),this.setState(h)};handleError=e=>{const{error:t}=e,{onError:i}=this.props;i(t)};handleDistributeElements=e=>{this.triggerAction("distributeElements",{type:e})};handleAlignElements=e=>{this.triggerAction("alignElements",{type:e})};checkImport(e){if(!this.isImportNeeded(e))return this.checkSheetChange(e);const{xml:t}=this.props;this.importXML(t)}isImportNeeded(e){const{importing:t}=this.state;if(t)return!1;const{xml:i}=this.props;if(e&&e.xml===i)return!1;const{lastXML:r}=this.getCached();return i!==r}async importXML(e){const{modeler:t}=this.getCached();this.setState({importing:!0});const i=await this.handleMigration(e);if(i)return t.importXML(i).then(this.ifMounted((({warnings:e})=>this.handleImport(null,e))),this.ifMounted((e=>this.handleImport(e,e.warnings))));this.props.onAction("close-tab")}handleMigration=async e=>{if(!(0,L.e)(e,"http://www.omg.org/spec/DMN/20151101/dmn.xsd")&&!(0,L.e)(e,"http://www.omg.org/spec/DMN/20180521/MODEL/"))return e;if(!1!==await this.props.getConfig(U)&&!await this.shouldMigrate())return null;const{onContentUpdated:t}=this.props;let i;try{i=await(0,R.V)(e)}catch(e){return this.handleError({error:e}),null}return t(i),i};async shouldMigrate(){const{onAction:e}=this.props,{button:t,checkboxChecked:i}=await e("show-dialog",{type:"warning",title:"Deprecated DMN 1.1 Diagram Detected",buttons:[{id:"cancel",label:"Cancel"},{id:"yes",label:"Yes"}],defaultId:1,message:"Would you like to migrate your diagram to DMN 1.3?",detail:["Only DMN 1.3 diagrams can be opened with Camunda Modeler v4.0.0 or later."].join("\n"),checkboxChecked:!0,checkboxLabel:"Do not ask again."});return"yes"===t&&i&&this.props.setConfig(U,!1),"yes"===t}checkSheetChange(e){this.shouldOpenActiveSheet(e)&&this.open(this.props.activeSheet.element)}shouldOpenActiveSheet(e){return!e||e.activeSheet.id!==this.props.activeSheet.id}open=e=>{const{activeView:t,dirty:i,modeler:r,stackIdx:o}=this.getCached();let n=r.getView(e);n||(n=r.getViews().find((t=>t.element.id===e.id))),n&&(t&&t.element===e||(this.setCached({dirty:i||this.getModeler().getStackIdx()!==o}),r.open(n),this.setCached({stackIdx:this.getModeler().getStackIdx()})))};triggerAction=(e,t)=>{const{layout:i={},onLayoutChanged:r}=this.props,{propertiesPanel:o={}}=i,n=this.getModeler();return"resize"===e?this.handleResize():"toggleGrid"===e?r({grid:{visible:!1===i.grid?.visible}}):"toggleProperties"===e?r({propertiesPanel:{...g.zR,...o,open:!o.open}}):("zoomIn"===e&&(e="stepZoom",t={value:1}),"zoomOut"===e&&(e="stepZoom",t={value:-1}),"resetZoom"===e&&(e="zoom",t={value:1}),"zoomFit"===e&&(e="zoom",t={value:"fit-viewport"}),"toggleOverview"===e?this.toggleOverview():"resetOverview"===e?this.resetOverview():n.getActiveViewer().get("editorActions").trigger(e,t))};getModeler(){const{modeler:e}=this.getCached();return e}handleResize=()=>{const{modeler:e}=this.getCached(),t=e.getActiveView();if("drd"!==(t&&t.type))return;const i=e.getActiveViewer(),r=i.get("canvas"),o=i.get("eventBus");r.resized(),o.fire("propertiesPanel.resized")};async getXML(){const{lastXML:e,modeler:t}=this.getCached();if(!this.isDirty())return e||this.props.xml;try{const{xml:e}=await t.saveXML({format:!0}),i=t.getStackIdx();return this.setCached({dirty:!1,lastXML:e,stackIdx:i}),e}catch(e){return this.handleError({error:e}),Promise.reject(e)}}async exportAs(e){let t;try{t=await this.exportSVG()}catch(e){return this.handleError({error:e}),Promise.reject(e)}return"svg"===e?t:(0,D.A)(e,t)}async exportSVG(){const e=this.getModeler().getActiveViewer();if(!e.saveSVG)return Promise.reject(new Error("SVG export not supported in current view"));try{const{svg:t}=await e.saveSVG();return t}catch(e){return Promise.reject(e)}}handleEditDrdClick=()=>{const e=this.getModeler(),t=e._views.find((({type:e})=>"drd"===e));t&&e.open(t)};toggleOverview=()=>{const{layout:e,onLayoutChanged:t}=this.props,i=e.dmnOverview||h.zR;t({dmnOverview:{...i,open:!i.open}})};resetOverview(){const{onLayoutChanged:e}=this.props;e({dmnOverview:{...h.zR}})}render(){const e=this.engineProfile.getCached(),{layout:t,onLayoutChanged:i}=this.props,o=this.getModeler().getDefinitions(),{importing:n}=this.state,d=this.getModeler(),c=d.getActiveView(),l=c&&"drd"===c.type,v=d.getActiveViewer(),p=F(this.props),u=!n&&v&&!!v.get("propertiesPanel",!1);return r.createElement("div",{className:_.Z},r.createElement(a.aH,{hidden:o&&!n}),!l&&r.createElement("div",{className:"top"},r.createElement("button",{id:"button-edit-drd",className:"button",onClick:this.handleEditDrdClick},"Edit DRD"),r.createElement("button",{id:"button-toggle-overview",className:"button",onClick:this.toggleOverview},p?"Close":"Open"," overview")),r.createElement("div",{className:"bottom"},!l&&r.createElement(h.Ay,{className:"overview",layout:t,ref:this.overviewRef,onLayoutChanged:i}),r.createElement("div",{className:s()("diagram",{drd:l}),ref:this.ref}),u&&r.createElement(g.Ay,{ref:this.propertiesPanelRef,layout:t,onLayoutChanged:i})),e&&r.createElement(z.Si,{engineProfile:e,onChange:e=>this.engineProfile.set(e)}))}static createCachedState(e){const{name:t,version:i}=I.A,{getPlugins:r,onAction:n,onError:s,settings:a}=e,{options:d,warnings:l}=(0,c.A)(r,{exporter:{name:t,version:i},settings:a},(e=>{n("emit-event",{type:"dmn.modeler.configure",payload:{middlewares:e}})}),"platform");l.length&&(0,o.Tn)(s)&&s("Problem(s) configuring DMN editor: \n\t"+l.map((e=>e.message)).join("\n\t")+"\n");const h=new E({...d,position:"absolute",keyboard:{bind:!1}}),g=h.getStackIdx();return n("emit-event",{type:"dmn.modeler.created",payload:{modeler:h}}),{__destroy:()=>{h.destroy()},dirty:!1,lastXML:null,modeler:h,stackIdx:g}}}const B=(0,l.rx)((0,l.cP)(G));function F(e){const t=(e.layout||{}).dmnOverview;return!t||t.open}var Z=i(53620);const W=(0,i(32528).a)("DmnTab",[{type:"dmn",editor:B,defaultName:"Diagram (Camunda Platform)"},{type:"xml",editor:Z.A,isFallback:!0,defaultName:"XML"}])}}]);
//# sourceMappingURL=7001.js.map